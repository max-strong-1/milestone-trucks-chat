(function(hs){typeof define=="function"&&define.amd?define(hs):hs()})((function(){"use strict";function hs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Ac={exports:{}},ms={};var bf;function Ry(){if(bf)return ms;bf=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function i(a,o,l){var u=null;if(l!==void 0&&(u=""+l),o.key!==void 0&&(u=""+o.key),"key"in o){l={};for(var d in o)d!=="key"&&(l[d]=o[d])}else l=o;return o=l.ref,{$$typeof:r,type:a,key:u,ref:o!==void 0?o:null,props:l}}return ms.Fragment=t,ms.jsx=i,ms.jsxs=i,ms}var Sf;function Oy(){return Sf||(Sf=1,Ac.exports=Ry()),Ac.exports}var kn=Oy(),Dc={exports:{}},he={};var Tf;function Ay(){if(Tf)return he;Tf=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),u=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),y=Symbol.for("react.activity"),S=Symbol.iterator;function C(_){return _===null||typeof _!="object"?null:(_=S&&_[S]||_["@@iterator"],typeof _=="function"?_:null)}var O={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,I={};function L(_,q,ee){this.props=_,this.context=q,this.refs=I,this.updater=ee||O}L.prototype.isReactComponent={},L.prototype.setState=function(_,q){if(typeof _!="object"&&typeof _!="function"&&_!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,_,q,"setState")},L.prototype.forceUpdate=function(_){this.updater.enqueueForceUpdate(this,_,"forceUpdate")};function X(){}X.prototype=L.prototype;function K(_,q,ee){this.props=_,this.context=q,this.refs=I,this.updater=ee||O}var D=K.prototype=new X;D.constructor=K,A(D,L.prototype),D.isPureReactComponent=!0;var x=Array.isArray;function F(){}var Y={H:null,A:null,T:null,S:null},te=Object.prototype.hasOwnProperty;function ie(_,q,ee){var re=ee.ref;return{$$typeof:r,type:_,key:q,ref:re!==void 0?re:null,props:ee}}function ne(_,q){return ie(_.type,q,_.props)}function ae(_){return typeof _=="object"&&_!==null&&_.$$typeof===r}function de(_){var q={"=":"=0",":":"=2"};return"$"+_.replace(/[=:]/g,function(ee){return q[ee]})}var Qe=/\/+/g;function mt(_,q){return typeof _=="object"&&_!==null&&_.key!=null?de(""+_.key):q.toString(36)}function bt(_){switch(_.status){case"fulfilled":return _.value;case"rejected":throw _.reason;default:switch(typeof _.status=="string"?_.then(F,F):(_.status="pending",_.then(function(q){_.status==="pending"&&(_.status="fulfilled",_.value=q)},function(q){_.status==="pending"&&(_.status="rejected",_.reason=q)})),_.status){case"fulfilled":return _.value;case"rejected":throw _.reason}}throw _}function j(_,q,ee,re,fe){var ve=typeof _;(ve==="undefined"||ve==="boolean")&&(_=null);var Ue=!1;if(_===null)Ue=!0;else switch(ve){case"bigint":case"string":case"number":Ue=!0;break;case"object":switch(_.$$typeof){case r:case t:Ue=!0;break;case g:return Ue=_._init,j(Ue(_._payload),q,ee,re,fe)}}if(Ue)return fe=fe(_),Ue=re===""?"."+mt(_,0):re,x(fe)?(ee="",Ue!=null&&(ee=Ue.replace(Qe,"$&/")+"/"),j(fe,q,ee,"",function(Ps){return Ps})):fe!=null&&(ae(fe)&&(fe=ne(fe,ee+(fe.key==null||_&&_.key===fe.key?"":(""+fe.key).replace(Qe,"$&/")+"/")+Ue)),q.push(fe)),1;Ue=0;var Mt=re===""?".":re+":";if(x(_))for(var tt=0;tt<_.length;tt++)re=_[tt],ve=Mt+mt(re,tt),Ue+=j(re,q,ee,ve,fe);else if(tt=C(_),typeof tt=="function")for(_=tt.call(_),tt=0;!(re=_.next()).done;)re=re.value,ve=Mt+mt(re,tt++),Ue+=j(re,q,ee,ve,fe);else if(ve==="object"){if(typeof _.then=="function")return j(bt(_),q,ee,re,fe);throw q=String(_),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.")}return Ue}function $(_,q,ee){if(_==null)return _;var re=[],fe=0;return j(_,re,"","",function(ve){return q.call(ee,ve,fe++)}),re}function le(_){if(_._status===-1){var q=_._result;q=q(),q.then(function(ee){(_._status===0||_._status===-1)&&(_._status=1,_._result=ee)},function(ee){(_._status===0||_._status===-1)&&(_._status=2,_._result=ee)}),_._status===-1&&(_._status=0,_._result=q)}if(_._status===1)return _._result.default;throw _._result}var Ae=typeof reportError=="function"?reportError:function(_){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof _=="object"&&_!==null&&typeof _.message=="string"?String(_.message):String(_),error:_});if(!window.dispatchEvent(q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",_);return}console.error(_)},xe={map:$,forEach:function(_,q,ee){$(_,function(){q.apply(this,arguments)},ee)},count:function(_){var q=0;return $(_,function(){q++}),q},toArray:function(_){return $(_,function(q){return q})||[]},only:function(_){if(!ae(_))throw Error("React.Children.only expected to receive a single React element child.");return _}};return he.Activity=y,he.Children=xe,he.Component=L,he.Fragment=i,he.Profiler=o,he.PureComponent=K,he.StrictMode=a,he.Suspense=p,he.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Y,he.__COMPILER_RUNTIME={__proto__:null,c:function(_){return Y.H.useMemoCache(_)}},he.cache=function(_){return function(){return _.apply(null,arguments)}},he.cacheSignal=function(){return null},he.cloneElement=function(_,q,ee){if(_==null)throw Error("The argument must be a React element, but you passed "+_+".");var re=A({},_.props),fe=_.key;if(q!=null)for(ve in q.key!==void 0&&(fe=""+q.key),q)!te.call(q,ve)||ve==="key"||ve==="__self"||ve==="__source"||ve==="ref"&&q.ref===void 0||(re[ve]=q[ve]);var ve=arguments.length-2;if(ve===1)re.children=ee;else if(1<ve){for(var Ue=Array(ve),Mt=0;Mt<ve;Mt++)Ue[Mt]=arguments[Mt+2];re.children=Ue}return ie(_.type,fe,re)},he.createContext=function(_){return _={$$typeof:u,_currentValue:_,_currentValue2:_,_threadCount:0,Provider:null,Consumer:null},_.Provider=_,_.Consumer={$$typeof:l,_context:_},_},he.createElement=function(_,q,ee){var re,fe={},ve=null;if(q!=null)for(re in q.key!==void 0&&(ve=""+q.key),q)te.call(q,re)&&re!=="key"&&re!=="__self"&&re!=="__source"&&(fe[re]=q[re]);var Ue=arguments.length-2;if(Ue===1)fe.children=ee;else if(1<Ue){for(var Mt=Array(Ue),tt=0;tt<Ue;tt++)Mt[tt]=arguments[tt+2];fe.children=Mt}if(_&&_.defaultProps)for(re in Ue=_.defaultProps,Ue)fe[re]===void 0&&(fe[re]=Ue[re]);return ie(_,ve,fe)},he.createRef=function(){return{current:null}},he.forwardRef=function(_){return{$$typeof:d,render:_}},he.isValidElement=ae,he.lazy=function(_){return{$$typeof:g,_payload:{_status:-1,_result:_},_init:le}},he.memo=function(_,q){return{$$typeof:m,type:_,compare:q===void 0?null:q}},he.startTransition=function(_){var q=Y.T,ee={};Y.T=ee;try{var re=_(),fe=Y.S;fe!==null&&fe(ee,re),typeof re=="object"&&re!==null&&typeof re.then=="function"&&re.then(F,Ae)}catch(ve){Ae(ve)}finally{q!==null&&ee.types!==null&&(q.types=ee.types),Y.T=q}},he.unstable_useCacheRefresh=function(){return Y.H.useCacheRefresh()},he.use=function(_){return Y.H.use(_)},he.useActionState=function(_,q,ee){return Y.H.useActionState(_,q,ee)},he.useCallback=function(_,q){return Y.H.useCallback(_,q)},he.useContext=function(_){return Y.H.useContext(_)},he.useDebugValue=function(){},he.useDeferredValue=function(_,q){return Y.H.useDeferredValue(_,q)},he.useEffect=function(_,q){return Y.H.useEffect(_,q)},he.useEffectEvent=function(_){return Y.H.useEffectEvent(_)},he.useId=function(){return Y.H.useId()},he.useImperativeHandle=function(_,q,ee){return Y.H.useImperativeHandle(_,q,ee)},he.useInsertionEffect=function(_,q){return Y.H.useInsertionEffect(_,q)},he.useLayoutEffect=function(_,q){return Y.H.useLayoutEffect(_,q)},he.useMemo=function(_,q){return Y.H.useMemo(_,q)},he.useOptimistic=function(_,q){return Y.H.useOptimistic(_,q)},he.useReducer=function(_,q,ee){return Y.H.useReducer(_,q,ee)},he.useRef=function(_){return Y.H.useRef(_)},he.useState=function(_){return Y.H.useState(_)},he.useSyncExternalStore=function(_,q,ee){return Y.H.useSyncExternalStore(_,q,ee)},he.useTransition=function(){return Y.H.useTransition()},he.version="19.2.0",he}var Cf;function Mc(){return Cf||(Cf=1,Dc.exports=Ay()),Dc.exports}var ma=Mc();const Dy=hs(ma);var wc={exports:{}},ps={},Nc={exports:{}},xc={};var kf;function My(){return kf||(kf=1,(function(r){function t(j,$){var le=j.length;j.push($);e:for(;0<le;){var Ae=le-1>>>1,xe=j[Ae];if(0<o(xe,$))j[Ae]=$,j[le]=xe,le=Ae;else break e}}function i(j){return j.length===0?null:j[0]}function a(j){if(j.length===0)return null;var $=j[0],le=j.pop();if(le!==$){j[0]=le;e:for(var Ae=0,xe=j.length,_=xe>>>1;Ae<_;){var q=2*(Ae+1)-1,ee=j[q],re=q+1,fe=j[re];if(0>o(ee,le))re<xe&&0>o(fe,ee)?(j[Ae]=fe,j[re]=le,Ae=re):(j[Ae]=ee,j[q]=le,Ae=q);else if(re<xe&&0>o(fe,le))j[Ae]=fe,j[re]=le,Ae=re;else break e}}return $}function o(j,$){var le=j.sortIndex-$.sortIndex;return le!==0?le:j.id-$.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;r.unstable_now=function(){return l.now()}}else{var u=Date,d=u.now();r.unstable_now=function(){return u.now()-d}}var p=[],m=[],g=1,y=null,S=3,C=!1,O=!1,A=!1,I=!1,L=typeof setTimeout=="function"?setTimeout:null,X=typeof clearTimeout=="function"?clearTimeout:null,K=typeof setImmediate<"u"?setImmediate:null;function D(j){for(var $=i(m);$!==null;){if($.callback===null)a(m);else if($.startTime<=j)a(m),$.sortIndex=$.expirationTime,t(p,$);else break;$=i(m)}}function x(j){if(A=!1,D(j),!O)if(i(p)!==null)O=!0,F||(F=!0,de());else{var $=i(m);$!==null&&bt(x,$.startTime-j)}}var F=!1,Y=-1,te=5,ie=-1;function ne(){return I?!0:!(r.unstable_now()-ie<te)}function ae(){if(I=!1,F){var j=r.unstable_now();ie=j;var $=!0;try{e:{O=!1,A&&(A=!1,X(Y),Y=-1),C=!0;var le=S;try{t:{for(D(j),y=i(p);y!==null&&!(y.expirationTime>j&&ne());){var Ae=y.callback;if(typeof Ae=="function"){y.callback=null,S=y.priorityLevel;var xe=Ae(y.expirationTime<=j);if(j=r.unstable_now(),typeof xe=="function"){y.callback=xe,D(j),$=!0;break t}y===i(p)&&a(p),D(j)}else a(p);y=i(p)}if(y!==null)$=!0;else{var _=i(m);_!==null&&bt(x,_.startTime-j),$=!1}}break e}finally{y=null,S=le,C=!1}$=void 0}}finally{$?de():F=!1}}}var de;if(typeof K=="function")de=function(){K(ae)};else if(typeof MessageChannel<"u"){var Qe=new MessageChannel,mt=Qe.port2;Qe.port1.onmessage=ae,de=function(){mt.postMessage(null)}}else de=function(){L(ae,0)};function bt(j,$){Y=L(function(){j(r.unstable_now())},$)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(j){j.callback=null},r.unstable_forceFrameRate=function(j){0>j||125<j?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):te=0<j?Math.floor(1e3/j):5},r.unstable_getCurrentPriorityLevel=function(){return S},r.unstable_next=function(j){switch(S){case 1:case 2:case 3:var $=3;break;default:$=S}var le=S;S=$;try{return j()}finally{S=le}},r.unstable_requestPaint=function(){I=!0},r.unstable_runWithPriority=function(j,$){switch(j){case 1:case 2:case 3:case 4:case 5:break;default:j=3}var le=S;S=j;try{return $()}finally{S=le}},r.unstable_scheduleCallback=function(j,$,le){var Ae=r.unstable_now();switch(typeof le=="object"&&le!==null?(le=le.delay,le=typeof le=="number"&&0<le?Ae+le:Ae):le=Ae,j){case 1:var xe=-1;break;case 2:xe=250;break;case 5:xe=1073741823;break;case 4:xe=1e4;break;default:xe=5e3}return xe=le+xe,j={id:g++,callback:$,priorityLevel:j,startTime:le,expirationTime:xe,sortIndex:-1},le>Ae?(j.sortIndex=le,t(m,j),i(p)===null&&j===i(m)&&(A?(X(Y),Y=-1):A=!0,bt(x,le-Ae))):(j.sortIndex=xe,t(p,j),O||C||(O=!0,F||(F=!0,de()))),j},r.unstable_shouldYield=ne,r.unstable_wrapCallback=function(j){var $=S;return function(){var le=S;S=$;try{return j.apply(this,arguments)}finally{S=le}}}})(xc)),xc}var Ef;function wy(){return Ef||(Ef=1,Nc.exports=My()),Nc.exports}var Pc={exports:{}},_t={};var _f;function Ny(){if(_f)return _t;_f=1;var r=Mc();function t(p){var m="https://react.dev/errors/"+p;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)m+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+p+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var a={d:{f:i,r:function(){throw Error(t(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},o=Symbol.for("react.portal");function l(p,m,g){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:y==null?null:""+y,children:p,containerInfo:m,implementation:g}}var u=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(p,m){if(p==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return _t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,_t.createPortal=function(p,m){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(t(299));return l(p,m,null,g)},_t.flushSync=function(p){var m=u.T,g=a.p;try{if(u.T=null,a.p=2,p)return p()}finally{u.T=m,a.p=g,a.d.f()}},_t.preconnect=function(p,m){typeof p=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,a.d.C(p,m))},_t.prefetchDNS=function(p){typeof p=="string"&&a.d.D(p)},_t.preinit=function(p,m){if(typeof p=="string"&&m&&typeof m.as=="string"){var g=m.as,y=d(g,m.crossOrigin),S=typeof m.integrity=="string"?m.integrity:void 0,C=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;g==="style"?a.d.S(p,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:y,integrity:S,fetchPriority:C}):g==="script"&&a.d.X(p,{crossOrigin:y,integrity:S,fetchPriority:C,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},_t.preinitModule=function(p,m){if(typeof p=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var g=d(m.as,m.crossOrigin);a.d.M(p,{crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&a.d.M(p)},_t.preload=function(p,m){if(typeof p=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var g=m.as,y=d(g,m.crossOrigin);a.d.L(p,g,{crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},_t.preloadModule=function(p,m){if(typeof p=="string")if(m){var g=d(m.as,m.crossOrigin);a.d.m(p,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else a.d.m(p)},_t.requestFormReset=function(p){a.d.r(p)},_t.unstable_batchedUpdates=function(p,m){return p(m)},_t.useFormState=function(p,m,g){return u.H.useFormState(p,m,g)},_t.useFormStatus=function(){return u.H.useHostTransitionStatus()},_t.version="19.2.0",_t}var Rf;function xy(){if(Rf)return Pc.exports;Rf=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),Pc.exports=Ny(),Pc.exports}var Of;function Py(){if(Of)return ps;Of=1;var r=wy(),t=Mc(),i=xy();function a(e){var n="https://react.dev/errors/"+e;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var s=2;s<arguments.length;s++)n+="&args[]="+encodeURIComponent(arguments[s])}return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function l(e){var n=e,s=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,(n.flags&4098)!==0&&(s=n.return),e=n.return;while(e)}return n.tag===3?s:null}function u(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function d(e){if(e.tag===31){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function p(e){if(l(e)!==e)throw Error(a(188))}function m(e){var n=e.alternate;if(!n){if(n=l(e),n===null)throw Error(a(188));return n!==e?null:e}for(var s=e,c=n;;){var f=s.return;if(f===null)break;var h=f.alternate;if(h===null){if(c=f.return,c!==null){s=c;continue}break}if(f.child===h.child){for(h=f.child;h;){if(h===s)return p(f),e;if(h===c)return p(f),n;h=h.sibling}throw Error(a(188))}if(s.return!==c.return)s=f,c=h;else{for(var v=!1,b=f.child;b;){if(b===s){v=!0,s=f,c=h;break}if(b===c){v=!0,c=f,s=h;break}b=b.sibling}if(!v){for(b=h.child;b;){if(b===s){v=!0,s=h,c=f;break}if(b===c){v=!0,c=h,s=f;break}b=b.sibling}if(!v)throw Error(a(189))}}if(s.alternate!==c)throw Error(a(190))}if(s.tag!==3)throw Error(a(188));return s.stateNode.current===s?e:n}function g(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e;for(e=e.child;e!==null;){if(n=g(e),n!==null)return n;e=e.sibling}return null}var y=Object.assign,S=Symbol.for("react.element"),C=Symbol.for("react.transitional.element"),O=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),I=Symbol.for("react.strict_mode"),L=Symbol.for("react.profiler"),X=Symbol.for("react.consumer"),K=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),x=Symbol.for("react.suspense"),F=Symbol.for("react.suspense_list"),Y=Symbol.for("react.memo"),te=Symbol.for("react.lazy"),ie=Symbol.for("react.activity"),ne=Symbol.for("react.memo_cache_sentinel"),ae=Symbol.iterator;function de(e){return e===null||typeof e!="object"?null:(e=ae&&e[ae]||e["@@iterator"],typeof e=="function"?e:null)}var Qe=Symbol.for("react.client.reference");function mt(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===Qe?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case A:return"Fragment";case L:return"Profiler";case I:return"StrictMode";case x:return"Suspense";case F:return"SuspenseList";case ie:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case O:return"Portal";case K:return e.displayName||"Context";case X:return(e._context.displayName||"Context")+".Consumer";case D:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Y:return n=e.displayName||null,n!==null?n:mt(e.type)||"Memo";case te:n=e._payload,e=e._init;try{return mt(e(n))}catch{}}return null}var bt=Array.isArray,j=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,le={pending:!1,data:null,method:null,action:null},Ae=[],xe=-1;function _(e){return{current:e}}function q(e){0>xe||(e.current=Ae[xe],Ae[xe]=null,xe--)}function ee(e,n){xe++,Ae[xe]=e.current,e.current=n}var re=_(null),fe=_(null),ve=_(null),Ue=_(null);function Mt(e,n){switch(ee(ve,n),ee(fe,e),ee(re,null),n.nodeType){case 9:case 11:e=(e=n.documentElement)&&(e=e.namespaceURI)?J0(e):0;break;default:if(e=n.tagName,n=n.namespaceURI)n=J0(n),e=X0(n,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}q(re),ee(re,e)}function tt(){q(re),q(fe),q(ve)}function Ps(e){e.memoizedState!==null&&ee(Ue,e);var n=re.current,s=X0(n,e.type);n!==s&&(ee(fe,e),ee(re,s))}function lo(e){fe.current===e&&(q(re),q(fe)),Ue.current===e&&(q(Ue),kr._currentValue=le)}var eu,_p;function Ji(e){if(eu===void 0)try{throw Error()}catch(s){var n=s.stack.trim().match(/\n( *(at )?)/);eu=n&&n[1]||"",_p=-1<s.stack.indexOf(`
    at`)?" (<anonymous>)":-1<s.stack.indexOf("@")?"@unknown:0:0":""}return`
`+eu+e+_p}var tu=!1;function nu(e,n){if(!e||tu)return"";tu=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(n){var V=function(){throw Error()};if(Object.defineProperty(V.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(V,[])}catch(U){var P=U}Reflect.construct(e,[],V)}else{try{V.call()}catch(U){P=U}e.call(V.prototype)}}else{try{throw Error()}catch(U){P=U}(V=e())&&typeof V.catch=="function"&&V.catch(function(){})}}catch(U){if(U&&P&&typeof U.stack=="string")return[U.stack,P.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var f=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");f&&f.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var h=c.DetermineComponentFrameRoot(),v=h[0],b=h[1];if(v&&b){var k=v.split(`
`),N=b.split(`
`);for(f=c=0;c<k.length&&!k[c].includes("DetermineComponentFrameRoot");)c++;for(;f<N.length&&!N[f].includes("DetermineComponentFrameRoot");)f++;if(c===k.length||f===N.length)for(c=k.length-1,f=N.length-1;1<=c&&0<=f&&k[c]!==N[f];)f--;for(;1<=c&&0<=f;c--,f--)if(k[c]!==N[f]){if(c!==1||f!==1)do if(c--,f--,0>f||k[c]!==N[f]){var B=`
`+k[c].replace(" at new "," at ");return e.displayName&&B.includes("<anonymous>")&&(B=B.replace("<anonymous>",e.displayName)),B}while(1<=c&&0<=f);break}}}finally{tu=!1,Error.prepareStackTrace=s}return(s=e?e.displayName||e.name:"")?Ji(s):""}function ck(e,n){switch(e.tag){case 26:case 27:case 5:return Ji(e.type);case 16:return Ji("Lazy");case 13:return e.child!==n&&n!==null?Ji("Suspense Fallback"):Ji("Suspense");case 19:return Ji("SuspenseList");case 0:case 15:return nu(e.type,!1);case 11:return nu(e.type.render,!1);case 1:return nu(e.type,!0);case 31:return Ji("Activity");default:return""}}function Rp(e){try{var n="",s=null;do n+=ck(e,s),s=e,e=e.return;while(e);return n}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}var iu=Object.prototype.hasOwnProperty,au=r.unstable_scheduleCallback,su=r.unstable_cancelCallback,lk=r.unstable_shouldYield,uk=r.unstable_requestPaint,Ft=r.unstable_now,dk=r.unstable_getCurrentPriorityLevel,Op=r.unstable_ImmediatePriority,Ap=r.unstable_UserBlockingPriority,uo=r.unstable_NormalPriority,fk=r.unstable_LowPriority,Dp=r.unstable_IdlePriority,hk=r.log,mk=r.unstable_setDisableYieldValue,Us=null,Ht=null;function yi(e){if(typeof hk=="function"&&mk(e),Ht&&typeof Ht.setStrictMode=="function")try{Ht.setStrictMode(Us,e)}catch{}}var Gt=Math.clz32?Math.clz32:vk,pk=Math.log,gk=Math.LN2;function vk(e){return e>>>=0,e===0?32:31-(pk(e)/gk|0)|0}var fo=256,ho=262144,mo=4194304;function Xi(e){var n=e&42;if(n!==0)return n;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function po(e,n,s){var c=e.pendingLanes;if(c===0)return 0;var f=0,h=e.suspendedLanes,v=e.pingedLanes;e=e.warmLanes;var b=c&134217727;return b!==0?(c=b&~h,c!==0?f=Xi(c):(v&=b,v!==0?f=Xi(v):s||(s=b&~e,s!==0&&(f=Xi(s))))):(b=c&~h,b!==0?f=Xi(b):v!==0?f=Xi(v):s||(s=c&~e,s!==0&&(f=Xi(s)))),f===0?0:n!==0&&n!==f&&(n&h)===0&&(h=f&-f,s=n&-n,h>=s||h===32&&(s&4194048)!==0)?n:f}function Ls(e,n){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&n)===0}function yk(e,n){switch(e){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Mp(){var e=mo;return mo<<=1,(mo&62914560)===0&&(mo=4194304),e}function ru(e){for(var n=[],s=0;31>s;s++)n.push(e);return n}function Is(e,n){e.pendingLanes|=n,n!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function bk(e,n,s,c,f,h){var v=e.pendingLanes;e.pendingLanes=s,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=s,e.entangledLanes&=s,e.errorRecoveryDisabledLanes&=s,e.shellSuspendCounter=0;var b=e.entanglements,k=e.expirationTimes,N=e.hiddenUpdates;for(s=v&~s;0<s;){var B=31-Gt(s),V=1<<B;b[B]=0,k[B]=-1;var P=N[B];if(P!==null)for(N[B]=null,B=0;B<P.length;B++){var U=P[B];U!==null&&(U.lane&=-536870913)}s&=~V}c!==0&&wp(e,c,0),h!==0&&f===0&&e.tag!==0&&(e.suspendedLanes|=h&~(v&~n))}function wp(e,n,s){e.pendingLanes|=n,e.suspendedLanes&=~n;var c=31-Gt(n);e.entangledLanes|=n,e.entanglements[c]=e.entanglements[c]|1073741824|s&261930}function Np(e,n){var s=e.entangledLanes|=n;for(e=e.entanglements;s;){var c=31-Gt(s),f=1<<c;f&n|e[c]&n&&(e[c]|=n),s&=~f}}function xp(e,n){var s=n&-n;return s=(s&42)!==0?1:ou(s),(s&(e.suspendedLanes|n))!==0?0:s}function ou(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function cu(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Pp(){var e=$.p;return e!==0?e:(e=window.event,e===void 0?32:by(e.type))}function Up(e,n){var s=$.p;try{return $.p=e,n()}finally{$.p=s}}var bi=Math.random().toString(36).slice(2),St="__reactFiber$"+bi,Ut="__reactProps$"+bi,Da="__reactContainer$"+bi,lu="__reactEvents$"+bi,Sk="__reactListeners$"+bi,Tk="__reactHandles$"+bi,Lp="__reactResources$"+bi,Bs="__reactMarker$"+bi;function uu(e){delete e[St],delete e[Ut],delete e[lu],delete e[Sk],delete e[Tk]}function Ma(e){var n=e[St];if(n)return n;for(var s=e.parentNode;s;){if(n=s[Da]||s[St]){if(s=n.alternate,n.child!==null||s!==null&&s.child!==null)for(e=iy(e);e!==null;){if(s=e[St])return s;e=iy(e)}return n}e=s,s=e.parentNode}return null}function wa(e){if(e=e[St]||e[Da]){var n=e.tag;if(n===5||n===6||n===13||n===31||n===26||n===27||n===3)return e}return null}function js(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e.stateNode;throw Error(a(33))}function Na(e){var n=e[Lp];return n||(n=e[Lp]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function pt(e){e[Bs]=!0}var Ip=new Set,Bp={};function Zi(e,n){xa(e,n),xa(e+"Capture",n)}function xa(e,n){for(Bp[e]=n,e=0;e<n.length;e++)Ip.add(n[e])}var Ck=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),jp={},zp={};function kk(e){return iu.call(zp,e)?!0:iu.call(jp,e)?!1:Ck.test(e)?zp[e]=!0:(jp[e]=!0,!1)}function go(e,n,s){if(kk(n))if(s===null)e.removeAttribute(n);else{switch(typeof s){case"undefined":case"function":case"symbol":e.removeAttribute(n);return;case"boolean":var c=n.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){e.removeAttribute(n);return}}e.setAttribute(n,""+s)}}function vo(e,n,s){if(s===null)e.removeAttribute(n);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(n);return}e.setAttribute(n,""+s)}}function Vn(e,n,s,c){if(c===null)e.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(s);return}e.setAttributeNS(n,s,""+c)}}function nn(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function qp(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function Ek(e,n,s){var c=Object.getOwnPropertyDescriptor(e.constructor.prototype,n);if(!e.hasOwnProperty(n)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var f=c.get,h=c.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return f.call(this)},set:function(v){s=""+v,h.call(this,v)}}),Object.defineProperty(e,n,{enumerable:c.enumerable}),{getValue:function(){return s},setValue:function(v){s=""+v},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function du(e){if(!e._valueTracker){var n=qp(e)?"checked":"value";e._valueTracker=Ek(e,n,""+e[n])}}function Vp(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var s=n.getValue(),c="";return e&&(c=qp(e)?e.checked?"true":"false":e.value),e=c,e!==s?(n.setValue(e),!0):!1}function yo(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var _k=/[\n"\\]/g;function an(e){return e.replace(_k,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function fu(e,n,s,c,f,h,v,b){e.name="",v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?e.type=v:e.removeAttribute("type"),n!=null?v==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+nn(n)):e.value!==""+nn(n)&&(e.value=""+nn(n)):v!=="submit"&&v!=="reset"||e.removeAttribute("value"),n!=null?hu(e,v,nn(n)):s!=null?hu(e,v,nn(s)):c!=null&&e.removeAttribute("value"),f==null&&h!=null&&(e.defaultChecked=!!h),f!=null&&(e.checked=f&&typeof f!="function"&&typeof f!="symbol"),b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?e.name=""+nn(b):e.removeAttribute("name")}function Fp(e,n,s,c,f,h,v,b){if(h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"&&(e.type=h),n!=null||s!=null){if(!(h!=="submit"&&h!=="reset"||n!=null)){du(e);return}s=s!=null?""+nn(s):"",n=n!=null?""+nn(n):s,b||n===e.value||(e.value=n),e.defaultValue=n}c=c??f,c=typeof c!="function"&&typeof c!="symbol"&&!!c,e.checked=b?e.checked:!!c,e.defaultChecked=!!c,v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(e.name=v),du(e)}function hu(e,n,s){n==="number"&&yo(e.ownerDocument)===e||e.defaultValue===""+s||(e.defaultValue=""+s)}function Pa(e,n,s,c){if(e=e.options,n){n={};for(var f=0;f<s.length;f++)n["$"+s[f]]=!0;for(s=0;s<e.length;s++)f=n.hasOwnProperty("$"+e[s].value),e[s].selected!==f&&(e[s].selected=f),f&&c&&(e[s].defaultSelected=!0)}else{for(s=""+nn(s),n=null,f=0;f<e.length;f++){if(e[f].value===s){e[f].selected=!0,c&&(e[f].defaultSelected=!0);return}n!==null||e[f].disabled||(n=e[f])}n!==null&&(n.selected=!0)}}function Hp(e,n,s){if(n!=null&&(n=""+nn(n),n!==e.value&&(e.value=n),s==null)){e.defaultValue!==n&&(e.defaultValue=n);return}e.defaultValue=s!=null?""+nn(s):""}function Gp(e,n,s,c){if(n==null){if(c!=null){if(s!=null)throw Error(a(92));if(bt(c)){if(1<c.length)throw Error(a(93));c=c[0]}s=c}s==null&&(s=""),n=s}s=nn(n),e.defaultValue=s,c=e.textContent,c===s&&c!==""&&c!==null&&(e.value=c),du(e)}function Ua(e,n){if(n){var s=e.firstChild;if(s&&s===e.lastChild&&s.nodeType===3){s.nodeValue=n;return}}e.textContent=n}var Rk=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Kp(e,n,s){var c=n.indexOf("--")===0;s==null||typeof s=="boolean"||s===""?c?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="":c?e.setProperty(n,s):typeof s!="number"||s===0||Rk.has(n)?n==="float"?e.cssFloat=s:e[n]=(""+s).trim():e[n]=s+"px"}function Yp(e,n,s){if(n!=null&&typeof n!="object")throw Error(a(62));if(e=e.style,s!=null){for(var c in s)!s.hasOwnProperty(c)||n!=null&&n.hasOwnProperty(c)||(c.indexOf("--")===0?e.setProperty(c,""):c==="float"?e.cssFloat="":e[c]="");for(var f in n)c=n[f],n.hasOwnProperty(f)&&s[f]!==c&&Kp(e,f,c)}else for(var h in n)n.hasOwnProperty(h)&&Kp(e,h,n[h])}function mu(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ok=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ak=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function bo(e){return Ak.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Fn(){}var pu=null;function gu(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var La=null,Ia=null;function Qp(e){var n=wa(e);if(n&&(e=n.stateNode)){var s=e[Ut]||null;e:switch(e=n.stateNode,n.type){case"input":if(fu(e,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name),n=s.name,s.type==="radio"&&n!=null){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll('input[name="'+an(""+n)+'"][type="radio"]'),n=0;n<s.length;n++){var c=s[n];if(c!==e&&c.form===e.form){var f=c[Ut]||null;if(!f)throw Error(a(90));fu(c,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name)}}for(n=0;n<s.length;n++)c=s[n],c.form===e.form&&Vp(c)}break e;case"textarea":Hp(e,s.value,s.defaultValue);break e;case"select":n=s.value,n!=null&&Pa(e,!!s.multiple,n,!1)}}}var vu=!1;function Jp(e,n,s){if(vu)return e(n,s);vu=!0;try{var c=e(n);return c}finally{if(vu=!1,(La!==null||Ia!==null)&&(rc(),La&&(n=La,e=Ia,Ia=La=null,Qp(n),e)))for(n=0;n<e.length;n++)Qp(e[n])}}function zs(e,n){var s=e.stateNode;if(s===null)return null;var c=s[Ut]||null;if(c===null)return null;s=c[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(e=e.type,c=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!c;break e;default:e=!1}if(e)return null;if(s&&typeof s!="function")throw Error(a(231,n,typeof s));return s}var Hn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),yu=!1;if(Hn)try{var qs={};Object.defineProperty(qs,"passive",{get:function(){yu=!0}}),window.addEventListener("test",qs,qs),window.removeEventListener("test",qs,qs)}catch{yu=!1}var Si=null,bu=null,So=null;function Xp(){if(So)return So;var e,n=bu,s=n.length,c,f="value"in Si?Si.value:Si.textContent,h=f.length;for(e=0;e<s&&n[e]===f[e];e++);var v=s-e;for(c=1;c<=v&&n[s-c]===f[h-c];c++);return So=f.slice(e,1<c?1-c:void 0)}function To(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function Co(){return!0}function Zp(){return!1}function Lt(e){function n(s,c,f,h,v){this._reactName=s,this._targetInst=f,this.type=c,this.nativeEvent=h,this.target=v,this.currentTarget=null;for(var b in e)e.hasOwnProperty(b)&&(s=e[b],this[b]=s?s(h):h[b]);return this.isDefaultPrevented=(h.defaultPrevented!=null?h.defaultPrevented:h.returnValue===!1)?Co:Zp,this.isPropagationStopped=Zp,this}return y(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=Co)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=Co)},persist:function(){},isPersistent:Co}),n}var Wi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ko=Lt(Wi),Vs=y({},Wi,{view:0,detail:0}),Dk=Lt(Vs),Su,Tu,Fs,Eo=y({},Vs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ku,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Fs&&(Fs&&e.type==="mousemove"?(Su=e.screenX-Fs.screenX,Tu=e.screenY-Fs.screenY):Tu=Su=0,Fs=e),Su)},movementY:function(e){return"movementY"in e?e.movementY:Tu}}),Wp=Lt(Eo),Mk=y({},Eo,{dataTransfer:0}),wk=Lt(Mk),Nk=y({},Vs,{relatedTarget:0}),Cu=Lt(Nk),xk=y({},Wi,{animationName:0,elapsedTime:0,pseudoElement:0}),Pk=Lt(xk),Uk=y({},Wi,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Lk=Lt(Uk),Ik=y({},Wi,{data:0}),$p=Lt(Ik),Bk={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},jk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zk={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function qk(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=zk[e])?!!n[e]:!1}function ku(){return qk}var Vk=y({},Vs,{key:function(e){if(e.key){var n=Bk[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=To(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?jk[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ku,charCode:function(e){return e.type==="keypress"?To(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?To(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Fk=Lt(Vk),Hk=y({},Eo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),eg=Lt(Hk),Gk=y({},Vs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ku}),Kk=Lt(Gk),Yk=y({},Wi,{propertyName:0,elapsedTime:0,pseudoElement:0}),Qk=Lt(Yk),Jk=y({},Eo,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Xk=Lt(Jk),Zk=y({},Wi,{newState:0,oldState:0}),Wk=Lt(Zk),$k=[9,13,27,32],Eu=Hn&&"CompositionEvent"in window,Hs=null;Hn&&"documentMode"in document&&(Hs=document.documentMode);var eE=Hn&&"TextEvent"in window&&!Hs,tg=Hn&&(!Eu||Hs&&8<Hs&&11>=Hs),ng=" ",ig=!1;function ag(e,n){switch(e){case"keyup":return $k.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sg(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Ba=!1;function tE(e,n){switch(e){case"compositionend":return sg(n);case"keypress":return n.which!==32?null:(ig=!0,ng);case"textInput":return e=n.data,e===ng&&ig?null:e;default:return null}}function nE(e,n){if(Ba)return e==="compositionend"||!Eu&&ag(e,n)?(e=Xp(),So=bu=Si=null,Ba=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return tg&&n.locale!=="ko"?null:n.data;default:return null}}var iE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function rg(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!iE[e.type]:n==="textarea"}function og(e,n,s,c){La?Ia?Ia.push(c):Ia=[c]:La=c,n=hc(n,"onChange"),0<n.length&&(s=new ko("onChange","change",null,s,c),e.push({event:s,listeners:n}))}var Gs=null,Ks=null;function aE(e){F0(e,0)}function _o(e){var n=js(e);if(Vp(n))return e}function cg(e,n){if(e==="change")return n}var lg=!1;if(Hn){var _u;if(Hn){var Ru="oninput"in document;if(!Ru){var ug=document.createElement("div");ug.setAttribute("oninput","return;"),Ru=typeof ug.oninput=="function"}_u=Ru}else _u=!1;lg=_u&&(!document.documentMode||9<document.documentMode)}function dg(){Gs&&(Gs.detachEvent("onpropertychange",fg),Ks=Gs=null)}function fg(e){if(e.propertyName==="value"&&_o(Ks)){var n=[];og(n,Ks,e,gu(e)),Jp(aE,n)}}function sE(e,n,s){e==="focusin"?(dg(),Gs=n,Ks=s,Gs.attachEvent("onpropertychange",fg)):e==="focusout"&&dg()}function rE(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return _o(Ks)}function oE(e,n){if(e==="click")return _o(n)}function cE(e,n){if(e==="input"||e==="change")return _o(n)}function lE(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var Kt=typeof Object.is=="function"?Object.is:lE;function Ys(e,n){if(Kt(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var s=Object.keys(e),c=Object.keys(n);if(s.length!==c.length)return!1;for(c=0;c<s.length;c++){var f=s[c];if(!iu.call(n,f)||!Kt(e[f],n[f]))return!1}return!0}function hg(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function mg(e,n){var s=hg(e);e=0;for(var c;s;){if(s.nodeType===3){if(c=e+s.textContent.length,e<=n&&c>=n)return{node:s,offset:n-e};e=c}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=hg(s)}}function pg(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?pg(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function gg(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var n=yo(e.document);n instanceof e.HTMLIFrameElement;){try{var s=typeof n.contentWindow.location.href=="string"}catch{s=!1}if(s)e=n.contentWindow;else break;n=yo(e.document)}return n}function Ou(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}var uE=Hn&&"documentMode"in document&&11>=document.documentMode,ja=null,Au=null,Qs=null,Du=!1;function vg(e,n,s){var c=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;Du||ja==null||ja!==yo(c)||(c=ja,"selectionStart"in c&&Ou(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Qs&&Ys(Qs,c)||(Qs=c,c=hc(Au,"onSelect"),0<c.length&&(n=new ko("onSelect","select",null,n,s),e.push({event:n,listeners:c}),n.target=ja)))}function $i(e,n){var s={};return s[e.toLowerCase()]=n.toLowerCase(),s["Webkit"+e]="webkit"+n,s["Moz"+e]="moz"+n,s}var za={animationend:$i("Animation","AnimationEnd"),animationiteration:$i("Animation","AnimationIteration"),animationstart:$i("Animation","AnimationStart"),transitionrun:$i("Transition","TransitionRun"),transitionstart:$i("Transition","TransitionStart"),transitioncancel:$i("Transition","TransitionCancel"),transitionend:$i("Transition","TransitionEnd")},Mu={},yg={};Hn&&(yg=document.createElement("div").style,"AnimationEvent"in window||(delete za.animationend.animation,delete za.animationiteration.animation,delete za.animationstart.animation),"TransitionEvent"in window||delete za.transitionend.transition);function ea(e){if(Mu[e])return Mu[e];if(!za[e])return e;var n=za[e],s;for(s in n)if(n.hasOwnProperty(s)&&s in yg)return Mu[e]=n[s];return e}var bg=ea("animationend"),Sg=ea("animationiteration"),Tg=ea("animationstart"),dE=ea("transitionrun"),fE=ea("transitionstart"),hE=ea("transitioncancel"),Cg=ea("transitionend"),kg=new Map,wu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");wu.push("scrollEnd");function Sn(e,n){kg.set(e,n),Zi(n,[e])}var Ro=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},sn=[],qa=0,Nu=0;function Oo(){for(var e=qa,n=Nu=qa=0;n<e;){var s=sn[n];sn[n++]=null;var c=sn[n];sn[n++]=null;var f=sn[n];sn[n++]=null;var h=sn[n];if(sn[n++]=null,c!==null&&f!==null){var v=c.pending;v===null?f.next=f:(f.next=v.next,v.next=f),c.pending=f}h!==0&&Eg(s,f,h)}}function Ao(e,n,s,c){sn[qa++]=e,sn[qa++]=n,sn[qa++]=s,sn[qa++]=c,Nu|=c,e.lanes|=c,e=e.alternate,e!==null&&(e.lanes|=c)}function xu(e,n,s,c){return Ao(e,n,s,c),Do(e)}function ta(e,n){return Ao(e,null,null,n),Do(e)}function Eg(e,n,s){e.lanes|=s;var c=e.alternate;c!==null&&(c.lanes|=s);for(var f=!1,h=e.return;h!==null;)h.childLanes|=s,c=h.alternate,c!==null&&(c.childLanes|=s),h.tag===22&&(e=h.stateNode,e===null||e._visibility&1||(f=!0)),e=h,h=h.return;return e.tag===3?(h=e.stateNode,f&&n!==null&&(f=31-Gt(s),e=h.hiddenUpdates,c=e[f],c===null?e[f]=[n]:c.push(n),n.lane=s|536870912),h):null}function Do(e){if(50<gr)throw gr=0,Vd=null,Error(a(185));for(var n=e.return;n!==null;)e=n,n=e.return;return e.tag===3?e.stateNode:null}var Va={};function mE(e,n,s,c){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Yt(e,n,s,c){return new mE(e,n,s,c)}function Pu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Gn(e,n){var s=e.alternate;return s===null?(s=Yt(e.tag,n,e.key,e.mode),s.elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=n,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=e.flags&65011712,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,n=e.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s.refCleanup=e.refCleanup,s}function _g(e,n){e.flags&=65011714;var s=e.alternate;return s===null?(e.childLanes=0,e.lanes=n,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=s.childLanes,e.lanes=s.lanes,e.child=s.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=s.memoizedProps,e.memoizedState=s.memoizedState,e.updateQueue=s.updateQueue,e.type=s.type,n=s.dependencies,e.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),e}function Mo(e,n,s,c,f,h){var v=0;if(c=e,typeof e=="function")Pu(e)&&(v=1);else if(typeof e=="string")v=b_(e,s,re.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case ie:return e=Yt(31,s,n,f),e.elementType=ie,e.lanes=h,e;case A:return na(s.children,f,h,n);case I:v=8,f|=24;break;case L:return e=Yt(12,s,n,f|2),e.elementType=L,e.lanes=h,e;case x:return e=Yt(13,s,n,f),e.elementType=x,e.lanes=h,e;case F:return e=Yt(19,s,n,f),e.elementType=F,e.lanes=h,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case K:v=10;break e;case X:v=9;break e;case D:v=11;break e;case Y:v=14;break e;case te:v=16,c=null;break e}v=29,s=Error(a(130,e===null?"null":typeof e,"")),c=null}return n=Yt(v,s,n,f),n.elementType=e,n.type=c,n.lanes=h,n}function na(e,n,s,c){return e=Yt(7,e,c,n),e.lanes=s,e}function Uu(e,n,s){return e=Yt(6,e,null,n),e.lanes=s,e}function Rg(e){var n=Yt(18,null,null,0);return n.stateNode=e,n}function Lu(e,n,s){return n=Yt(4,e.children!==null?e.children:[],e.key,n),n.lanes=s,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}var Og=new WeakMap;function rn(e,n){if(typeof e=="object"&&e!==null){var s=Og.get(e);return s!==void 0?s:(n={value:e,source:n,stack:Rp(n)},Og.set(e,n),n)}return{value:e,source:n,stack:Rp(n)}}var Fa=[],Ha=0,wo=null,Js=0,on=[],cn=0,Ti=null,Mn=1,wn="";function Kn(e,n){Fa[Ha++]=Js,Fa[Ha++]=wo,wo=e,Js=n}function Ag(e,n,s){on[cn++]=Mn,on[cn++]=wn,on[cn++]=Ti,Ti=e;var c=Mn;e=wn;var f=32-Gt(c)-1;c&=~(1<<f),s+=1;var h=32-Gt(n)+f;if(30<h){var v=f-f%5;h=(c&(1<<v)-1).toString(32),c>>=v,f-=v,Mn=1<<32-Gt(n)+f|s<<f|c,wn=h+e}else Mn=1<<h|s<<f|c,wn=e}function Iu(e){e.return!==null&&(Kn(e,1),Ag(e,1,0))}function Bu(e){for(;e===wo;)wo=Fa[--Ha],Fa[Ha]=null,Js=Fa[--Ha],Fa[Ha]=null;for(;e===Ti;)Ti=on[--cn],on[cn]=null,wn=on[--cn],on[cn]=null,Mn=on[--cn],on[cn]=null}function Dg(e,n){on[cn++]=Mn,on[cn++]=wn,on[cn++]=Ti,Mn=n.id,wn=n.overflow,Ti=e}var Tt=null,He=null,Oe=!1,Ci=null,ln=!1,ju=Error(a(519));function ki(e){var n=Error(a(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Xs(rn(n,e)),ju}function Mg(e){var n=e.stateNode,s=e.type,c=e.memoizedProps;switch(n[St]=e,n[Ut]=c,s){case"dialog":ke("cancel",n),ke("close",n);break;case"iframe":case"object":case"embed":ke("load",n);break;case"video":case"audio":for(s=0;s<yr.length;s++)ke(yr[s],n);break;case"source":ke("error",n);break;case"img":case"image":case"link":ke("error",n),ke("load",n);break;case"details":ke("toggle",n);break;case"input":ke("invalid",n),Fp(n,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0);break;case"select":ke("invalid",n);break;case"textarea":ke("invalid",n),Gp(n,c.value,c.defaultValue,c.children)}s=c.children,typeof s!="string"&&typeof s!="number"&&typeof s!="bigint"||n.textContent===""+s||c.suppressHydrationWarning===!0||Y0(n.textContent,s)?(c.popover!=null&&(ke("beforetoggle",n),ke("toggle",n)),c.onScroll!=null&&ke("scroll",n),c.onScrollEnd!=null&&ke("scrollend",n),c.onClick!=null&&(n.onclick=Fn),n=!0):n=!1,n||ki(e,!0)}function wg(e){for(Tt=e.return;Tt;)switch(Tt.tag){case 5:case 31:case 13:ln=!1;return;case 27:case 3:ln=!0;return;default:Tt=Tt.return}}function Ga(e){if(e!==Tt)return!1;if(!Oe)return wg(e),Oe=!0,!1;var n=e.tag,s;if((s=n!==3&&n!==27)&&((s=n===5)&&(s=e.type,s=!(s!=="form"&&s!=="button")||af(e.type,e.memoizedProps)),s=!s),s&&He&&ki(e),wg(e),n===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(317));He=ny(e)}else if(n===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(317));He=ny(e)}else n===27?(n=He,Ii(e.type)?(e=lf,lf=null,He=e):He=n):He=Tt?dn(e.stateNode.nextSibling):null;return!0}function ia(){He=Tt=null,Oe=!1}function zu(){var e=Ci;return e!==null&&(zt===null?zt=e:zt.push.apply(zt,e),Ci=null),e}function Xs(e){Ci===null?Ci=[e]:Ci.push(e)}var qu=_(null),aa=null,Yn=null;function Ei(e,n,s){ee(qu,n._currentValue),n._currentValue=s}function Qn(e){e._currentValue=qu.current,q(qu)}function Vu(e,n,s){for(;e!==null;){var c=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,c!==null&&(c.childLanes|=n)):c!==null&&(c.childLanes&n)!==n&&(c.childLanes|=n),e===s)break;e=e.return}}function Fu(e,n,s,c){var f=e.child;for(f!==null&&(f.return=e);f!==null;){var h=f.dependencies;if(h!==null){var v=f.child;h=h.firstContext;e:for(;h!==null;){var b=h;h=f;for(var k=0;k<n.length;k++)if(b.context===n[k]){h.lanes|=s,b=h.alternate,b!==null&&(b.lanes|=s),Vu(h.return,s,e),c||(v=null);break e}h=b.next}}else if(f.tag===18){if(v=f.return,v===null)throw Error(a(341));v.lanes|=s,h=v.alternate,h!==null&&(h.lanes|=s),Vu(v,s,e),v=null}else v=f.child;if(v!==null)v.return=f;else for(v=f;v!==null;){if(v===e){v=null;break}if(f=v.sibling,f!==null){f.return=v.return,v=f;break}v=v.return}f=v}}function Ka(e,n,s,c){e=null;for(var f=n,h=!1;f!==null;){if(!h){if((f.flags&524288)!==0)h=!0;else if((f.flags&262144)!==0)break}if(f.tag===10){var v=f.alternate;if(v===null)throw Error(a(387));if(v=v.memoizedProps,v!==null){var b=f.type;Kt(f.pendingProps.value,v.value)||(e!==null?e.push(b):e=[b])}}else if(f===Ue.current){if(v=f.alternate,v===null)throw Error(a(387));v.memoizedState.memoizedState!==f.memoizedState.memoizedState&&(e!==null?e.push(kr):e=[kr])}f=f.return}e!==null&&Fu(n,e,s,c),n.flags|=262144}function No(e){for(e=e.firstContext;e!==null;){if(!Kt(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function sa(e){aa=e,Yn=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Ct(e){return Ng(aa,e)}function xo(e,n){return aa===null&&sa(e),Ng(e,n)}function Ng(e,n){var s=n._currentValue;if(n={context:n,memoizedValue:s,next:null},Yn===null){if(e===null)throw Error(a(308));Yn=n,e.dependencies={lanes:0,firstContext:n},e.flags|=524288}else Yn=Yn.next=n;return s}var pE=typeof AbortController<"u"?AbortController:function(){var e=[],n=this.signal={aborted:!1,addEventListener:function(s,c){e.push(c)}};this.abort=function(){n.aborted=!0,e.forEach(function(s){return s()})}},gE=r.unstable_scheduleCallback,vE=r.unstable_NormalPriority,st={$$typeof:K,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Hu(){return{controller:new pE,data:new Map,refCount:0}}function Zs(e){e.refCount--,e.refCount===0&&gE(vE,function(){e.controller.abort()})}var Ws=null,Gu=0,Ya=0,Qa=null;function yE(e,n){if(Ws===null){var s=Ws=[];Gu=0,Ya=Qd(),Qa={status:"pending",value:void 0,then:function(c){s.push(c)}}}return Gu++,n.then(xg,xg),n}function xg(){if(--Gu===0&&Ws!==null){Qa!==null&&(Qa.status="fulfilled");var e=Ws;Ws=null,Ya=0,Qa=null;for(var n=0;n<e.length;n++)(0,e[n])()}}function bE(e,n){var s=[],c={status:"pending",value:null,reason:null,then:function(f){s.push(f)}};return e.then(function(){c.status="fulfilled",c.value=n;for(var f=0;f<s.length;f++)(0,s[f])(n)},function(f){for(c.status="rejected",c.reason=f,f=0;f<s.length;f++)(0,s[f])(void 0)}),c}var Pg=j.S;j.S=function(e,n){v0=Ft(),typeof n=="object"&&n!==null&&typeof n.then=="function"&&yE(e,n),Pg!==null&&Pg(e,n)};var ra=_(null);function Ku(){var e=ra.current;return e!==null?e:Fe.pooledCache}function Po(e,n){n===null?ee(ra,ra.current):ee(ra,n.pool)}function Ug(){var e=Ku();return e===null?null:{parent:st._currentValue,pool:e}}var Ja=Error(a(460)),Yu=Error(a(474)),Uo=Error(a(542)),Lo={then:function(){}};function Lg(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Ig(e,n,s){switch(s=e[s],s===void 0?e.push(n):s!==n&&(n.then(Fn,Fn),n=s),n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,jg(e),e;default:if(typeof n.status=="string")n.then(Fn,Fn);else{if(e=Fe,e!==null&&100<e.shellSuspendCounter)throw Error(a(482));e=n,e.status="pending",e.then(function(c){if(n.status==="pending"){var f=n;f.status="fulfilled",f.value=c}},function(c){if(n.status==="pending"){var f=n;f.status="rejected",f.reason=c}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,jg(e),e}throw ca=n,Ja}}function oa(e){try{var n=e._init;return n(e._payload)}catch(s){throw s!==null&&typeof s=="object"&&typeof s.then=="function"?(ca=s,Ja):s}}var ca=null;function Bg(){if(ca===null)throw Error(a(459));var e=ca;return ca=null,e}function jg(e){if(e===Ja||e===Uo)throw Error(a(483))}var Xa=null,$s=0;function Io(e){var n=$s;return $s+=1,Xa===null&&(Xa=[]),Ig(Xa,e,n)}function er(e,n){n=n.props.ref,e.ref=n!==void 0?n:null}function Bo(e,n){throw n.$$typeof===S?Error(a(525)):(e=Object.prototype.toString.call(n),Error(a(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)))}function zg(e){function n(R,E){if(e){var M=R.deletions;M===null?(R.deletions=[E],R.flags|=16):M.push(E)}}function s(R,E){if(!e)return null;for(;E!==null;)n(R,E),E=E.sibling;return null}function c(R){for(var E=new Map;R!==null;)R.key!==null?E.set(R.key,R):E.set(R.index,R),R=R.sibling;return E}function f(R,E){return R=Gn(R,E),R.index=0,R.sibling=null,R}function h(R,E,M){return R.index=M,e?(M=R.alternate,M!==null?(M=M.index,M<E?(R.flags|=67108866,E):M):(R.flags|=67108866,E)):(R.flags|=1048576,E)}function v(R){return e&&R.alternate===null&&(R.flags|=67108866),R}function b(R,E,M,z){return E===null||E.tag!==6?(E=Uu(M,R.mode,z),E.return=R,E):(E=f(E,M),E.return=R,E)}function k(R,E,M,z){var ce=M.type;return ce===A?B(R,E,M.props.children,z,M.key):E!==null&&(E.elementType===ce||typeof ce=="object"&&ce!==null&&ce.$$typeof===te&&oa(ce)===E.type)?(E=f(E,M.props),er(E,M),E.return=R,E):(E=Mo(M.type,M.key,M.props,null,R.mode,z),er(E,M),E.return=R,E)}function N(R,E,M,z){return E===null||E.tag!==4||E.stateNode.containerInfo!==M.containerInfo||E.stateNode.implementation!==M.implementation?(E=Lu(M,R.mode,z),E.return=R,E):(E=f(E,M.children||[]),E.return=R,E)}function B(R,E,M,z,ce){return E===null||E.tag!==7?(E=na(M,R.mode,z,ce),E.return=R,E):(E=f(E,M),E.return=R,E)}function V(R,E,M){if(typeof E=="string"&&E!==""||typeof E=="number"||typeof E=="bigint")return E=Uu(""+E,R.mode,M),E.return=R,E;if(typeof E=="object"&&E!==null){switch(E.$$typeof){case C:return M=Mo(E.type,E.key,E.props,null,R.mode,M),er(M,E),M.return=R,M;case O:return E=Lu(E,R.mode,M),E.return=R,E;case te:return E=oa(E),V(R,E,M)}if(bt(E)||de(E))return E=na(E,R.mode,M,null),E.return=R,E;if(typeof E.then=="function")return V(R,Io(E),M);if(E.$$typeof===K)return V(R,xo(R,E),M);Bo(R,E)}return null}function P(R,E,M,z){var ce=E!==null?E.key:null;if(typeof M=="string"&&M!==""||typeof M=="number"||typeof M=="bigint")return ce!==null?null:b(R,E,""+M,z);if(typeof M=="object"&&M!==null){switch(M.$$typeof){case C:return M.key===ce?k(R,E,M,z):null;case O:return M.key===ce?N(R,E,M,z):null;case te:return M=oa(M),P(R,E,M,z)}if(bt(M)||de(M))return ce!==null?null:B(R,E,M,z,null);if(typeof M.then=="function")return P(R,E,Io(M),z);if(M.$$typeof===K)return P(R,E,xo(R,M),z);Bo(R,M)}return null}function U(R,E,M,z,ce){if(typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint")return R=R.get(M)||null,b(E,R,""+z,ce);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case C:return R=R.get(z.key===null?M:z.key)||null,k(E,R,z,ce);case O:return R=R.get(z.key===null?M:z.key)||null,N(E,R,z,ce);case te:return z=oa(z),U(R,E,M,z,ce)}if(bt(z)||de(z))return R=R.get(M)||null,B(E,R,z,ce,null);if(typeof z.then=="function")return U(R,E,M,Io(z),ce);if(z.$$typeof===K)return U(R,E,M,xo(E,z),ce);Bo(E,z)}return null}function se(R,E,M,z){for(var ce=null,De=null,oe=E,ye=E=0,Re=null;oe!==null&&ye<M.length;ye++){oe.index>ye?(Re=oe,oe=null):Re=oe.sibling;var Me=P(R,oe,M[ye],z);if(Me===null){oe===null&&(oe=Re);break}e&&oe&&Me.alternate===null&&n(R,oe),E=h(Me,E,ye),De===null?ce=Me:De.sibling=Me,De=Me,oe=Re}if(ye===M.length)return s(R,oe),Oe&&Kn(R,ye),ce;if(oe===null){for(;ye<M.length;ye++)oe=V(R,M[ye],z),oe!==null&&(E=h(oe,E,ye),De===null?ce=oe:De.sibling=oe,De=oe);return Oe&&Kn(R,ye),ce}for(oe=c(oe);ye<M.length;ye++)Re=U(oe,R,ye,M[ye],z),Re!==null&&(e&&Re.alternate!==null&&oe.delete(Re.key===null?ye:Re.key),E=h(Re,E,ye),De===null?ce=Re:De.sibling=Re,De=Re);return e&&oe.forEach(function(Vi){return n(R,Vi)}),Oe&&Kn(R,ye),ce}function ue(R,E,M,z){if(M==null)throw Error(a(151));for(var ce=null,De=null,oe=E,ye=E=0,Re=null,Me=M.next();oe!==null&&!Me.done;ye++,Me=M.next()){oe.index>ye?(Re=oe,oe=null):Re=oe.sibling;var Vi=P(R,oe,Me.value,z);if(Vi===null){oe===null&&(oe=Re);break}e&&oe&&Vi.alternate===null&&n(R,oe),E=h(Vi,E,ye),De===null?ce=Vi:De.sibling=Vi,De=Vi,oe=Re}if(Me.done)return s(R,oe),Oe&&Kn(R,ye),ce;if(oe===null){for(;!Me.done;ye++,Me=M.next())Me=V(R,Me.value,z),Me!==null&&(E=h(Me,E,ye),De===null?ce=Me:De.sibling=Me,De=Me);return Oe&&Kn(R,ye),ce}for(oe=c(oe);!Me.done;ye++,Me=M.next())Me=U(oe,R,ye,Me.value,z),Me!==null&&(e&&Me.alternate!==null&&oe.delete(Me.key===null?ye:Me.key),E=h(Me,E,ye),De===null?ce=Me:De.sibling=Me,De=Me);return e&&oe.forEach(function(M_){return n(R,M_)}),Oe&&Kn(R,ye),ce}function qe(R,E,M,z){if(typeof M=="object"&&M!==null&&M.type===A&&M.key===null&&(M=M.props.children),typeof M=="object"&&M!==null){switch(M.$$typeof){case C:e:{for(var ce=M.key;E!==null;){if(E.key===ce){if(ce=M.type,ce===A){if(E.tag===7){s(R,E.sibling),z=f(E,M.props.children),z.return=R,R=z;break e}}else if(E.elementType===ce||typeof ce=="object"&&ce!==null&&ce.$$typeof===te&&oa(ce)===E.type){s(R,E.sibling),z=f(E,M.props),er(z,M),z.return=R,R=z;break e}s(R,E);break}else n(R,E);E=E.sibling}M.type===A?(z=na(M.props.children,R.mode,z,M.key),z.return=R,R=z):(z=Mo(M.type,M.key,M.props,null,R.mode,z),er(z,M),z.return=R,R=z)}return v(R);case O:e:{for(ce=M.key;E!==null;){if(E.key===ce)if(E.tag===4&&E.stateNode.containerInfo===M.containerInfo&&E.stateNode.implementation===M.implementation){s(R,E.sibling),z=f(E,M.children||[]),z.return=R,R=z;break e}else{s(R,E);break}else n(R,E);E=E.sibling}z=Lu(M,R.mode,z),z.return=R,R=z}return v(R);case te:return M=oa(M),qe(R,E,M,z)}if(bt(M))return se(R,E,M,z);if(de(M)){if(ce=de(M),typeof ce!="function")throw Error(a(150));return M=ce.call(M),ue(R,E,M,z)}if(typeof M.then=="function")return qe(R,E,Io(M),z);if(M.$$typeof===K)return qe(R,E,xo(R,M),z);Bo(R,M)}return typeof M=="string"&&M!==""||typeof M=="number"||typeof M=="bigint"?(M=""+M,E!==null&&E.tag===6?(s(R,E.sibling),z=f(E,M),z.return=R,R=z):(s(R,E),z=Uu(M,R.mode,z),z.return=R,R=z),v(R)):s(R,E)}return function(R,E,M,z){try{$s=0;var ce=qe(R,E,M,z);return Xa=null,ce}catch(oe){if(oe===Ja||oe===Uo)throw oe;var De=Yt(29,oe,null,R.mode);return De.lanes=z,De.return=R,De}finally{}}}var la=zg(!0),qg=zg(!1),_i=!1;function Qu(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ju(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Ri(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Oi(e,n,s){var c=e.updateQueue;if(c===null)return null;if(c=c.shared,(Pe&2)!==0){var f=c.pending;return f===null?n.next=n:(n.next=f.next,f.next=n),c.pending=n,n=Do(e),Eg(e,null,s),n}return Ao(e,c,n,s),Do(e)}function tr(e,n,s){if(n=n.updateQueue,n!==null&&(n=n.shared,(s&4194048)!==0)){var c=n.lanes;c&=e.pendingLanes,s|=c,n.lanes=s,Np(e,s)}}function Xu(e,n){var s=e.updateQueue,c=e.alternate;if(c!==null&&(c=c.updateQueue,s===c)){var f=null,h=null;if(s=s.firstBaseUpdate,s!==null){do{var v={lane:s.lane,tag:s.tag,payload:s.payload,callback:null,next:null};h===null?f=h=v:h=h.next=v,s=s.next}while(s!==null);h===null?f=h=n:h=h.next=n}else f=h=n;s={baseState:c.baseState,firstBaseUpdate:f,lastBaseUpdate:h,shared:c.shared,callbacks:c.callbacks},e.updateQueue=s;return}e=s.lastBaseUpdate,e===null?s.firstBaseUpdate=n:e.next=n,s.lastBaseUpdate=n}var Zu=!1;function nr(){if(Zu){var e=Qa;if(e!==null)throw e}}function ir(e,n,s,c){Zu=!1;var f=e.updateQueue;_i=!1;var h=f.firstBaseUpdate,v=f.lastBaseUpdate,b=f.shared.pending;if(b!==null){f.shared.pending=null;var k=b,N=k.next;k.next=null,v===null?h=N:v.next=N,v=k;var B=e.alternate;B!==null&&(B=B.updateQueue,b=B.lastBaseUpdate,b!==v&&(b===null?B.firstBaseUpdate=N:b.next=N,B.lastBaseUpdate=k))}if(h!==null){var V=f.baseState;v=0,B=N=k=null,b=h;do{var P=b.lane&-536870913,U=P!==b.lane;if(U?(_e&P)===P:(c&P)===P){P!==0&&P===Ya&&(Zu=!0),B!==null&&(B=B.next={lane:0,tag:b.tag,payload:b.payload,callback:null,next:null});e:{var se=e,ue=b;P=n;var qe=s;switch(ue.tag){case 1:if(se=ue.payload,typeof se=="function"){V=se.call(qe,V,P);break e}V=se;break e;case 3:se.flags=se.flags&-65537|128;case 0:if(se=ue.payload,P=typeof se=="function"?se.call(qe,V,P):se,P==null)break e;V=y({},V,P);break e;case 2:_i=!0}}P=b.callback,P!==null&&(e.flags|=64,U&&(e.flags|=8192),U=f.callbacks,U===null?f.callbacks=[P]:U.push(P))}else U={lane:P,tag:b.tag,payload:b.payload,callback:b.callback,next:null},B===null?(N=B=U,k=V):B=B.next=U,v|=P;if(b=b.next,b===null){if(b=f.shared.pending,b===null)break;U=b,b=U.next,U.next=null,f.lastBaseUpdate=U,f.shared.pending=null}}while(!0);B===null&&(k=V),f.baseState=k,f.firstBaseUpdate=N,f.lastBaseUpdate=B,h===null&&(f.shared.lanes=0),Ni|=v,e.lanes=v,e.memoizedState=V}}function Vg(e,n){if(typeof e!="function")throw Error(a(191,e));e.call(n)}function Fg(e,n){var s=e.callbacks;if(s!==null)for(e.callbacks=null,e=0;e<s.length;e++)Vg(s[e],n)}var Za=_(null),jo=_(0);function Hg(e,n){e=ii,ee(jo,e),ee(Za,n),ii=e|n.baseLanes}function Wu(){ee(jo,ii),ee(Za,Za.current)}function $u(){ii=jo.current,q(Za),q(jo)}var Qt=_(null),un=null;function Ai(e){var n=e.alternate;ee(nt,nt.current&1),ee(Qt,e),un===null&&(n===null||Za.current!==null||n.memoizedState!==null)&&(un=e)}function ed(e){ee(nt,nt.current),ee(Qt,e),un===null&&(un=e)}function Gg(e){e.tag===22?(ee(nt,nt.current),ee(Qt,e),un===null&&(un=e)):Di()}function Di(){ee(nt,nt.current),ee(Qt,Qt.current)}function Jt(e){q(Qt),un===e&&(un=null),q(nt)}var nt=_(0);function zo(e){for(var n=e;n!==null;){if(n.tag===13){var s=n.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||of(s)||cf(s)))return n}else if(n.tag===19&&(n.memoizedProps.revealOrder==="forwards"||n.memoizedProps.revealOrder==="backwards"||n.memoizedProps.revealOrder==="unstable_legacy-backwards"||n.memoizedProps.revealOrder==="together")){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var Jn=0,pe=null,je=null,rt=null,qo=!1,Wa=!1,ua=!1,Vo=0,ar=0,$a=null,SE=0;function We(){throw Error(a(321))}function td(e,n){if(n===null)return!1;for(var s=0;s<n.length&&s<e.length;s++)if(!Kt(e[s],n[s]))return!1;return!0}function nd(e,n,s,c,f,h){return Jn=h,pe=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,j.H=e===null||e.memoizedState===null?Av:vd,ua=!1,h=s(c,f),ua=!1,Wa&&(h=Yg(n,s,c,f)),Kg(e),h}function Kg(e){j.H=or;var n=je!==null&&je.next!==null;if(Jn=0,rt=je=pe=null,qo=!1,ar=0,$a=null,n)throw Error(a(300));e===null||ot||(e=e.dependencies,e!==null&&No(e)&&(ot=!0))}function Yg(e,n,s,c){pe=e;var f=0;do{if(Wa&&($a=null),ar=0,Wa=!1,25<=f)throw Error(a(301));if(f+=1,rt=je=null,e.updateQueue!=null){var h=e.updateQueue;h.lastEffect=null,h.events=null,h.stores=null,h.memoCache!=null&&(h.memoCache.index=0)}j.H=Dv,h=n(s,c)}while(Wa);return h}function TE(){var e=j.H,n=e.useState()[0];return n=typeof n.then=="function"?sr(n):n,e=e.useState()[0],(je!==null?je.memoizedState:null)!==e&&(pe.flags|=1024),n}function id(){var e=Vo!==0;return Vo=0,e}function ad(e,n,s){n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~s}function sd(e){if(qo){for(e=e.memoizedState;e!==null;){var n=e.queue;n!==null&&(n.pending=null),e=e.next}qo=!1}Jn=0,rt=je=pe=null,Wa=!1,ar=Vo=0,$a=null}function wt(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rt===null?pe.memoizedState=rt=e:rt=rt.next=e,rt}function it(){if(je===null){var e=pe.alternate;e=e!==null?e.memoizedState:null}else e=je.next;var n=rt===null?pe.memoizedState:rt.next;if(n!==null)rt=n,je=e;else{if(e===null)throw pe.alternate===null?Error(a(467)):Error(a(310));je=e,e={memoizedState:je.memoizedState,baseState:je.baseState,baseQueue:je.baseQueue,queue:je.queue,next:null},rt===null?pe.memoizedState=rt=e:rt=rt.next=e}return rt}function Fo(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function sr(e){var n=ar;return ar+=1,$a===null&&($a=[]),e=Ig($a,e,n),n=pe,(rt===null?n.memoizedState:rt.next)===null&&(n=n.alternate,j.H=n===null||n.memoizedState===null?Av:vd),e}function Ho(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return sr(e);if(e.$$typeof===K)return Ct(e)}throw Error(a(438,String(e)))}function rd(e){var n=null,s=pe.updateQueue;if(s!==null&&(n=s.memoCache),n==null){var c=pe.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(n={data:c.data.map(function(f){return f.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),s===null&&(s=Fo(),pe.updateQueue=s),s.memoCache=n,s=n.data[n.index],s===void 0)for(s=n.data[n.index]=Array(e),c=0;c<e;c++)s[c]=ne;return n.index++,s}function Xn(e,n){return typeof n=="function"?n(e):n}function Go(e){var n=it();return od(n,je,e)}function od(e,n,s){var c=e.queue;if(c===null)throw Error(a(311));c.lastRenderedReducer=s;var f=e.baseQueue,h=c.pending;if(h!==null){if(f!==null){var v=f.next;f.next=h.next,h.next=v}n.baseQueue=f=h,c.pending=null}if(h=e.baseState,f===null)e.memoizedState=h;else{n=f.next;var b=v=null,k=null,N=n,B=!1;do{var V=N.lane&-536870913;if(V!==N.lane?(_e&V)===V:(Jn&V)===V){var P=N.revertLane;if(P===0)k!==null&&(k=k.next={lane:0,revertLane:0,gesture:null,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null}),V===Ya&&(B=!0);else if((Jn&P)===P){N=N.next,P===Ya&&(B=!0);continue}else V={lane:0,revertLane:N.revertLane,gesture:null,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null},k===null?(b=k=V,v=h):k=k.next=V,pe.lanes|=P,Ni|=P;V=N.action,ua&&s(h,V),h=N.hasEagerState?N.eagerState:s(h,V)}else P={lane:V,revertLane:N.revertLane,gesture:N.gesture,action:N.action,hasEagerState:N.hasEagerState,eagerState:N.eagerState,next:null},k===null?(b=k=P,v=h):k=k.next=P,pe.lanes|=V,Ni|=V;N=N.next}while(N!==null&&N!==n);if(k===null?v=h:k.next=b,!Kt(h,e.memoizedState)&&(ot=!0,B&&(s=Qa,s!==null)))throw s;e.memoizedState=h,e.baseState=v,e.baseQueue=k,c.lastRenderedState=h}return f===null&&(c.lanes=0),[e.memoizedState,c.dispatch]}function cd(e){var n=it(),s=n.queue;if(s===null)throw Error(a(311));s.lastRenderedReducer=e;var c=s.dispatch,f=s.pending,h=n.memoizedState;if(f!==null){s.pending=null;var v=f=f.next;do h=e(h,v.action),v=v.next;while(v!==f);Kt(h,n.memoizedState)||(ot=!0),n.memoizedState=h,n.baseQueue===null&&(n.baseState=h),s.lastRenderedState=h}return[h,c]}function Qg(e,n,s){var c=pe,f=it(),h=Oe;if(h){if(s===void 0)throw Error(a(407));s=s()}else s=n();var v=!Kt((je||f).memoizedState,s);if(v&&(f.memoizedState=s,ot=!0),f=f.queue,dd(Zg.bind(null,c,f,e),[e]),f.getSnapshot!==n||v||rt!==null&&rt.memoizedState.tag&1){if(c.flags|=2048,es(9,{destroy:void 0},Xg.bind(null,c,f,s,n),null),Fe===null)throw Error(a(349));h||(Jn&127)!==0||Jg(c,n,s)}return s}function Jg(e,n,s){e.flags|=16384,e={getSnapshot:n,value:s},n=pe.updateQueue,n===null?(n=Fo(),pe.updateQueue=n,n.stores=[e]):(s=n.stores,s===null?n.stores=[e]:s.push(e))}function Xg(e,n,s,c){n.value=s,n.getSnapshot=c,Wg(n)&&$g(e)}function Zg(e,n,s){return s(function(){Wg(n)&&$g(e)})}function Wg(e){var n=e.getSnapshot;e=e.value;try{var s=n();return!Kt(e,s)}catch{return!0}}function $g(e){var n=ta(e,2);n!==null&&qt(n,e,2)}function ld(e){var n=wt();if(typeof e=="function"){var s=e;if(e=s(),ua){yi(!0);try{s()}finally{yi(!1)}}}return n.memoizedState=n.baseState=e,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Xn,lastRenderedState:e},n}function ev(e,n,s,c){return e.baseState=s,od(e,je,typeof c=="function"?c:Xn)}function CE(e,n,s,c,f){if(Qo(e))throw Error(a(485));if(e=n.action,e!==null){var h={payload:f,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(v){h.listeners.push(v)}};j.T!==null?s(!0):h.isTransition=!1,c(h),s=n.pending,s===null?(h.next=n.pending=h,tv(n,h)):(h.next=s.next,n.pending=s.next=h)}}function tv(e,n){var s=n.action,c=n.payload,f=e.state;if(n.isTransition){var h=j.T,v={};j.T=v;try{var b=s(f,c),k=j.S;k!==null&&k(v,b),nv(e,n,b)}catch(N){ud(e,n,N)}finally{h!==null&&v.types!==null&&(h.types=v.types),j.T=h}}else try{h=s(f,c),nv(e,n,h)}catch(N){ud(e,n,N)}}function nv(e,n,s){s!==null&&typeof s=="object"&&typeof s.then=="function"?s.then(function(c){iv(e,n,c)},function(c){return ud(e,n,c)}):iv(e,n,s)}function iv(e,n,s){n.status="fulfilled",n.value=s,av(n),e.state=s,n=e.pending,n!==null&&(s=n.next,s===n?e.pending=null:(s=s.next,n.next=s,tv(e,s)))}function ud(e,n,s){var c=e.pending;if(e.pending=null,c!==null){c=c.next;do n.status="rejected",n.reason=s,av(n),n=n.next;while(n!==c)}e.action=null}function av(e){e=e.listeners;for(var n=0;n<e.length;n++)(0,e[n])()}function sv(e,n){return n}function rv(e,n){if(Oe){var s=Fe.formState;if(s!==null){e:{var c=pe;if(Oe){if(He){t:{for(var f=He,h=ln;f.nodeType!==8;){if(!h){f=null;break t}if(f=dn(f.nextSibling),f===null){f=null;break t}}h=f.data,f=h==="F!"||h==="F"?f:null}if(f){He=dn(f.nextSibling),c=f.data==="F!";break e}}ki(c)}c=!1}c&&(n=s[0])}}return s=wt(),s.memoizedState=s.baseState=n,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:sv,lastRenderedState:n},s.queue=c,s=_v.bind(null,pe,c),c.dispatch=s,c=ld(!1),h=gd.bind(null,pe,!1,c.queue),c=wt(),f={state:n,dispatch:null,action:e,pending:null},c.queue=f,s=CE.bind(null,pe,f,h,s),f.dispatch=s,c.memoizedState=e,[n,s,!1]}function ov(e){var n=it();return cv(n,je,e)}function cv(e,n,s){if(n=od(e,n,sv)[0],e=Go(Xn)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var c=sr(n)}catch(v){throw v===Ja?Uo:v}else c=n;n=it();var f=n.queue,h=f.dispatch;return s!==n.memoizedState&&(pe.flags|=2048,es(9,{destroy:void 0},kE.bind(null,f,s),null)),[c,h,e]}function kE(e,n){e.action=n}function lv(e){var n=it(),s=je;if(s!==null)return cv(n,s,e);it(),n=n.memoizedState,s=it();var c=s.queue.dispatch;return s.memoizedState=e,[n,c,!1]}function es(e,n,s,c){return e={tag:e,create:s,deps:c,inst:n,next:null},n=pe.updateQueue,n===null&&(n=Fo(),pe.updateQueue=n),s=n.lastEffect,s===null?n.lastEffect=e.next=e:(c=s.next,s.next=e,e.next=c,n.lastEffect=e),e}function uv(){return it().memoizedState}function Ko(e,n,s,c){var f=wt();pe.flags|=e,f.memoizedState=es(1|n,{destroy:void 0},s,c===void 0?null:c)}function Yo(e,n,s,c){var f=it();c=c===void 0?null:c;var h=f.memoizedState.inst;je!==null&&c!==null&&td(c,je.memoizedState.deps)?f.memoizedState=es(n,h,s,c):(pe.flags|=e,f.memoizedState=es(1|n,h,s,c))}function dv(e,n){Ko(8390656,8,e,n)}function dd(e,n){Yo(2048,8,e,n)}function EE(e){pe.flags|=4;var n=pe.updateQueue;if(n===null)n=Fo(),pe.updateQueue=n,n.events=[e];else{var s=n.events;s===null?n.events=[e]:s.push(e)}}function fv(e){var n=it().memoizedState;return EE({ref:n,nextImpl:e}),function(){if((Pe&2)!==0)throw Error(a(440));return n.impl.apply(void 0,arguments)}}function hv(e,n){return Yo(4,2,e,n)}function mv(e,n){return Yo(4,4,e,n)}function pv(e,n){if(typeof n=="function"){e=e();var s=n(e);return function(){typeof s=="function"?s():n(null)}}if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function gv(e,n,s){s=s!=null?s.concat([e]):null,Yo(4,4,pv.bind(null,n,e),s)}function fd(){}function vv(e,n){var s=it();n=n===void 0?null:n;var c=s.memoizedState;return n!==null&&td(n,c[1])?c[0]:(s.memoizedState=[e,n],e)}function yv(e,n){var s=it();n=n===void 0?null:n;var c=s.memoizedState;if(n!==null&&td(n,c[1]))return c[0];if(c=e(),ua){yi(!0);try{e()}finally{yi(!1)}}return s.memoizedState=[c,n],c}function hd(e,n,s){return s===void 0||(Jn&1073741824)!==0&&(_e&261930)===0?e.memoizedState=n:(e.memoizedState=s,e=b0(),pe.lanes|=e,Ni|=e,s)}function bv(e,n,s,c){return Kt(s,n)?s:Za.current!==null?(e=hd(e,s,c),Kt(e,n)||(ot=!0),e):(Jn&42)===0||(Jn&1073741824)!==0&&(_e&261930)===0?(ot=!0,e.memoizedState=s):(e=b0(),pe.lanes|=e,Ni|=e,n)}function Sv(e,n,s,c,f){var h=$.p;$.p=h!==0&&8>h?h:8;var v=j.T,b={};j.T=b,gd(e,!1,n,s);try{var k=f(),N=j.S;if(N!==null&&N(b,k),k!==null&&typeof k=="object"&&typeof k.then=="function"){var B=bE(k,c);rr(e,n,B,Wt(e))}else rr(e,n,c,Wt(e))}catch(V){rr(e,n,{then:function(){},status:"rejected",reason:V},Wt())}finally{$.p=h,v!==null&&b.types!==null&&(v.types=b.types),j.T=v}}function _E(){}function md(e,n,s,c){if(e.tag!==5)throw Error(a(476));var f=Tv(e).queue;Sv(e,f,n,le,s===null?_E:function(){return Cv(e),s(c)})}function Tv(e){var n=e.memoizedState;if(n!==null)return n;n={memoizedState:le,baseState:le,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Xn,lastRenderedState:le},next:null};var s={};return n.next={memoizedState:s,baseState:s,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Xn,lastRenderedState:s},next:null},e.memoizedState=n,e=e.alternate,e!==null&&(e.memoizedState=n),n}function Cv(e){var n=Tv(e);n.next===null&&(n=e.alternate.memoizedState),rr(e,n.next.queue,{},Wt())}function pd(){return Ct(kr)}function kv(){return it().memoizedState}function Ev(){return it().memoizedState}function RE(e){for(var n=e.return;n!==null;){switch(n.tag){case 24:case 3:var s=Wt();e=Ri(s);var c=Oi(n,e,s);c!==null&&(qt(c,n,s),tr(c,n,s)),n={cache:Hu()},e.payload=n;return}n=n.return}}function OE(e,n,s){var c=Wt();s={lane:c,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},Qo(e)?Rv(n,s):(s=xu(e,n,s,c),s!==null&&(qt(s,e,c),Ov(s,n,c)))}function _v(e,n,s){var c=Wt();rr(e,n,s,c)}function rr(e,n,s,c){var f={lane:c,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null};if(Qo(e))Rv(n,f);else{var h=e.alternate;if(e.lanes===0&&(h===null||h.lanes===0)&&(h=n.lastRenderedReducer,h!==null))try{var v=n.lastRenderedState,b=h(v,s);if(f.hasEagerState=!0,f.eagerState=b,Kt(b,v))return Ao(e,n,f,0),Fe===null&&Oo(),!1}catch{}finally{}if(s=xu(e,n,f,c),s!==null)return qt(s,e,c),Ov(s,n,c),!0}return!1}function gd(e,n,s,c){if(c={lane:2,revertLane:Qd(),gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Qo(e)){if(n)throw Error(a(479))}else n=xu(e,s,c,2),n!==null&&qt(n,e,2)}function Qo(e){var n=e.alternate;return e===pe||n!==null&&n===pe}function Rv(e,n){Wa=qo=!0;var s=e.pending;s===null?n.next=n:(n.next=s.next,s.next=n),e.pending=n}function Ov(e,n,s){if((s&4194048)!==0){var c=n.lanes;c&=e.pendingLanes,s|=c,n.lanes=s,Np(e,s)}}var or={readContext:Ct,use:Ho,useCallback:We,useContext:We,useEffect:We,useImperativeHandle:We,useLayoutEffect:We,useInsertionEffect:We,useMemo:We,useReducer:We,useRef:We,useState:We,useDebugValue:We,useDeferredValue:We,useTransition:We,useSyncExternalStore:We,useId:We,useHostTransitionStatus:We,useFormState:We,useActionState:We,useOptimistic:We,useMemoCache:We,useCacheRefresh:We};or.useEffectEvent=We;var Av={readContext:Ct,use:Ho,useCallback:function(e,n){return wt().memoizedState=[e,n===void 0?null:n],e},useContext:Ct,useEffect:dv,useImperativeHandle:function(e,n,s){s=s!=null?s.concat([e]):null,Ko(4194308,4,pv.bind(null,n,e),s)},useLayoutEffect:function(e,n){return Ko(4194308,4,e,n)},useInsertionEffect:function(e,n){Ko(4,2,e,n)},useMemo:function(e,n){var s=wt();n=n===void 0?null:n;var c=e();if(ua){yi(!0);try{e()}finally{yi(!1)}}return s.memoizedState=[c,n],c},useReducer:function(e,n,s){var c=wt();if(s!==void 0){var f=s(n);if(ua){yi(!0);try{s(n)}finally{yi(!1)}}}else f=n;return c.memoizedState=c.baseState=f,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:f},c.queue=e,e=e.dispatch=OE.bind(null,pe,e),[c.memoizedState,e]},useRef:function(e){var n=wt();return e={current:e},n.memoizedState=e},useState:function(e){e=ld(e);var n=e.queue,s=_v.bind(null,pe,n);return n.dispatch=s,[e.memoizedState,s]},useDebugValue:fd,useDeferredValue:function(e,n){var s=wt();return hd(s,e,n)},useTransition:function(){var e=ld(!1);return e=Sv.bind(null,pe,e.queue,!0,!1),wt().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,n,s){var c=pe,f=wt();if(Oe){if(s===void 0)throw Error(a(407));s=s()}else{if(s=n(),Fe===null)throw Error(a(349));(_e&127)!==0||Jg(c,n,s)}f.memoizedState=s;var h={value:s,getSnapshot:n};return f.queue=h,dv(Zg.bind(null,c,h,e),[e]),c.flags|=2048,es(9,{destroy:void 0},Xg.bind(null,c,h,s,n),null),s},useId:function(){var e=wt(),n=Fe.identifierPrefix;if(Oe){var s=wn,c=Mn;s=(c&~(1<<32-Gt(c)-1)).toString(32)+s,n="_"+n+"R_"+s,s=Vo++,0<s&&(n+="H"+s.toString(32)),n+="_"}else s=SE++,n="_"+n+"r_"+s.toString(32)+"_";return e.memoizedState=n},useHostTransitionStatus:pd,useFormState:rv,useActionState:rv,useOptimistic:function(e){var n=wt();n.memoizedState=n.baseState=e;var s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=s,n=gd.bind(null,pe,!0,s),s.dispatch=n,[e,n]},useMemoCache:rd,useCacheRefresh:function(){return wt().memoizedState=RE.bind(null,pe)},useEffectEvent:function(e){var n=wt(),s={impl:e};return n.memoizedState=s,function(){if((Pe&2)!==0)throw Error(a(440));return s.impl.apply(void 0,arguments)}}},vd={readContext:Ct,use:Ho,useCallback:vv,useContext:Ct,useEffect:dd,useImperativeHandle:gv,useInsertionEffect:hv,useLayoutEffect:mv,useMemo:yv,useReducer:Go,useRef:uv,useState:function(){return Go(Xn)},useDebugValue:fd,useDeferredValue:function(e,n){var s=it();return bv(s,je.memoizedState,e,n)},useTransition:function(){var e=Go(Xn)[0],n=it().memoizedState;return[typeof e=="boolean"?e:sr(e),n]},useSyncExternalStore:Qg,useId:kv,useHostTransitionStatus:pd,useFormState:ov,useActionState:ov,useOptimistic:function(e,n){var s=it();return ev(s,je,e,n)},useMemoCache:rd,useCacheRefresh:Ev};vd.useEffectEvent=fv;var Dv={readContext:Ct,use:Ho,useCallback:vv,useContext:Ct,useEffect:dd,useImperativeHandle:gv,useInsertionEffect:hv,useLayoutEffect:mv,useMemo:yv,useReducer:cd,useRef:uv,useState:function(){return cd(Xn)},useDebugValue:fd,useDeferredValue:function(e,n){var s=it();return je===null?hd(s,e,n):bv(s,je.memoizedState,e,n)},useTransition:function(){var e=cd(Xn)[0],n=it().memoizedState;return[typeof e=="boolean"?e:sr(e),n]},useSyncExternalStore:Qg,useId:kv,useHostTransitionStatus:pd,useFormState:lv,useActionState:lv,useOptimistic:function(e,n){var s=it();return je!==null?ev(s,je,e,n):(s.baseState=e,[e,s.queue.dispatch])},useMemoCache:rd,useCacheRefresh:Ev};Dv.useEffectEvent=fv;function yd(e,n,s,c){n=e.memoizedState,s=s(c,n),s=s==null?n:y({},n,s),e.memoizedState=s,e.lanes===0&&(e.updateQueue.baseState=s)}var bd={enqueueSetState:function(e,n,s){e=e._reactInternals;var c=Wt(),f=Ri(c);f.payload=n,s!=null&&(f.callback=s),n=Oi(e,f,c),n!==null&&(qt(n,e,c),tr(n,e,c))},enqueueReplaceState:function(e,n,s){e=e._reactInternals;var c=Wt(),f=Ri(c);f.tag=1,f.payload=n,s!=null&&(f.callback=s),n=Oi(e,f,c),n!==null&&(qt(n,e,c),tr(n,e,c))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var s=Wt(),c=Ri(s);c.tag=2,n!=null&&(c.callback=n),n=Oi(e,c,s),n!==null&&(qt(n,e,s),tr(n,e,s))}};function Mv(e,n,s,c,f,h,v){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(c,h,v):n.prototype&&n.prototype.isPureReactComponent?!Ys(s,c)||!Ys(f,h):!0}function wv(e,n,s,c){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(s,c),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(s,c),n.state!==e&&bd.enqueueReplaceState(n,n.state,null)}function da(e,n){var s=n;if("ref"in n){s={};for(var c in n)c!=="ref"&&(s[c]=n[c])}if(e=e.defaultProps){s===n&&(s=y({},s));for(var f in e)s[f]===void 0&&(s[f]=e[f])}return s}function Nv(e){Ro(e)}function xv(e){console.error(e)}function Pv(e){Ro(e)}function Jo(e,n){try{var s=e.onUncaughtError;s(n.value,{componentStack:n.stack})}catch(c){setTimeout(function(){throw c})}}function Uv(e,n,s){try{var c=e.onCaughtError;c(s.value,{componentStack:s.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(f){setTimeout(function(){throw f})}}function Sd(e,n,s){return s=Ri(s),s.tag=3,s.payload={element:null},s.callback=function(){Jo(e,n)},s}function Lv(e){return e=Ri(e),e.tag=3,e}function Iv(e,n,s,c){var f=s.type.getDerivedStateFromError;if(typeof f=="function"){var h=c.value;e.payload=function(){return f(h)},e.callback=function(){Uv(n,s,c)}}var v=s.stateNode;v!==null&&typeof v.componentDidCatch=="function"&&(e.callback=function(){Uv(n,s,c),typeof f!="function"&&(xi===null?xi=new Set([this]):xi.add(this));var b=c.stack;this.componentDidCatch(c.value,{componentStack:b!==null?b:""})})}function AE(e,n,s,c,f){if(s.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(n=s.alternate,n!==null&&Ka(n,s,f,!0),s=Qt.current,s!==null){switch(s.tag){case 31:case 13:return un===null?oc():s.alternate===null&&$e===0&&($e=3),s.flags&=-257,s.flags|=65536,s.lanes=f,c===Lo?s.flags|=16384:(n=s.updateQueue,n===null?s.updateQueue=new Set([c]):n.add(c),Gd(e,c,f)),!1;case 22:return s.flags|=65536,c===Lo?s.flags|=16384:(n=s.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([c])},s.updateQueue=n):(s=n.retryQueue,s===null?n.retryQueue=new Set([c]):s.add(c)),Gd(e,c,f)),!1}throw Error(a(435,s.tag))}return Gd(e,c,f),oc(),!1}if(Oe)return n=Qt.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=f,c!==ju&&(e=Error(a(422),{cause:c}),Xs(rn(e,s)))):(c!==ju&&(n=Error(a(423),{cause:c}),Xs(rn(n,s))),e=e.current.alternate,e.flags|=65536,f&=-f,e.lanes|=f,c=rn(c,s),f=Sd(e.stateNode,c,f),Xu(e,f),$e!==4&&($e=2)),!1;var h=Error(a(520),{cause:c});if(h=rn(h,s),pr===null?pr=[h]:pr.push(h),$e!==4&&($e=2),n===null)return!0;c=rn(c,s),s=n;do{switch(s.tag){case 3:return s.flags|=65536,e=f&-f,s.lanes|=e,e=Sd(s.stateNode,c,e),Xu(s,e),!1;case 1:if(n=s.type,h=s.stateNode,(s.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||h!==null&&typeof h.componentDidCatch=="function"&&(xi===null||!xi.has(h))))return s.flags|=65536,f&=-f,s.lanes|=f,f=Lv(f),Iv(f,e,s,c),Xu(s,f),!1}s=s.return}while(s!==null);return!1}var Td=Error(a(461)),ot=!1;function kt(e,n,s,c){n.child=e===null?qg(n,null,s,c):la(n,e.child,s,c)}function Bv(e,n,s,c,f){s=s.render;var h=n.ref;if("ref"in c){var v={};for(var b in c)b!=="ref"&&(v[b]=c[b])}else v=c;return sa(n),c=nd(e,n,s,v,h,f),b=id(),e!==null&&!ot?(ad(e,n,f),Zn(e,n,f)):(Oe&&b&&Iu(n),n.flags|=1,kt(e,n,c,f),n.child)}function jv(e,n,s,c,f){if(e===null){var h=s.type;return typeof h=="function"&&!Pu(h)&&h.defaultProps===void 0&&s.compare===null?(n.tag=15,n.type=h,zv(e,n,h,c,f)):(e=Mo(s.type,null,c,n,n.mode,f),e.ref=n.ref,e.return=n,n.child=e)}if(h=e.child,!Dd(e,f)){var v=h.memoizedProps;if(s=s.compare,s=s!==null?s:Ys,s(v,c)&&e.ref===n.ref)return Zn(e,n,f)}return n.flags|=1,e=Gn(h,c),e.ref=n.ref,e.return=n,n.child=e}function zv(e,n,s,c,f){if(e!==null){var h=e.memoizedProps;if(Ys(h,c)&&e.ref===n.ref)if(ot=!1,n.pendingProps=c=h,Dd(e,f))(e.flags&131072)!==0&&(ot=!0);else return n.lanes=e.lanes,Zn(e,n,f)}return Cd(e,n,s,c,f)}function qv(e,n,s,c){var f=c.children,h=e!==null?e.memoizedState:null;if(e===null&&n.stateNode===null&&(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.mode==="hidden"){if((n.flags&128)!==0){if(h=h!==null?h.baseLanes|s:s,e!==null){for(c=n.child=e.child,f=0;c!==null;)f=f|c.lanes|c.childLanes,c=c.sibling;c=f&~h}else c=0,n.child=null;return Vv(e,n,h,s,c)}if((s&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},e!==null&&Po(n,h!==null?h.cachePool:null),h!==null?Hg(n,h):Wu(),Gg(n);else return c=n.lanes=536870912,Vv(e,n,h!==null?h.baseLanes|s:s,s,c)}else h!==null?(Po(n,h.cachePool),Hg(n,h),Di(),n.memoizedState=null):(e!==null&&Po(n,null),Wu(),Di());return kt(e,n,f,s),n.child}function cr(e,n){return e!==null&&e.tag===22||n.stateNode!==null||(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.sibling}function Vv(e,n,s,c,f){var h=Ku();return h=h===null?null:{parent:st._currentValue,pool:h},n.memoizedState={baseLanes:s,cachePool:h},e!==null&&Po(n,null),Wu(),Gg(n),e!==null&&Ka(e,n,c,!0),n.childLanes=f,null}function Xo(e,n){return n=Wo({mode:n.mode,children:n.children},e.mode),n.ref=e.ref,e.child=n,n.return=e,n}function Fv(e,n,s){return la(n,e.child,null,s),e=Xo(n,n.pendingProps),e.flags|=2,Jt(n),n.memoizedState=null,e}function DE(e,n,s){var c=n.pendingProps,f=(n.flags&128)!==0;if(n.flags&=-129,e===null){if(Oe){if(c.mode==="hidden")return e=Xo(n,c),n.lanes=536870912,cr(null,e);if(ed(n),(e=He)?(e=ty(e,ln),e=e!==null&&e.data==="&"?e:null,e!==null&&(n.memoizedState={dehydrated:e,treeContext:Ti!==null?{id:Mn,overflow:wn}:null,retryLane:536870912,hydrationErrors:null},s=Rg(e),s.return=n,n.child=s,Tt=n,He=null)):e=null,e===null)throw ki(n);return n.lanes=536870912,null}return Xo(n,c)}var h=e.memoizedState;if(h!==null){var v=h.dehydrated;if(ed(n),f)if(n.flags&256)n.flags&=-257,n=Fv(e,n,s);else if(n.memoizedState!==null)n.child=e.child,n.flags|=128,n=null;else throw Error(a(558));else if(ot||Ka(e,n,s,!1),f=(s&e.childLanes)!==0,ot||f){if(c=Fe,c!==null&&(v=xp(c,s),v!==0&&v!==h.retryLane))throw h.retryLane=v,ta(e,v),qt(c,e,v),Td;oc(),n=Fv(e,n,s)}else e=h.treeContext,He=dn(v.nextSibling),Tt=n,Oe=!0,Ci=null,ln=!1,e!==null&&Dg(n,e),n=Xo(n,c),n.flags|=4096;return n}return e=Gn(e.child,{mode:c.mode,children:c.children}),e.ref=n.ref,n.child=e,e.return=n,e}function Zo(e,n){var s=n.ref;if(s===null)e!==null&&e.ref!==null&&(n.flags|=4194816);else{if(typeof s!="function"&&typeof s!="object")throw Error(a(284));(e===null||e.ref!==s)&&(n.flags|=4194816)}}function Cd(e,n,s,c,f){return sa(n),s=nd(e,n,s,c,void 0,f),c=id(),e!==null&&!ot?(ad(e,n,f),Zn(e,n,f)):(Oe&&c&&Iu(n),n.flags|=1,kt(e,n,s,f),n.child)}function Hv(e,n,s,c,f,h){return sa(n),n.updateQueue=null,s=Yg(n,c,s,f),Kg(e),c=id(),e!==null&&!ot?(ad(e,n,h),Zn(e,n,h)):(Oe&&c&&Iu(n),n.flags|=1,kt(e,n,s,h),n.child)}function Gv(e,n,s,c,f){if(sa(n),n.stateNode===null){var h=Va,v=s.contextType;typeof v=="object"&&v!==null&&(h=Ct(v)),h=new s(c,h),n.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=bd,n.stateNode=h,h._reactInternals=n,h=n.stateNode,h.props=c,h.state=n.memoizedState,h.refs={},Qu(n),v=s.contextType,h.context=typeof v=="object"&&v!==null?Ct(v):Va,h.state=n.memoizedState,v=s.getDerivedStateFromProps,typeof v=="function"&&(yd(n,s,v,c),h.state=n.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof h.getSnapshotBeforeUpdate=="function"||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(v=h.state,typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),v!==h.state&&bd.enqueueReplaceState(h,h.state,null),ir(n,c,h,f),nr(),h.state=n.memoizedState),typeof h.componentDidMount=="function"&&(n.flags|=4194308),c=!0}else if(e===null){h=n.stateNode;var b=n.memoizedProps,k=da(s,b);h.props=k;var N=h.context,B=s.contextType;v=Va,typeof B=="object"&&B!==null&&(v=Ct(B));var V=s.getDerivedStateFromProps;B=typeof V=="function"||typeof h.getSnapshotBeforeUpdate=="function",b=n.pendingProps!==b,B||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(b||N!==v)&&wv(n,h,c,v),_i=!1;var P=n.memoizedState;h.state=P,ir(n,c,h,f),nr(),N=n.memoizedState,b||P!==N||_i?(typeof V=="function"&&(yd(n,s,V,c),N=n.memoizedState),(k=_i||Mv(n,s,k,c,P,N,v))?(B||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount()),typeof h.componentDidMount=="function"&&(n.flags|=4194308)):(typeof h.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=c,n.memoizedState=N),h.props=c,h.state=N,h.context=v,c=k):(typeof h.componentDidMount=="function"&&(n.flags|=4194308),c=!1)}else{h=n.stateNode,Ju(e,n),v=n.memoizedProps,B=da(s,v),h.props=B,V=n.pendingProps,P=h.context,N=s.contextType,k=Va,typeof N=="object"&&N!==null&&(k=Ct(N)),b=s.getDerivedStateFromProps,(N=typeof b=="function"||typeof h.getSnapshotBeforeUpdate=="function")||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(v!==V||P!==k)&&wv(n,h,c,k),_i=!1,P=n.memoizedState,h.state=P,ir(n,c,h,f),nr();var U=n.memoizedState;v!==V||P!==U||_i||e!==null&&e.dependencies!==null&&No(e.dependencies)?(typeof b=="function"&&(yd(n,s,b,c),U=n.memoizedState),(B=_i||Mv(n,s,B,c,P,U,k)||e!==null&&e.dependencies!==null&&No(e.dependencies))?(N||typeof h.UNSAFE_componentWillUpdate!="function"&&typeof h.componentWillUpdate!="function"||(typeof h.componentWillUpdate=="function"&&h.componentWillUpdate(c,U,k),typeof h.UNSAFE_componentWillUpdate=="function"&&h.UNSAFE_componentWillUpdate(c,U,k)),typeof h.componentDidUpdate=="function"&&(n.flags|=4),typeof h.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof h.componentDidUpdate!="function"||v===e.memoizedProps&&P===e.memoizedState||(n.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||v===e.memoizedProps&&P===e.memoizedState||(n.flags|=1024),n.memoizedProps=c,n.memoizedState=U),h.props=c,h.state=U,h.context=k,c=B):(typeof h.componentDidUpdate!="function"||v===e.memoizedProps&&P===e.memoizedState||(n.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||v===e.memoizedProps&&P===e.memoizedState||(n.flags|=1024),c=!1)}return h=c,Zo(e,n),c=(n.flags&128)!==0,h||c?(h=n.stateNode,s=c&&typeof s.getDerivedStateFromError!="function"?null:h.render(),n.flags|=1,e!==null&&c?(n.child=la(n,e.child,null,f),n.child=la(n,null,s,f)):kt(e,n,s,f),n.memoizedState=h.state,e=n.child):e=Zn(e,n,f),e}function Kv(e,n,s,c){return ia(),n.flags|=256,kt(e,n,s,c),n.child}var kd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ed(e){return{baseLanes:e,cachePool:Ug()}}function _d(e,n,s){return e=e!==null?e.childLanes&~s:0,n&&(e|=Zt),e}function Yv(e,n,s){var c=n.pendingProps,f=!1,h=(n.flags&128)!==0,v;if((v=h)||(v=e!==null&&e.memoizedState===null?!1:(nt.current&2)!==0),v&&(f=!0,n.flags&=-129),v=(n.flags&32)!==0,n.flags&=-33,e===null){if(Oe){if(f?Ai(n):Di(),(e=He)?(e=ty(e,ln),e=e!==null&&e.data!=="&"?e:null,e!==null&&(n.memoizedState={dehydrated:e,treeContext:Ti!==null?{id:Mn,overflow:wn}:null,retryLane:536870912,hydrationErrors:null},s=Rg(e),s.return=n,n.child=s,Tt=n,He=null)):e=null,e===null)throw ki(n);return cf(e)?n.lanes=32:n.lanes=536870912,null}var b=c.children;return c=c.fallback,f?(Di(),f=n.mode,b=Wo({mode:"hidden",children:b},f),c=na(c,f,s,null),b.return=n,c.return=n,b.sibling=c,n.child=b,c=n.child,c.memoizedState=Ed(s),c.childLanes=_d(e,v,s),n.memoizedState=kd,cr(null,c)):(Ai(n),Rd(n,b))}var k=e.memoizedState;if(k!==null&&(b=k.dehydrated,b!==null)){if(h)n.flags&256?(Ai(n),n.flags&=-257,n=Od(e,n,s)):n.memoizedState!==null?(Di(),n.child=e.child,n.flags|=128,n=null):(Di(),b=c.fallback,f=n.mode,c=Wo({mode:"visible",children:c.children},f),b=na(b,f,s,null),b.flags|=2,c.return=n,b.return=n,c.sibling=b,n.child=c,la(n,e.child,null,s),c=n.child,c.memoizedState=Ed(s),c.childLanes=_d(e,v,s),n.memoizedState=kd,n=cr(null,c));else if(Ai(n),cf(b)){if(v=b.nextSibling&&b.nextSibling.dataset,v)var N=v.dgst;v=N,c=Error(a(419)),c.stack="",c.digest=v,Xs({value:c,source:null,stack:null}),n=Od(e,n,s)}else if(ot||Ka(e,n,s,!1),v=(s&e.childLanes)!==0,ot||v){if(v=Fe,v!==null&&(c=xp(v,s),c!==0&&c!==k.retryLane))throw k.retryLane=c,ta(e,c),qt(v,e,c),Td;of(b)||oc(),n=Od(e,n,s)}else of(b)?(n.flags|=192,n.child=e.child,n=null):(e=k.treeContext,He=dn(b.nextSibling),Tt=n,Oe=!0,Ci=null,ln=!1,e!==null&&Dg(n,e),n=Rd(n,c.children),n.flags|=4096);return n}return f?(Di(),b=c.fallback,f=n.mode,k=e.child,N=k.sibling,c=Gn(k,{mode:"hidden",children:c.children}),c.subtreeFlags=k.subtreeFlags&65011712,N!==null?b=Gn(N,b):(b=na(b,f,s,null),b.flags|=2),b.return=n,c.return=n,c.sibling=b,n.child=c,cr(null,c),c=n.child,b=e.child.memoizedState,b===null?b=Ed(s):(f=b.cachePool,f!==null?(k=st._currentValue,f=f.parent!==k?{parent:k,pool:k}:f):f=Ug(),b={baseLanes:b.baseLanes|s,cachePool:f}),c.memoizedState=b,c.childLanes=_d(e,v,s),n.memoizedState=kd,cr(e.child,c)):(Ai(n),s=e.child,e=s.sibling,s=Gn(s,{mode:"visible",children:c.children}),s.return=n,s.sibling=null,e!==null&&(v=n.deletions,v===null?(n.deletions=[e],n.flags|=16):v.push(e)),n.child=s,n.memoizedState=null,s)}function Rd(e,n){return n=Wo({mode:"visible",children:n},e.mode),n.return=e,e.child=n}function Wo(e,n){return e=Yt(22,e,null,n),e.lanes=0,e}function Od(e,n,s){return la(n,e.child,null,s),e=Rd(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function Qv(e,n,s){e.lanes|=n;var c=e.alternate;c!==null&&(c.lanes|=n),Vu(e.return,n,s)}function Ad(e,n,s,c,f,h){var v=e.memoizedState;v===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:c,tail:s,tailMode:f,treeForkCount:h}:(v.isBackwards=n,v.rendering=null,v.renderingStartTime=0,v.last=c,v.tail=s,v.tailMode=f,v.treeForkCount=h)}function Jv(e,n,s){var c=n.pendingProps,f=c.revealOrder,h=c.tail;c=c.children;var v=nt.current,b=(v&2)!==0;if(b?(v=v&1|2,n.flags|=128):v&=1,ee(nt,v),kt(e,n,c,s),c=Oe?Js:0,!b&&e!==null&&(e.flags&128)!==0)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Qv(e,s,n);else if(e.tag===19)Qv(e,s,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(f){case"forwards":for(s=n.child,f=null;s!==null;)e=s.alternate,e!==null&&zo(e)===null&&(f=s),s=s.sibling;s=f,s===null?(f=n.child,n.child=null):(f=s.sibling,s.sibling=null),Ad(n,!1,f,s,h,c);break;case"backwards":case"unstable_legacy-backwards":for(s=null,f=n.child,n.child=null;f!==null;){if(e=f.alternate,e!==null&&zo(e)===null){n.child=f;break}e=f.sibling,f.sibling=s,s=f,f=e}Ad(n,!0,s,null,h,c);break;case"together":Ad(n,!1,null,null,void 0,c);break;default:n.memoizedState=null}return n.child}function Zn(e,n,s){if(e!==null&&(n.dependencies=e.dependencies),Ni|=n.lanes,(s&n.childLanes)===0)if(e!==null){if(Ka(e,n,s,!1),(s&n.childLanes)===0)return null}else return null;if(e!==null&&n.child!==e.child)throw Error(a(153));if(n.child!==null){for(e=n.child,s=Gn(e,e.pendingProps),n.child=s,s.return=n;e.sibling!==null;)e=e.sibling,s=s.sibling=Gn(e,e.pendingProps),s.return=n;s.sibling=null}return n.child}function Dd(e,n){return(e.lanes&n)!==0?!0:(e=e.dependencies,!!(e!==null&&No(e)))}function ME(e,n,s){switch(n.tag){case 3:Mt(n,n.stateNode.containerInfo),Ei(n,st,e.memoizedState.cache),ia();break;case 27:case 5:Ps(n);break;case 4:Mt(n,n.stateNode.containerInfo);break;case 10:Ei(n,n.type,n.memoizedProps.value);break;case 31:if(n.memoizedState!==null)return n.flags|=128,ed(n),null;break;case 13:var c=n.memoizedState;if(c!==null)return c.dehydrated!==null?(Ai(n),n.flags|=128,null):(s&n.child.childLanes)!==0?Yv(e,n,s):(Ai(n),e=Zn(e,n,s),e!==null?e.sibling:null);Ai(n);break;case 19:var f=(e.flags&128)!==0;if(c=(s&n.childLanes)!==0,c||(Ka(e,n,s,!1),c=(s&n.childLanes)!==0),f){if(c)return Jv(e,n,s);n.flags|=128}if(f=n.memoizedState,f!==null&&(f.rendering=null,f.tail=null,f.lastEffect=null),ee(nt,nt.current),c)break;return null;case 22:return n.lanes=0,qv(e,n,s,n.pendingProps);case 24:Ei(n,st,e.memoizedState.cache)}return Zn(e,n,s)}function Xv(e,n,s){if(e!==null)if(e.memoizedProps!==n.pendingProps)ot=!0;else{if(!Dd(e,s)&&(n.flags&128)===0)return ot=!1,ME(e,n,s);ot=(e.flags&131072)!==0}else ot=!1,Oe&&(n.flags&1048576)!==0&&Ag(n,Js,n.index);switch(n.lanes=0,n.tag){case 16:e:{var c=n.pendingProps;if(e=oa(n.elementType),n.type=e,typeof e=="function")Pu(e)?(c=da(e,c),n.tag=1,n=Gv(null,n,e,c,s)):(n.tag=0,n=Cd(null,n,e,c,s));else{if(e!=null){var f=e.$$typeof;if(f===D){n.tag=11,n=Bv(null,n,e,c,s);break e}else if(f===Y){n.tag=14,n=jv(null,n,e,c,s);break e}}throw n=mt(e)||e,Error(a(306,n,""))}}return n;case 0:return Cd(e,n,n.type,n.pendingProps,s);case 1:return c=n.type,f=da(c,n.pendingProps),Gv(e,n,c,f,s);case 3:e:{if(Mt(n,n.stateNode.containerInfo),e===null)throw Error(a(387));c=n.pendingProps;var h=n.memoizedState;f=h.element,Ju(e,n),ir(n,c,null,s);var v=n.memoizedState;if(c=v.cache,Ei(n,st,c),c!==h.cache&&Fu(n,[st],s,!0),nr(),c=v.element,h.isDehydrated)if(h={element:c,isDehydrated:!1,cache:v.cache},n.updateQueue.baseState=h,n.memoizedState=h,n.flags&256){n=Kv(e,n,c,s);break e}else if(c!==f){f=rn(Error(a(424)),n),Xs(f),n=Kv(e,n,c,s);break e}else{switch(e=n.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(He=dn(e.firstChild),Tt=n,Oe=!0,Ci=null,ln=!0,s=qg(n,null,c,s),n.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling}else{if(ia(),c===f){n=Zn(e,n,s);break e}kt(e,n,c,s)}n=n.child}return n;case 26:return Zo(e,n),e===null?(s=oy(n.type,null,n.pendingProps,null))?n.memoizedState=s:Oe||(s=n.type,e=n.pendingProps,c=mc(ve.current).createElement(s),c[St]=n,c[Ut]=e,Et(c,s,e),pt(c),n.stateNode=c):n.memoizedState=oy(n.type,e.memoizedProps,n.pendingProps,e.memoizedState),null;case 27:return Ps(n),e===null&&Oe&&(c=n.stateNode=ay(n.type,n.pendingProps,ve.current),Tt=n,ln=!0,f=He,Ii(n.type)?(lf=f,He=dn(c.firstChild)):He=f),kt(e,n,n.pendingProps.children,s),Zo(e,n),e===null&&(n.flags|=4194304),n.child;case 5:return e===null&&Oe&&((f=c=He)&&(c=r_(c,n.type,n.pendingProps,ln),c!==null?(n.stateNode=c,Tt=n,He=dn(c.firstChild),ln=!1,f=!0):f=!1),f||ki(n)),Ps(n),f=n.type,h=n.pendingProps,v=e!==null?e.memoizedProps:null,c=h.children,af(f,h)?c=null:v!==null&&af(f,v)&&(n.flags|=32),n.memoizedState!==null&&(f=nd(e,n,TE,null,null,s),kr._currentValue=f),Zo(e,n),kt(e,n,c,s),n.child;case 6:return e===null&&Oe&&((e=s=He)&&(s=o_(s,n.pendingProps,ln),s!==null?(n.stateNode=s,Tt=n,He=null,e=!0):e=!1),e||ki(n)),null;case 13:return Yv(e,n,s);case 4:return Mt(n,n.stateNode.containerInfo),c=n.pendingProps,e===null?n.child=la(n,null,c,s):kt(e,n,c,s),n.child;case 11:return Bv(e,n,n.type,n.pendingProps,s);case 7:return kt(e,n,n.pendingProps,s),n.child;case 8:return kt(e,n,n.pendingProps.children,s),n.child;case 12:return kt(e,n,n.pendingProps.children,s),n.child;case 10:return c=n.pendingProps,Ei(n,n.type,c.value),kt(e,n,c.children,s),n.child;case 9:return f=n.type._context,c=n.pendingProps.children,sa(n),f=Ct(f),c=c(f),n.flags|=1,kt(e,n,c,s),n.child;case 14:return jv(e,n,n.type,n.pendingProps,s);case 15:return zv(e,n,n.type,n.pendingProps,s);case 19:return Jv(e,n,s);case 31:return DE(e,n,s);case 22:return qv(e,n,s,n.pendingProps);case 24:return sa(n),c=Ct(st),e===null?(f=Ku(),f===null&&(f=Fe,h=Hu(),f.pooledCache=h,h.refCount++,h!==null&&(f.pooledCacheLanes|=s),f=h),n.memoizedState={parent:c,cache:f},Qu(n),Ei(n,st,f)):((e.lanes&s)!==0&&(Ju(e,n),ir(n,null,null,s),nr()),f=e.memoizedState,h=n.memoizedState,f.parent!==c?(f={parent:c,cache:c},n.memoizedState=f,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=f),Ei(n,st,c)):(c=h.cache,Ei(n,st,c),c!==f.cache&&Fu(n,[st],s,!0))),kt(e,n,n.pendingProps.children,s),n.child;case 29:throw n.pendingProps}throw Error(a(156,n.tag))}function Wn(e){e.flags|=4}function Md(e,n,s,c,f){if((n=(e.mode&32)!==0)&&(n=!1),n){if(e.flags|=16777216,(f&335544128)===f)if(e.stateNode.complete)e.flags|=8192;else if(k0())e.flags|=8192;else throw ca=Lo,Yu}else e.flags&=-16777217}function Zv(e,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!fy(n))if(k0())e.flags|=8192;else throw ca=Lo,Yu}function $o(e,n){n!==null&&(e.flags|=4),e.flags&16384&&(n=e.tag!==22?Mp():536870912,e.lanes|=n,as|=n)}function lr(e,n){if(!Oe)switch(e.tailMode){case"hidden":n=e.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:c.sibling=null}}function Ge(e){var n=e.alternate!==null&&e.alternate.child===e.child,s=0,c=0;if(n)for(var f=e.child;f!==null;)s|=f.lanes|f.childLanes,c|=f.subtreeFlags&65011712,c|=f.flags&65011712,f.return=e,f=f.sibling;else for(f=e.child;f!==null;)s|=f.lanes|f.childLanes,c|=f.subtreeFlags,c|=f.flags,f.return=e,f=f.sibling;return e.subtreeFlags|=c,e.childLanes=s,n}function wE(e,n,s){var c=n.pendingProps;switch(Bu(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ge(n),null;case 1:return Ge(n),null;case 3:return s=n.stateNode,c=null,e!==null&&(c=e.memoizedState.cache),n.memoizedState.cache!==c&&(n.flags|=2048),Qn(st),tt(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(Ga(n)?Wn(n):e===null||e.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,zu())),Ge(n),null;case 26:var f=n.type,h=n.memoizedState;return e===null?(Wn(n),h!==null?(Ge(n),Zv(n,h)):(Ge(n),Md(n,f,null,c,s))):h?h!==e.memoizedState?(Wn(n),Ge(n),Zv(n,h)):(Ge(n),n.flags&=-16777217):(e=e.memoizedProps,e!==c&&Wn(n),Ge(n),Md(n,f,e,c,s)),null;case 27:if(lo(n),s=ve.current,f=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==c&&Wn(n);else{if(!c){if(n.stateNode===null)throw Error(a(166));return Ge(n),null}e=re.current,Ga(n)?Mg(n):(e=ay(f,c,s),n.stateNode=e,Wn(n))}return Ge(n),null;case 5:if(lo(n),f=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==c&&Wn(n);else{if(!c){if(n.stateNode===null)throw Error(a(166));return Ge(n),null}if(h=re.current,Ga(n))Mg(n);else{var v=mc(ve.current);switch(h){case 1:h=v.createElementNS("http://www.w3.org/2000/svg",f);break;case 2:h=v.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;default:switch(f){case"svg":h=v.createElementNS("http://www.w3.org/2000/svg",f);break;case"math":h=v.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;case"script":h=v.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild);break;case"select":h=typeof c.is=="string"?v.createElement("select",{is:c.is}):v.createElement("select"),c.multiple?h.multiple=!0:c.size&&(h.size=c.size);break;default:h=typeof c.is=="string"?v.createElement(f,{is:c.is}):v.createElement(f)}}h[St]=n,h[Ut]=c;e:for(v=n.child;v!==null;){if(v.tag===5||v.tag===6)h.appendChild(v.stateNode);else if(v.tag!==4&&v.tag!==27&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===n)break e;for(;v.sibling===null;){if(v.return===null||v.return===n)break e;v=v.return}v.sibling.return=v.return,v=v.sibling}n.stateNode=h;e:switch(Et(h,f,c),f){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&Wn(n)}}return Ge(n),Md(n,n.type,e===null?null:e.memoizedProps,n.pendingProps,s),null;case 6:if(e&&n.stateNode!=null)e.memoizedProps!==c&&Wn(n);else{if(typeof c!="string"&&n.stateNode===null)throw Error(a(166));if(e=ve.current,Ga(n)){if(e=n.stateNode,s=n.memoizedProps,c=null,f=Tt,f!==null)switch(f.tag){case 27:case 5:c=f.memoizedProps}e[St]=n,e=!!(e.nodeValue===s||c!==null&&c.suppressHydrationWarning===!0||Y0(e.nodeValue,s)),e||ki(n,!0)}else e=mc(e).createTextNode(c),e[St]=n,n.stateNode=e}return Ge(n),null;case 31:if(s=n.memoizedState,e===null||e.memoizedState!==null){if(c=Ga(n),s!==null){if(e===null){if(!c)throw Error(a(318));if(e=n.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(557));e[St]=n}else ia(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Ge(n),e=!1}else s=zu(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=s),e=!0;if(!e)return n.flags&256?(Jt(n),n):(Jt(n),null);if((n.flags&128)!==0)throw Error(a(558))}return Ge(n),null;case 13:if(c=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(f=Ga(n),c!==null&&c.dehydrated!==null){if(e===null){if(!f)throw Error(a(318));if(f=n.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(a(317));f[St]=n}else ia(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Ge(n),f=!1}else f=zu(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=f),f=!0;if(!f)return n.flags&256?(Jt(n),n):(Jt(n),null)}return Jt(n),(n.flags&128)!==0?(n.lanes=s,n):(s=c!==null,e=e!==null&&e.memoizedState!==null,s&&(c=n.child,f=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(f=c.alternate.memoizedState.cachePool.pool),h=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(h=c.memoizedState.cachePool.pool),h!==f&&(c.flags|=2048)),s!==e&&s&&(n.child.flags|=8192),$o(n,n.updateQueue),Ge(n),null);case 4:return tt(),e===null&&Wd(n.stateNode.containerInfo),Ge(n),null;case 10:return Qn(n.type),Ge(n),null;case 19:if(q(nt),c=n.memoizedState,c===null)return Ge(n),null;if(f=(n.flags&128)!==0,h=c.rendering,h===null)if(f)lr(c,!1);else{if($e!==0||e!==null&&(e.flags&128)!==0)for(e=n.child;e!==null;){if(h=zo(e),h!==null){for(n.flags|=128,lr(c,!1),e=h.updateQueue,n.updateQueue=e,$o(n,e),n.subtreeFlags=0,e=s,s=n.child;s!==null;)_g(s,e),s=s.sibling;return ee(nt,nt.current&1|2),Oe&&Kn(n,c.treeForkCount),n.child}e=e.sibling}c.tail!==null&&Ft()>ac&&(n.flags|=128,f=!0,lr(c,!1),n.lanes=4194304)}else{if(!f)if(e=zo(h),e!==null){if(n.flags|=128,f=!0,e=e.updateQueue,n.updateQueue=e,$o(n,e),lr(c,!0),c.tail===null&&c.tailMode==="hidden"&&!h.alternate&&!Oe)return Ge(n),null}else 2*Ft()-c.renderingStartTime>ac&&s!==536870912&&(n.flags|=128,f=!0,lr(c,!1),n.lanes=4194304);c.isBackwards?(h.sibling=n.child,n.child=h):(e=c.last,e!==null?e.sibling=h:n.child=h,c.last=h)}return c.tail!==null?(e=c.tail,c.rendering=e,c.tail=e.sibling,c.renderingStartTime=Ft(),e.sibling=null,s=nt.current,ee(nt,f?s&1|2:s&1),Oe&&Kn(n,c.treeForkCount),e):(Ge(n),null);case 22:case 23:return Jt(n),$u(),c=n.memoizedState!==null,e!==null?e.memoizedState!==null!==c&&(n.flags|=8192):c&&(n.flags|=8192),c?(s&536870912)!==0&&(n.flags&128)===0&&(Ge(n),n.subtreeFlags&6&&(n.flags|=8192)):Ge(n),s=n.updateQueue,s!==null&&$o(n,s.retryQueue),s=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(s=e.memoizedState.cachePool.pool),c=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(c=n.memoizedState.cachePool.pool),c!==s&&(n.flags|=2048),e!==null&&q(ra),null;case 24:return s=null,e!==null&&(s=e.memoizedState.cache),n.memoizedState.cache!==s&&(n.flags|=2048),Qn(st),Ge(n),null;case 25:return null;case 30:return null}throw Error(a(156,n.tag))}function NE(e,n){switch(Bu(n),n.tag){case 1:return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return Qn(st),tt(),e=n.flags,(e&65536)!==0&&(e&128)===0?(n.flags=e&-65537|128,n):null;case 26:case 27:case 5:return lo(n),null;case 31:if(n.memoizedState!==null){if(Jt(n),n.alternate===null)throw Error(a(340));ia()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 13:if(Jt(n),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(a(340));ia()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return q(nt),null;case 4:return tt(),null;case 10:return Qn(n.type),null;case 22:case 23:return Jt(n),$u(),e!==null&&q(ra),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 24:return Qn(st),null;case 25:return null;default:return null}}function Wv(e,n){switch(Bu(n),n.tag){case 3:Qn(st),tt();break;case 26:case 27:case 5:lo(n);break;case 4:tt();break;case 31:n.memoizedState!==null&&Jt(n);break;case 13:Jt(n);break;case 19:q(nt);break;case 10:Qn(n.type);break;case 22:case 23:Jt(n),$u(),e!==null&&q(ra);break;case 24:Qn(st)}}function ur(e,n){try{var s=n.updateQueue,c=s!==null?s.lastEffect:null;if(c!==null){var f=c.next;s=f;do{if((s.tag&e)===e){c=void 0;var h=s.create,v=s.inst;c=h(),v.destroy=c}s=s.next}while(s!==f)}}catch(b){Ie(n,n.return,b)}}function Mi(e,n,s){try{var c=n.updateQueue,f=c!==null?c.lastEffect:null;if(f!==null){var h=f.next;c=h;do{if((c.tag&e)===e){var v=c.inst,b=v.destroy;if(b!==void 0){v.destroy=void 0,f=n;var k=s,N=b;try{N()}catch(B){Ie(f,k,B)}}}c=c.next}while(c!==h)}}catch(B){Ie(n,n.return,B)}}function $v(e){var n=e.updateQueue;if(n!==null){var s=e.stateNode;try{Fg(n,s)}catch(c){Ie(e,e.return,c)}}}function e0(e,n,s){s.props=da(e.type,e.memoizedProps),s.state=e.memoizedState;try{s.componentWillUnmount()}catch(c){Ie(e,n,c)}}function dr(e,n){try{var s=e.ref;if(s!==null){switch(e.tag){case 26:case 27:case 5:var c=e.stateNode;break;case 30:c=e.stateNode;break;default:c=e.stateNode}typeof s=="function"?e.refCleanup=s(c):s.current=c}}catch(f){Ie(e,n,f)}}function Nn(e,n){var s=e.ref,c=e.refCleanup;if(s!==null)if(typeof c=="function")try{c()}catch(f){Ie(e,n,f)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof s=="function")try{s(null)}catch(f){Ie(e,n,f)}else s.current=null}function t0(e){var n=e.type,s=e.memoizedProps,c=e.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":s.autoFocus&&c.focus();break e;case"img":s.src?c.src=s.src:s.srcSet&&(c.srcset=s.srcSet)}}catch(f){Ie(e,e.return,f)}}function wd(e,n,s){try{var c=e.stateNode;e_(c,e.type,s,n),c[Ut]=n}catch(f){Ie(e,e.return,f)}}function n0(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Ii(e.type)||e.tag===4}function Nd(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||n0(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Ii(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function xd(e,n,s){var c=e.tag;if(c===5||c===6)e=e.stateNode,n?(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s).insertBefore(e,n):(n=s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,n.appendChild(e),s=s._reactRootContainer,s!=null||n.onclick!==null||(n.onclick=Fn));else if(c!==4&&(c===27&&Ii(e.type)&&(s=e.stateNode,n=null),e=e.child,e!==null))for(xd(e,n,s),e=e.sibling;e!==null;)xd(e,n,s),e=e.sibling}function ec(e,n,s){var c=e.tag;if(c===5||c===6)e=e.stateNode,n?s.insertBefore(e,n):s.appendChild(e);else if(c!==4&&(c===27&&Ii(e.type)&&(s=e.stateNode),e=e.child,e!==null))for(ec(e,n,s),e=e.sibling;e!==null;)ec(e,n,s),e=e.sibling}function i0(e){var n=e.stateNode,s=e.memoizedProps;try{for(var c=e.type,f=n.attributes;f.length;)n.removeAttributeNode(f[0]);Et(n,c,s),n[St]=e,n[Ut]=s}catch(h){Ie(e,e.return,h)}}var $n=!1,ct=!1,Pd=!1,a0=typeof WeakSet=="function"?WeakSet:Set,gt=null;function xE(e,n){if(e=e.containerInfo,tf=Tc,e=gg(e),Ou(e)){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{s=(s=e.ownerDocument)&&s.defaultView||window;var c=s.getSelection&&s.getSelection();if(c&&c.rangeCount!==0){s=c.anchorNode;var f=c.anchorOffset,h=c.focusNode;c=c.focusOffset;try{s.nodeType,h.nodeType}catch{s=null;break e}var v=0,b=-1,k=-1,N=0,B=0,V=e,P=null;t:for(;;){for(var U;V!==s||f!==0&&V.nodeType!==3||(b=v+f),V!==h||c!==0&&V.nodeType!==3||(k=v+c),V.nodeType===3&&(v+=V.nodeValue.length),(U=V.firstChild)!==null;)P=V,V=U;for(;;){if(V===e)break t;if(P===s&&++N===f&&(b=v),P===h&&++B===c&&(k=v),(U=V.nextSibling)!==null)break;V=P,P=V.parentNode}V=U}s=b===-1||k===-1?null:{start:b,end:k}}else s=null}s=s||{start:0,end:0}}else s=null;for(nf={focusedElem:e,selectionRange:s},Tc=!1,gt=n;gt!==null;)if(n=gt,e=n.child,(n.subtreeFlags&1028)!==0&&e!==null)e.return=n,gt=e;else for(;gt!==null;){switch(n=gt,h=n.alternate,e=n.flags,n.tag){case 0:if((e&4)!==0&&(e=n.updateQueue,e=e!==null?e.events:null,e!==null))for(s=0;s<e.length;s++)f=e[s],f.ref.impl=f.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&h!==null){e=void 0,s=n,f=h.memoizedProps,h=h.memoizedState,c=s.stateNode;try{var se=da(s.type,f);e=c.getSnapshotBeforeUpdate(se,h),c.__reactInternalSnapshotBeforeUpdate=e}catch(ue){Ie(s,s.return,ue)}}break;case 3:if((e&1024)!==0){if(e=n.stateNode.containerInfo,s=e.nodeType,s===9)rf(e);else if(s===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":rf(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(a(163))}if(e=n.sibling,e!==null){e.return=n.return,gt=e;break}gt=n.return}}function s0(e,n,s){var c=s.flags;switch(s.tag){case 0:case 11:case 15:ti(e,s),c&4&&ur(5,s);break;case 1:if(ti(e,s),c&4)if(e=s.stateNode,n===null)try{e.componentDidMount()}catch(v){Ie(s,s.return,v)}else{var f=da(s.type,n.memoizedProps);n=n.memoizedState;try{e.componentDidUpdate(f,n,e.__reactInternalSnapshotBeforeUpdate)}catch(v){Ie(s,s.return,v)}}c&64&&$v(s),c&512&&dr(s,s.return);break;case 3:if(ti(e,s),c&64&&(e=s.updateQueue,e!==null)){if(n=null,s.child!==null)switch(s.child.tag){case 27:case 5:n=s.child.stateNode;break;case 1:n=s.child.stateNode}try{Fg(e,n)}catch(v){Ie(s,s.return,v)}}break;case 27:n===null&&c&4&&i0(s);case 26:case 5:ti(e,s),n===null&&c&4&&t0(s),c&512&&dr(s,s.return);break;case 12:ti(e,s);break;case 31:ti(e,s),c&4&&c0(e,s);break;case 13:ti(e,s),c&4&&l0(e,s),c&64&&(e=s.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(s=VE.bind(null,s),c_(e,s))));break;case 22:if(c=s.memoizedState!==null||$n,!c){n=n!==null&&n.memoizedState!==null||ct,f=$n;var h=ct;$n=c,(ct=n)&&!h?ni(e,s,(s.subtreeFlags&8772)!==0):ti(e,s),$n=f,ct=h}break;case 30:break;default:ti(e,s)}}function r0(e){var n=e.alternate;n!==null&&(e.alternate=null,r0(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&uu(n)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Ye=null,It=!1;function ei(e,n,s){for(s=s.child;s!==null;)o0(e,n,s),s=s.sibling}function o0(e,n,s){if(Ht&&typeof Ht.onCommitFiberUnmount=="function")try{Ht.onCommitFiberUnmount(Us,s)}catch{}switch(s.tag){case 26:ct||Nn(s,n),ei(e,n,s),s.memoizedState?s.memoizedState.count--:s.stateNode&&(s=s.stateNode,s.parentNode.removeChild(s));break;case 27:ct||Nn(s,n);var c=Ye,f=It;Ii(s.type)&&(Ye=s.stateNode,It=!1),ei(e,n,s),Sr(s.stateNode),Ye=c,It=f;break;case 5:ct||Nn(s,n);case 6:if(c=Ye,f=It,Ye=null,ei(e,n,s),Ye=c,It=f,Ye!==null)if(It)try{(Ye.nodeType===9?Ye.body:Ye.nodeName==="HTML"?Ye.ownerDocument.body:Ye).removeChild(s.stateNode)}catch(h){Ie(s,n,h)}else try{Ye.removeChild(s.stateNode)}catch(h){Ie(s,n,h)}break;case 18:Ye!==null&&(It?(e=Ye,$0(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,s.stateNode),fs(e)):$0(Ye,s.stateNode));break;case 4:c=Ye,f=It,Ye=s.stateNode.containerInfo,It=!0,ei(e,n,s),Ye=c,It=f;break;case 0:case 11:case 14:case 15:Mi(2,s,n),ct||Mi(4,s,n),ei(e,n,s);break;case 1:ct||(Nn(s,n),c=s.stateNode,typeof c.componentWillUnmount=="function"&&e0(s,n,c)),ei(e,n,s);break;case 21:ei(e,n,s);break;case 22:ct=(c=ct)||s.memoizedState!==null,ei(e,n,s),ct=c;break;default:ei(e,n,s)}}function c0(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{fs(e)}catch(s){Ie(n,n.return,s)}}}function l0(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{fs(e)}catch(s){Ie(n,n.return,s)}}function PE(e){switch(e.tag){case 31:case 13:case 19:var n=e.stateNode;return n===null&&(n=e.stateNode=new a0),n;case 22:return e=e.stateNode,n=e._retryCache,n===null&&(n=e._retryCache=new a0),n;default:throw Error(a(435,e.tag))}}function tc(e,n){var s=PE(e);n.forEach(function(c){if(!s.has(c)){s.add(c);var f=FE.bind(null,e,c);c.then(f,f)}})}function Bt(e,n){var s=n.deletions;if(s!==null)for(var c=0;c<s.length;c++){var f=s[c],h=e,v=n,b=v;e:for(;b!==null;){switch(b.tag){case 27:if(Ii(b.type)){Ye=b.stateNode,It=!1;break e}break;case 5:Ye=b.stateNode,It=!1;break e;case 3:case 4:Ye=b.stateNode.containerInfo,It=!0;break e}b=b.return}if(Ye===null)throw Error(a(160));o0(h,v,f),Ye=null,It=!1,h=f.alternate,h!==null&&(h.return=null),f.return=null}if(n.subtreeFlags&13886)for(n=n.child;n!==null;)u0(n,e),n=n.sibling}var Tn=null;function u0(e,n){var s=e.alternate,c=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Bt(n,e),jt(e),c&4&&(Mi(3,e,e.return),ur(3,e),Mi(5,e,e.return));break;case 1:Bt(n,e),jt(e),c&512&&(ct||s===null||Nn(s,s.return)),c&64&&$n&&(e=e.updateQueue,e!==null&&(c=e.callbacks,c!==null&&(s=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=s===null?c:s.concat(c))));break;case 26:var f=Tn;if(Bt(n,e),jt(e),c&512&&(ct||s===null||Nn(s,s.return)),c&4){var h=s!==null?s.memoizedState:null;if(c=e.memoizedState,s===null)if(c===null)if(e.stateNode===null){e:{c=e.type,s=e.memoizedProps,f=f.ownerDocument||f;t:switch(c){case"title":h=f.getElementsByTagName("title")[0],(!h||h[Bs]||h[St]||h.namespaceURI==="http://www.w3.org/2000/svg"||h.hasAttribute("itemprop"))&&(h=f.createElement(c),f.head.insertBefore(h,f.querySelector("head > title"))),Et(h,c,s),h[St]=e,pt(h),c=h;break e;case"link":var v=uy("link","href",f).get(c+(s.href||""));if(v){for(var b=0;b<v.length;b++)if(h=v[b],h.getAttribute("href")===(s.href==null||s.href===""?null:s.href)&&h.getAttribute("rel")===(s.rel==null?null:s.rel)&&h.getAttribute("title")===(s.title==null?null:s.title)&&h.getAttribute("crossorigin")===(s.crossOrigin==null?null:s.crossOrigin)){v.splice(b,1);break t}}h=f.createElement(c),Et(h,c,s),f.head.appendChild(h);break;case"meta":if(v=uy("meta","content",f).get(c+(s.content||""))){for(b=0;b<v.length;b++)if(h=v[b],h.getAttribute("content")===(s.content==null?null:""+s.content)&&h.getAttribute("name")===(s.name==null?null:s.name)&&h.getAttribute("property")===(s.property==null?null:s.property)&&h.getAttribute("http-equiv")===(s.httpEquiv==null?null:s.httpEquiv)&&h.getAttribute("charset")===(s.charSet==null?null:s.charSet)){v.splice(b,1);break t}}h=f.createElement(c),Et(h,c,s),f.head.appendChild(h);break;default:throw Error(a(468,c))}h[St]=e,pt(h),c=h}e.stateNode=c}else dy(f,e.type,e.stateNode);else e.stateNode=ly(f,c,e.memoizedProps);else h!==c?(h===null?s.stateNode!==null&&(s=s.stateNode,s.parentNode.removeChild(s)):h.count--,c===null?dy(f,e.type,e.stateNode):ly(f,c,e.memoizedProps)):c===null&&e.stateNode!==null&&wd(e,e.memoizedProps,s.memoizedProps)}break;case 27:Bt(n,e),jt(e),c&512&&(ct||s===null||Nn(s,s.return)),s!==null&&c&4&&wd(e,e.memoizedProps,s.memoizedProps);break;case 5:if(Bt(n,e),jt(e),c&512&&(ct||s===null||Nn(s,s.return)),e.flags&32){f=e.stateNode;try{Ua(f,"")}catch(se){Ie(e,e.return,se)}}c&4&&e.stateNode!=null&&(f=e.memoizedProps,wd(e,f,s!==null?s.memoizedProps:f)),c&1024&&(Pd=!0);break;case 6:if(Bt(n,e),jt(e),c&4){if(e.stateNode===null)throw Error(a(162));c=e.memoizedProps,s=e.stateNode;try{s.nodeValue=c}catch(se){Ie(e,e.return,se)}}break;case 3:if(vc=null,f=Tn,Tn=pc(n.containerInfo),Bt(n,e),Tn=f,jt(e),c&4&&s!==null&&s.memoizedState.isDehydrated)try{fs(n.containerInfo)}catch(se){Ie(e,e.return,se)}Pd&&(Pd=!1,d0(e));break;case 4:c=Tn,Tn=pc(e.stateNode.containerInfo),Bt(n,e),jt(e),Tn=c;break;case 12:Bt(n,e),jt(e);break;case 31:Bt(n,e),jt(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,tc(e,c)));break;case 13:Bt(n,e),jt(e),e.child.flags&8192&&e.memoizedState!==null!=(s!==null&&s.memoizedState!==null)&&(ic=Ft()),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,tc(e,c)));break;case 22:f=e.memoizedState!==null;var k=s!==null&&s.memoizedState!==null,N=$n,B=ct;if($n=N||f,ct=B||k,Bt(n,e),ct=B,$n=N,jt(e),c&8192)e:for(n=e.stateNode,n._visibility=f?n._visibility&-2:n._visibility|1,f&&(s===null||k||$n||ct||fa(e)),s=null,n=e;;){if(n.tag===5||n.tag===26){if(s===null){k=s=n;try{if(h=k.stateNode,f)v=h.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none";else{b=k.stateNode;var V=k.memoizedProps.style,P=V!=null&&V.hasOwnProperty("display")?V.display:null;b.style.display=P==null||typeof P=="boolean"?"":(""+P).trim()}}catch(se){Ie(k,k.return,se)}}}else if(n.tag===6){if(s===null){k=n;try{k.stateNode.nodeValue=f?"":k.memoizedProps}catch(se){Ie(k,k.return,se)}}}else if(n.tag===18){if(s===null){k=n;try{var U=k.stateNode;f?ey(U,!0):ey(k.stateNode,!1)}catch(se){Ie(k,k.return,se)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===e)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;s===n&&(s=null),n=n.return}s===n&&(s=null),n.sibling.return=n.return,n=n.sibling}c&4&&(c=e.updateQueue,c!==null&&(s=c.retryQueue,s!==null&&(c.retryQueue=null,tc(e,s))));break;case 19:Bt(n,e),jt(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,tc(e,c)));break;case 30:break;case 21:break;default:Bt(n,e),jt(e)}}function jt(e){var n=e.flags;if(n&2){try{for(var s,c=e.return;c!==null;){if(n0(c)){s=c;break}c=c.return}if(s==null)throw Error(a(160));switch(s.tag){case 27:var f=s.stateNode,h=Nd(e);ec(e,h,f);break;case 5:var v=s.stateNode;s.flags&32&&(Ua(v,""),s.flags&=-33);var b=Nd(e);ec(e,b,v);break;case 3:case 4:var k=s.stateNode.containerInfo,N=Nd(e);xd(e,N,k);break;default:throw Error(a(161))}}catch(B){Ie(e,e.return,B)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function d0(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var n=e;d0(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),e=e.sibling}}function ti(e,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)s0(e,n.alternate,n),n=n.sibling}function fa(e){for(e=e.child;e!==null;){var n=e;switch(n.tag){case 0:case 11:case 14:case 15:Mi(4,n,n.return),fa(n);break;case 1:Nn(n,n.return);var s=n.stateNode;typeof s.componentWillUnmount=="function"&&e0(n,n.return,s),fa(n);break;case 27:Sr(n.stateNode);case 26:case 5:Nn(n,n.return),fa(n);break;case 22:n.memoizedState===null&&fa(n);break;case 30:fa(n);break;default:fa(n)}e=e.sibling}}function ni(e,n,s){for(s=s&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var c=n.alternate,f=e,h=n,v=h.flags;switch(h.tag){case 0:case 11:case 15:ni(f,h,s),ur(4,h);break;case 1:if(ni(f,h,s),c=h,f=c.stateNode,typeof f.componentDidMount=="function")try{f.componentDidMount()}catch(N){Ie(c,c.return,N)}if(c=h,f=c.updateQueue,f!==null){var b=c.stateNode;try{var k=f.shared.hiddenCallbacks;if(k!==null)for(f.shared.hiddenCallbacks=null,f=0;f<k.length;f++)Vg(k[f],b)}catch(N){Ie(c,c.return,N)}}s&&v&64&&$v(h),dr(h,h.return);break;case 27:i0(h);case 26:case 5:ni(f,h,s),s&&c===null&&v&4&&t0(h),dr(h,h.return);break;case 12:ni(f,h,s);break;case 31:ni(f,h,s),s&&v&4&&c0(f,h);break;case 13:ni(f,h,s),s&&v&4&&l0(f,h);break;case 22:h.memoizedState===null&&ni(f,h,s),dr(h,h.return);break;case 30:break;default:ni(f,h,s)}n=n.sibling}}function Ud(e,n){var s=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(s=e.memoizedState.cachePool.pool),e=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(e=n.memoizedState.cachePool.pool),e!==s&&(e!=null&&e.refCount++,s!=null&&Zs(s))}function Ld(e,n){e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&Zs(e))}function Cn(e,n,s,c){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)f0(e,n,s,c),n=n.sibling}function f0(e,n,s,c){var f=n.flags;switch(n.tag){case 0:case 11:case 15:Cn(e,n,s,c),f&2048&&ur(9,n);break;case 1:Cn(e,n,s,c);break;case 3:Cn(e,n,s,c),f&2048&&(e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&Zs(e)));break;case 12:if(f&2048){Cn(e,n,s,c),e=n.stateNode;try{var h=n.memoizedProps,v=h.id,b=h.onPostCommit;typeof b=="function"&&b(v,n.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(k){Ie(n,n.return,k)}}else Cn(e,n,s,c);break;case 31:Cn(e,n,s,c);break;case 13:Cn(e,n,s,c);break;case 23:break;case 22:h=n.stateNode,v=n.alternate,n.memoizedState!==null?h._visibility&2?Cn(e,n,s,c):fr(e,n):h._visibility&2?Cn(e,n,s,c):(h._visibility|=2,ts(e,n,s,c,(n.subtreeFlags&10256)!==0||!1)),f&2048&&Ud(v,n);break;case 24:Cn(e,n,s,c),f&2048&&Ld(n.alternate,n);break;default:Cn(e,n,s,c)}}function ts(e,n,s,c,f){for(f=f&&((n.subtreeFlags&10256)!==0||!1),n=n.child;n!==null;){var h=e,v=n,b=s,k=c,N=v.flags;switch(v.tag){case 0:case 11:case 15:ts(h,v,b,k,f),ur(8,v);break;case 23:break;case 22:var B=v.stateNode;v.memoizedState!==null?B._visibility&2?ts(h,v,b,k,f):fr(h,v):(B._visibility|=2,ts(h,v,b,k,f)),f&&N&2048&&Ud(v.alternate,v);break;case 24:ts(h,v,b,k,f),f&&N&2048&&Ld(v.alternate,v);break;default:ts(h,v,b,k,f)}n=n.sibling}}function fr(e,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var s=e,c=n,f=c.flags;switch(c.tag){case 22:fr(s,c),f&2048&&Ud(c.alternate,c);break;case 24:fr(s,c),f&2048&&Ld(c.alternate,c);break;default:fr(s,c)}n=n.sibling}}var hr=8192;function ns(e,n,s){if(e.subtreeFlags&hr)for(e=e.child;e!==null;)h0(e,n,s),e=e.sibling}function h0(e,n,s){switch(e.tag){case 26:ns(e,n,s),e.flags&hr&&e.memoizedState!==null&&S_(s,Tn,e.memoizedState,e.memoizedProps);break;case 5:ns(e,n,s);break;case 3:case 4:var c=Tn;Tn=pc(e.stateNode.containerInfo),ns(e,n,s),Tn=c;break;case 22:e.memoizedState===null&&(c=e.alternate,c!==null&&c.memoizedState!==null?(c=hr,hr=16777216,ns(e,n,s),hr=c):ns(e,n,s));break;default:ns(e,n,s)}}function m0(e){var n=e.alternate;if(n!==null&&(e=n.child,e!==null)){n.child=null;do n=e.sibling,e.sibling=null,e=n;while(e!==null)}}function mr(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var s=0;s<n.length;s++){var c=n[s];gt=c,g0(c,e)}m0(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)p0(e),e=e.sibling}function p0(e){switch(e.tag){case 0:case 11:case 15:mr(e),e.flags&2048&&Mi(9,e,e.return);break;case 3:mr(e);break;case 12:mr(e);break;case 22:var n=e.stateNode;e.memoizedState!==null&&n._visibility&2&&(e.return===null||e.return.tag!==13)?(n._visibility&=-3,nc(e)):mr(e);break;default:mr(e)}}function nc(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var s=0;s<n.length;s++){var c=n[s];gt=c,g0(c,e)}m0(e)}for(e=e.child;e!==null;){switch(n=e,n.tag){case 0:case 11:case 15:Mi(8,n,n.return),nc(n);break;case 22:s=n.stateNode,s._visibility&2&&(s._visibility&=-3,nc(n));break;default:nc(n)}e=e.sibling}}function g0(e,n){for(;gt!==null;){var s=gt;switch(s.tag){case 0:case 11:case 15:Mi(8,s,n);break;case 23:case 22:if(s.memoizedState!==null&&s.memoizedState.cachePool!==null){var c=s.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:Zs(s.memoizedState.cache)}if(c=s.child,c!==null)c.return=s,gt=c;else e:for(s=e;gt!==null;){c=gt;var f=c.sibling,h=c.return;if(r0(c),c===s){gt=null;break e}if(f!==null){f.return=h,gt=f;break e}gt=h}}}var UE={getCacheForType:function(e){var n=Ct(st),s=n.data.get(e);return s===void 0&&(s=e(),n.data.set(e,s)),s},cacheSignal:function(){return Ct(st).controller.signal}},LE=typeof WeakMap=="function"?WeakMap:Map,Pe=0,Fe=null,Ce=null,_e=0,Le=0,Xt=null,wi=!1,is=!1,Id=!1,ii=0,$e=0,Ni=0,ha=0,Bd=0,Zt=0,as=0,pr=null,zt=null,jd=!1,ic=0,v0=0,ac=1/0,sc=null,xi=null,dt=0,Pi=null,ss=null,ai=0,zd=0,qd=null,y0=null,gr=0,Vd=null;function Wt(){return(Pe&2)!==0&&_e!==0?_e&-_e:j.T!==null?Qd():Pp()}function b0(){if(Zt===0)if((_e&536870912)===0||Oe){var e=ho;ho<<=1,(ho&3932160)===0&&(ho=262144),Zt=e}else Zt=536870912;return e=Qt.current,e!==null&&(e.flags|=32),Zt}function qt(e,n,s){(e===Fe&&(Le===2||Le===9)||e.cancelPendingCommit!==null)&&(rs(e,0),Ui(e,_e,Zt,!1)),Is(e,s),((Pe&2)===0||e!==Fe)&&(e===Fe&&((Pe&2)===0&&(ha|=s),$e===4&&Ui(e,_e,Zt,!1)),xn(e))}function S0(e,n,s){if((Pe&6)!==0)throw Error(a(327));var c=!s&&(n&127)===0&&(n&e.expiredLanes)===0||Ls(e,n),f=c?jE(e,n):Hd(e,n,!0),h=c;do{if(f===0){is&&!c&&Ui(e,n,0,!1);break}else{if(s=e.current.alternate,h&&!IE(s)){f=Hd(e,n,!1),h=!1;continue}if(f===2){if(h=n,e.errorRecoveryDisabledLanes&h)var v=0;else v=e.pendingLanes&-536870913,v=v!==0?v:v&536870912?536870912:0;if(v!==0){n=v;e:{var b=e;f=pr;var k=b.current.memoizedState.isDehydrated;if(k&&(rs(b,v).flags|=256),v=Hd(b,v,!1),v!==2){if(Id&&!k){b.errorRecoveryDisabledLanes|=h,ha|=h,f=4;break e}h=zt,zt=f,h!==null&&(zt===null?zt=h:zt.push.apply(zt,h))}f=v}if(h=!1,f!==2)continue}}if(f===1){rs(e,0),Ui(e,n,0,!0);break}e:{switch(c=e,h=f,h){case 0:case 1:throw Error(a(345));case 4:if((n&4194048)!==n)break;case 6:Ui(c,n,Zt,!wi);break e;case 2:zt=null;break;case 3:case 5:break;default:throw Error(a(329))}if((n&62914560)===n&&(f=ic+300-Ft(),10<f)){if(Ui(c,n,Zt,!wi),po(c,0,!0)!==0)break e;ai=n,c.timeoutHandle=Z0(T0.bind(null,c,s,zt,sc,jd,n,Zt,ha,as,wi,h,"Throttled",-0,0),f);break e}T0(c,s,zt,sc,jd,n,Zt,ha,as,wi,h,null,-0,0)}}break}while(!0);xn(e)}function T0(e,n,s,c,f,h,v,b,k,N,B,V,P,U){if(e.timeoutHandle=-1,V=n.subtreeFlags,V&8192||(V&16785408)===16785408){V={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Fn},h0(n,h,V);var se=(h&62914560)===h?ic-Ft():(h&4194048)===h?v0-Ft():0;if(se=T_(V,se),se!==null){ai=h,e.cancelPendingCommit=se(D0.bind(null,e,n,h,s,c,f,v,b,k,B,V,null,P,U)),Ui(e,h,v,!N);return}}D0(e,n,h,s,c,f,v,b,k)}function IE(e){for(var n=e;;){var s=n.tag;if((s===0||s===11||s===15)&&n.flags&16384&&(s=n.updateQueue,s!==null&&(s=s.stores,s!==null)))for(var c=0;c<s.length;c++){var f=s[c],h=f.getSnapshot;f=f.value;try{if(!Kt(h(),f))return!1}catch{return!1}}if(s=n.child,n.subtreeFlags&16384&&s!==null)s.return=n,n=s;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Ui(e,n,s,c){n&=~Bd,n&=~ha,e.suspendedLanes|=n,e.pingedLanes&=~n,c&&(e.warmLanes|=n),c=e.expirationTimes;for(var f=n;0<f;){var h=31-Gt(f),v=1<<h;c[h]=-1,f&=~v}s!==0&&wp(e,s,n)}function rc(){return(Pe&6)===0?(vr(0),!1):!0}function Fd(){if(Ce!==null){if(Le===0)var e=Ce.return;else e=Ce,Yn=aa=null,sd(e),Xa=null,$s=0,e=Ce;for(;e!==null;)Wv(e.alternate,e),e=e.return;Ce=null}}function rs(e,n){var s=e.timeoutHandle;s!==-1&&(e.timeoutHandle=-1,i_(s)),s=e.cancelPendingCommit,s!==null&&(e.cancelPendingCommit=null,s()),ai=0,Fd(),Fe=e,Ce=s=Gn(e.current,null),_e=n,Le=0,Xt=null,wi=!1,is=Ls(e,n),Id=!1,as=Zt=Bd=ha=Ni=$e=0,zt=pr=null,jd=!1,(n&8)!==0&&(n|=n&32);var c=e.entangledLanes;if(c!==0)for(e=e.entanglements,c&=n;0<c;){var f=31-Gt(c),h=1<<f;n|=e[f],c&=~h}return ii=n,Oo(),s}function C0(e,n){pe=null,j.H=or,n===Ja||n===Uo?(n=Bg(),Le=3):n===Yu?(n=Bg(),Le=4):Le=n===Td?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,Xt=n,Ce===null&&($e=1,Jo(e,rn(n,e.current)))}function k0(){var e=Qt.current;return e===null?!0:(_e&4194048)===_e?un===null:(_e&62914560)===_e||(_e&536870912)!==0?e===un:!1}function E0(){var e=j.H;return j.H=or,e===null?or:e}function _0(){var e=j.A;return j.A=UE,e}function oc(){$e=4,wi||(_e&4194048)!==_e&&Qt.current!==null||(is=!0),(Ni&134217727)===0&&(ha&134217727)===0||Fe===null||Ui(Fe,_e,Zt,!1)}function Hd(e,n,s){var c=Pe;Pe|=2;var f=E0(),h=_0();(Fe!==e||_e!==n)&&(sc=null,rs(e,n)),n=!1;var v=$e;e:do try{if(Le!==0&&Ce!==null){var b=Ce,k=Xt;switch(Le){case 8:Fd(),v=6;break e;case 3:case 2:case 9:case 6:Qt.current===null&&(n=!0);var N=Le;if(Le=0,Xt=null,os(e,b,k,N),s&&is){v=0;break e}break;default:N=Le,Le=0,Xt=null,os(e,b,k,N)}}BE(),v=$e;break}catch(B){C0(e,B)}while(!0);return n&&e.shellSuspendCounter++,Yn=aa=null,Pe=c,j.H=f,j.A=h,Ce===null&&(Fe=null,_e=0,Oo()),v}function BE(){for(;Ce!==null;)R0(Ce)}function jE(e,n){var s=Pe;Pe|=2;var c=E0(),f=_0();Fe!==e||_e!==n?(sc=null,ac=Ft()+500,rs(e,n)):is=Ls(e,n);e:do try{if(Le!==0&&Ce!==null){n=Ce;var h=Xt;t:switch(Le){case 1:Le=0,Xt=null,os(e,n,h,1);break;case 2:case 9:if(Lg(h)){Le=0,Xt=null,O0(n);break}n=function(){Le!==2&&Le!==9||Fe!==e||(Le=7),xn(e)},h.then(n,n);break e;case 3:Le=7;break e;case 4:Le=5;break e;case 7:Lg(h)?(Le=0,Xt=null,O0(n)):(Le=0,Xt=null,os(e,n,h,7));break;case 5:var v=null;switch(Ce.tag){case 26:v=Ce.memoizedState;case 5:case 27:var b=Ce;if(v?fy(v):b.stateNode.complete){Le=0,Xt=null;var k=b.sibling;if(k!==null)Ce=k;else{var N=b.return;N!==null?(Ce=N,cc(N)):Ce=null}break t}}Le=0,Xt=null,os(e,n,h,5);break;case 6:Le=0,Xt=null,os(e,n,h,6);break;case 8:Fd(),$e=6;break e;default:throw Error(a(462))}}zE();break}catch(B){C0(e,B)}while(!0);return Yn=aa=null,j.H=c,j.A=f,Pe=s,Ce!==null?0:(Fe=null,_e=0,Oo(),$e)}function zE(){for(;Ce!==null&&!lk();)R0(Ce)}function R0(e){var n=Xv(e.alternate,e,ii);e.memoizedProps=e.pendingProps,n===null?cc(e):Ce=n}function O0(e){var n=e,s=n.alternate;switch(n.tag){case 15:case 0:n=Hv(s,n,n.pendingProps,n.type,void 0,_e);break;case 11:n=Hv(s,n,n.pendingProps,n.type.render,n.ref,_e);break;case 5:sd(n);default:Wv(s,n),n=Ce=_g(n,ii),n=Xv(s,n,ii)}e.memoizedProps=e.pendingProps,n===null?cc(e):Ce=n}function os(e,n,s,c){Yn=aa=null,sd(n),Xa=null,$s=0;var f=n.return;try{if(AE(e,f,n,s,_e)){$e=1,Jo(e,rn(s,e.current)),Ce=null;return}}catch(h){if(f!==null)throw Ce=f,h;$e=1,Jo(e,rn(s,e.current)),Ce=null;return}n.flags&32768?(Oe||c===1?e=!0:is||(_e&536870912)!==0?e=!1:(wi=e=!0,(c===2||c===9||c===3||c===6)&&(c=Qt.current,c!==null&&c.tag===13&&(c.flags|=16384))),A0(n,e)):cc(n)}function cc(e){var n=e;do{if((n.flags&32768)!==0){A0(n,wi);return}e=n.return;var s=wE(n.alternate,n,ii);if(s!==null){Ce=s;return}if(n=n.sibling,n!==null){Ce=n;return}Ce=n=e}while(n!==null);$e===0&&($e=5)}function A0(e,n){do{var s=NE(e.alternate,e);if(s!==null){s.flags&=32767,Ce=s;return}if(s=e.return,s!==null&&(s.flags|=32768,s.subtreeFlags=0,s.deletions=null),!n&&(e=e.sibling,e!==null)){Ce=e;return}Ce=e=s}while(e!==null);$e=6,Ce=null}function D0(e,n,s,c,f,h,v,b,k){e.cancelPendingCommit=null;do lc();while(dt!==0);if((Pe&6)!==0)throw Error(a(327));if(n!==null){if(n===e.current)throw Error(a(177));if(h=n.lanes|n.childLanes,h|=Nu,bk(e,s,h,v,b,k),e===Fe&&(Ce=Fe=null,_e=0),ss=n,Pi=e,ai=s,zd=h,qd=f,y0=c,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,HE(uo,function(){return P0(),null})):(e.callbackNode=null,e.callbackPriority=0),c=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||c){c=j.T,j.T=null,f=$.p,$.p=2,v=Pe,Pe|=4;try{xE(e,n,s)}finally{Pe=v,$.p=f,j.T=c}}dt=1,M0(),w0(),N0()}}function M0(){if(dt===1){dt=0;var e=Pi,n=ss,s=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||s){s=j.T,j.T=null;var c=$.p;$.p=2;var f=Pe;Pe|=4;try{u0(n,e);var h=nf,v=gg(e.containerInfo),b=h.focusedElem,k=h.selectionRange;if(v!==b&&b&&b.ownerDocument&&pg(b.ownerDocument.documentElement,b)){if(k!==null&&Ou(b)){var N=k.start,B=k.end;if(B===void 0&&(B=N),"selectionStart"in b)b.selectionStart=N,b.selectionEnd=Math.min(B,b.value.length);else{var V=b.ownerDocument||document,P=V&&V.defaultView||window;if(P.getSelection){var U=P.getSelection(),se=b.textContent.length,ue=Math.min(k.start,se),qe=k.end===void 0?ue:Math.min(k.end,se);!U.extend&&ue>qe&&(v=qe,qe=ue,ue=v);var R=mg(b,ue),E=mg(b,qe);if(R&&E&&(U.rangeCount!==1||U.anchorNode!==R.node||U.anchorOffset!==R.offset||U.focusNode!==E.node||U.focusOffset!==E.offset)){var M=V.createRange();M.setStart(R.node,R.offset),U.removeAllRanges(),ue>qe?(U.addRange(M),U.extend(E.node,E.offset)):(M.setEnd(E.node,E.offset),U.addRange(M))}}}}for(V=[],U=b;U=U.parentNode;)U.nodeType===1&&V.push({element:U,left:U.scrollLeft,top:U.scrollTop});for(typeof b.focus=="function"&&b.focus(),b=0;b<V.length;b++){var z=V[b];z.element.scrollLeft=z.left,z.element.scrollTop=z.top}}Tc=!!tf,nf=tf=null}finally{Pe=f,$.p=c,j.T=s}}e.current=n,dt=2}}function w0(){if(dt===2){dt=0;var e=Pi,n=ss,s=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||s){s=j.T,j.T=null;var c=$.p;$.p=2;var f=Pe;Pe|=4;try{s0(e,n.alternate,n)}finally{Pe=f,$.p=c,j.T=s}}dt=3}}function N0(){if(dt===4||dt===3){dt=0,uk();var e=Pi,n=ss,s=ai,c=y0;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?dt=5:(dt=0,ss=Pi=null,x0(e,e.pendingLanes));var f=e.pendingLanes;if(f===0&&(xi=null),cu(s),n=n.stateNode,Ht&&typeof Ht.onCommitFiberRoot=="function")try{Ht.onCommitFiberRoot(Us,n,void 0,(n.current.flags&128)===128)}catch{}if(c!==null){n=j.T,f=$.p,$.p=2,j.T=null;try{for(var h=e.onRecoverableError,v=0;v<c.length;v++){var b=c[v];h(b.value,{componentStack:b.stack})}}finally{j.T=n,$.p=f}}(ai&3)!==0&&lc(),xn(e),f=e.pendingLanes,(s&261930)!==0&&(f&42)!==0?e===Vd?gr++:(gr=0,Vd=e):gr=0,vr(0)}}function x0(e,n){(e.pooledCacheLanes&=n)===0&&(n=e.pooledCache,n!=null&&(e.pooledCache=null,Zs(n)))}function lc(){return M0(),w0(),N0(),P0()}function P0(){if(dt!==5)return!1;var e=Pi,n=zd;zd=0;var s=cu(ai),c=j.T,f=$.p;try{$.p=32>s?32:s,j.T=null,s=qd,qd=null;var h=Pi,v=ai;if(dt=0,ss=Pi=null,ai=0,(Pe&6)!==0)throw Error(a(331));var b=Pe;if(Pe|=4,p0(h.current),f0(h,h.current,v,s),Pe=b,vr(0,!1),Ht&&typeof Ht.onPostCommitFiberRoot=="function")try{Ht.onPostCommitFiberRoot(Us,h)}catch{}return!0}finally{$.p=f,j.T=c,x0(e,n)}}function U0(e,n,s){n=rn(s,n),n=Sd(e.stateNode,n,2),e=Oi(e,n,2),e!==null&&(Is(e,2),xn(e))}function Ie(e,n,s){if(e.tag===3)U0(e,e,s);else for(;n!==null;){if(n.tag===3){U0(n,e,s);break}else if(n.tag===1){var c=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(xi===null||!xi.has(c))){e=rn(s,e),s=Lv(2),c=Oi(n,s,2),c!==null&&(Iv(s,c,n,e),Is(c,2),xn(c));break}}n=n.return}}function Gd(e,n,s){var c=e.pingCache;if(c===null){c=e.pingCache=new LE;var f=new Set;c.set(n,f)}else f=c.get(n),f===void 0&&(f=new Set,c.set(n,f));f.has(s)||(Id=!0,f.add(s),e=qE.bind(null,e,n,s),n.then(e,e))}function qE(e,n,s){var c=e.pingCache;c!==null&&c.delete(n),e.pingedLanes|=e.suspendedLanes&s,e.warmLanes&=~s,Fe===e&&(_e&s)===s&&($e===4||$e===3&&(_e&62914560)===_e&&300>Ft()-ic?(Pe&2)===0&&rs(e,0):Bd|=s,as===_e&&(as=0)),xn(e)}function L0(e,n){n===0&&(n=Mp()),e=ta(e,n),e!==null&&(Is(e,n),xn(e))}function VE(e){var n=e.memoizedState,s=0;n!==null&&(s=n.retryLane),L0(e,s)}function FE(e,n){var s=0;switch(e.tag){case 31:case 13:var c=e.stateNode,f=e.memoizedState;f!==null&&(s=f.retryLane);break;case 19:c=e.stateNode;break;case 22:c=e.stateNode._retryCache;break;default:throw Error(a(314))}c!==null&&c.delete(n),L0(e,s)}function HE(e,n){return au(e,n)}var uc=null,cs=null,Kd=!1,dc=!1,Yd=!1,Li=0;function xn(e){e!==cs&&e.next===null&&(cs===null?uc=cs=e:cs=cs.next=e),dc=!0,Kd||(Kd=!0,KE())}function vr(e,n){if(!Yd&&dc){Yd=!0;do for(var s=!1,c=uc;c!==null;){if(e!==0){var f=c.pendingLanes;if(f===0)var h=0;else{var v=c.suspendedLanes,b=c.pingedLanes;h=(1<<31-Gt(42|e)+1)-1,h&=f&~(v&~b),h=h&201326741?h&201326741|1:h?h|2:0}h!==0&&(s=!0,z0(c,h))}else h=_e,h=po(c,c===Fe?h:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(h&3)===0||Ls(c,h)||(s=!0,z0(c,h));c=c.next}while(s);Yd=!1}}function GE(){I0()}function I0(){dc=Kd=!1;var e=0;Li!==0&&n_()&&(e=Li);for(var n=Ft(),s=null,c=uc;c!==null;){var f=c.next,h=B0(c,n);h===0?(c.next=null,s===null?uc=f:s.next=f,f===null&&(cs=s)):(s=c,(e!==0||(h&3)!==0)&&(dc=!0)),c=f}dt!==0&&dt!==5||vr(e),Li!==0&&(Li=0)}function B0(e,n){for(var s=e.suspendedLanes,c=e.pingedLanes,f=e.expirationTimes,h=e.pendingLanes&-62914561;0<h;){var v=31-Gt(h),b=1<<v,k=f[v];k===-1?((b&s)===0||(b&c)!==0)&&(f[v]=yk(b,n)):k<=n&&(e.expiredLanes|=b),h&=~b}if(n=Fe,s=_e,s=po(e,e===n?s:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c=e.callbackNode,s===0||e===n&&(Le===2||Le===9)||e.cancelPendingCommit!==null)return c!==null&&c!==null&&su(c),e.callbackNode=null,e.callbackPriority=0;if((s&3)===0||Ls(e,s)){if(n=s&-s,n===e.callbackPriority)return n;switch(c!==null&&su(c),cu(s)){case 2:case 8:s=Ap;break;case 32:s=uo;break;case 268435456:s=Dp;break;default:s=uo}return c=j0.bind(null,e),s=au(s,c),e.callbackPriority=n,e.callbackNode=s,n}return c!==null&&c!==null&&su(c),e.callbackPriority=2,e.callbackNode=null,2}function j0(e,n){if(dt!==0&&dt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var s=e.callbackNode;if(lc()&&e.callbackNode!==s)return null;var c=_e;return c=po(e,e===Fe?c:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c===0?null:(S0(e,c,n),B0(e,Ft()),e.callbackNode!=null&&e.callbackNode===s?j0.bind(null,e):null)}function z0(e,n){if(lc())return null;S0(e,n,!0)}function KE(){a_(function(){(Pe&6)!==0?au(Op,GE):I0()})}function Qd(){if(Li===0){var e=Ya;e===0&&(e=fo,fo<<=1,(fo&261888)===0&&(fo=256)),Li=e}return Li}function q0(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:bo(""+e)}function V0(e,n){var s=n.ownerDocument.createElement("input");return s.name=n.name,s.value=n.value,e.id&&s.setAttribute("form",e.id),n.parentNode.insertBefore(s,n),e=new FormData(e),s.parentNode.removeChild(s),e}function YE(e,n,s,c,f){if(n==="submit"&&s&&s.stateNode===f){var h=q0((f[Ut]||null).action),v=c.submitter;v&&(n=(n=v[Ut]||null)?q0(n.formAction):v.getAttribute("formAction"),n!==null&&(h=n,v=null));var b=new ko("action","action",null,c,f);e.push({event:b,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(Li!==0){var k=v?V0(f,v):new FormData(f);md(s,{pending:!0,data:k,method:f.method,action:h},null,k)}}else typeof h=="function"&&(b.preventDefault(),k=v?V0(f,v):new FormData(f),md(s,{pending:!0,data:k,method:f.method,action:h},h,k))},currentTarget:f}]})}}for(var Jd=0;Jd<wu.length;Jd++){var Xd=wu[Jd],QE=Xd.toLowerCase(),JE=Xd[0].toUpperCase()+Xd.slice(1);Sn(QE,"on"+JE)}Sn(bg,"onAnimationEnd"),Sn(Sg,"onAnimationIteration"),Sn(Tg,"onAnimationStart"),Sn("dblclick","onDoubleClick"),Sn("focusin","onFocus"),Sn("focusout","onBlur"),Sn(dE,"onTransitionRun"),Sn(fE,"onTransitionStart"),Sn(hE,"onTransitionCancel"),Sn(Cg,"onTransitionEnd"),xa("onMouseEnter",["mouseout","mouseover"]),xa("onMouseLeave",["mouseout","mouseover"]),xa("onPointerEnter",["pointerout","pointerover"]),xa("onPointerLeave",["pointerout","pointerover"]),Zi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Zi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Zi("onBeforeInput",["compositionend","keypress","textInput","paste"]),Zi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Zi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Zi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),XE=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(yr));function F0(e,n){n=(n&4)!==0;for(var s=0;s<e.length;s++){var c=e[s],f=c.event;c=c.listeners;e:{var h=void 0;if(n)for(var v=c.length-1;0<=v;v--){var b=c[v],k=b.instance,N=b.currentTarget;if(b=b.listener,k!==h&&f.isPropagationStopped())break e;h=b,f.currentTarget=N;try{h(f)}catch(B){Ro(B)}f.currentTarget=null,h=k}else for(v=0;v<c.length;v++){if(b=c[v],k=b.instance,N=b.currentTarget,b=b.listener,k!==h&&f.isPropagationStopped())break e;h=b,f.currentTarget=N;try{h(f)}catch(B){Ro(B)}f.currentTarget=null,h=k}}}}function ke(e,n){var s=n[lu];s===void 0&&(s=n[lu]=new Set);var c=e+"__bubble";s.has(c)||(H0(n,e,2,!1),s.add(c))}function Zd(e,n,s){var c=0;n&&(c|=4),H0(s,e,c,n)}var fc="_reactListening"+Math.random().toString(36).slice(2);function Wd(e){if(!e[fc]){e[fc]=!0,Ip.forEach(function(s){s!=="selectionchange"&&(XE.has(s)||Zd(s,!1,e),Zd(s,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[fc]||(n[fc]=!0,Zd("selectionchange",!1,n))}}function H0(e,n,s,c){switch(by(n)){case 2:var f=E_;break;case 8:f=__;break;default:f=mf}s=f.bind(null,n,s,e),f=void 0,!yu||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(f=!0),c?f!==void 0?e.addEventListener(n,s,{capture:!0,passive:f}):e.addEventListener(n,s,!0):f!==void 0?e.addEventListener(n,s,{passive:f}):e.addEventListener(n,s,!1)}function $d(e,n,s,c,f){var h=c;if((n&1)===0&&(n&2)===0&&c!==null)e:for(;;){if(c===null)return;var v=c.tag;if(v===3||v===4){var b=c.stateNode.containerInfo;if(b===f)break;if(v===4)for(v=c.return;v!==null;){var k=v.tag;if((k===3||k===4)&&v.stateNode.containerInfo===f)return;v=v.return}for(;b!==null;){if(v=Ma(b),v===null)return;if(k=v.tag,k===5||k===6||k===26||k===27){c=h=v;continue e}b=b.parentNode}}c=c.return}Jp(function(){var N=h,B=gu(s),V=[];e:{var P=kg.get(e);if(P!==void 0){var U=ko,se=e;switch(e){case"keypress":if(To(s)===0)break e;case"keydown":case"keyup":U=Fk;break;case"focusin":se="focus",U=Cu;break;case"focusout":se="blur",U=Cu;break;case"beforeblur":case"afterblur":U=Cu;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":U=Wp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":U=wk;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":U=Kk;break;case bg:case Sg:case Tg:U=Pk;break;case Cg:U=Qk;break;case"scroll":case"scrollend":U=Dk;break;case"wheel":U=Xk;break;case"copy":case"cut":case"paste":U=Lk;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":U=eg;break;case"toggle":case"beforetoggle":U=Wk}var ue=(n&4)!==0,qe=!ue&&(e==="scroll"||e==="scrollend"),R=ue?P!==null?P+"Capture":null:P;ue=[];for(var E=N,M;E!==null;){var z=E;if(M=z.stateNode,z=z.tag,z!==5&&z!==26&&z!==27||M===null||R===null||(z=zs(E,R),z!=null&&ue.push(br(E,z,M))),qe)break;E=E.return}0<ue.length&&(P=new U(P,se,null,s,B),V.push({event:P,listeners:ue}))}}if((n&7)===0){e:{if(P=e==="mouseover"||e==="pointerover",U=e==="mouseout"||e==="pointerout",P&&s!==pu&&(se=s.relatedTarget||s.fromElement)&&(Ma(se)||se[Da]))break e;if((U||P)&&(P=B.window===B?B:(P=B.ownerDocument)?P.defaultView||P.parentWindow:window,U?(se=s.relatedTarget||s.toElement,U=N,se=se?Ma(se):null,se!==null&&(qe=l(se),ue=se.tag,se!==qe||ue!==5&&ue!==27&&ue!==6)&&(se=null)):(U=null,se=N),U!==se)){if(ue=Wp,z="onMouseLeave",R="onMouseEnter",E="mouse",(e==="pointerout"||e==="pointerover")&&(ue=eg,z="onPointerLeave",R="onPointerEnter",E="pointer"),qe=U==null?P:js(U),M=se==null?P:js(se),P=new ue(z,E+"leave",U,s,B),P.target=qe,P.relatedTarget=M,z=null,Ma(B)===N&&(ue=new ue(R,E+"enter",se,s,B),ue.target=M,ue.relatedTarget=qe,z=ue),qe=z,U&&se)t:{for(ue=ZE,R=U,E=se,M=0,z=R;z;z=ue(z))M++;z=0;for(var ce=E;ce;ce=ue(ce))z++;for(;0<M-z;)R=ue(R),M--;for(;0<z-M;)E=ue(E),z--;for(;M--;){if(R===E||E!==null&&R===E.alternate){ue=R;break t}R=ue(R),E=ue(E)}ue=null}else ue=null;U!==null&&G0(V,P,U,ue,!1),se!==null&&qe!==null&&G0(V,qe,se,ue,!0)}}e:{if(P=N?js(N):window,U=P.nodeName&&P.nodeName.toLowerCase(),U==="select"||U==="input"&&P.type==="file")var De=cg;else if(rg(P))if(lg)De=cE;else{De=rE;var oe=sE}else U=P.nodeName,!U||U.toLowerCase()!=="input"||P.type!=="checkbox"&&P.type!=="radio"?N&&mu(N.elementType)&&(De=cg):De=oE;if(De&&(De=De(e,N))){og(V,De,s,B);break e}oe&&oe(e,P,N),e==="focusout"&&N&&P.type==="number"&&N.memoizedProps.value!=null&&hu(P,"number",P.value)}switch(oe=N?js(N):window,e){case"focusin":(rg(oe)||oe.contentEditable==="true")&&(ja=oe,Au=N,Qs=null);break;case"focusout":Qs=Au=ja=null;break;case"mousedown":Du=!0;break;case"contextmenu":case"mouseup":case"dragend":Du=!1,vg(V,s,B);break;case"selectionchange":if(uE)break;case"keydown":case"keyup":vg(V,s,B)}var ye;if(Eu)e:{switch(e){case"compositionstart":var Re="onCompositionStart";break e;case"compositionend":Re="onCompositionEnd";break e;case"compositionupdate":Re="onCompositionUpdate";break e}Re=void 0}else Ba?ag(e,s)&&(Re="onCompositionEnd"):e==="keydown"&&s.keyCode===229&&(Re="onCompositionStart");Re&&(tg&&s.locale!=="ko"&&(Ba||Re!=="onCompositionStart"?Re==="onCompositionEnd"&&Ba&&(ye=Xp()):(Si=B,bu="value"in Si?Si.value:Si.textContent,Ba=!0)),oe=hc(N,Re),0<oe.length&&(Re=new $p(Re,e,null,s,B),V.push({event:Re,listeners:oe}),ye?Re.data=ye:(ye=sg(s),ye!==null&&(Re.data=ye)))),(ye=eE?tE(e,s):nE(e,s))&&(Re=hc(N,"onBeforeInput"),0<Re.length&&(oe=new $p("onBeforeInput","beforeinput",null,s,B),V.push({event:oe,listeners:Re}),oe.data=ye)),YE(V,e,N,s,B)}F0(V,n)})}function br(e,n,s){return{instance:e,listener:n,currentTarget:s}}function hc(e,n){for(var s=n+"Capture",c=[];e!==null;){var f=e,h=f.stateNode;if(f=f.tag,f!==5&&f!==26&&f!==27||h===null||(f=zs(e,s),f!=null&&c.unshift(br(e,f,h)),f=zs(e,n),f!=null&&c.push(br(e,f,h))),e.tag===3)return c;e=e.return}return[]}function ZE(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function G0(e,n,s,c,f){for(var h=n._reactName,v=[];s!==null&&s!==c;){var b=s,k=b.alternate,N=b.stateNode;if(b=b.tag,k!==null&&k===c)break;b!==5&&b!==26&&b!==27||N===null||(k=N,f?(N=zs(s,h),N!=null&&v.unshift(br(s,N,k))):f||(N=zs(s,h),N!=null&&v.push(br(s,N,k)))),s=s.return}v.length!==0&&e.push({event:n,listeners:v})}var WE=/\r\n?/g,$E=/\u0000|\uFFFD/g;function K0(e){return(typeof e=="string"?e:""+e).replace(WE,`
`).replace($E,"")}function Y0(e,n){return n=K0(n),K0(e)===n}function ze(e,n,s,c,f,h){switch(s){case"children":typeof c=="string"?n==="body"||n==="textarea"&&c===""||Ua(e,c):(typeof c=="number"||typeof c=="bigint")&&n!=="body"&&Ua(e,""+c);break;case"className":vo(e,"class",c);break;case"tabIndex":vo(e,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":vo(e,s,c);break;case"style":Yp(e,c,h);break;case"data":if(n!=="object"){vo(e,"data",c);break}case"src":case"href":if(c===""&&(n!=="a"||s!=="href")){e.removeAttribute(s);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(s);break}c=bo(""+c),e.setAttribute(s,c);break;case"action":case"formAction":if(typeof c=="function"){e.setAttribute(s,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof h=="function"&&(s==="formAction"?(n!=="input"&&ze(e,n,"name",f.name,f,null),ze(e,n,"formEncType",f.formEncType,f,null),ze(e,n,"formMethod",f.formMethod,f,null),ze(e,n,"formTarget",f.formTarget,f,null)):(ze(e,n,"encType",f.encType,f,null),ze(e,n,"method",f.method,f,null),ze(e,n,"target",f.target,f,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(s);break}c=bo(""+c),e.setAttribute(s,c);break;case"onClick":c!=null&&(e.onclick=Fn);break;case"onScroll":c!=null&&ke("scroll",e);break;case"onScrollEnd":c!=null&&ke("scrollend",e);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(a(61));if(s=c.__html,s!=null){if(f.children!=null)throw Error(a(60));e.innerHTML=s}}break;case"multiple":e.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":e.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){e.removeAttribute("xlink:href");break}s=bo(""+c),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(s,""+c):e.removeAttribute(s);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(s,""):e.removeAttribute(s);break;case"capture":case"download":c===!0?e.setAttribute(s,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(s,c):e.removeAttribute(s);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?e.setAttribute(s,c):e.removeAttribute(s);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?e.removeAttribute(s):e.setAttribute(s,c);break;case"popover":ke("beforetoggle",e),ke("toggle",e),go(e,"popover",c);break;case"xlinkActuate":Vn(e,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":Vn(e,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":Vn(e,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":Vn(e,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":Vn(e,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":Vn(e,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":Vn(e,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":Vn(e,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":Vn(e,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":go(e,"is",c);break;case"innerText":case"textContent":break;default:(!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(s=Ok.get(s)||s,go(e,s,c))}}function ef(e,n,s,c,f,h){switch(s){case"style":Yp(e,c,h);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(a(61));if(s=c.__html,s!=null){if(f.children!=null)throw Error(a(60));e.innerHTML=s}}break;case"children":typeof c=="string"?Ua(e,c):(typeof c=="number"||typeof c=="bigint")&&Ua(e,""+c);break;case"onScroll":c!=null&&ke("scroll",e);break;case"onScrollEnd":c!=null&&ke("scrollend",e);break;case"onClick":c!=null&&(e.onclick=Fn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Bp.hasOwnProperty(s))e:{if(s[0]==="o"&&s[1]==="n"&&(f=s.endsWith("Capture"),n=s.slice(2,f?s.length-7:void 0),h=e[Ut]||null,h=h!=null?h[s]:null,typeof h=="function"&&e.removeEventListener(n,h,f),typeof c=="function")){typeof h!="function"&&h!==null&&(s in e?e[s]=null:e.hasAttribute(s)&&e.removeAttribute(s)),e.addEventListener(n,c,f);break e}s in e?e[s]=c:c===!0?e.setAttribute(s,""):go(e,s,c)}}}function Et(e,n,s){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ke("error",e),ke("load",e);var c=!1,f=!1,h;for(h in s)if(s.hasOwnProperty(h)){var v=s[h];if(v!=null)switch(h){case"src":c=!0;break;case"srcSet":f=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,n));default:ze(e,n,h,v,s,null)}}f&&ze(e,n,"srcSet",s.srcSet,s,null),c&&ze(e,n,"src",s.src,s,null);return;case"input":ke("invalid",e);var b=h=v=f=null,k=null,N=null;for(c in s)if(s.hasOwnProperty(c)){var B=s[c];if(B!=null)switch(c){case"name":f=B;break;case"type":v=B;break;case"checked":k=B;break;case"defaultChecked":N=B;break;case"value":h=B;break;case"defaultValue":b=B;break;case"children":case"dangerouslySetInnerHTML":if(B!=null)throw Error(a(137,n));break;default:ze(e,n,c,B,s,null)}}Fp(e,h,b,k,N,v,f,!1);return;case"select":ke("invalid",e),c=v=h=null;for(f in s)if(s.hasOwnProperty(f)&&(b=s[f],b!=null))switch(f){case"value":h=b;break;case"defaultValue":v=b;break;case"multiple":c=b;default:ze(e,n,f,b,s,null)}n=h,s=v,e.multiple=!!c,n!=null?Pa(e,!!c,n,!1):s!=null&&Pa(e,!!c,s,!0);return;case"textarea":ke("invalid",e),h=f=c=null;for(v in s)if(s.hasOwnProperty(v)&&(b=s[v],b!=null))switch(v){case"value":c=b;break;case"defaultValue":f=b;break;case"children":h=b;break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(a(91));break;default:ze(e,n,v,b,s,null)}Gp(e,c,f,h);return;case"option":for(k in s)if(s.hasOwnProperty(k)&&(c=s[k],c!=null))switch(k){case"selected":e.selected=c&&typeof c!="function"&&typeof c!="symbol";break;default:ze(e,n,k,c,s,null)}return;case"dialog":ke("beforetoggle",e),ke("toggle",e),ke("cancel",e),ke("close",e);break;case"iframe":case"object":ke("load",e);break;case"video":case"audio":for(c=0;c<yr.length;c++)ke(yr[c],e);break;case"image":ke("error",e),ke("load",e);break;case"details":ke("toggle",e);break;case"embed":case"source":case"link":ke("error",e),ke("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(N in s)if(s.hasOwnProperty(N)&&(c=s[N],c!=null))switch(N){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,n));default:ze(e,n,N,c,s,null)}return;default:if(mu(n)){for(B in s)s.hasOwnProperty(B)&&(c=s[B],c!==void 0&&ef(e,n,B,c,s,void 0));return}}for(b in s)s.hasOwnProperty(b)&&(c=s[b],c!=null&&ze(e,n,b,c,s,null))}function e_(e,n,s,c){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var f=null,h=null,v=null,b=null,k=null,N=null,B=null;for(U in s){var V=s[U];if(s.hasOwnProperty(U)&&V!=null)switch(U){case"checked":break;case"value":break;case"defaultValue":k=V;default:c.hasOwnProperty(U)||ze(e,n,U,null,c,V)}}for(var P in c){var U=c[P];if(V=s[P],c.hasOwnProperty(P)&&(U!=null||V!=null))switch(P){case"type":h=U;break;case"name":f=U;break;case"checked":N=U;break;case"defaultChecked":B=U;break;case"value":v=U;break;case"defaultValue":b=U;break;case"children":case"dangerouslySetInnerHTML":if(U!=null)throw Error(a(137,n));break;default:U!==V&&ze(e,n,P,U,c,V)}}fu(e,v,b,k,N,B,h,f);return;case"select":U=v=b=P=null;for(h in s)if(k=s[h],s.hasOwnProperty(h)&&k!=null)switch(h){case"value":break;case"multiple":U=k;default:c.hasOwnProperty(h)||ze(e,n,h,null,c,k)}for(f in c)if(h=c[f],k=s[f],c.hasOwnProperty(f)&&(h!=null||k!=null))switch(f){case"value":P=h;break;case"defaultValue":b=h;break;case"multiple":v=h;default:h!==k&&ze(e,n,f,h,c,k)}n=b,s=v,c=U,P!=null?Pa(e,!!s,P,!1):!!c!=!!s&&(n!=null?Pa(e,!!s,n,!0):Pa(e,!!s,s?[]:"",!1));return;case"textarea":U=P=null;for(b in s)if(f=s[b],s.hasOwnProperty(b)&&f!=null&&!c.hasOwnProperty(b))switch(b){case"value":break;case"children":break;default:ze(e,n,b,null,c,f)}for(v in c)if(f=c[v],h=s[v],c.hasOwnProperty(v)&&(f!=null||h!=null))switch(v){case"value":P=f;break;case"defaultValue":U=f;break;case"children":break;case"dangerouslySetInnerHTML":if(f!=null)throw Error(a(91));break;default:f!==h&&ze(e,n,v,f,c,h)}Hp(e,P,U);return;case"option":for(var se in s)if(P=s[se],s.hasOwnProperty(se)&&P!=null&&!c.hasOwnProperty(se))switch(se){case"selected":e.selected=!1;break;default:ze(e,n,se,null,c,P)}for(k in c)if(P=c[k],U=s[k],c.hasOwnProperty(k)&&P!==U&&(P!=null||U!=null))switch(k){case"selected":e.selected=P&&typeof P!="function"&&typeof P!="symbol";break;default:ze(e,n,k,P,c,U)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ue in s)P=s[ue],s.hasOwnProperty(ue)&&P!=null&&!c.hasOwnProperty(ue)&&ze(e,n,ue,null,c,P);for(N in c)if(P=c[N],U=s[N],c.hasOwnProperty(N)&&P!==U&&(P!=null||U!=null))switch(N){case"children":case"dangerouslySetInnerHTML":if(P!=null)throw Error(a(137,n));break;default:ze(e,n,N,P,c,U)}return;default:if(mu(n)){for(var qe in s)P=s[qe],s.hasOwnProperty(qe)&&P!==void 0&&!c.hasOwnProperty(qe)&&ef(e,n,qe,void 0,c,P);for(B in c)P=c[B],U=s[B],!c.hasOwnProperty(B)||P===U||P===void 0&&U===void 0||ef(e,n,B,P,c,U);return}}for(var R in s)P=s[R],s.hasOwnProperty(R)&&P!=null&&!c.hasOwnProperty(R)&&ze(e,n,R,null,c,P);for(V in c)P=c[V],U=s[V],!c.hasOwnProperty(V)||P===U||P==null&&U==null||ze(e,n,V,P,c,U)}function Q0(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function t_(){if(typeof performance.getEntriesByType=="function"){for(var e=0,n=0,s=performance.getEntriesByType("resource"),c=0;c<s.length;c++){var f=s[c],h=f.transferSize,v=f.initiatorType,b=f.duration;if(h&&b&&Q0(v)){for(v=0,b=f.responseEnd,c+=1;c<s.length;c++){var k=s[c],N=k.startTime;if(N>b)break;var B=k.transferSize,V=k.initiatorType;B&&Q0(V)&&(k=k.responseEnd,v+=B*(k<b?1:(b-N)/(k-N)))}if(--c,n+=8*(h+v)/(f.duration/1e3),e++,10<e)break}}if(0<e)return n/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var tf=null,nf=null;function mc(e){return e.nodeType===9?e:e.ownerDocument}function J0(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function X0(e,n){if(e===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&n==="foreignObject"?0:e}function af(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var sf=null;function n_(){var e=window.event;return e&&e.type==="popstate"?e===sf?!1:(sf=e,!0):(sf=null,!1)}var Z0=typeof setTimeout=="function"?setTimeout:void 0,i_=typeof clearTimeout=="function"?clearTimeout:void 0,W0=typeof Promise=="function"?Promise:void 0,a_=typeof queueMicrotask=="function"?queueMicrotask:typeof W0<"u"?function(e){return W0.resolve(null).then(e).catch(s_)}:Z0;function s_(e){setTimeout(function(){throw e})}function Ii(e){return e==="head"}function $0(e,n){var s=n,c=0;do{var f=s.nextSibling;if(e.removeChild(s),f&&f.nodeType===8)if(s=f.data,s==="/$"||s==="/&"){if(c===0){e.removeChild(f),fs(n);return}c--}else if(s==="$"||s==="$?"||s==="$~"||s==="$!"||s==="&")c++;else if(s==="html")Sr(e.ownerDocument.documentElement);else if(s==="head"){s=e.ownerDocument.head,Sr(s);for(var h=s.firstChild;h;){var v=h.nextSibling,b=h.nodeName;h[Bs]||b==="SCRIPT"||b==="STYLE"||b==="LINK"&&h.rel.toLowerCase()==="stylesheet"||s.removeChild(h),h=v}}else s==="body"&&Sr(e.ownerDocument.body);s=f}while(s);fs(n)}function ey(e,n){var s=e;e=0;do{var c=s.nextSibling;if(s.nodeType===1?n?(s._stashedDisplay=s.style.display,s.style.display="none"):(s.style.display=s._stashedDisplay||"",s.getAttribute("style")===""&&s.removeAttribute("style")):s.nodeType===3&&(n?(s._stashedText=s.nodeValue,s.nodeValue=""):s.nodeValue=s._stashedText||""),c&&c.nodeType===8)if(s=c.data,s==="/$"){if(e===0)break;e--}else s!=="$"&&s!=="$?"&&s!=="$~"&&s!=="$!"||e++;s=c}while(s)}function rf(e){var n=e.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var s=n;switch(n=n.nextSibling,s.nodeName){case"HTML":case"HEAD":case"BODY":rf(s),uu(s);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(s.rel.toLowerCase()==="stylesheet")continue}e.removeChild(s)}}function r_(e,n,s,c){for(;e.nodeType===1;){var f=s;if(e.nodeName.toLowerCase()!==n.toLowerCase()){if(!c&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(c){if(!e[Bs])switch(n){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(h=e.getAttribute("rel"),h==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(h!==f.rel||e.getAttribute("href")!==(f.href==null||f.href===""?null:f.href)||e.getAttribute("crossorigin")!==(f.crossOrigin==null?null:f.crossOrigin)||e.getAttribute("title")!==(f.title==null?null:f.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(h=e.getAttribute("src"),(h!==(f.src==null?null:f.src)||e.getAttribute("type")!==(f.type==null?null:f.type)||e.getAttribute("crossorigin")!==(f.crossOrigin==null?null:f.crossOrigin))&&h&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(n==="input"&&e.type==="hidden"){var h=f.name==null?null:""+f.name;if(f.type==="hidden"&&e.getAttribute("name")===h)return e}else return e;if(e=dn(e.nextSibling),e===null)break}return null}function o_(e,n,s){if(n==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!s||(e=dn(e.nextSibling),e===null))return null;return e}function ty(e,n){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!n||(e=dn(e.nextSibling),e===null))return null;return e}function of(e){return e.data==="$?"||e.data==="$~"}function cf(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function c_(e,n){var s=e.ownerDocument;if(e.data==="$~")e._reactRetry=n;else if(e.data!=="$?"||s.readyState!=="loading")n();else{var c=function(){n(),s.removeEventListener("DOMContentLoaded",c)};s.addEventListener("DOMContentLoaded",c),e._reactRetry=c}}function dn(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"||n==="F!"||n==="F")break;if(n==="/$"||n==="/&")return null}}return e}var lf=null;function ny(e){e=e.nextSibling;for(var n=0;e;){if(e.nodeType===8){var s=e.data;if(s==="/$"||s==="/&"){if(n===0)return dn(e.nextSibling);n--}else s!=="$"&&s!=="$!"&&s!=="$?"&&s!=="$~"&&s!=="&"||n++}e=e.nextSibling}return null}function iy(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var s=e.data;if(s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"){if(n===0)return e;n--}else s!=="/$"&&s!=="/&"||n++}e=e.previousSibling}return null}function ay(e,n,s){switch(n=mc(s),e){case"html":if(e=n.documentElement,!e)throw Error(a(452));return e;case"head":if(e=n.head,!e)throw Error(a(453));return e;case"body":if(e=n.body,!e)throw Error(a(454));return e;default:throw Error(a(451))}}function Sr(e){for(var n=e.attributes;n.length;)e.removeAttributeNode(n[0]);uu(e)}var fn=new Map,sy=new Set;function pc(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var si=$.d;$.d={f:l_,r:u_,D:d_,C:f_,L:h_,m:m_,X:g_,S:p_,M:v_};function l_(){var e=si.f(),n=rc();return e||n}function u_(e){var n=wa(e);n!==null&&n.tag===5&&n.type==="form"?Cv(n):si.r(e)}var ls=typeof document>"u"?null:document;function ry(e,n,s){var c=ls;if(c&&typeof n=="string"&&n){var f=an(n);f='link[rel="'+e+'"][href="'+f+'"]',typeof s=="string"&&(f+='[crossorigin="'+s+'"]'),sy.has(f)||(sy.add(f),e={rel:e,crossOrigin:s,href:n},c.querySelector(f)===null&&(n=c.createElement("link"),Et(n,"link",e),pt(n),c.head.appendChild(n)))}}function d_(e){si.D(e),ry("dns-prefetch",e,null)}function f_(e,n){si.C(e,n),ry("preconnect",e,n)}function h_(e,n,s){si.L(e,n,s);var c=ls;if(c&&e&&n){var f='link[rel="preload"][as="'+an(n)+'"]';n==="image"&&s&&s.imageSrcSet?(f+='[imagesrcset="'+an(s.imageSrcSet)+'"]',typeof s.imageSizes=="string"&&(f+='[imagesizes="'+an(s.imageSizes)+'"]')):f+='[href="'+an(e)+'"]';var h=f;switch(n){case"style":h=us(e);break;case"script":h=ds(e)}fn.has(h)||(e=y({rel:"preload",href:n==="image"&&s&&s.imageSrcSet?void 0:e,as:n},s),fn.set(h,e),c.querySelector(f)!==null||n==="style"&&c.querySelector(Tr(h))||n==="script"&&c.querySelector(Cr(h))||(n=c.createElement("link"),Et(n,"link",e),pt(n),c.head.appendChild(n)))}}function m_(e,n){si.m(e,n);var s=ls;if(s&&e){var c=n&&typeof n.as=="string"?n.as:"script",f='link[rel="modulepreload"][as="'+an(c)+'"][href="'+an(e)+'"]',h=f;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":h=ds(e)}if(!fn.has(h)&&(e=y({rel:"modulepreload",href:e},n),fn.set(h,e),s.querySelector(f)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(s.querySelector(Cr(h)))return}c=s.createElement("link"),Et(c,"link",e),pt(c),s.head.appendChild(c)}}}function p_(e,n,s){si.S(e,n,s);var c=ls;if(c&&e){var f=Na(c).hoistableStyles,h=us(e);n=n||"default";var v=f.get(h);if(!v){var b={loading:0,preload:null};if(v=c.querySelector(Tr(h)))b.loading=5;else{e=y({rel:"stylesheet",href:e,"data-precedence":n},s),(s=fn.get(h))&&uf(e,s);var k=v=c.createElement("link");pt(k),Et(k,"link",e),k._p=new Promise(function(N,B){k.onload=N,k.onerror=B}),k.addEventListener("load",function(){b.loading|=1}),k.addEventListener("error",function(){b.loading|=2}),b.loading|=4,gc(v,n,c)}v={type:"stylesheet",instance:v,count:1,state:b},f.set(h,v)}}}function g_(e,n){si.X(e,n);var s=ls;if(s&&e){var c=Na(s).hoistableScripts,f=ds(e),h=c.get(f);h||(h=s.querySelector(Cr(f)),h||(e=y({src:e,async:!0},n),(n=fn.get(f))&&df(e,n),h=s.createElement("script"),pt(h),Et(h,"link",e),s.head.appendChild(h)),h={type:"script",instance:h,count:1,state:null},c.set(f,h))}}function v_(e,n){si.M(e,n);var s=ls;if(s&&e){var c=Na(s).hoistableScripts,f=ds(e),h=c.get(f);h||(h=s.querySelector(Cr(f)),h||(e=y({src:e,async:!0,type:"module"},n),(n=fn.get(f))&&df(e,n),h=s.createElement("script"),pt(h),Et(h,"link",e),s.head.appendChild(h)),h={type:"script",instance:h,count:1,state:null},c.set(f,h))}}function oy(e,n,s,c){var f=(f=ve.current)?pc(f):null;if(!f)throw Error(a(446));switch(e){case"meta":case"title":return null;case"style":return typeof s.precedence=="string"&&typeof s.href=="string"?(n=us(s.href),s=Na(f).hoistableStyles,c=s.get(n),c||(c={type:"style",instance:null,count:0,state:null},s.set(n,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(s.rel==="stylesheet"&&typeof s.href=="string"&&typeof s.precedence=="string"){e=us(s.href);var h=Na(f).hoistableStyles,v=h.get(e);if(v||(f=f.ownerDocument||f,v={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},h.set(e,v),(h=f.querySelector(Tr(e)))&&!h._p&&(v.instance=h,v.state.loading=5),fn.has(e)||(s={rel:"preload",as:"style",href:s.href,crossOrigin:s.crossOrigin,integrity:s.integrity,media:s.media,hrefLang:s.hrefLang,referrerPolicy:s.referrerPolicy},fn.set(e,s),h||y_(f,e,s,v.state))),n&&c===null)throw Error(a(528,""));return v}if(n&&c!==null)throw Error(a(529,""));return null;case"script":return n=s.async,s=s.src,typeof s=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=ds(s),s=Na(f).hoistableScripts,c=s.get(n),c||(c={type:"script",instance:null,count:0,state:null},s.set(n,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,e))}}function us(e){return'href="'+an(e)+'"'}function Tr(e){return'link[rel="stylesheet"]['+e+"]"}function cy(e){return y({},e,{"data-precedence":e.precedence,precedence:null})}function y_(e,n,s,c){e.querySelector('link[rel="preload"][as="style"]['+n+"]")?c.loading=1:(n=e.createElement("link"),c.preload=n,n.addEventListener("load",function(){return c.loading|=1}),n.addEventListener("error",function(){return c.loading|=2}),Et(n,"link",s),pt(n),e.head.appendChild(n))}function ds(e){return'[src="'+an(e)+'"]'}function Cr(e){return"script[async]"+e}function ly(e,n,s){if(n.count++,n.instance===null)switch(n.type){case"style":var c=e.querySelector('style[data-href~="'+an(s.href)+'"]');if(c)return n.instance=c,pt(c),c;var f=y({},s,{"data-href":s.href,"data-precedence":s.precedence,href:null,precedence:null});return c=(e.ownerDocument||e).createElement("style"),pt(c),Et(c,"style",f),gc(c,s.precedence,e),n.instance=c;case"stylesheet":f=us(s.href);var h=e.querySelector(Tr(f));if(h)return n.state.loading|=4,n.instance=h,pt(h),h;c=cy(s),(f=fn.get(f))&&uf(c,f),h=(e.ownerDocument||e).createElement("link"),pt(h);var v=h;return v._p=new Promise(function(b,k){v.onload=b,v.onerror=k}),Et(h,"link",c),n.state.loading|=4,gc(h,s.precedence,e),n.instance=h;case"script":return h=ds(s.src),(f=e.querySelector(Cr(h)))?(n.instance=f,pt(f),f):(c=s,(f=fn.get(h))&&(c=y({},s),df(c,f)),e=e.ownerDocument||e,f=e.createElement("script"),pt(f),Et(f,"link",c),e.head.appendChild(f),n.instance=f);case"void":return null;default:throw Error(a(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(c=n.instance,n.state.loading|=4,gc(c,s.precedence,e));return n.instance}function gc(e,n,s){for(var c=s.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),f=c.length?c[c.length-1]:null,h=f,v=0;v<c.length;v++){var b=c[v];if(b.dataset.precedence===n)h=b;else if(h!==f)break}h?h.parentNode.insertBefore(e,h.nextSibling):(n=s.nodeType===9?s.head:s,n.insertBefore(e,n.firstChild))}function uf(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.title==null&&(e.title=n.title)}function df(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.integrity==null&&(e.integrity=n.integrity)}var vc=null;function uy(e,n,s){if(vc===null){var c=new Map,f=vc=new Map;f.set(s,c)}else f=vc,c=f.get(s),c||(c=new Map,f.set(s,c));if(c.has(e))return c;for(c.set(e,null),s=s.getElementsByTagName(e),f=0;f<s.length;f++){var h=s[f];if(!(h[Bs]||h[St]||e==="link"&&h.getAttribute("rel")==="stylesheet")&&h.namespaceURI!=="http://www.w3.org/2000/svg"){var v=h.getAttribute(n)||"";v=e+v;var b=c.get(v);b?b.push(h):c.set(v,[h])}}return c}function dy(e,n,s){e=e.ownerDocument||e,e.head.insertBefore(s,n==="title"?e.querySelector("head > title"):null)}function b_(e,n,s){if(s===1||n.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;switch(n.rel){case"stylesheet":return e=n.disabled,typeof n.precedence=="string"&&e==null;default:return!0}case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function fy(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function S_(e,n,s,c){if(s.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var f=us(c.href),h=n.querySelector(Tr(f));if(h){n=h._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(e.count++,e=yc.bind(e),n.then(e,e)),s.state.loading|=4,s.instance=h,pt(h);return}h=n.ownerDocument||n,c=cy(c),(f=fn.get(f))&&uf(c,f),h=h.createElement("link"),pt(h);var v=h;v._p=new Promise(function(b,k){v.onload=b,v.onerror=k}),Et(h,"link",c),s.instance=h}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(s,n),(n=s.state.preload)&&(s.state.loading&3)===0&&(e.count++,s=yc.bind(e),n.addEventListener("load",s),n.addEventListener("error",s))}}var ff=0;function T_(e,n){return e.stylesheets&&e.count===0&&Sc(e,e.stylesheets),0<e.count||0<e.imgCount?function(s){var c=setTimeout(function(){if(e.stylesheets&&Sc(e,e.stylesheets),e.unsuspend){var h=e.unsuspend;e.unsuspend=null,h()}},6e4+n);0<e.imgBytes&&ff===0&&(ff=62500*t_());var f=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&Sc(e,e.stylesheets),e.unsuspend)){var h=e.unsuspend;e.unsuspend=null,h()}},(e.imgBytes>ff?50:800)+n);return e.unsuspend=s,function(){e.unsuspend=null,clearTimeout(c),clearTimeout(f)}}:null}function yc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Sc(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var bc=null;function Sc(e,n){e.stylesheets=null,e.unsuspend!==null&&(e.count++,bc=new Map,n.forEach(C_,e),bc=null,yc.call(e))}function C_(e,n){if(!(n.state.loading&4)){var s=bc.get(e);if(s)var c=s.get(null);else{s=new Map,bc.set(e,s);for(var f=e.querySelectorAll("link[data-precedence],style[data-precedence]"),h=0;h<f.length;h++){var v=f[h];(v.nodeName==="LINK"||v.getAttribute("media")!=="not all")&&(s.set(v.dataset.precedence,v),c=v)}c&&s.set(null,c)}f=n.instance,v=f.getAttribute("data-precedence"),h=s.get(v)||c,h===c&&s.set(null,f),s.set(v,f),this.count++,c=yc.bind(this),f.addEventListener("load",c),f.addEventListener("error",c),h?h.parentNode.insertBefore(f,h.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(f,e.firstChild)),n.state.loading|=4}}var kr={$$typeof:K,Provider:null,Consumer:null,_currentValue:le,_currentValue2:le,_threadCount:0};function k_(e,n,s,c,f,h,v,b,k){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ru(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ru(0),this.hiddenUpdates=ru(null),this.identifierPrefix=c,this.onUncaughtError=f,this.onCaughtError=h,this.onRecoverableError=v,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=k,this.incompleteTransitions=new Map}function hy(e,n,s,c,f,h,v,b,k,N,B,V){return e=new k_(e,n,s,v,k,N,B,V,b),n=1,h===!0&&(n|=24),h=Yt(3,null,null,n),e.current=h,h.stateNode=e,n=Hu(),n.refCount++,e.pooledCache=n,n.refCount++,h.memoizedState={element:c,isDehydrated:s,cache:n},Qu(h),e}function my(e){return e?(e=Va,e):Va}function py(e,n,s,c,f,h){f=my(f),c.context===null?c.context=f:c.pendingContext=f,c=Ri(n),c.payload={element:s},h=h===void 0?null:h,h!==null&&(c.callback=h),s=Oi(e,c,n),s!==null&&(qt(s,e,n),tr(s,e,n))}function gy(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var s=e.retryLane;e.retryLane=s!==0&&s<n?s:n}}function hf(e,n){gy(e,n),(e=e.alternate)&&gy(e,n)}function vy(e){if(e.tag===13||e.tag===31){var n=ta(e,67108864);n!==null&&qt(n,e,67108864),hf(e,67108864)}}function yy(e){if(e.tag===13||e.tag===31){var n=Wt();n=ou(n);var s=ta(e,n);s!==null&&qt(s,e,n),hf(e,n)}}var Tc=!0;function E_(e,n,s,c){var f=j.T;j.T=null;var h=$.p;try{$.p=2,mf(e,n,s,c)}finally{$.p=h,j.T=f}}function __(e,n,s,c){var f=j.T;j.T=null;var h=$.p;try{$.p=8,mf(e,n,s,c)}finally{$.p=h,j.T=f}}function mf(e,n,s,c){if(Tc){var f=pf(c);if(f===null)$d(e,n,c,Cc,s),Sy(e,c);else if(O_(f,e,n,s,c))c.stopPropagation();else if(Sy(e,c),n&4&&-1<R_.indexOf(e)){for(;f!==null;){var h=wa(f);if(h!==null)switch(h.tag){case 3:if(h=h.stateNode,h.current.memoizedState.isDehydrated){var v=Xi(h.pendingLanes);if(v!==0){var b=h;for(b.pendingLanes|=2,b.entangledLanes|=2;v;){var k=1<<31-Gt(v);b.entanglements[1]|=k,v&=~k}xn(h),(Pe&6)===0&&(ac=Ft()+500,vr(0))}}break;case 31:case 13:b=ta(h,2),b!==null&&qt(b,h,2),rc(),hf(h,2)}if(h=pf(c),h===null&&$d(e,n,c,Cc,s),h===f)break;f=h}f!==null&&c.stopPropagation()}else $d(e,n,c,null,s)}}function pf(e){return e=gu(e),gf(e)}var Cc=null;function gf(e){if(Cc=null,e=Ma(e),e!==null){var n=l(e);if(n===null)e=null;else{var s=n.tag;if(s===13){if(e=u(n),e!==null)return e;e=null}else if(s===31){if(e=d(n),e!==null)return e;e=null}else if(s===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null)}}return Cc=e,null}function by(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(dk()){case Op:return 2;case Ap:return 8;case uo:case fk:return 32;case Dp:return 268435456;default:return 32}default:return 32}}var vf=!1,Bi=null,ji=null,zi=null,Er=new Map,_r=new Map,qi=[],R_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Sy(e,n){switch(e){case"focusin":case"focusout":Bi=null;break;case"dragenter":case"dragleave":ji=null;break;case"mouseover":case"mouseout":zi=null;break;case"pointerover":case"pointerout":Er.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":_r.delete(n.pointerId)}}function Rr(e,n,s,c,f,h){return e===null||e.nativeEvent!==h?(e={blockedOn:n,domEventName:s,eventSystemFlags:c,nativeEvent:h,targetContainers:[f]},n!==null&&(n=wa(n),n!==null&&vy(n)),e):(e.eventSystemFlags|=c,n=e.targetContainers,f!==null&&n.indexOf(f)===-1&&n.push(f),e)}function O_(e,n,s,c,f){switch(n){case"focusin":return Bi=Rr(Bi,e,n,s,c,f),!0;case"dragenter":return ji=Rr(ji,e,n,s,c,f),!0;case"mouseover":return zi=Rr(zi,e,n,s,c,f),!0;case"pointerover":var h=f.pointerId;return Er.set(h,Rr(Er.get(h)||null,e,n,s,c,f)),!0;case"gotpointercapture":return h=f.pointerId,_r.set(h,Rr(_r.get(h)||null,e,n,s,c,f)),!0}return!1}function Ty(e){var n=Ma(e.target);if(n!==null){var s=l(n);if(s!==null){if(n=s.tag,n===13){if(n=u(s),n!==null){e.blockedOn=n,Up(e.priority,function(){yy(s)});return}}else if(n===31){if(n=d(s),n!==null){e.blockedOn=n,Up(e.priority,function(){yy(s)});return}}else if(n===3&&s.stateNode.current.memoizedState.isDehydrated){e.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}e.blockedOn=null}function kc(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var s=pf(e.nativeEvent);if(s===null){s=e.nativeEvent;var c=new s.constructor(s.type,s);pu=c,s.target.dispatchEvent(c),pu=null}else return n=wa(s),n!==null&&vy(n),e.blockedOn=s,!1;n.shift()}return!0}function Cy(e,n,s){kc(e)&&s.delete(n)}function A_(){vf=!1,Bi!==null&&kc(Bi)&&(Bi=null),ji!==null&&kc(ji)&&(ji=null),zi!==null&&kc(zi)&&(zi=null),Er.forEach(Cy),_r.forEach(Cy)}function Ec(e,n){e.blockedOn===n&&(e.blockedOn=null,vf||(vf=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,A_)))}var _c=null;function ky(e){_c!==e&&(_c=e,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){_c===e&&(_c=null);for(var n=0;n<e.length;n+=3){var s=e[n],c=e[n+1],f=e[n+2];if(typeof c!="function"){if(gf(c||s)===null)continue;break}var h=wa(s);h!==null&&(e.splice(n,3),n-=3,md(h,{pending:!0,data:f,method:s.method,action:c},c,f))}}))}function fs(e){function n(k){return Ec(k,e)}Bi!==null&&Ec(Bi,e),ji!==null&&Ec(ji,e),zi!==null&&Ec(zi,e),Er.forEach(n),_r.forEach(n);for(var s=0;s<qi.length;s++){var c=qi[s];c.blockedOn===e&&(c.blockedOn=null)}for(;0<qi.length&&(s=qi[0],s.blockedOn===null);)Ty(s),s.blockedOn===null&&qi.shift();if(s=(e.ownerDocument||e).$$reactFormReplay,s!=null)for(c=0;c<s.length;c+=3){var f=s[c],h=s[c+1],v=f[Ut]||null;if(typeof h=="function")v||ky(s);else if(v){var b=null;if(h&&h.hasAttribute("formAction")){if(f=h,v=h[Ut]||null)b=v.formAction;else if(gf(f)!==null)continue}else b=v.action;typeof b=="function"?s[c+1]=b:(s.splice(c,3),c-=3),ky(s)}}}function Ey(){function e(h){h.canIntercept&&h.info==="react-transition"&&h.intercept({handler:function(){return new Promise(function(v){return f=v})},focusReset:"manual",scroll:"manual"})}function n(){f!==null&&(f(),f=null),c||setTimeout(s,20)}function s(){if(!c&&!navigation.transition){var h=navigation.currentEntry;h&&h.url!=null&&navigation.navigate(h.url,{state:h.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var c=!1,f=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",n),navigation.addEventListener("navigateerror",n),setTimeout(s,100),function(){c=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",n),navigation.removeEventListener("navigateerror",n),f!==null&&(f(),f=null)}}}function yf(e){this._internalRoot=e}Rc.prototype.render=yf.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(a(409));var s=n.current,c=Wt();py(s,c,e,n,null,null)},Rc.prototype.unmount=yf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;py(e.current,2,null,e,null,null),rc(),n[Da]=null}};function Rc(e){this._internalRoot=e}Rc.prototype.unstable_scheduleHydration=function(e){if(e){var n=Pp();e={blockedOn:null,target:e,priority:n};for(var s=0;s<qi.length&&n!==0&&n<qi[s].priority;s++);qi.splice(s,0,e),s===0&&Ty(e)}};var _y=t.version;if(_y!=="19.2.0")throw Error(a(527,_y,"19.2.0"));$.findDOMNode=function(e){var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(a(188)):(e=Object.keys(e).join(","),Error(a(268,e)));return e=m(n),e=e!==null?g(e):null,e=e===null?null:e.stateNode,e};var D_={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:j,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Oc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Oc.isDisabled&&Oc.supportsFiber)try{Us=Oc.inject(D_),Ht=Oc}catch{}}return ps.createRoot=function(e,n){if(!o(e))throw Error(a(299));var s=!1,c="",f=Nv,h=xv,v=Pv;return n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(c=n.identifierPrefix),n.onUncaughtError!==void 0&&(f=n.onUncaughtError),n.onCaughtError!==void 0&&(h=n.onCaughtError),n.onRecoverableError!==void 0&&(v=n.onRecoverableError)),n=hy(e,1,!1,null,null,s,c,null,f,h,v,Ey),e[Da]=n.current,Wd(e),new yf(n)},ps.hydrateRoot=function(e,n,s){if(!o(e))throw Error(a(299));var c=!1,f="",h=Nv,v=xv,b=Pv,k=null;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(f=s.identifierPrefix),s.onUncaughtError!==void 0&&(h=s.onUncaughtError),s.onCaughtError!==void 0&&(v=s.onCaughtError),s.onRecoverableError!==void 0&&(b=s.onRecoverableError),s.formState!==void 0&&(k=s.formState)),n=hy(e,1,!0,n,s??null,c,f,k,h,v,b,Ey),n.context=my(null),s=n.current,c=Wt(),c=ou(c),f=Ri(c),f.callback=null,Oi(s,f,c),s=c,n.current.lanes=s,Is(n,s),xn(n),e[Da]=n.current,Wd(e),new Rc(n)},ps.version="19.2.0",ps}var Af;function Uy(){if(Af)return wc.exports;Af=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),wc.exports=Py(),wc.exports}var Ly=Uy(),Uc={exports:{}},Df;function Iy(){return Df||(Df=1,(function(r){var t=Object.prototype.hasOwnProperty,i="~";function a(){}Object.create&&(a.prototype=Object.create(null),new a().__proto__||(i=!1));function o(p,m,g){this.fn=p,this.context=m,this.once=g||!1}function l(p,m,g,y,S){if(typeof g!="function")throw new TypeError("The listener must be a function");var C=new o(g,y||p,S),O=i?i+m:m;return p._events[O]?p._events[O].fn?p._events[O]=[p._events[O],C]:p._events[O].push(C):(p._events[O]=C,p._eventsCount++),p}function u(p,m){--p._eventsCount===0?p._events=new a:delete p._events[m]}function d(){this._events=new a,this._eventsCount=0}d.prototype.eventNames=function(){var m=[],g,y;if(this._eventsCount===0)return m;for(y in g=this._events)t.call(g,y)&&m.push(i?y.slice(1):y);return Object.getOwnPropertySymbols?m.concat(Object.getOwnPropertySymbols(g)):m},d.prototype.listeners=function(m){var g=i?i+m:m,y=this._events[g];if(!y)return[];if(y.fn)return[y.fn];for(var S=0,C=y.length,O=new Array(C);S<C;S++)O[S]=y[S].fn;return O},d.prototype.listenerCount=function(m){var g=i?i+m:m,y=this._events[g];return y?y.fn?1:y.length:0},d.prototype.emit=function(m,g,y,S,C,O){var A=i?i+m:m;if(!this._events[A])return!1;var I=this._events[A],L=arguments.length,X,K;if(I.fn){switch(I.once&&this.removeListener(m,I.fn,void 0,!0),L){case 1:return I.fn.call(I.context),!0;case 2:return I.fn.call(I.context,g),!0;case 3:return I.fn.call(I.context,g,y),!0;case 4:return I.fn.call(I.context,g,y,S),!0;case 5:return I.fn.call(I.context,g,y,S,C),!0;case 6:return I.fn.call(I.context,g,y,S,C,O),!0}for(K=1,X=new Array(L-1);K<L;K++)X[K-1]=arguments[K];I.fn.apply(I.context,X)}else{var D=I.length,x;for(K=0;K<D;K++)switch(I[K].once&&this.removeListener(m,I[K].fn,void 0,!0),L){case 1:I[K].fn.call(I[K].context);break;case 2:I[K].fn.call(I[K].context,g);break;case 3:I[K].fn.call(I[K].context,g,y);break;case 4:I[K].fn.call(I[K].context,g,y,S);break;default:if(!X)for(x=1,X=new Array(L-1);x<L;x++)X[x-1]=arguments[x];I[K].fn.apply(I[K].context,X)}}return!0},d.prototype.on=function(m,g,y){return l(this,m,g,y,!1)},d.prototype.once=function(m,g,y){return l(this,m,g,y,!0)},d.prototype.removeListener=function(m,g,y,S){var C=i?i+m:m;if(!this._events[C])return this;if(!g)return u(this,C),this;var O=this._events[C];if(O.fn)O.fn===g&&(!S||O.once)&&(!y||O.context===y)&&u(this,C);else{for(var A=0,I=[],L=O.length;A<L;A++)(O[A].fn!==g||S&&!O[A].once||y&&O[A].context!==y)&&I.push(O[A]);I.length?this._events[C]=I.length===1?I[0]:I:u(this,C)}return this},d.prototype.removeAllListeners=function(m){var g;return m?(g=i?i+m:m,this._events[g]&&u(this,g)):(this._events=new a,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=i,d.EventEmitter=d,r.exports=d})(Uc)),Uc.exports}var By=Iy();const jy=hs(By);function zy(r,t){return t.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(a){if(a!=="default"&&!(a in r)){var o=Object.getOwnPropertyDescriptor(i,a);Object.defineProperty(r,a,o.get?o:{enumerable:!0,get:function(){return i[a]}})}})}),Object.freeze(r)}var qy=Object.defineProperty,Vy=(r,t,i)=>t in r?qy(r,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[t]=i,Mf=(r,t,i)=>Vy(r,typeof t!="symbol"?t+"":t,i);class Rt{constructor(){Mf(this,"_locking"),Mf(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let t;const i=new Promise(o=>t=()=>{this._locks-=1,o()}),a=this._locking.then(()=>t);return this._locking=this._locking.then(()=>i),a}}function Je(r,t){if(!r)throw new Error(t)}const Fy=34028234663852886e22,Hy=-34028234663852886e22,Gy=4294967295,Ky=2147483647,Yy=-2147483648;function Or(r){if(typeof r!="number")throw new Error("invalid int 32: "+typeof r);if(!Number.isInteger(r)||r>Ky||r<Yy)throw new Error("invalid int 32: "+r)}function Lc(r){if(typeof r!="number")throw new Error("invalid uint 32: "+typeof r);if(!Number.isInteger(r)||r>Gy||r<0)throw new Error("invalid uint 32: "+r)}function wf(r){if(typeof r!="number")throw new Error("invalid float 32: "+typeof r);if(Number.isFinite(r)&&(r>Fy||r<Hy))throw new Error("invalid float 32: "+r)}const Nf=Symbol("@bufbuild/protobuf/enum-type");function Qy(r){const t=r[Nf];return Je(t,"missing enum type on enum object"),t}function xf(r,t,i,a){r[Nf]=Pf(t,i.map(o=>({no:o.no,name:o.name,localName:r[o.no]})))}function Pf(r,t,i){const a=Object.create(null),o=Object.create(null),l=[];for(const u of t){const d=Uf(u);l.push(d),a[u.name]=d,o[u.no]=d}return{typeName:r,values:l,findName(u){return a[u]},findNumber(u){return o[u]}}}function Jy(r,t,i){const a={};for(const o of t){const l=Uf(o);a[l.localName]=l.no,a[l.no]=l.localName}return xf(a,r,t),a}function Uf(r){return"localName"in r?r:Object.assign(Object.assign({},r),{localName:r.name})}class Ic{equals(t){return this.getType().runtime.util.equals(this.getType(),this,t)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(t,i){const a=this.getType(),o=a.runtime.bin,l=o.makeReadOptions(i);return o.readMessage(this,l.readerFactory(t),t.byteLength,l),this}fromJson(t,i){const a=this.getType(),o=a.runtime.json,l=o.makeReadOptions(i);return o.readMessage(a,t,l,this),this}fromJsonString(t,i){let a;try{a=JSON.parse(t)}catch(o){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(o instanceof Error?o.message:String(o)))}return this.fromJson(a,i)}toBinary(t){const i=this.getType(),a=i.runtime.bin,o=a.makeWriteOptions(t),l=o.writerFactory();return a.writeMessage(this,l,o),l.finish()}toJson(t){const i=this.getType(),a=i.runtime.json,o=a.makeWriteOptions(t);return a.writeMessage(this,o)}toJsonString(t){var i;const a=this.toJson(t);return JSON.stringify(a,null,(i=t?.prettySpaces)!==null&&i!==void 0?i:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function Xy(r,t,i,a){var o;const l=(o=a?.localName)!==null&&o!==void 0?o:t.substring(t.lastIndexOf(".")+1),u={[l]:function(d){r.util.initFields(this),r.util.initPartial(d,this)}}[l];return Object.setPrototypeOf(u.prototype,new Ic),Object.assign(u,{runtime:r,typeName:t,fields:r.util.newFieldList(i),fromBinary(d,p){return new u().fromBinary(d,p)},fromJson(d,p){return new u().fromJson(d,p)},fromJsonString(d,p){return new u().fromJsonString(d,p)},equals(d,p){return r.util.equals(u,d,p)}}),u}function Zy(){let r=0,t=0;for(let a=0;a<28;a+=7){let o=this.buf[this.pos++];if(r|=(o&127)<<a,(o&128)==0)return this.assertBounds(),[r,t]}let i=this.buf[this.pos++];if(r|=(i&15)<<28,t=(i&112)>>4,(i&128)==0)return this.assertBounds(),[r,t];for(let a=3;a<=31;a+=7){let o=this.buf[this.pos++];if(t|=(o&127)<<a,(o&128)==0)return this.assertBounds(),[r,t]}throw new Error("invalid varint")}function Bc(r,t,i){for(let l=0;l<28;l=l+7){const u=r>>>l,d=!(!(u>>>7)&&t==0),p=(d?u|128:u)&255;if(i.push(p),!d)return}const a=r>>>28&15|(t&7)<<4,o=t>>3!=0;if(i.push((o?a|128:a)&255),!!o){for(let l=3;l<31;l=l+7){const u=t>>>l,d=!!(u>>>7),p=(d?u|128:u)&255;if(i.push(p),!d)return}i.push(t>>>31&1)}}const Ar=4294967296;function Lf(r){const t=r[0]==="-";t&&(r=r.slice(1));const i=1e6;let a=0,o=0;function l(u,d){const p=Number(r.slice(u,d));o*=i,a=a*i+p,a>=Ar&&(o=o+(a/Ar|0),a=a%Ar)}return l(-24,-18),l(-18,-12),l(-12,-6),l(-6),t?Bf(a,o):jc(a,o)}function Wy(r,t){let i=jc(r,t);const a=i.hi&2147483648;a&&(i=Bf(i.lo,i.hi));const o=If(i.lo,i.hi);return a?"-"+o:o}function If(r,t){if({lo:r,hi:t}=$y(r,t),t<=2097151)return String(Ar*t+r);const i=r&16777215,a=(r>>>24|t<<8)&16777215,o=t>>16&65535;let l=i+a*6777216+o*6710656,u=a+o*8147497,d=o*2;const p=1e7;return l>=p&&(u+=Math.floor(l/p),l%=p),u>=p&&(d+=Math.floor(u/p),u%=p),d.toString()+jf(u)+jf(l)}function $y(r,t){return{lo:r>>>0,hi:t>>>0}}function jc(r,t){return{lo:r|0,hi:t|0}}function Bf(r,t){return t=~t,r?r=~r+1:t+=1,jc(r,t)}const jf=r=>{const t=String(r);return"0000000".slice(t.length)+t};function zf(r,t){if(r>=0){for(;r>127;)t.push(r&127|128),r=r>>>7;t.push(r)}else{for(let i=0;i<9;i++)t.push(r&127|128),r=r>>7;t.push(1)}}function eb(){let r=this.buf[this.pos++],t=r&127;if((r&128)==0)return this.assertBounds(),t;if(r=this.buf[this.pos++],t|=(r&127)<<7,(r&128)==0)return this.assertBounds(),t;if(r=this.buf[this.pos++],t|=(r&127)<<14,(r&128)==0)return this.assertBounds(),t;if(r=this.buf[this.pos++],t|=(r&127)<<21,(r&128)==0)return this.assertBounds(),t;r=this.buf[this.pos++],t|=(r&15)<<28;for(let i=5;(r&128)!==0&&i<10;i++)r=this.buf[this.pos++];if((r&128)!=0)throw new Error("invalid varint");return this.assertBounds(),t>>>0}function tb(){const r=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof r.getBigInt64=="function"&&typeof r.getBigUint64=="function"&&typeof r.setBigInt64=="function"&&typeof r.setBigUint64=="function"&&(typeof process!="object"||typeof process.env!="object"||process.env.BUF_BIGINT_DISABLE!=="1")){const o=BigInt("-9223372036854775808"),l=BigInt("9223372036854775807"),u=BigInt("0"),d=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(p){const m=typeof p=="bigint"?p:BigInt(p);if(m>l||m<o)throw new Error("int64 invalid: ".concat(p));return m},uParse(p){const m=typeof p=="bigint"?p:BigInt(p);if(m>d||m<u)throw new Error("uint64 invalid: ".concat(p));return m},enc(p){return r.setBigInt64(0,this.parse(p),!0),{lo:r.getInt32(0,!0),hi:r.getInt32(4,!0)}},uEnc(p){return r.setBigInt64(0,this.uParse(p),!0),{lo:r.getInt32(0,!0),hi:r.getInt32(4,!0)}},dec(p,m){return r.setInt32(0,p,!0),r.setInt32(4,m,!0),r.getBigInt64(0,!0)},uDec(p,m){return r.setInt32(0,p,!0),r.setInt32(4,m,!0),r.getBigUint64(0,!0)}}}const i=o=>Je(/^-?[0-9]+$/.test(o),"int64 invalid: ".concat(o)),a=o=>Je(/^[0-9]+$/.test(o),"uint64 invalid: ".concat(o));return{zero:"0",supported:!1,parse(o){return typeof o!="string"&&(o=o.toString()),i(o),o},uParse(o){return typeof o!="string"&&(o=o.toString()),a(o),o},enc(o){return typeof o!="string"&&(o=o.toString()),i(o),Lf(o)},uEnc(o){return typeof o!="string"&&(o=o.toString()),a(o),Lf(o)},dec(o,l){return Wy(o,l)},uDec(o,l){return If(o,l)}}}const Ke=tb();var G;(function(r){r[r.DOUBLE=1]="DOUBLE",r[r.FLOAT=2]="FLOAT",r[r.INT64=3]="INT64",r[r.UINT64=4]="UINT64",r[r.INT32=5]="INT32",r[r.FIXED64=6]="FIXED64",r[r.FIXED32=7]="FIXED32",r[r.BOOL=8]="BOOL",r[r.STRING=9]="STRING",r[r.BYTES=12]="BYTES",r[r.UINT32=13]="UINT32",r[r.SFIXED32=15]="SFIXED32",r[r.SFIXED64=16]="SFIXED64",r[r.SINT32=17]="SINT32",r[r.SINT64=18]="SINT64"})(G||(G={}));var ri;(function(r){r[r.BIGINT=0]="BIGINT",r[r.STRING=1]="STRING"})(ri||(ri={}));function oi(r,t,i){if(t===i)return!0;if(r==G.BYTES){if(!(t instanceof Uint8Array)||!(i instanceof Uint8Array)||t.length!==i.length)return!1;for(let a=0;a<t.length;a++)if(t[a]!==i[a])return!1;return!0}switch(r){case G.UINT64:case G.FIXED64:case G.INT64:case G.SFIXED64:case G.SINT64:return t==i}return!1}function pa(r,t){switch(r){case G.BOOL:return!1;case G.UINT64:case G.FIXED64:case G.INT64:case G.SFIXED64:case G.SINT64:return t==0?Ke.zero:"0";case G.DOUBLE:case G.FLOAT:return 0;case G.BYTES:return new Uint8Array(0);case G.STRING:return"";default:return 0}}function qf(r,t){switch(r){case G.BOOL:return t===!1;case G.STRING:return t==="";case G.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return t==0}}var et;(function(r){r[r.Varint=0]="Varint",r[r.Bit64=1]="Bit64",r[r.LengthDelimited=2]="LengthDelimited",r[r.StartGroup=3]="StartGroup",r[r.EndGroup=4]="EndGroup",r[r.Bit32=5]="Bit32"})(et||(et={}));class nb{constructor(t){this.stack=[],this.textEncoder=t??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let t=0;for(let o=0;o<this.chunks.length;o++)t+=this.chunks[o].length;let i=new Uint8Array(t),a=0;for(let o=0;o<this.chunks.length;o++)i.set(this.chunks[o],a),a+=this.chunks[o].length;return this.chunks=[],i}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let t=this.finish(),i=this.stack.pop();if(!i)throw new Error("invalid state, fork stack empty");return this.chunks=i.chunks,this.buf=i.buf,this.uint32(t.byteLength),this.raw(t)}tag(t,i){return this.uint32((t<<3|i)>>>0)}raw(t){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(t),this}uint32(t){for(Lc(t);t>127;)this.buf.push(t&127|128),t=t>>>7;return this.buf.push(t),this}int32(t){return Or(t),zf(t,this.buf),this}bool(t){return this.buf.push(t?1:0),this}bytes(t){return this.uint32(t.byteLength),this.raw(t)}string(t){let i=this.textEncoder.encode(t);return this.uint32(i.byteLength),this.raw(i)}float(t){wf(t);let i=new Uint8Array(4);return new DataView(i.buffer).setFloat32(0,t,!0),this.raw(i)}double(t){let i=new Uint8Array(8);return new DataView(i.buffer).setFloat64(0,t,!0),this.raw(i)}fixed32(t){Lc(t);let i=new Uint8Array(4);return new DataView(i.buffer).setUint32(0,t,!0),this.raw(i)}sfixed32(t){Or(t);let i=new Uint8Array(4);return new DataView(i.buffer).setInt32(0,t,!0),this.raw(i)}sint32(t){return Or(t),t=(t<<1^t>>31)>>>0,zf(t,this.buf),this}sfixed64(t){let i=new Uint8Array(8),a=new DataView(i.buffer),o=Ke.enc(t);return a.setInt32(0,o.lo,!0),a.setInt32(4,o.hi,!0),this.raw(i)}fixed64(t){let i=new Uint8Array(8),a=new DataView(i.buffer),o=Ke.uEnc(t);return a.setInt32(0,o.lo,!0),a.setInt32(4,o.hi,!0),this.raw(i)}int64(t){let i=Ke.enc(t);return Bc(i.lo,i.hi,this.buf),this}sint64(t){let i=Ke.enc(t),a=i.hi>>31,o=i.lo<<1^a,l=(i.hi<<1|i.lo>>>31)^a;return Bc(o,l,this.buf),this}uint64(t){let i=Ke.uEnc(t);return Bc(i.lo,i.hi,this.buf),this}}class ib{constructor(t,i){this.varint64=Zy,this.uint32=eb,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.textDecoder=i??new TextDecoder}tag(){let t=this.uint32(),i=t>>>3,a=t&7;if(i<=0||a<0||a>5)throw new Error("illegal tag: field no "+i+" wire type "+a);return[i,a]}skip(t,i){let a=this.pos;switch(t){case et.Varint:for(;this.buf[this.pos++]&128;);break;case et.Bit64:this.pos+=4;case et.Bit32:this.pos+=4;break;case et.LengthDelimited:let o=this.uint32();this.pos+=o;break;case et.StartGroup:for(;;){const[l,u]=this.tag();if(u===et.EndGroup){if(i!==void 0&&l!==i)throw new Error("invalid end group tag");break}this.skip(u,l)}break;default:throw new Error("cant skip wire type "+t)}return this.assertBounds(),this.buf.subarray(a,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)}int64(){return Ke.dec(...this.varint64())}uint64(){return Ke.uDec(...this.varint64())}sint64(){let[t,i]=this.varint64(),a=-(t&1);return t=(t>>>1|(i&1)<<31)^a,i=i>>>1^a,Ke.dec(t,i)}bool(){let[t,i]=this.varint64();return t!==0||i!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return Ke.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return Ke.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let t=this.uint32(),i=this.pos;return this.pos+=t,this.assertBounds(),this.buf.subarray(i,i+t)}string(){return this.textDecoder.decode(this.bytes())}}function ab(r,t,i,a){let o;return{typeName:t,extendee:i,get field(){if(!o){const l=typeof a=="function"?a():a;l.name=t.split(".").pop(),l.jsonName="[".concat(t,"]"),o=r.util.newFieldList([l]).list()[0]}return o},runtime:r}}function Vf(r){const t=r.field.localName,i=Object.create(null);return i[t]=sb(r),[i,()=>i[t]]}function sb(r){const t=r.field;if(t.repeated)return[];if(t.default!==void 0)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return pa(t.T,t.L);case"message":const i=t.T,a=new i;return i.fieldWrapper?i.fieldWrapper.unwrapField(a):a;case"map":throw"map fields are not allowed to be extensions"}}function rb(r,t){if(!t.repeated&&(t.kind=="enum"||t.kind=="scalar")){for(let i=r.length-1;i>=0;--i)if(r[i].no==t.no)return[r[i]];return[]}return r.filter(i=>i.no===t.no)}let Pn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Dr=[];for(let r=0;r<Pn.length;r++)Dr[Pn[r].charCodeAt(0)]=r;Dr[45]=Pn.indexOf("+"),Dr[95]=Pn.indexOf("/");const Ff={dec(r){let t=r.length*3/4;r[r.length-2]=="="?t-=2:r[r.length-1]=="="&&(t-=1);let i=new Uint8Array(t),a=0,o=0,l,u=0;for(let d=0;d<r.length;d++){if(l=Dr[r.charCodeAt(d)],l===void 0)switch(r[d]){case"=":o=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(o){case 0:u=l,o=1;break;case 1:i[a++]=u<<2|(l&48)>>4,u=l,o=2;break;case 2:i[a++]=(u&15)<<4|(l&60)>>2,u=l,o=3;break;case 3:i[a++]=(u&3)<<6|l,o=0;break}}if(o==1)throw Error("invalid base64 string.");return i.subarray(0,a)},enc(r){let t="",i=0,a,o=0;for(let l=0;l<r.length;l++)switch(a=r[l],i){case 0:t+=Pn[a>>2],o=(a&3)<<4,i=1;break;case 1:t+=Pn[o|a>>4],o=(a&15)<<2,i=2;break;case 2:t+=Pn[o|a>>6],t+=Pn[a&63],i=0;break}return i&&(t+=Pn[o],t+="=",i==1&&(t+="=")),t}};function ob(r,t,i){Gf(t,r);const a=t.runtime.bin.makeReadOptions(i),o=rb(r.getType().runtime.bin.listUnknownFields(r),t.field),[l,u]=Vf(t);for(const d of o)t.runtime.bin.readField(l,a.readerFactory(d.data),t.field,d.wireType,a);return u()}function cb(r,t,i,a){Gf(t,r);const o=t.runtime.bin.makeReadOptions(a),l=t.runtime.bin.makeWriteOptions(a);if(Hf(r,t)){const m=r.getType().runtime.bin.listUnknownFields(r).filter(g=>g.no!=t.field.no);r.getType().runtime.bin.discardUnknownFields(r);for(const g of m)r.getType().runtime.bin.onUnknownField(r,g.no,g.wireType,g.data)}const u=l.writerFactory();let d=t.field;!d.opt&&!d.repeated&&(d.kind=="enum"||d.kind=="scalar")&&(d=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(d,i,u,l);const p=o.readerFactory(u.finish());for(;p.pos<p.len;){const[m,g]=p.tag(),y=p.skip(g,m);r.getType().runtime.bin.onUnknownField(r,m,g,y)}}function Hf(r,t){const i=r.getType();return t.extendee.typeName===i.typeName&&!!i.runtime.bin.listUnknownFields(r).find(a=>a.no==t.field.no)}function Gf(r,t){Je(r.extendee.typeName==t.getType().typeName,"extension ".concat(r.typeName," can only be applied to message ").concat(r.extendee.typeName))}function Kf(r,t){const i=r.localName;if(r.repeated)return t[i].length>0;if(r.oneof)return t[r.oneof.localName].case===i;switch(r.kind){case"enum":case"scalar":return r.opt||r.req?t[i]!==void 0:r.kind=="enum"?t[i]!==r.T.values[0].no:!qf(r.T,t[i]);case"message":return t[i]!==void 0;case"map":return Object.keys(t[i]).length>0}}function Yf(r,t){const i=r.localName,a=!r.opt&&!r.req;if(r.repeated)t[i]=[];else if(r.oneof)t[r.oneof.localName]={case:void 0};else switch(r.kind){case"map":t[i]={};break;case"enum":t[i]=a?r.T.values[0].no:void 0;break;case"scalar":t[i]=a?pa(r.T,r.L):void 0;break;case"message":t[i]=void 0;break}}function Un(r,t){if(r===null||typeof r!="object"||!Object.getOwnPropertyNames(Ic.prototype).every(a=>a in r&&typeof r[a]=="function"))return!1;const i=r.getType();return i===null||typeof i!="function"||!("typeName"in i)||typeof i.typeName!="string"?!1:t===void 0?!0:i.typeName==t.typeName}function Qf(r,t){return Un(t)||!r.fieldWrapper?t:r.fieldWrapper.wrapField(t)}G.DOUBLE,G.FLOAT,G.INT64,G.UINT64,G.INT32,G.UINT32,G.BOOL,G.STRING,G.BYTES;const Jf={ignoreUnknownFields:!1},Xf={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function lb(r){return r?Object.assign(Object.assign({},Jf),r):Jf}function ub(r){return r?Object.assign(Object.assign({},Xf),r):Xf}const Mr=Symbol(),wr=Symbol();function db(){return{makeReadOptions:lb,makeWriteOptions:ub,readMessage(r,t,i,a){if(t==null||Array.isArray(t)||typeof t!="object")throw new Error("cannot decode message ".concat(r.typeName," from JSON: ").concat(En(t)));a=a??new r;const o=new Map,l=i.typeRegistry;for(const[u,d]of Object.entries(t)){const p=r.fields.findJsonName(u);if(p){if(p.oneof){if(d===null&&p.kind=="scalar")continue;const m=o.get(p.oneof);if(m!==void 0)throw new Error("cannot decode message ".concat(r.typeName,' from JSON: multiple keys for oneof "').concat(p.oneof.name,'" present: "').concat(m,'", "').concat(u,'"'));o.set(p.oneof,u)}Zf(a,d,p,i,r)}else{let m=!1;if(l?.findExtension&&u.startsWith("[")&&u.endsWith("]")){const g=l.findExtension(u.substring(1,u.length-1));if(g&&g.extendee.typeName==r.typeName){m=!0;const[y,S]=Vf(g);Zf(y,d,g.field,i,g),cb(a,g,S(),i)}}if(!m&&!i.ignoreUnknownFields)throw new Error("cannot decode message ".concat(r.typeName,' from JSON: key "').concat(u,'" is unknown'))}}return a},writeMessage(r,t){const i=r.getType(),a={};let o;try{for(o of i.fields.byNumber()){if(!Kf(o,r)){if(o.req)throw"required field not set";if(!t.emitDefaultValues||!hb(o))continue}const u=o.oneof?r[o.oneof.localName].value:r[o.localName],d=Wf(o,u,t);d!==void 0&&(a[t.useProtoFieldName?o.name:o.jsonName]=d)}const l=t.typeRegistry;if(l?.findExtensionFor)for(const u of i.runtime.bin.listUnknownFields(r)){const d=l.findExtensionFor(i.typeName,u.no);if(d&&Hf(r,d)){const p=ob(r,d,t),m=Wf(d.field,p,t);m!==void 0&&(a[d.field.jsonName]=m)}}}catch(l){const u=o?"cannot encode field ".concat(i.typeName,".").concat(o.name," to JSON"):"cannot encode message ".concat(i.typeName," to JSON"),d=l instanceof Error?l.message:String(l);throw new Error(u+(d.length>0?": ".concat(d):""))}return a},readScalar(r,t,i){return gs(r,t,i??ri.BIGINT,!0)},writeScalar(r,t,i){if(t!==void 0&&(i||qf(r,t)))return Nr(r,t)},debug:En}}function En(r){if(r===null)return"null";switch(typeof r){case"object":return Array.isArray(r)?"array":"object";case"string":return r.length>100?"string":'"'.concat(r.split('"').join('\\"'),'"');default:return String(r)}}function Zf(r,t,i,a,o){let l=i.localName;if(i.repeated){if(Je(i.kind!="map"),t===null)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(En(t)));const u=r[l];for(const d of t){if(d===null)throw new Error("cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(En(d)));switch(i.kind){case"message":u.push(i.T.fromJson(d,a));break;case"enum":const p=zc(i.T,d,a.ignoreUnknownFields,!0);p!==wr&&u.push(p);break;case"scalar":try{u.push(gs(i.T,d,i.L,!0))}catch(m){let g="cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(En(d));throw m instanceof Error&&m.message.length>0&&(g+=": ".concat(m.message)),new Error(g)}break}}}else if(i.kind=="map"){if(t===null)return;if(typeof t!="object"||Array.isArray(t))throw new Error("cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(En(t)));const u=r[l];for(const[d,p]of Object.entries(t)){if(p===null)throw new Error("cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: map value null"));let m;try{m=fb(i.K,d)}catch(g){let y="cannot decode map key for field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(En(t));throw g instanceof Error&&g.message.length>0&&(y+=": ".concat(g.message)),new Error(y)}switch(i.V.kind){case"message":u[m]=i.V.T.fromJson(p,a);break;case"enum":const g=zc(i.V.T,p,a.ignoreUnknownFields,!0);g!==wr&&(u[m]=g);break;case"scalar":try{u[m]=gs(i.V.T,p,ri.BIGINT,!0)}catch(y){let S="cannot decode map value for field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(En(t));throw y instanceof Error&&y.message.length>0&&(S+=": ".concat(y.message)),new Error(S)}break}}}else switch(i.oneof&&(r=r[i.oneof.localName]={case:l},l="value"),i.kind){case"message":const u=i.T;if(t===null&&u.typeName!="google.protobuf.Value")return;let d=r[l];Un(d)?d.fromJson(t,a):(r[l]=d=u.fromJson(t,a),u.fieldWrapper&&!i.oneof&&(r[l]=u.fieldWrapper.unwrapField(d)));break;case"enum":const p=zc(i.T,t,a.ignoreUnknownFields,!1);switch(p){case Mr:Yf(i,r);break;case wr:break;default:r[l]=p;break}break;case"scalar":try{const m=gs(i.T,t,i.L,!1);switch(m){case Mr:Yf(i,r);break;default:r[l]=m;break}}catch(m){let g="cannot decode field ".concat(o.typeName,".").concat(i.name," from JSON: ").concat(En(t));throw m instanceof Error&&m.message.length>0&&(g+=": ".concat(m.message)),new Error(g)}break}}function fb(r,t){if(r===G.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1;break}return gs(r,t,ri.BIGINT,!0).toString()}function gs(r,t,i,a){if(t===null)return a?pa(r,i):Mr;switch(r){case G.DOUBLE:case G.FLOAT:if(t==="NaN")return Number.NaN;if(t==="Infinity")return Number.POSITIVE_INFINITY;if(t==="-Infinity")return Number.NEGATIVE_INFINITY;if(t===""||typeof t=="string"&&t.trim().length!==t.length||typeof t!="string"&&typeof t!="number")break;const o=Number(t);if(Number.isNaN(o)||!Number.isFinite(o))break;return r==G.FLOAT&&wf(o),o;case G.INT32:case G.FIXED32:case G.SFIXED32:case G.SINT32:case G.UINT32:let l;if(typeof t=="number"?l=t:typeof t=="string"&&t.length>0&&t.trim().length===t.length&&(l=Number(t)),l===void 0)break;return r==G.UINT32||r==G.FIXED32?Lc(l):Or(l),l;case G.INT64:case G.SFIXED64:case G.SINT64:if(typeof t!="number"&&typeof t!="string")break;const u=Ke.parse(t);return i?u.toString():u;case G.FIXED64:case G.UINT64:if(typeof t!="number"&&typeof t!="string")break;const d=Ke.uParse(t);return i?d.toString():d;case G.BOOL:if(typeof t!="boolean")break;return t;case G.STRING:if(typeof t!="string")break;try{encodeURIComponent(t)}catch{throw new Error("invalid UTF8")}return t;case G.BYTES:if(t==="")return new Uint8Array(0);if(typeof t!="string")break;return Ff.dec(t)}throw new Error}function zc(r,t,i,a){if(t===null)return r.typeName=="google.protobuf.NullValue"?0:a?r.values[0].no:Mr;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const o=r.findName(t);if(o!==void 0)return o.no;if(i)return wr;break}throw new Error("cannot decode enum ".concat(r.typeName," from JSON: ").concat(En(t)))}function hb(r){return r.repeated||r.kind=="map"?!0:!(r.oneof||r.kind=="message"||r.opt||r.req)}function Wf(r,t,i){if(r.kind=="map"){Je(typeof t=="object"&&t!=null);const a={},o=Object.entries(t);switch(r.V.kind){case"scalar":for(const[u,d]of o)a[u.toString()]=Nr(r.V.T,d);break;case"message":for(const[u,d]of o)a[u.toString()]=d.toJson(i);break;case"enum":const l=r.V.T;for(const[u,d]of o)a[u.toString()]=qc(l,d,i.enumAsInteger);break}return i.emitDefaultValues||o.length>0?a:void 0}if(r.repeated){Je(Array.isArray(t));const a=[];switch(r.kind){case"scalar":for(let o=0;o<t.length;o++)a.push(Nr(r.T,t[o]));break;case"enum":for(let o=0;o<t.length;o++)a.push(qc(r.T,t[o],i.enumAsInteger));break;case"message":for(let o=0;o<t.length;o++)a.push(t[o].toJson(i));break}return i.emitDefaultValues||a.length>0?a:void 0}switch(r.kind){case"scalar":return Nr(r.T,t);case"enum":return qc(r.T,t,i.enumAsInteger);case"message":return Qf(r.T,t).toJson(i)}}function qc(r,t,i){var a;if(Je(typeof t=="number"),r.typeName=="google.protobuf.NullValue")return null;if(i)return t;const o=r.findNumber(t);return(a=o?.name)!==null&&a!==void 0?a:t}function Nr(r,t){switch(r){case G.INT32:case G.SFIXED32:case G.SINT32:case G.FIXED32:case G.UINT32:return Je(typeof t=="number"),t;case G.FLOAT:case G.DOUBLE:return Je(typeof t=="number"),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case G.STRING:return Je(typeof t=="string"),t;case G.BOOL:return Je(typeof t=="boolean"),t;case G.UINT64:case G.FIXED64:case G.INT64:case G.SFIXED64:case G.SINT64:return Je(typeof t=="bigint"||typeof t=="string"||typeof t=="number"),t.toString();case G.BYTES:return Je(t instanceof Uint8Array),Ff.enc(t)}}const ga=Symbol("@bufbuild/protobuf/unknown-fields"),$f={readUnknownFields:!0,readerFactory:r=>new ib(r)},eh={writeUnknownFields:!0,writerFactory:()=>new nb};function mb(r){return r?Object.assign(Object.assign({},$f),r):$f}function pb(r){return r?Object.assign(Object.assign({},eh),r):eh}function gb(){return{makeReadOptions:mb,makeWriteOptions:pb,listUnknownFields(r){var t;return(t=r[ga])!==null&&t!==void 0?t:[]},discardUnknownFields(r){delete r[ga]},writeUnknownFields(r,t){const a=r[ga];if(a)for(const o of a)t.tag(o.no,o.wireType).raw(o.data)},onUnknownField(r,t,i,a){const o=r;Array.isArray(o[ga])||(o[ga]=[]),o[ga].push({no:t,wireType:i,data:a})},readMessage(r,t,i,a,o){const l=r.getType(),u=o?t.len:t.pos+i;let d,p;for(;t.pos<u&&([d,p]=t.tag(),!(o===!0&&p==et.EndGroup));){const m=l.fields.find(d);if(!m){const g=t.skip(p,d);a.readUnknownFields&&this.onUnknownField(r,d,p,g);continue}th(r,t,m,p,a)}if(o&&(p!=et.EndGroup||d!==i))throw new Error("invalid end group tag")},readField:th,writeMessage(r,t,i){const a=r.getType();for(const o of a.fields.byNumber()){if(!Kf(o,r)){if(o.req)throw new Error("cannot encode field ".concat(a.typeName,".").concat(o.name," to binary: required field not set"));continue}const l=o.oneof?r[o.oneof.localName].value:r[o.localName];nh(o,l,t,i)}return i.writeUnknownFields&&this.writeUnknownFields(r,t),t},writeField(r,t,i,a){t!==void 0&&nh(r,t,i,a)}}}function th(r,t,i,a,o){let{repeated:l,localName:u}=i;switch(i.oneof&&(r=r[i.oneof.localName],r.case!=u&&delete r.value,r.case=u,u="value"),i.kind){case"scalar":case"enum":const d=i.kind=="enum"?G.INT32:i.T;let p=Pr;if(i.kind=="scalar"&&i.L>0&&(p=yb),l){let S=r[u];if(a==et.LengthDelimited&&d!=G.STRING&&d!=G.BYTES){let O=t.uint32()+t.pos;for(;t.pos<O;)S.push(p(t,d))}else S.push(p(t,d))}else r[u]=p(t,d);break;case"message":const m=i.T;l?r[u].push(xr(t,new m,o,i)):Un(r[u])?xr(t,r[u],o,i):(r[u]=xr(t,new m,o,i),m.fieldWrapper&&!i.oneof&&!i.repeated&&(r[u]=m.fieldWrapper.unwrapField(r[u])));break;case"map":let[g,y]=vb(i,t,o);r[u][g]=y;break}}function xr(r,t,i,a){const o=t.getType().runtime.bin,l=a?.delimited;return o.readMessage(t,r,l?a.no:r.uint32(),i,l),t}function vb(r,t,i){const a=t.uint32(),o=t.pos+a;let l,u;for(;t.pos<o;){const[d]=t.tag();switch(d){case 1:l=Pr(t,r.K);break;case 2:switch(r.V.kind){case"scalar":u=Pr(t,r.V.T);break;case"enum":u=t.int32();break;case"message":u=xr(t,new r.V.T,i,void 0);break}break}}if(l===void 0&&(l=pa(r.K,ri.BIGINT)),typeof l!="string"&&typeof l!="number"&&(l=l.toString()),u===void 0)switch(r.V.kind){case"scalar":u=pa(r.V.T,ri.BIGINT);break;case"enum":u=r.V.T.values[0].no;break;case"message":u=new r.V.T;break}return[l,u]}function yb(r,t){const i=Pr(r,t);return typeof i=="bigint"?i.toString():i}function Pr(r,t){switch(t){case G.STRING:return r.string();case G.BOOL:return r.bool();case G.DOUBLE:return r.double();case G.FLOAT:return r.float();case G.INT32:return r.int32();case G.INT64:return r.int64();case G.UINT64:return r.uint64();case G.FIXED64:return r.fixed64();case G.BYTES:return r.bytes();case G.FIXED32:return r.fixed32();case G.SFIXED32:return r.sfixed32();case G.SFIXED64:return r.sfixed64();case G.SINT64:return r.sint64();case G.UINT32:return r.uint32();case G.SINT32:return r.sint32()}}function nh(r,t,i,a){Je(t!==void 0);const o=r.repeated;switch(r.kind){case"scalar":case"enum":let l=r.kind=="enum"?G.INT32:r.T;if(o)if(Je(Array.isArray(t)),r.packed)Sb(i,l,r.no,t);else for(const u of t)vs(i,l,r.no,u);else vs(i,l,r.no,t);break;case"message":if(o){Je(Array.isArray(t));for(const u of t)ih(i,a,r,u)}else ih(i,a,r,t);break;case"map":Je(typeof t=="object"&&t!=null);for(const[u,d]of Object.entries(t))bb(i,a,r,u,d);break}}function bb(r,t,i,a,o){r.tag(i.no,et.LengthDelimited),r.fork();let l=a;switch(i.K){case G.INT32:case G.FIXED32:case G.UINT32:case G.SFIXED32:case G.SINT32:l=Number.parseInt(a);break;case G.BOOL:Je(a=="true"||a=="false"),l=a=="true";break}switch(vs(r,i.K,1,l),i.V.kind){case"scalar":vs(r,i.V.T,2,o);break;case"enum":vs(r,G.INT32,2,o);break;case"message":Je(o!==void 0),r.tag(2,et.LengthDelimited).bytes(o.toBinary(t));break}r.join()}function ih(r,t,i,a){const o=Qf(i.T,a);i.delimited?r.tag(i.no,et.StartGroup).raw(o.toBinary(t)).tag(i.no,et.EndGroup):r.tag(i.no,et.LengthDelimited).bytes(o.toBinary(t))}function vs(r,t,i,a){Je(a!==void 0);let[o,l]=ah(t);r.tag(i,o)[l](a)}function Sb(r,t,i,a){if(!a.length)return;r.tag(i,et.LengthDelimited).fork();let[,o]=ah(t);for(let l=0;l<a.length;l++)r[o](a[l]);r.join()}function ah(r){let t=et.Varint;switch(r){case G.BYTES:case G.STRING:t=et.LengthDelimited;break;case G.DOUBLE:case G.FIXED64:case G.SFIXED64:t=et.Bit64;break;case G.FIXED32:case G.SFIXED32:case G.FLOAT:t=et.Bit32;break}const i=G[r].toLowerCase();return[t,i]}function Tb(){return{setEnumType:xf,initPartial(r,t){if(r===void 0)return;const i=t.getType();for(const a of i.fields.byMember()){const o=a.localName,l=t,u=r;if(u[o]!=null)switch(a.kind){case"oneof":const d=u[o].case;if(d===void 0)continue;const p=a.findField(d);let m=u[o].value;p&&p.kind=="message"&&!Un(m,p.T)?m=new p.T(m):p&&p.kind==="scalar"&&p.T===G.BYTES&&(m=ys(m)),l[o]={case:d,value:m};break;case"scalar":case"enum":let g=u[o];a.T===G.BYTES&&(g=a.repeated?g.map(ys):ys(g)),l[o]=g;break;case"map":switch(a.V.kind){case"scalar":case"enum":if(a.V.T===G.BYTES)for(const[C,O]of Object.entries(u[o]))l[o][C]=ys(O);else Object.assign(l[o],u[o]);break;case"message":const S=a.V.T;for(const C of Object.keys(u[o])){let O=u[o][C];S.fieldWrapper||(O=new S(O)),l[o][C]=O}break}break;case"message":const y=a.T;if(a.repeated)l[o]=u[o].map(S=>Un(S,y)?S:new y(S));else{const S=u[o];y.fieldWrapper?y.typeName==="google.protobuf.BytesValue"?l[o]=ys(S):l[o]=S:l[o]=Un(S,y)?S:new y(S)}break}}},equals(r,t,i){return t===i?!0:!t||!i?!1:r.fields.byMember().every(a=>{const o=t[a.localName],l=i[a.localName];if(a.repeated){if(o.length!==l.length)return!1;switch(a.kind){case"message":return o.every((u,d)=>a.T.equals(u,l[d]));case"scalar":return o.every((u,d)=>oi(a.T,u,l[d]));case"enum":return o.every((u,d)=>oi(G.INT32,u,l[d]))}throw new Error("repeated cannot contain ".concat(a.kind))}switch(a.kind){case"message":let u=o,d=l;return a.T.fieldWrapper&&(u!==void 0&&!Un(u)&&(u=a.T.fieldWrapper.wrapField(u)),d!==void 0&&!Un(d)&&(d=a.T.fieldWrapper.wrapField(d))),a.T.equals(u,d);case"enum":return oi(G.INT32,o,l);case"scalar":return oi(a.T,o,l);case"oneof":if(o.case!==l.case)return!1;const p=a.findField(o.case);if(p===void 0)return!0;switch(p.kind){case"message":return p.T.equals(o.value,l.value);case"enum":return oi(G.INT32,o.value,l.value);case"scalar":return oi(p.T,o.value,l.value)}throw new Error("oneof cannot contain ".concat(p.kind));case"map":const m=Object.keys(o).concat(Object.keys(l));switch(a.V.kind){case"message":const g=a.V.T;return m.every(S=>g.equals(o[S],l[S]));case"enum":return m.every(S=>oi(G.INT32,o[S],l[S]));case"scalar":const y=a.V.T;return m.every(S=>oi(y,o[S],l[S]))}break}})},clone(r){const t=r.getType(),i=new t,a=i;for(const o of t.fields.byMember()){const l=r[o.localName];let u;if(o.repeated)u=l.map(Ur);else if(o.kind=="map"){u=a[o.localName];for(const[d,p]of Object.entries(l))u[d]=Ur(p)}else o.kind=="oneof"?u=o.findField(l.case)?{case:l.case,value:Ur(l.value)}:{case:void 0}:u=Ur(l);a[o.localName]=u}for(const o of t.runtime.bin.listUnknownFields(r))t.runtime.bin.onUnknownField(a,o.no,o.wireType,o.data);return i}}}function Ur(r){if(r===void 0)return r;if(Un(r))return r.clone();if(r instanceof Uint8Array){const t=new Uint8Array(r.byteLength);return t.set(r),t}return r}function ys(r){return r instanceof Uint8Array?r:new Uint8Array(r)}function Cb(r,t,i){return{syntax:r,json:db(),bin:gb(),util:Object.assign(Object.assign({},Tb()),{newFieldList:t,initFields:i}),makeMessageType(a,o,l){return Xy(this,a,o,l)},makeEnum:Jy,makeEnumType:Pf,getEnumType:Qy,makeExtension(a,o,l){return ab(this,a,o,l)}}}class kb{constructor(t,i){this._fields=t,this._normalizer=i}findJsonName(t){if(!this.jsonNames){const i={};for(const a of this.list())i[a.jsonName]=i[a.name]=a;this.jsonNames=i}return this.jsonNames[t]}find(t){if(!this.numbers){const i={};for(const a of this.list())i[a.no]=a;this.numbers=i}return this.numbers[t]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((t,i)=>t.no-i.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const t=this.members;let i;for(const a of this.list())a.oneof?a.oneof!==i&&(i=a.oneof,t.push(i)):t.push(a)}return this.members}}function sh(r,t){const i=rh(r);return t?i:Db(Ab(i))}function Eb(r){return sh(r,!1)}const _b=rh;function rh(r){let t=!1;const i=[];for(let a=0;a<r.length;a++){let o=r.charAt(a);switch(o){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":i.push(o),t=!1;break;default:t&&(t=!1,o=o.toUpperCase()),i.push(o);break}}return i.join("")}const Rb=new Set(["constructor","toString","toJSON","valueOf"]),Ob=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),oh=r=>"".concat(r,"$"),Ab=r=>Ob.has(r)?oh(r):r,Db=r=>Rb.has(r)?oh(r):r;class Mb{constructor(t){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=t,this.localName=Eb(t)}addField(t){Je(t.oneof===this,"field ".concat(t.name," not one of ").concat(this.name)),this.fields.push(t)}findField(t){if(!this._lookup){this._lookup=Object.create(null);for(let i=0;i<this.fields.length;i++)this._lookup[this.fields[i].localName]=this.fields[i]}return this._lookup[t]}}function wb(r,t){var i,a,o,l,u,d;const p=[];let m;for(const g of typeof r=="function"?r():r){const y=g;if(y.localName=sh(g.name,g.oneof!==void 0),y.jsonName=(i=g.jsonName)!==null&&i!==void 0?i:_b(g.name),y.repeated=(a=g.repeated)!==null&&a!==void 0?a:!1,g.kind=="scalar"&&(y.L=(o=g.L)!==null&&o!==void 0?o:ri.BIGINT),y.delimited=(l=g.delimited)!==null&&l!==void 0?l:!1,y.req=(u=g.req)!==null&&u!==void 0?u:!1,y.opt=(d=g.opt)!==null&&d!==void 0?d:!1,g.packed===void 0&&(y.packed=g.kind=="enum"||g.kind=="scalar"&&g.T!=G.BYTES&&g.T!=G.STRING),g.oneof!==void 0){const S=typeof g.oneof=="string"?g.oneof:g.oneof.name;(!m||m.name!=S)&&(m=new Mb(S)),y.oneof=m,m.addField(y)}p.push(y)}return p}const w=Cb("proto3",r=>new kb(r,t=>wb(t)),r=>{for(const t of r.getType().fields.byMember()){if(t.opt)continue;const i=t.localName,a=r;if(t.repeated){a[i]=[];continue}switch(t.kind){case"oneof":a[i]={case:void 0};break;case"enum":a[i]=0;break;case"map":a[i]={};break;case"scalar":a[i]=pa(t.T,t.L);break}}});class Nt extends Ic{constructor(t){super(),this.seconds=Ke.zero,this.nanos=0,w.util.initPartial(t,this)}fromJson(t,i){if(typeof t!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(w.json.debug(t)));const a=t.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!a)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const o=Date.parse(a[1]+"-"+a[2]+"-"+a[3]+"T"+a[4]+":"+a[5]+":"+a[6]+(a[8]?a[8]:"Z"));if(Number.isNaN(o))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(o<Date.parse("0001-01-01T00:00:00Z")||o>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=Ke.parse(o/1e3),this.nanos=0,a[7]&&(this.nanos=parseInt("1"+a[7]+"0".repeat(9-a[7].length))-1e9),this}toJson(t){const i=Number(this.seconds)*1e3;if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let a="Z";if(this.nanos>0){const o=(this.nanos+1e9).toString().substring(1);o.substring(3)==="000000"?a="."+o.substring(0,3)+"Z":o.substring(6)==="000"?a="."+o.substring(0,6)+"Z":a="."+o+"Z"}return new Date(i).toISOString().replace(".000Z",a)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Nt.fromDate(new Date)}static fromDate(t){const i=t.getTime();return new Nt({seconds:Ke.parse(Math.floor(i/1e3)),nanos:i%1e3*1e6})}static fromBinary(t,i){return new Nt().fromBinary(t,i)}static fromJson(t,i){return new Nt().fromJson(t,i)}static fromJsonString(t,i){return new Nt().fromJsonString(t,i)}static equals(t,i){return w.util.equals(Nt,t,i)}}Nt.runtime=w,Nt.typeName="google.protobuf.Timestamp",Nt.fields=w.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const Nb=w.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Nt},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:xb,repeated:!0},{no:5,name:"events",kind:"message",T:Ub,repeated:!0}]),xb=w.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:Pb,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),Pb=w.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Nt},{no:3,name:"value",kind:"scalar",T:2}]),Ub=w.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Nt},{no:7,name:"normalized_end_timestamp",kind:"message",T:Nt,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),ch=w.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),hn=w.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),at=w.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Vc=w.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),bs=w.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Ss=w.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),mn=w.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),Fi=w.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),Lb=w.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),ft=w.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),Lr=w.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Ir,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Ch}]),Ir=w.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),Ib=w.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:w.getEnumType(at),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Hi=w.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:w.getEnumType(va)},{no:4,name:"tracks",kind:"message",T:ya,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:Ib},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:w.getEnumType(Ts)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:w.getEnumType(mn)},{no:18,name:"kind_details",kind:"enum",T:w.getEnumType(Bb),repeated:!0}]),va=w.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Ts=w.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),Bb=w.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),lt=w.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),jb=w.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ci,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:w.getEnumType(lh)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),ya=w.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:w.getEnumType(hn)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:w.getEnumType(at)},{no:10,name:"layers",kind:"message",T:ci,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:jb,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:w.getEnumType(lt)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Ch},{no:19,name:"audio_features",kind:"enum",T:w.getEnumType(ft),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:w.getEnumType(ch)}]),ci=w.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:w.getEnumType(Vc)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),lh=w.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),Ot=w.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:w.getEnumType(be)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Fc,oneof:"value"},{no:3,name:"speaker",kind:"message",T:zb,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:hh,oneof:"value"},{no:7,name:"transcription",kind:"message",T:qb,oneof:"value"},{no:8,name:"metrics",kind:"message",T:Nb,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Br,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:Hc,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Gc,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Kc,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:jr,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:zr,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:qr,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:uh,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),be=w.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),uh=w.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:w.getEnumType(lt)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),dh=w.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:Fc,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:Br,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:Hc,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:Gc,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:Kc,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:jr,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:zr,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:qr,oneof:"value"}]),zb=w.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:fh,repeated:!0}]),fh=w.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Fc=w.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),hh=w.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),qb=w.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:Vb,repeated:!0}]),Vb=w.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Br=w.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),Hc=w.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),Gc=w.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Kc=w.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:mh,oneof:"value"}]),mh=w.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),ph=w.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),gh=w.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:w.getEnumType(vh)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),vh=w.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),yh=w.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:w.getEnumType(bh)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),bh=w.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),Sh=w.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:Th},{no:2,name:"screen",kind:"message",T:Th},{no:3,name:"resume_connection",kind:"enum",T:w.getEnumType(Ss)},{no:4,name:"disabled_codecs",kind:"message",T:Fb},{no:5,name:"force_relay",kind:"enum",T:w.getEnumType(Ss)}]),Th=w.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:w.getEnumType(Ss)}]),Fb=w.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Ir,repeated:!0},{no:2,name:"publish",kind:"message",T:Ir,repeated:!0}]),Ch=w.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Yc=w.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),kh=w.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:w.getEnumType(Yc)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),Eh=w.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),jr=w.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:w.getEnumType(lt)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:kh,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:Eh,oneof:"content_header"}],{localName:"DataStream_Header"}),zr=w.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),qr=w.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),Hb=w.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),pn=w.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Qc=w.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),Gb=w.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),Kb=w.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:li,oneof:"message"},{no:2,name:"answer",kind:"message",T:li,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Vr,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Cs,oneof:"message"},{no:5,name:"mute",kind:"message",T:Fr,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Hr,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:Rh,oneof:"message"},{no:8,name:"leave",kind:"message",T:Gr,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:Ah,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:wh,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:el,oneof:"message"},{no:13,name:"simulate",kind:"message",T:_n,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Wc,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Ph,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Zc,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:Oh,oneof:"message"}]),_h=w.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:Yb,oneof:"message"},{no:2,name:"answer",kind:"message",T:li,oneof:"message"},{no:3,name:"offer",kind:"message",T:li,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Vr,oneof:"message"},{no:5,name:"update",kind:"message",T:Xb,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Xc,oneof:"message"},{no:8,name:"leave",kind:"message",T:Gr,oneof:"message"},{no:9,name:"mute",kind:"message",T:Fr,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:Zb,oneof:"message"},{no:11,name:"room_update",kind:"message",T:Wb,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:eS,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:nS,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:aS,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:rS,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:Jb,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:Qb,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:cS,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:dS,oneof:"message"},{no:22,name:"request_response",kind:"message",T:fS,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:hS,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:oS,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:vS,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:sS,oneof:"message"}]),Jc=w.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ci,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:w.getEnumType(lh)}]),Cs=w.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:w.getEnumType(hn)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:w.getEnumType(at)},{no:9,name:"layers",kind:"message",T:ci,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Jc,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:w.getEnumType(lt)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:w.getEnumType(ch)},{no:17,name:"audio_features",kind:"enum",T:w.getEnumType(ft),repeated:!0}]),Vr=w.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:w.getEnumType(pn)},{no:3,name:"final",kind:"scalar",T:8}]),Fr=w.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),Yb=w.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Lr},{no:2,name:"participant",kind:"message",T:Hi},{no:3,name:"other_participants",kind:"message",T:Hi,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:Dh,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:Sh},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:gh},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Ir,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),Qb=w.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:Dh,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:Sh},{no:3,name:"server_info",kind:"message",T:gh},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),Xc=w.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:ya}]),Jb=w.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),li=w.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),Xb=w.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Hi,repeated:!0}]),Hr=w.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:ph,repeated:!0}]),Rh=w.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:w.getEnumType(Vc)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Zc=w.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:w.getEnumType(ft),repeated:!0}]),Oh=w.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Gr=w.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:w.getEnumType(mn)},{no:3,name:"action",kind:"enum",T:w.getEnumType(ba)},{no:4,name:"regions",kind:"message",T:lS}]),ba=w.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),Ah=w.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:ci,repeated:!0}]),Wc=w.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),Dh=w.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),Zb=w.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:fh,repeated:!0}]),Wb=w.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Lr}]),$b=w.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:w.getEnumType(bs)},{no:3,name:"score",kind:"scalar",T:2}]),eS=w.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:$b,repeated:!0}]),tS=w.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:w.getEnumType(Qc)}]),nS=w.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:tS,repeated:!0}]),$c=w.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:w.getEnumType(Vc)},{no:2,name:"enabled",kind:"scalar",T:8}]),iS=w.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:$c,repeated:!0}]),aS=w.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:$c,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:iS,repeated:!0}]),sS=w.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:Hb,repeated:!0}]),Mh=w.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),wh=w.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Mh,repeated:!0}]),rS=w.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),oS=w.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:Lr},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Hi},{no:4,name:"other_participants",kind:"message",T:Hi,repeated:!0}]),el=w.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:li},{no:2,name:"subscription",kind:"message",T:Hr},{no:3,name:"publish_tracks",kind:"message",T:Xc,repeated:!0},{no:4,name:"data_channels",kind:"message",T:xh,repeated:!0},{no:5,name:"offer",kind:"message",T:li},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:Nh,repeated:!0}]),Nh=w.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),xh=w.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:w.getEnumType(pn)}]),_n=w.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:w.getEnumType(Gb),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Ph=w.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),cS=w.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),lS=w.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:uS,repeated:!0}]),uS=w.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),dS=w.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:w.getEnumType(Lb)}]),fS=w.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:w.getEnumType(tl)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:Vr,oneof:"request"},{no:5,name:"add_track",kind:"message",T:Cs,oneof:"request"},{no:6,name:"mute",kind:"message",T:Fr,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:Wc,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:Zc,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:Oh,oneof:"request"}]),tl=w.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),hS=w.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Uh=w.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),mS=w.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:yh},{no:2,name:"connection_settings",kind:"message",T:Uh},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:Cs,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:li},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:w.getEnumType(Fi)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:el}]),pS=w.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:w.getEnumType(gS)},{no:2,name:"join_request",kind:"scalar",T:12}]),gS=w.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),vS=w.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function yS(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Kr={exports:{}},bS=Kr.exports,Lh;function SS(){return Lh||(Lh=1,(function(r){(function(t,i){r.exports?r.exports=i():t.log=i()})(bS,function(){var t=function(){},i="undefined",a=typeof window!==i&&typeof window.navigator!==i&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"],l={},u=null;function d(A,I){var L=A[I];if(typeof L.bind=="function")return L.bind(A);try{return Function.prototype.bind.call(L,A)}catch{return function(){return Function.prototype.apply.apply(L,[A,arguments])}}}function p(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function m(A){return A==="debug"&&(A="log"),typeof console===i?!1:A==="trace"&&a?p:console[A]!==void 0?d(console,A):console.log!==void 0?d(console,"log"):t}function g(){for(var A=this.getLevel(),I=0;I<o.length;I++){var L=o[I];this[L]=I<A?t:this.methodFactory(L,A,this.name)}if(this.log=this.debug,typeof console===i&&A<this.levels.SILENT)return"No console available for logging"}function y(A){return function(){typeof console!==i&&(g.call(this),this[A].apply(this,arguments))}}function S(A,I,L){return m(A)||y.apply(this,arguments)}function C(A,I){var L=this,X,K,D,x="loglevel";typeof A=="string"?x+=":"+A:typeof A=="symbol"&&(x=void 0);function F(ae){var de=(o[ae]||"silent").toUpperCase();if(!(typeof window===i||!x)){try{window.localStorage[x]=de;return}catch{}try{window.document.cookie=encodeURIComponent(x)+"="+de+";"}catch{}}}function Y(){var ae;if(!(typeof window===i||!x)){try{ae=window.localStorage[x]}catch{}if(typeof ae===i)try{var de=window.document.cookie,Qe=encodeURIComponent(x),mt=de.indexOf(Qe+"=");mt!==-1&&(ae=/^([^;]+)/.exec(de.slice(mt+Qe.length+1))[1])}catch{}return L.levels[ae]===void 0&&(ae=void 0),ae}}function te(){if(!(typeof window===i||!x)){try{window.localStorage.removeItem(x)}catch{}try{window.document.cookie=encodeURIComponent(x)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function ie(ae){var de=ae;if(typeof de=="string"&&L.levels[de.toUpperCase()]!==void 0&&(de=L.levels[de.toUpperCase()]),typeof de=="number"&&de>=0&&de<=L.levels.SILENT)return de;throw new TypeError("log.setLevel() called with invalid level: "+ae)}L.name=A,L.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},L.methodFactory=I||S,L.getLevel=function(){return D??K??X},L.setLevel=function(ae,de){return D=ie(ae),de!==!1&&F(D),g.call(L)},L.setDefaultLevel=function(ae){K=ie(ae),Y()||L.setLevel(ae,!1)},L.resetLevel=function(){D=null,te(),g.call(L)},L.enableAll=function(ae){L.setLevel(L.levels.TRACE,ae)},L.disableAll=function(ae){L.setLevel(L.levels.SILENT,ae)},L.rebuild=function(){if(u!==L&&(X=ie(u.getLevel())),g.call(L),u===L)for(var ae in l)l[ae].rebuild()},X=ie(u?u.getLevel():"WARN");var ne=Y();ne!=null&&(D=ie(ne)),g.call(L)}u=new C,u.getLogger=function(I){if(typeof I!="symbol"&&typeof I!="string"||I==="")throw new TypeError("You must supply a name when creating a logger.");var L=l[I];return L||(L=l[I]=new C(I,u.methodFactory)),L};var O=typeof window!==i?window.log:void 0;return u.noConflict=function(){return typeof window!==i&&window.log===u&&(window.log=O),u},u.getLoggers=function(){return l},u.default=u,u})})(Kr)),Kr.exports}var Yr=SS(),nl;(function(r){r[r.trace=0]="trace",r[r.debug=1]="debug",r[r.info=2]="info",r[r.warn=3]="warn",r[r.error=4]="error",r[r.silent=5]="silent"})(nl||(nl={}));var gn;(function(r){r.Default="livekit",r.Room="livekit-room",r.TokenSource="livekit-token-source",r.Participant="livekit-participant",r.Track="livekit-track",r.Publication="livekit-track-publication",r.Engine="livekit-engine",r.Signal="livekit-signal",r.PCManager="livekit-pc-manager",r.PCTransport="livekit-pc-transport",r.E2EE="lk-e2ee"})(gn||(gn={}));let ge=Yr.getLogger("livekit");Object.values(gn).map(r=>Yr.getLogger(r)),ge.setDefaultLevel(nl.info);function Ln(r){const t=Yr.getLogger(r);return t.setDefaultLevel(ge.getLevel()),t}const TS=Yr.getLogger("lk-e2ee"),ks=7e3,CS=[0,300,4*300,9*300,16*300,ks,ks,ks,ks,ks];class kS{constructor(t){this._retryDelays=t!==void 0?[...t]:CS}nextRetryDelayInMs(t){if(t.retryCount>=this._retryDelays.length)return null;const i=this._retryDelays[t.retryCount];return t.retryCount<=1?i:i+Math.random()*1e3}}function ES(r,t){var i={};for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&t.indexOf(a)<0&&(i[a]=r[a]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,a=Object.getOwnPropertySymbols(r);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(r,a[o])&&(i[a[o]]=r[a[o]]);return i}function T(r,t,i,a){function o(l){return l instanceof i?l:new i(function(u){u(l)})}return new(i||(i=Promise))(function(l,u){function d(g){try{m(a.next(g))}catch(y){u(y)}}function p(g){try{m(a.throw(g))}catch(y){u(y)}}function m(g){g.done?l(g.value):o(g.value).then(d,p)}m((a=a.apply(r,t||[])).next())})}function Ih(r){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&r[t],a=0;if(i)return i.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&a>=r.length&&(r=void 0),{value:r&&r[a++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function In(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=r[Symbol.asyncIterator],i;return t?t.call(r):(r=typeof Ih=="function"?Ih(r):r[Symbol.iterator](),i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i);function a(l){i[l]=r[l]&&function(u){return new Promise(function(d,p){u=r[l](u),o(d,p,u.done,u.value)})}}function o(l,u,d,p){Promise.resolve(p).then(function(m){l({value:m,done:d})},u)}}typeof SuppressedError=="function"&&SuppressedError;var Qr={exports:{}},Bh;function _S(){if(Bh)return Qr.exports;Bh=1;var r=typeof Reflect=="object"?Reflect:null,t=r&&typeof r.apply=="function"?r.apply:function(x,F,Y){return Function.prototype.apply.call(x,F,Y)},i;r&&typeof r.ownKeys=="function"?i=r.ownKeys:Object.getOwnPropertySymbols?i=function(x){return Object.getOwnPropertyNames(x).concat(Object.getOwnPropertySymbols(x))}:i=function(x){return Object.getOwnPropertyNames(x)};function a(D){console&&console.warn&&console.warn(D)}var o=Number.isNaN||function(x){return x!==x};function l(){l.init.call(this)}Qr.exports=l,Qr.exports.once=L,l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var u=10;function d(D){if(typeof D!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof D)}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(D){if(typeof D!="number"||D<0||o(D))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+D+".");u=D}}),l.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(x){if(typeof x!="number"||x<0||o(x))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+x+".");return this._maxListeners=x,this};function p(D){return D._maxListeners===void 0?l.defaultMaxListeners:D._maxListeners}l.prototype.getMaxListeners=function(){return p(this)},l.prototype.emit=function(x){for(var F=[],Y=1;Y<arguments.length;Y++)F.push(arguments[Y]);var te=x==="error",ie=this._events;if(ie!==void 0)te=te&&ie.error===void 0;else if(!te)return!1;if(te){var ne;if(F.length>0&&(ne=F[0]),ne instanceof Error)throw ne;var ae=new Error("Unhandled error."+(ne?" ("+ne.message+")":""));throw ae.context=ne,ae}var de=ie[x];if(de===void 0)return!1;if(typeof de=="function")t(de,this,F);else for(var Qe=de.length,mt=O(de,Qe),Y=0;Y<Qe;++Y)t(mt[Y],this,F);return!0};function m(D,x,F,Y){var te,ie,ne;if(d(F),ie=D._events,ie===void 0?(ie=D._events=Object.create(null),D._eventsCount=0):(ie.newListener!==void 0&&(D.emit("newListener",x,F.listener?F.listener:F),ie=D._events),ne=ie[x]),ne===void 0)ne=ie[x]=F,++D._eventsCount;else if(typeof ne=="function"?ne=ie[x]=Y?[F,ne]:[ne,F]:Y?ne.unshift(F):ne.push(F),te=p(D),te>0&&ne.length>te&&!ne.warned){ne.warned=!0;var ae=new Error("Possible EventEmitter memory leak detected. "+ne.length+" "+String(x)+" listeners added. Use emitter.setMaxListeners() to increase limit");ae.name="MaxListenersExceededWarning",ae.emitter=D,ae.type=x,ae.count=ne.length,a(ae)}return D}l.prototype.addListener=function(x,F){return m(this,x,F,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(x,F){return m(this,x,F,!0)};function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function y(D,x,F){var Y={fired:!1,wrapFn:void 0,target:D,type:x,listener:F},te=g.bind(Y);return te.listener=F,Y.wrapFn=te,te}l.prototype.once=function(x,F){return d(F),this.on(x,y(this,x,F)),this},l.prototype.prependOnceListener=function(x,F){return d(F),this.prependListener(x,y(this,x,F)),this},l.prototype.removeListener=function(x,F){var Y,te,ie,ne,ae;if(d(F),te=this._events,te===void 0)return this;if(Y=te[x],Y===void 0)return this;if(Y===F||Y.listener===F)--this._eventsCount===0?this._events=Object.create(null):(delete te[x],te.removeListener&&this.emit("removeListener",x,Y.listener||F));else if(typeof Y!="function"){for(ie=-1,ne=Y.length-1;ne>=0;ne--)if(Y[ne]===F||Y[ne].listener===F){ae=Y[ne].listener,ie=ne;break}if(ie<0)return this;ie===0?Y.shift():A(Y,ie),Y.length===1&&(te[x]=Y[0]),te.removeListener!==void 0&&this.emit("removeListener",x,ae||F)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(x){var F,Y,te;if(Y=this._events,Y===void 0)return this;if(Y.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):Y[x]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete Y[x]),this;if(arguments.length===0){var ie=Object.keys(Y),ne;for(te=0;te<ie.length;++te)ne=ie[te],ne!=="removeListener"&&this.removeAllListeners(ne);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(F=Y[x],typeof F=="function")this.removeListener(x,F);else if(F!==void 0)for(te=F.length-1;te>=0;te--)this.removeListener(x,F[te]);return this};function S(D,x,F){var Y=D._events;if(Y===void 0)return[];var te=Y[x];return te===void 0?[]:typeof te=="function"?F?[te.listener||te]:[te]:F?I(te):O(te,te.length)}l.prototype.listeners=function(x){return S(this,x,!0)},l.prototype.rawListeners=function(x){return S(this,x,!1)},l.listenerCount=function(D,x){return typeof D.listenerCount=="function"?D.listenerCount(x):C.call(D,x)},l.prototype.listenerCount=C;function C(D){var x=this._events;if(x!==void 0){var F=x[D];if(typeof F=="function")return 1;if(F!==void 0)return F.length}return 0}l.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]};function O(D,x){for(var F=new Array(x),Y=0;Y<x;++Y)F[Y]=D[Y];return F}function A(D,x){for(;x+1<D.length;x++)D[x]=D[x+1];D.pop()}function I(D){for(var x=new Array(D.length),F=0;F<x.length;++F)x[F]=D[F].listener||D[F];return x}function L(D,x){return new Promise(function(F,Y){function te(ne){D.removeListener(x,ie),Y(ne)}function ie(){typeof D.removeListener=="function"&&D.removeListener("error",te),F([].slice.call(arguments))}K(D,x,ie,{once:!0}),x!=="error"&&X(D,te,{once:!0})})}function X(D,x,F){typeof D.on=="function"&&K(D,"error",x,F)}function K(D,x,F,Y){if(typeof D.on=="function")Y.once?D.once(x,F):D.on(x,F);else if(typeof D.addEventListener=="function")D.addEventListener(x,function te(ie){Y.once&&D.removeEventListener(x,te),F(ie)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof D)}return Qr.exports}var Rn=_S();let jh=!0,zh=!0;function Es(r,t,i){const a=r.match(t);return a&&a.length>=i&&parseFloat(a[i],10)}function Gi(r,t,i){if(!r.RTCPeerConnection)return;const a=r.RTCPeerConnection.prototype,o=a.addEventListener;a.addEventListener=function(u,d){if(u!==t)return o.apply(this,arguments);const p=m=>{const g=i(m);g&&(d.handleEvent?d.handleEvent(g):d(g))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(d,p),o.apply(this,[u,p])};const l=a.removeEventListener;a.removeEventListener=function(u,d){if(u!==t||!this._eventMap||!this._eventMap[t])return l.apply(this,arguments);if(!this._eventMap[t].has(d))return l.apply(this,arguments);const p=this._eventMap[t].get(d);return this._eventMap[t].delete(d),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,l.apply(this,[u,p])},Object.defineProperty(a,"on"+t,{get(){return this["_on"+t]},set(u){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),u&&this.addEventListener(t,this["_on"+t]=u)},enumerable:!0,configurable:!0})}function RS(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(jh=r,r?"adapter.js logging disabled":"adapter.js logging enabled")}function OS(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(zh=!r,"adapter.js deprecation warnings "+(r?"disabled":"enabled"))}function qh(){if(typeof window=="object"){if(jh)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function il(r,t){zh&&console.warn(r+" is deprecated, please use "+t+" instead.")}function AS(r){const t={browser:null,version:null};if(typeof r>"u"||!r.navigator||!r.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:i}=r;if(i.userAgentData&&i.userAgentData.brands){const a=i.userAgentData.brands.find(o=>o.brand==="Chromium");if(a)return{browser:"chrome",version:parseInt(a.version,10)}}if(i.mozGetUserMedia)t.browser="firefox",t.version=parseInt(Es(i.userAgent,/Firefox\/(\d+)\./,1));else if(i.webkitGetUserMedia||r.isSecureContext===!1&&r.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(Es(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(r.RTCPeerConnection&&i.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=parseInt(Es(i.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=r.RTCRtpTransceiver&&"currentDirection"in r.RTCRtpTransceiver.prototype,t._safariVersion=Es(i.userAgent,/Version\/(\d+(\.?\d+))/,1);else return t.browser="Not a supported browser.",t;return t}function Vh(r){return Object.prototype.toString.call(r)==="[object Object]"}function Fh(r){return Vh(r)?Object.keys(r).reduce(function(t,i){const a=Vh(r[i]),o=a?Fh(r[i]):r[i],l=a&&!Object.keys(o).length;return o===void 0||l?t:Object.assign(t,{[i]:o})},{}):r}function al(r,t,i){!t||i.has(t.id)||(i.set(t.id,t),Object.keys(t).forEach(a=>{a.endsWith("Id")?al(r,r.get(t[a]),i):a.endsWith("Ids")&&t[a].forEach(o=>{al(r,r.get(o),i)})}))}function Hh(r,t,i){const a=i?"outbound-rtp":"inbound-rtp",o=new Map;if(t===null)return o;const l=[];return r.forEach(u=>{u.type==="track"&&u.trackIdentifier===t.id&&l.push(u)}),l.forEach(u=>{r.forEach(d=>{d.type===a&&d.trackId===u.id&&al(r,d,o)})}),o}const Gh=qh;function Kh(r,t){const i=r&&r.navigator;if(!i.mediaDevices)return;const a=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;const p={};return Object.keys(d).forEach(m=>{if(m==="require"||m==="advanced"||m==="mediaSource")return;const g=typeof d[m]=="object"?d[m]:{ideal:d[m]};g.exact!==void 0&&typeof g.exact=="number"&&(g.min=g.max=g.exact);const y=function(S,C){return S?S+C.charAt(0).toUpperCase()+C.slice(1):C==="deviceId"?"sourceId":C};if(g.ideal!==void 0){p.optional=p.optional||[];let S={};typeof g.ideal=="number"?(S[y("min",m)]=g.ideal,p.optional.push(S),S={},S[y("max",m)]=g.ideal,p.optional.push(S)):(S[y("",m)]=g.ideal,p.optional.push(S))}g.exact!==void 0&&typeof g.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[y("",m)]=g.exact):["min","max"].forEach(S=>{g[S]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[y(S,m)]=g[S])})}),d.advanced&&(p.optional=(p.optional||[]).concat(d.advanced)),p},o=function(d,p){if(t.version>=61)return p(d);if(d=JSON.parse(JSON.stringify(d)),d&&typeof d.audio=="object"){const m=function(g,y,S){y in g&&!(S in g)&&(g[S]=g[y],delete g[y])};d=JSON.parse(JSON.stringify(d)),m(d.audio,"autoGainControl","googAutoGainControl"),m(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=a(d.audio)}if(d&&typeof d.video=="object"){let m=d.video.facingMode;m=m&&(typeof m=="object"?m:{ideal:m});const g=t.version<66;if(m&&(m.exact==="user"||m.exact==="environment"||m.ideal==="user"||m.ideal==="environment")&&!(i.mediaDevices.getSupportedConstraints&&i.mediaDevices.getSupportedConstraints().facingMode&&!g)){delete d.video.facingMode;let y;if(m.exact==="environment"||m.ideal==="environment"?y=["back","rear"]:(m.exact==="user"||m.ideal==="user")&&(y=["front"]),y)return i.mediaDevices.enumerateDevices().then(S=>{S=S.filter(O=>O.kind==="videoinput");let C=S.find(O=>y.some(A=>O.label.toLowerCase().includes(A)));return!C&&S.length&&y.includes("back")&&(C=S[S.length-1]),C&&(d.video.deviceId=m.exact?{exact:C.deviceId}:{ideal:C.deviceId}),d.video=a(d.video),Gh("chrome: "+JSON.stringify(d)),p(d)})}d.video=a(d.video)}return Gh("chrome: "+JSON.stringify(d)),p(d)},l=function(d){return t.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},u=function(d,p,m){o(d,g=>{i.webkitGetUserMedia(g,p,y=>{m&&m(l(y))})})};if(i.getUserMedia=u.bind(i),i.mediaDevices.getUserMedia){const d=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(p){return o(p,m=>d(m).then(g=>{if(m.audio&&!g.getAudioTracks().length||m.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(y=>{y.stop()}),new DOMException("","NotFoundError");return g},g=>Promise.reject(l(g))))}}}function Yh(r){r.MediaStream=r.MediaStream||r.webkitMediaStream}function Qh(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("ontrack"in r.RTCPeerConnection.prototype)){Object.defineProperty(r.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const t=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=a=>{a.stream.addEventListener("addtrack",o=>{let l;r.RTCPeerConnection.prototype.getReceivers?l=this.getReceivers().find(d=>d.track&&d.track.id===o.track.id):l={track:o.track};const u=new Event("track");u.track=o.track,u.receiver=l,u.transceiver={receiver:l},u.streams=[a.stream],this.dispatchEvent(u)}),a.stream.getTracks().forEach(o=>{let l;r.RTCPeerConnection.prototype.getReceivers?l=this.getReceivers().find(d=>d.track&&d.track.id===o.id):l={track:o};const u=new Event("track");u.track=o,u.receiver=l,u.transceiver={receiver:l},u.streams=[a.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Gi(r,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Jh(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("getSenders"in r.RTCPeerConnection.prototype)&&"createDTMFSender"in r.RTCPeerConnection.prototype){const t=function(o,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=o.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:o}};if(!r.RTCPeerConnection.prototype.getSenders){r.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(d,p){let m=o.apply(this,arguments);return m||(m=t(this,d),this._senders.push(m)),m};const l=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(d){l.apply(this,arguments);const p=this._senders.indexOf(d);p!==-1&&this._senders.splice(p,1)}}const i=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(l){this._senders=this._senders||[],i.apply(this,[l]),l.getTracks().forEach(u=>{this._senders.push(t(this,u))})};const a=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(l){this._senders=this._senders||[],a.apply(this,[l]),l.getTracks().forEach(u=>{const d=this._senders.find(p=>p.track===u);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof r=="object"&&r.RTCPeerConnection&&"getSenders"in r.RTCPeerConnection.prototype&&"createDTMFSender"in r.RTCPeerConnection.prototype&&r.RTCRtpSender&&!("dtmf"in r.RTCRtpSender.prototype)){const t=r.RTCPeerConnection.prototype.getSenders;r.RTCPeerConnection.prototype.getSenders=function(){const a=t.apply(this,[]);return a.forEach(o=>o._pc=this),a},Object.defineProperty(r.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Xh(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&r.RTCRtpReceiver))return;if(!("getStats"in r.RTCRtpSender.prototype)){const i=r.RTCPeerConnection.prototype.getSenders;i&&(r.RTCPeerConnection.prototype.getSenders=function(){const l=i.apply(this,[]);return l.forEach(u=>u._pc=this),l});const a=r.RTCPeerConnection.prototype.addTrack;a&&(r.RTCPeerConnection.prototype.addTrack=function(){const l=a.apply(this,arguments);return l._pc=this,l}),r.RTCRtpSender.prototype.getStats=function(){const l=this;return this._pc.getStats().then(u=>Hh(u,l.track,!0))}}if(!("getStats"in r.RTCRtpReceiver.prototype)){const i=r.RTCPeerConnection.prototype.getReceivers;i&&(r.RTCPeerConnection.prototype.getReceivers=function(){const o=i.apply(this,[]);return o.forEach(l=>l._pc=this),o}),Gi(r,"track",a=>(a.receiver._pc=a.srcElement,a)),r.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(l=>Hh(l,o.track,!1))}}if(!("getStats"in r.RTCRtpSender.prototype&&"getStats"in r.RTCRtpReceiver.prototype))return;const t=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof r.MediaStreamTrack){const a=arguments[0];let o,l,u;return this.getSenders().forEach(d=>{d.track===a&&(o?u=!0:o=d)}),this.getReceivers().forEach(d=>(d.track===a&&(l?u=!0:l=d),d.track===a)),u||o&&l?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():l?l.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Zh(r){r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const t=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(u,d){if(!d)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=t.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(p)===-1&&this._shimmedLocalStreams[d.id].push(p):this._shimmedLocalStreams[d.id]=[d,p],p};const i=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(m=>{if(this.getSenders().find(y=>y.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const d=this.getSenders();i.apply(this,arguments);const p=this.getSenders().filter(m=>d.indexOf(m)===-1);this._shimmedLocalStreams[u.id]=[u].concat(p)};const a=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],a.apply(this,arguments)};const o=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(d=>{const p=this._shimmedLocalStreams[d].indexOf(u);p!==-1&&this._shimmedLocalStreams[d].splice(p,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),o.apply(this,arguments)}}function Wh(r,t){if(!r.RTCPeerConnection)return;if(r.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Zh(r);const i=r.RTCPeerConnection.prototype.getLocalStreams;r.RTCPeerConnection.prototype.getLocalStreams=function(){const g=i.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map(y=>this._reverseStreams[y.id])};const a=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach(y=>{if(this.getSenders().find(C=>C.track===y))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[g.id]){const y=new r.MediaStream(g.getTracks());this._streams[g.id]=y,this._reverseStreams[y.id]=g,g=y}a.apply(this,[g])};const o=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},r.RTCPeerConnection.prototype.addTrack=function(g,y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(A=>A===g))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(A=>A.track===g))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const O=this._streams[y.id];if(O)O.addTrack(g),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const A=new r.MediaStream([g]);this._streams[y.id]=A,this._reverseStreams[A.id]=y,this.addStream(A)}return this.getSenders().find(A=>A.track===g)};function l(m,g){let y=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(S=>{const C=m._reverseStreams[S],O=m._streams[C.id];y=y.replace(new RegExp(O.id,"g"),C.id)}),new RTCSessionDescription({type:g.type,sdp:y})}function u(m,g){let y=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(S=>{const C=m._reverseStreams[S],O=m._streams[C.id];y=y.replace(new RegExp(C.id,"g"),O.id)}),new RTCSessionDescription({type:g.type,sdp:y})}["createOffer","createAnswer"].forEach(function(m){const g=r.RTCPeerConnection.prototype[m],y={[m](){const S=arguments;return arguments.length&&typeof arguments[0]=="function"?g.apply(this,[O=>{const A=l(this,O);S[0].apply(null,[A])},O=>{S[1]&&S[1].apply(null,O)},arguments[2]]):g.apply(this,arguments).then(O=>l(this,O))}};r.RTCPeerConnection.prototype[m]=y[m]});const d=r.RTCPeerConnection.prototype.setLocalDescription;r.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?d.apply(this,arguments):(arguments[0]=u(this,arguments[0]),d.apply(this,arguments))};const p=Object.getOwnPropertyDescriptor(r.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(r.RTCPeerConnection.prototype,"localDescription",{get(){const m=p.get.apply(this);return m.type===""?m:l(this,m)}}),r.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(g._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let S;Object.keys(this._streams).forEach(C=>{this._streams[C].getTracks().find(A=>g.track===A)&&(S=this._streams[C])}),S&&(S.getTracks().length===1?this.removeStream(this._reverseStreams[S.id]):S.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function sl(r,t){!r.RTCPeerConnection&&r.webkitRTCPeerConnection&&(r.RTCPeerConnection=r.webkitRTCPeerConnection),r.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const a=r.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};r.RTCPeerConnection.prototype[i]=o[i]})}function $h(r,t){Gi(r,"negotiationneeded",i=>{const a=i.target;if(!((t.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")&&a.signalingState!=="stable"))return i})}var em=Object.freeze({__proto__:null,fixNegotiationNeeded:$h,shimAddTrackRemoveTrack:Wh,shimAddTrackRemoveTrackWithNative:Zh,shimGetSendersWithDtmf:Jh,shimGetUserMedia:Kh,shimMediaStream:Yh,shimOnTrack:Qh,shimPeerConnection:sl,shimSenderReceiverGetStats:Xh});function tm(r,t){const i=r&&r.navigator,a=r&&r.MediaStreamTrack;if(i.getUserMedia=function(o,l,u){il("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(o).then(l,u)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const o=function(u,d,p){d in u&&!(p in u)&&(u[p]=u[d],delete u[d])},l=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(u){return typeof u=="object"&&typeof u.audio=="object"&&(u=JSON.parse(JSON.stringify(u)),o(u.audio,"autoGainControl","mozAutoGainControl"),o(u.audio,"noiseSuppression","mozNoiseSuppression")),l(u)},a&&a.prototype.getSettings){const u=a.prototype.getSettings;a.prototype.getSettings=function(){const d=u.apply(this,arguments);return o(d,"mozAutoGainControl","autoGainControl"),o(d,"mozNoiseSuppression","noiseSuppression"),d}}if(a&&a.prototype.applyConstraints){const u=a.prototype.applyConstraints;a.prototype.applyConstraints=function(d){return this.kind==="audio"&&typeof d=="object"&&(d=JSON.parse(JSON.stringify(d)),o(d,"autoGainControl","mozAutoGainControl"),o(d,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[d])}}}}function DS(r,t){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&(r.navigator.mediaDevices.getDisplayMedia=function(a){if(!(a&&a.video)){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,Promise.reject(o)}return a.video===!0?a.video={mediaSource:t}:a.video.mediaSource=t,r.navigator.mediaDevices.getUserMedia(a)})}function nm(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function rl(r,t){if(typeof r!="object"||!(r.RTCPeerConnection||r.mozRTCPeerConnection))return;!r.RTCPeerConnection&&r.mozRTCPeerConnection&&(r.RTCPeerConnection=r.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const l=r.RTCPeerConnection.prototype[o],u={[o](){return arguments[0]=new(o==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};r.RTCPeerConnection.prototype[o]=u[o]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){const[l,u,d]=arguments;return a.apply(this,[l||null]).then(p=>{if(t.version<53&&!u)try{p.forEach(m=>{m.type=i[m.type]||m.type})}catch(m){if(m.name!=="TypeError")throw m;p.forEach((g,y)=>{p.set(y,Object.assign({},g,{type:i[g.type]||g.type}))})}return p}).then(u,d)}}function im(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender)||r.RTCRtpSender&&"getStats"in r.RTCRtpSender.prototype)return;const t=r.RTCPeerConnection.prototype.getSenders;t&&(r.RTCPeerConnection.prototype.getSenders=function(){const o=t.apply(this,[]);return o.forEach(l=>l._pc=this),o});const i=r.RTCPeerConnection.prototype.addTrack;i&&(r.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),r.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function am(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender)||r.RTCRtpSender&&"getStats"in r.RTCRtpReceiver.prototype)return;const t=r.RTCPeerConnection.prototype.getReceivers;t&&(r.RTCPeerConnection.prototype.getReceivers=function(){const a=t.apply(this,[]);return a.forEach(o=>o._pc=this),a}),Gi(r,"track",i=>(i.receiver._pc=i.srcElement,i)),r.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function sm(r){!r.RTCPeerConnection||"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(i){il("removeStream","removeTrack"),this.getSenders().forEach(a=>{a.track&&i.getTracks().includes(a.track)&&this.removeTrack(a)})})}function rm(r){r.DataChannel&&!r.RTCDataChannel&&(r.RTCDataChannel=r.DataChannel)}function om(r){if(!(typeof r=="object"&&r.RTCPeerConnection))return;const t=r.RTCPeerConnection.prototype.addTransceiver;t&&(r.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let a=arguments[1]&&arguments[1].sendEncodings;a===void 0&&(a=[]),a=[...a];const o=a.length>0;o&&a.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const l=t.apply(this,arguments);if(o){const{sender:u}=l,d=u.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=a,u.sendEncodings=a,this.setParametersPromises.push(u.setParameters(d).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return l})}function cm(r){if(!(typeof r=="object"&&r.RTCRtpSender))return;const t=r.RTCRtpSender.prototype.getParameters;t&&(r.RTCRtpSender.prototype.getParameters=function(){const a=t.apply(this,arguments);return"encodings"in a||(a.encodings=[].concat(this.sendEncodings||[{}])),a})}function lm(r){if(!(typeof r=="object"&&r.RTCPeerConnection))return;const t=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function um(r){if(!(typeof r=="object"&&r.RTCPeerConnection))return;const t=r.RTCPeerConnection.prototype.createAnswer;r.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var dm=Object.freeze({__proto__:null,shimAddTransceiver:om,shimCreateAnswer:um,shimCreateOffer:lm,shimGetDisplayMedia:DS,shimGetParameters:cm,shimGetUserMedia:tm,shimOnTrack:nm,shimPeerConnection:rl,shimRTCDataChannel:rm,shimReceiverGetStats:am,shimRemoveStream:sm,shimSenderGetStats:im});function fm(r){if(!(typeof r!="object"||!r.RTCPeerConnection)){if("getLocalStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in r.RTCPeerConnection.prototype)){const t=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addStream=function(a){this._localStreams||(this._localStreams=[]),this._localStreams.includes(a)||this._localStreams.push(a),a.getAudioTracks().forEach(o=>t.call(this,o,a)),a.getVideoTracks().forEach(o=>t.call(this,o,a))},r.RTCPeerConnection.prototype.addTrack=function(a){for(var o=arguments.length,l=new Array(o>1?o-1:0),u=1;u<o;u++)l[u-1]=arguments[u];return l&&l.forEach(d=>{this._localStreams?this._localStreams.includes(d)||this._localStreams.push(d):this._localStreams=[d]}),t.apply(this,arguments)}}"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const a=this._localStreams.indexOf(i);if(a===-1)return;this._localStreams.splice(a,1);const o=i.getTracks();this.getSenders().forEach(l=>{o.includes(l.track)&&this.removeTrack(l)})})}}function hm(r){if(!(typeof r!="object"||!r.RTCPeerConnection)&&("getRemoteStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in r.RTCPeerConnection.prototype))){Object.defineProperty(r.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(o=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(o))return;this._remoteStreams.push(o);const l=new Event("addstream");l.stream=o,this.dispatchEvent(l)})})}});const t=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){const a=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(l=>{if(a._remoteStreams||(a._remoteStreams=[]),a._remoteStreams.indexOf(l)>=0)return;a._remoteStreams.push(l);const u=new Event("addstream");u.stream=l,a.dispatchEvent(u)})}),t.apply(a,arguments)}}}function mm(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const t=r.RTCPeerConnection.prototype,i=t.createOffer,a=t.createAnswer,o=t.setLocalDescription,l=t.setRemoteDescription,u=t.addIceCandidate;t.createOffer=function(m,g){const y=arguments.length>=2?arguments[2]:arguments[0],S=i.apply(this,[y]);return g?(S.then(m,g),Promise.resolve()):S},t.createAnswer=function(m,g){const y=arguments.length>=2?arguments[2]:arguments[0],S=a.apply(this,[y]);return g?(S.then(m,g),Promise.resolve()):S};let d=function(p,m,g){const y=o.apply(this,[p]);return g?(y.then(m,g),Promise.resolve()):y};t.setLocalDescription=d,d=function(p,m,g){const y=l.apply(this,[p]);return g?(y.then(m,g),Promise.resolve()):y},t.setRemoteDescription=d,d=function(p,m,g){const y=u.apply(this,[p]);return g?(y.then(m,g),Promise.resolve()):y},t.addIceCandidate=d}function pm(r){const t=r&&r.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const i=t.mediaDevices,a=i.getUserMedia.bind(i);t.mediaDevices.getUserMedia=o=>a(gm(o))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(a,o,l){t.mediaDevices.getUserMedia(a).then(o,l)}).bind(t))}function gm(r){return r&&r.video!==void 0?Object.assign({},r,{video:Fh(r.video)}):r}function vm(r){if(!r.RTCPeerConnection)return;const t=r.RTCPeerConnection;r.RTCPeerConnection=function(a,o){if(a&&a.iceServers){const l=[];for(let u=0;u<a.iceServers.length;u++){let d=a.iceServers[u];d.urls===void 0&&d.url?(il("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,l.push(d)):l.push(a.iceServers[u])}a.iceServers=l}return new t(a,o)},r.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function ym(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function bm(r){const t=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(a){if(a){typeof a.offerToReceiveAudio<"u"&&(a.offerToReceiveAudio=!!a.offerToReceiveAudio);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");a.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):a.offerToReceiveAudio===!0&&!o&&this.addTransceiver("audio",{direction:"recvonly"}),typeof a.offerToReceiveVideo<"u"&&(a.offerToReceiveVideo=!!a.offerToReceiveVideo);const l=this.getTransceivers().find(u=>u.receiver.track.kind==="video");a.offerToReceiveVideo===!1&&l?l.direction==="sendrecv"?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":l.direction==="recvonly"&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):a.offerToReceiveVideo===!0&&!l&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Sm(r){typeof r!="object"||r.AudioContext||(r.AudioContext=r.webkitAudioContext)}var Tm=Object.freeze({__proto__:null,shimAudioContext:Sm,shimCallbacksAPI:mm,shimConstraints:gm,shimCreateOfferLegacy:bm,shimGetUserMedia:pm,shimLocalStreamsAPI:fm,shimRTCIceServerUrls:vm,shimRemoteStreamsAPI:hm,shimTrackEventTransceiver:ym}),ol={exports:{}},Cm;function MS(){return Cm||(Cm=1,(function(r){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(i){return i.trim().split(`
`).map(a=>a.trim())},t.splitSections=function(i){return i.split(`
m=`).map((o,l)=>(l>0?"m="+o:o).trim()+`\r
`)},t.getDescription=function(i){const a=t.splitSections(i);return a&&a[0]},t.getMediaSections=function(i){const a=t.splitSections(i);return a.shift(),a},t.matchPrefix=function(i,a){return t.splitLines(i).filter(o=>o.indexOf(a)===0)},t.parseCandidate=function(i){let a;i.indexOf("a=candidate:")===0?a=i.substring(12).split(" "):a=i.substring(10).split(" ");const o={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let l=8;l<a.length;l+=2)switch(a[l]){case"raddr":o.relatedAddress=a[l+1];break;case"rport":o.relatedPort=parseInt(a[l+1],10);break;case"tcptype":o.tcpType=a[l+1];break;case"ufrag":o.ufrag=a[l+1],o.usernameFragment=a[l+1];break;default:o[a[l]]===void 0&&(o[a[l]]=a[l+1]);break}return o},t.writeCandidate=function(i){const a=[];a.push(i.foundation);const o=i.component;o==="rtp"?a.push(1):o==="rtcp"?a.push(2):a.push(o),a.push(i.protocol.toUpperCase()),a.push(i.priority),a.push(i.address||i.ip),a.push(i.port);const l=i.type;return a.push("typ"),a.push(l),l!=="host"&&i.relatedAddress&&i.relatedPort&&(a.push("raddr"),a.push(i.relatedAddress),a.push("rport"),a.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(a.push("tcptype"),a.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(a.push("ufrag"),a.push(i.usernameFragment||i.ufrag)),"candidate:"+a.join(" ")},t.parseIceOptions=function(i){return i.substring(14).split(" ")},t.parseRtpMap=function(i){let a=i.substring(9).split(" ");const o={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),o.name=a[0],o.clockRate=parseInt(a[1],10),o.channels=a.length===3?parseInt(a[2],10):1,o.numChannels=o.channels,o},t.writeRtpMap=function(i){let a=i.payloadType;i.preferredPayloadType!==void 0&&(a=i.preferredPayloadType);const o=i.channels||i.numChannels||1;return"a=rtpmap:"+a+" "+i.name+"/"+i.clockRate+(o!==1?"/"+o:"")+`\r
`},t.parseExtmap=function(i){const a=i.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},t.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},t.parseFmtp=function(i){const a={};let o;const l=i.substring(i.indexOf(" ")+1).split(";");for(let u=0;u<l.length;u++)o=l[u].trim().split("="),a[o[0].trim()]=o[1];return a},t.writeFmtp=function(i){let a="",o=i.payloadType;if(i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const l=[];Object.keys(i.parameters).forEach(u=>{i.parameters[u]!==void 0?l.push(u+"="+i.parameters[u]):l.push(u)}),a+="a=fmtp:"+o+" "+l.join(";")+`\r
`}return a},t.parseRtcpFb=function(i){const a=i.substring(i.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},t.writeRtcpFb=function(i){let a="",o=i.payloadType;return i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(l=>{a+="a=rtcp-fb:"+o+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+`\r
`}),a},t.parseSsrcMedia=function(i){const a=i.indexOf(" "),o={ssrc:parseInt(i.substring(7,a),10)},l=i.indexOf(":",a);return l>-1?(o.attribute=i.substring(a+1,l),o.value=i.substring(l+1)):o.attribute=i.substring(a+1),o},t.parseSsrcGroup=function(i){const a=i.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(o=>parseInt(o,10))}},t.getMid=function(i){const a=t.matchPrefix(i,"a=mid:")[0];if(a)return a.substring(6)},t.parseFingerprint=function(i){const a=i.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},t.getDtlsParameters=function(i,a){return{role:"auto",fingerprints:t.matchPrefix(i+a,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(i,a){let o="a=setup:"+a+`\r
`;return i.fingerprints.forEach(l=>{o+="a=fingerprint:"+l.algorithm+" "+l.value+`\r
`}),o},t.parseCryptoLine=function(i){const a=i.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},t.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?t.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const a=i.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},t.getCryptoParameters=function(i,a){return t.matchPrefix(i+a,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(i,a){const o=t.matchPrefix(i+a,"a=ice-ufrag:")[0],l=t.matchPrefix(i+a,"a=ice-pwd:")[0];return o&&l?{usernameFragment:o.substring(12),password:l.substring(10)}:null},t.writeIceParameters=function(i){let a="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(a+=`a=ice-lite\r
`),a},t.parseRtpParameters=function(i){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},l=t.splitLines(i)[0].split(" ");a.profile=l[2];for(let d=3;d<l.length;d++){const p=l[d],m=t.matchPrefix(i,"a=rtpmap:"+p+" ")[0];if(m){const g=t.parseRtpMap(m),y=t.matchPrefix(i,"a=fmtp:"+p+" ");switch(g.parameters=y.length?t.parseFmtp(y[0]):{},g.rtcpFeedback=t.matchPrefix(i,"a=rtcp-fb:"+p+" ").map(t.parseRtcpFb),a.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(g.name.toUpperCase());break}}}t.matchPrefix(i,"a=extmap:").forEach(d=>{a.headerExtensions.push(t.parseExtmap(d))});const u=t.matchPrefix(i,"a=rtcp-fb:* ").map(t.parseRtcpFb);return a.codecs.forEach(d=>{u.forEach(p=>{d.rtcpFeedback.find(g=>g.type===p.type&&g.parameter===p.parameter)||d.rtcpFeedback.push(p)})}),a},t.writeRtpDescription=function(i,a){let o="";o+="m="+i+" ",o+=a.codecs.length>0?"9":"0",o+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",o+=a.codecs.map(u=>u.preferredPayloadType!==void 0?u.preferredPayloadType:u.payloadType).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,a.codecs.forEach(u=>{o+=t.writeRtpMap(u),o+=t.writeFmtp(u),o+=t.writeRtcpFb(u)});let l=0;return a.codecs.forEach(u=>{u.maxptime>l&&(l=u.maxptime)}),l>0&&(o+="a=maxptime:"+l+`\r
`),a.headerExtensions&&a.headerExtensions.forEach(u=>{o+=t.writeExtmap(u)}),o},t.parseRtpEncodingParameters=function(i){const a=[],o=t.parseRtpParameters(i),l=o.fecMechanisms.indexOf("RED")!==-1,u=o.fecMechanisms.indexOf("ULPFEC")!==-1,d=t.matchPrefix(i,"a=ssrc:").map(S=>t.parseSsrcMedia(S)).filter(S=>S.attribute==="cname"),p=d.length>0&&d[0].ssrc;let m;const g=t.matchPrefix(i,"a=ssrc-group:FID").map(S=>S.substring(17).split(" ").map(O=>parseInt(O,10)));g.length>0&&g[0].length>1&&g[0][0]===p&&(m=g[0][1]),o.codecs.forEach(S=>{if(S.name.toUpperCase()==="RTX"&&S.parameters.apt){let C={ssrc:p,codecPayloadType:parseInt(S.parameters.apt,10)};p&&m&&(C.rtx={ssrc:m}),a.push(C),l&&(C=JSON.parse(JSON.stringify(C)),C.fec={ssrc:p,mechanism:u?"red+ulpfec":"red"},a.push(C))}}),a.length===0&&p&&a.push({ssrc:p});let y=t.matchPrefix(i,"b=");return y.length&&(y[0].indexOf("b=TIAS:")===0?y=parseInt(y[0].substring(7),10):y[0].indexOf("b=AS:")===0?y=parseInt(y[0].substring(5),10)*1e3*.95-2e3*8:y=void 0,a.forEach(S=>{S.maxBitrate=y})),a},t.parseRtcpParameters=function(i){const a={},o=t.matchPrefix(i,"a=ssrc:").map(d=>t.parseSsrcMedia(d)).filter(d=>d.attribute==="cname")[0];o&&(a.cname=o.value,a.ssrc=o.ssrc);const l=t.matchPrefix(i,"a=rtcp-rsize");a.reducedSize=l.length>0,a.compound=l.length===0;const u=t.matchPrefix(i,"a=rtcp-mux");return a.mux=u.length>0,a},t.writeRtcpParameters=function(i){let a="";return i.reducedSize&&(a+=`a=rtcp-rsize\r
`),i.mux&&(a+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(a+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),a},t.parseMsid=function(i){let a;const o=t.matchPrefix(i,"a=msid:");if(o.length===1)return a=o[0].substring(7).split(" "),{stream:a[0],track:a[1]};const l=t.matchPrefix(i,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="msid");if(l.length>0)return a=l[0].value.split(" "),{stream:a[0],track:a[1]}},t.parseSctpDescription=function(i){const a=t.parseMLine(i),o=t.matchPrefix(i,"a=max-message-size:");let l;o.length>0&&(l=parseInt(o[0].substring(19),10)),isNaN(l)&&(l=65536);const u=t.matchPrefix(i,"a=sctp-port:");if(u.length>0)return{port:parseInt(u[0].substring(12),10),protocol:a.fmt,maxMessageSize:l};const d=t.matchPrefix(i,"a=sctpmap:");if(d.length>0){const p=d[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:l}}},t.writeSctpDescription=function(i,a){let o=[];return i.protocol!=="DTLS/SCTP"?o=["m="+i.kind+" 9 "+i.protocol+" "+a.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+a.port+`\r
`]:o=["m="+i.kind+" 9 "+i.protocol+" "+a.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+a.port+" "+a.protocol+` 65535\r
`],a.maxMessageSize!==void 0&&o.push("a=max-message-size:"+a.maxMessageSize+`\r
`),o.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(i,a,o){let l;const u=a!==void 0?a:2;return i?l=i:l=t.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+l+" "+u+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(i,a){const o=t.splitLines(i);for(let l=0;l<o.length;l++)switch(o[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[l].substring(2)}return a?t.getDirection(a):"sendrecv"},t.getKind=function(i){return t.splitLines(i)[0].split(" ")[0].substring(2)},t.isRejected=function(i){return i.split(" ",2)[1]==="0"},t.parseMLine=function(i){const o=t.splitLines(i)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},t.parseOLine=function(i){const o=t.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},t.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const a=t.splitLines(i);for(let o=0;o<a.length;o++)if(a[o].length<2||a[o].charAt(1)!=="=")return!1;return!0},r.exports=t})(ol)),ol.exports}var km=MS(),Sa=yS(km),wS=zy({__proto__:null,default:Sa},[km]);function Jr(r){if(!r.RTCIceCandidate||r.RTCIceCandidate&&"foundation"in r.RTCIceCandidate.prototype)return;const t=r.RTCIceCandidate;r.RTCIceCandidate=function(a){if(typeof a=="object"&&a.candidate&&a.candidate.indexOf("a=")===0&&(a=JSON.parse(JSON.stringify(a)),a.candidate=a.candidate.substring(2)),a.candidate&&a.candidate.length){const o=new t(a),l=Sa.parseCandidate(a.candidate);for(const u in l)u in o||Object.defineProperty(o,u,{value:l[u]});return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(a)},r.RTCIceCandidate.prototype=t.prototype,Gi(r,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new r.RTCIceCandidate(i.candidate),writable:"false"}),i))}function cl(r){!r.RTCIceCandidate||r.RTCIceCandidate&&"relayProtocol"in r.RTCIceCandidate.prototype||Gi(r,"icecandidate",t=>{if(t.candidate){const i=Sa.parseCandidate(t.candidate.candidate);i.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return t})}function Xr(r,t){if(!r.RTCPeerConnection)return;"sctp"in r.RTCPeerConnection.prototype||Object.defineProperty(r.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const i=function(d){if(!d||!d.sdp)return!1;const p=Sa.splitSections(d.sdp);return p.shift(),p.some(m=>{const g=Sa.parseMLine(m);return g&&g.kind==="application"&&g.protocol.indexOf("SCTP")!==-1})},a=function(d){const p=d.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(p===null||p.length<2)return-1;const m=parseInt(p[1],10);return m!==m?-1:m},o=function(d){let p=65536;return t.browser==="firefox"&&(t.version<57?d===-1?p=16384:p=2147483637:t.version<60?p=t.version===57?65535:65536:p=2147483637),p},l=function(d,p){let m=65536;t.browser==="firefox"&&t.version===57&&(m=65535);const g=Sa.matchPrefix(d.sdp,"a=max-message-size:");return g.length>0?m=parseInt(g[0].substring(19),10):t.browser==="firefox"&&p!==-1&&(m=2147483637),m},u=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const p=a(arguments[0]),m=o(p),g=l(arguments[0],p);let y;m===0&&g===0?y=Number.POSITIVE_INFINITY:m===0||g===0?y=Math.max(m,g):y=Math.min(m,g);const S={};Object.defineProperty(S,"maxMessageSize",{get(){return y}}),this._sctp=S}return u.apply(this,arguments)}}function Zr(r){if(!(r.RTCPeerConnection&&"createDataChannel"in r.RTCPeerConnection.prototype))return;function t(a,o){const l=a.send;a.send=function(){const d=arguments[0],p=d.length||d.size||d.byteLength;if(a.readyState==="open"&&o.sctp&&p>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return l.apply(a,arguments)}}const i=r.RTCPeerConnection.prototype.createDataChannel;r.RTCPeerConnection.prototype.createDataChannel=function(){const o=i.apply(this,arguments);return t(o,this),o},Gi(r,"datachannel",a=>(t(a.channel,a.target),a))}function ll(r){if(!r.RTCPeerConnection||"connectionState"in r.RTCPeerConnection.prototype)return;const t=r.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const a=t[i];t[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const l=o.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;const u=new Event("connectionstatechange",o);l.dispatchEvent(u)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function ul(r,t){if(!r.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t._safariVersion>=13.1)return;const i=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const l=o.sdp.split(`
`).filter(u=>u.trim()!=="a=extmap-allow-mixed").join(`
`);r.RTCSessionDescription&&o instanceof r.RTCSessionDescription?arguments[0]=new r.RTCSessionDescription({type:o.type,sdp:l}):o.sdp=l}return i.apply(this,arguments)}}function Wr(r,t){if(!(r.RTCPeerConnection&&r.RTCPeerConnection.prototype))return;const i=r.RTCPeerConnection.prototype.addIceCandidate;!i||i.length===0||(r.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function $r(r,t){if(!(r.RTCPeerConnection&&r.RTCPeerConnection.prototype))return;const i=r.RTCPeerConnection.prototype.setLocalDescription;!i||i.length===0||(r.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return i.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer";break}return o.sdp||o.type!=="offer"&&o.type!=="answer"?i.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(u=>i.apply(this,[u]))})}var NS=Object.freeze({__proto__:null,removeExtmapAllowMixed:ul,shimAddIceCandidateNullOrEmpty:Wr,shimConnectionState:ll,shimMaxMessageSize:Xr,shimParameterlessSetLocalDescription:$r,shimRTCIceCandidate:Jr,shimRTCIceCandidateRelayProtocol:cl,shimSendThrowTypeError:Zr});function xS(){let{window:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=qh,a=AS(r),o={browserDetails:a,commonShim:NS,extractVersion:Es,disableLog:RS,disableWarnings:OS,sdp:wS};switch(a.browser){case"chrome":if(!em||!sl||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),o;if(a.version===null)return i("Chrome shim can not determine version, not shimming."),o;i("adapter.js shimming chrome."),o.browserShim=em,Wr(r,a),$r(r),Kh(r,a),Yh(r),sl(r,a),Qh(r),Wh(r,a),Jh(r),Xh(r),$h(r,a),Jr(r),cl(r),ll(r),Xr(r,a),Zr(r),ul(r,a);break;case"firefox":if(!dm||!rl||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),o;i("adapter.js shimming firefox."),o.browserShim=dm,Wr(r,a),$r(r),tm(r,a),rl(r,a),nm(r),sm(r),im(r),am(r),rm(r),om(r),cm(r),lm(r),um(r),Jr(r),ll(r),Xr(r,a),Zr(r);break;case"safari":if(!Tm||!t.shimSafari)return i("Safari shim is not included in this adapter release."),o;i("adapter.js shimming safari."),o.browserShim=Tm,Wr(r,a),$r(r),vm(r),bm(r),mm(r),fm(r),hm(r),ym(r),pm(r),Sm(r),Jr(r),cl(r),Xr(r,a),Zr(r),ul(r,a);break;default:i("Unsupported browser!");break}return o}xS({window:typeof window>"u"?void 0:window});const PS=10,_s="lk_e2ee",US={sharedKey:!1,ratchetSalt:"LKFrameEncryptionKey",ratchetWindowSize:8,failureTolerance:PS,keyringSize:16};var ui;(function(r){r.SetKey="setKey",r.RatchetRequest="ratchetRequest",r.KeyRatcheted="keyRatcheted"})(ui||(ui={}));var Em;(function(r){r.KeyRatcheted="keyRatcheted"})(Em||(Em={}));var di;(function(r){r.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",r.EncryptionError="encryptionError"})(di||(di={}));var _m;(function(r){r.Error="cryptorError"})(_m||(_m={}));function LS(){return IS()||dl()}function dl(){return typeof window.RTCRtpScriptTransform<"u"}function IS(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function BS(r){var t,i,a,o,l;if(((t=r.value)===null||t===void 0?void 0:t.case)!=="sipDtmf"&&((i=r.value)===null||i===void 0?void 0:i.case)!=="metrics"&&((a=r.value)===null||a===void 0?void 0:a.case)!=="speaker"&&((o=r.value)===null||o===void 0?void 0:o.case)!=="transcription"&&((l=r.value)===null||l===void 0?void 0:l.case)!=="encryptedPacket")return new dh({value:r.value})}class N_ extends Rn.EventEmitter{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(i,a,o)=>{ge.debug("key ratcheted event received",{ratchetResult:i,participantId:a,keyIndex:o})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},US),t),this.on(ui.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(t,i,a){const o={key:t,participantIdentity:i,keyIndex:a};if(!this.options.sharedKey&&!i)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(i??"shared","-").concat(a??0),o),this.emit(ui.SetKey,o)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(t,i){this.emit(ui.RatchetRequest,t,i)}}class Bn extends Error{constructor(t,i){super(i||"an error has occured"),this.name="LiveKitError",this.code=t}}var me;(function(r){r[r.NotAllowed=0]="NotAllowed",r[r.ServerUnreachable=1]="ServerUnreachable",r[r.InternalError=2]="InternalError",r[r.Cancelled=3]="Cancelled",r[r.LeaveRequest=4]="LeaveRequest",r[r.Timeout=5]="Timeout"})(me||(me={}));class Ee extends Bn{constructor(t,i,a,o){super(1,t),this.name="ConnectionError",this.status=a,this.reason=i,this.context=o,this.reasonName=me[i]}}class fl extends Bn{constructor(t){super(21,t??"device is unsupported"),this.name="DeviceUnsupportedError"}}class jn extends Bn{constructor(t){super(20,t??"track is invalid"),this.name="TrackInvalidError"}}class jS extends Bn{constructor(t){super(10,t??"unsupported server"),this.name="UnsupportedServer"}}class ut extends Bn{constructor(t){super(12,t??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class hl extends Bn{constructor(t){super(13,t??"unable to negotiate"),this.name="NegotiationError"}}class Rm extends Bn{constructor(t,i){super(15,t),this.name="PublishTrackError",this.status=i}}class Om extends Bn{constructor(t,i){super(15,t),this.reason=i,this.reasonName=typeof i=="string"?i:tl[i]}}var At;(function(r){r[r.AlreadyOpened=0]="AlreadyOpened",r[r.AbnormalEnd=1]="AbnormalEnd",r[r.DecodeFailed=2]="DecodeFailed",r[r.LengthExceeded=3]="LengthExceeded",r[r.Incomplete=4]="Incomplete",r[r.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",r[r.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(At||(At={}));class $t extends Bn{constructor(t,i){super(16,t),this.name="DataStreamError",this.reason=i,this.reasonName=At[i]}}var eo;(function(r){r.PermissionDenied="PermissionDenied",r.NotFound="NotFound",r.DeviceInUse="DeviceInUse",r.Other="Other"})(eo||(eo={})),(function(r){function t(i){if(i&&"name"in i)return i.name==="NotFoundError"||i.name==="DevicesNotFoundError"?r.NotFound:i.name==="NotAllowedError"||i.name==="PermissionDeniedError"?r.PermissionDenied:i.name==="NotReadableError"||i.name==="TrackStartError"?r.DeviceInUse:r.Other}r.getFailure=t})(eo||(eo={}));var Am;(function(r){r[r.InvalidKey=0]="InvalidKey",r[r.MissingKey=1]="MissingKey",r[r.InternalError=2]="InternalError"})(Am||(Am={}));var Q;(function(r){r.Connected="connected",r.Reconnecting="reconnecting",r.SignalReconnecting="signalReconnecting",r.Reconnected="reconnected",r.Disconnected="disconnected",r.ConnectionStateChanged="connectionStateChanged",r.Moved="moved",r.MediaDevicesChanged="mediaDevicesChanged",r.ParticipantConnected="participantConnected",r.ParticipantDisconnected="participantDisconnected",r.TrackPublished="trackPublished",r.TrackSubscribed="trackSubscribed",r.TrackSubscriptionFailed="trackSubscriptionFailed",r.TrackUnpublished="trackUnpublished",r.TrackUnsubscribed="trackUnsubscribed",r.TrackMuted="trackMuted",r.TrackUnmuted="trackUnmuted",r.LocalTrackPublished="localTrackPublished",r.LocalTrackUnpublished="localTrackUnpublished",r.LocalAudioSilenceDetected="localAudioSilenceDetected",r.ActiveSpeakersChanged="activeSpeakersChanged",r.ParticipantMetadataChanged="participantMetadataChanged",r.ParticipantNameChanged="participantNameChanged",r.ParticipantAttributesChanged="participantAttributesChanged",r.ParticipantActive="participantActive",r.RoomMetadataChanged="roomMetadataChanged",r.DataReceived="dataReceived",r.SipDTMFReceived="sipDTMFReceived",r.TranscriptionReceived="transcriptionReceived",r.ConnectionQualityChanged="connectionQualityChanged",r.TrackStreamStateChanged="trackStreamStateChanged",r.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",r.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",r.AudioPlaybackStatusChanged="audioPlaybackChanged",r.VideoPlaybackStatusChanged="videoPlaybackChanged",r.MediaDevicesError="mediaDevicesError",r.ParticipantPermissionsChanged="participantPermissionsChanged",r.SignalConnected="signalConnected",r.RecordingStatusChanged="recordingStatusChanged",r.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",r.EncryptionError="encryptionError",r.DCBufferStatusChanged="dcBufferStatusChanged",r.ActiveDeviceChanged="activeDeviceChanged",r.ChatMessage="chatMessage",r.LocalTrackSubscribed="localTrackSubscribed",r.MetricsReceived="metricsReceived"})(Q||(Q={}));var W;(function(r){r.TrackPublished="trackPublished",r.TrackSubscribed="trackSubscribed",r.TrackSubscriptionFailed="trackSubscriptionFailed",r.TrackUnpublished="trackUnpublished",r.TrackUnsubscribed="trackUnsubscribed",r.TrackMuted="trackMuted",r.TrackUnmuted="trackUnmuted",r.LocalTrackPublished="localTrackPublished",r.LocalTrackUnpublished="localTrackUnpublished",r.LocalTrackCpuConstrained="localTrackCpuConstrained",r.LocalSenderCreated="localSenderCreated",r.ParticipantMetadataChanged="participantMetadataChanged",r.ParticipantNameChanged="participantNameChanged",r.DataReceived="dataReceived",r.SipDTMFReceived="sipDTMFReceived",r.TranscriptionReceived="transcriptionReceived",r.IsSpeakingChanged="isSpeakingChanged",r.ConnectionQualityChanged="connectionQualityChanged",r.TrackStreamStateChanged="trackStreamStateChanged",r.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",r.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",r.TrackCpuConstrained="trackCpuConstrained",r.MediaDevicesError="mediaDevicesError",r.AudioStreamAcquired="audioStreamAcquired",r.ParticipantPermissionsChanged="participantPermissionsChanged",r.PCTrackAdded="pcTrackAdded",r.AttributesChanged="attributesChanged",r.LocalTrackSubscribed="localTrackSubscribed",r.ChatMessage="chatMessage",r.Active="active"})(W||(W={}));var Z;(function(r){r.TransportsCreated="transportsCreated",r.Connected="connected",r.Disconnected="disconnected",r.Resuming="resuming",r.Resumed="resumed",r.Restarting="restarting",r.Restarted="restarted",r.SignalResumed="signalResumed",r.SignalRestarted="signalRestarted",r.Closing="closing",r.MediaTrackAdded="mediaTrackAdded",r.ActiveSpeakersUpdate="activeSpeakersUpdate",r.DataPacketReceived="dataPacketReceived",r.RTPVideoMapUpdate="rtpVideoMapUpdate",r.DCBufferStatusChanged="dcBufferStatusChanged",r.ParticipantUpdate="participantUpdate",r.RoomUpdate="roomUpdate",r.SpeakersChanged="speakersChanged",r.StreamStateChanged="streamStateChanged",r.ConnectionQualityUpdate="connectionQualityUpdate",r.SubscriptionError="subscriptionError",r.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",r.RemoteMute="remoteMute",r.SubscribedQualityUpdate="subscribedQualityUpdate",r.LocalTrackUnpublished="localTrackUnpublished",r.LocalTrackSubscribed="localTrackSubscribed",r.Offline="offline",r.SignalRequestResponse="signalRequestResponse",r.SignalConnected="signalConnected",r.RoomMoved="roomMoved"})(Z||(Z={}));var J;(function(r){r.Message="message",r.Muted="muted",r.Unmuted="unmuted",r.Restarted="restarted",r.Ended="ended",r.Subscribed="subscribed",r.Unsubscribed="unsubscribed",r.CpuConstrained="cpuConstrained",r.UpdateSettings="updateSettings",r.UpdateSubscription="updateSubscription",r.AudioPlaybackStarted="audioPlaybackStarted",r.AudioPlaybackFailed="audioPlaybackFailed",r.AudioSilenceDetected="audioSilenceDetected",r.VisibilityChanged="visibilityChanged",r.VideoDimensionsChanged="videoDimensionsChanged",r.VideoPlaybackStarted="videoPlaybackStarted",r.VideoPlaybackFailed="videoPlaybackFailed",r.ElementAttached="elementAttached",r.ElementDetached="elementDetached",r.UpstreamPaused="upstreamPaused",r.UpstreamResumed="upstreamResumed",r.SubscriptionPermissionChanged="subscriptionPermissionChanged",r.SubscriptionStatusChanged="subscriptionStatusChanged",r.SubscriptionFailed="subscriptionFailed",r.TrackProcessorUpdate="trackProcessorUpdate",r.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",r.TranscriptionReceived="transcriptionReceived",r.TimeSyncUpdate="timeSyncUpdate",r.PreConnectBufferFlushed="preConnectBufferFlushed"})(J||(J={}));function zS(r){return typeof r>"u"?r:typeof structuredClone=="function"?typeof r=="object"&&r!==null?structuredClone(Object.assign({},r)):structuredClone(r):JSON.parse(JSON.stringify(r))}const qS=/version\/(\d+(\.?_?\d+)+)/i;let ml;function xt(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const i=navigator.userAgent.toLowerCase();if(ml===void 0||t){const a=VS.find(o=>{let{test:l}=o;return l.test(i)});ml=a?.describe(i)}return ml}const VS=[{test:/firefox|iceweasel|fxios/i,describe(r){return{name:"Firefox",version:to(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,r),os:r.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:pl(r)}}},{test:/chrom|crios|crmo/i,describe(r){return{name:"Chrome",version:to(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,r),os:r.toLowerCase().includes("crios")?"iOS":void 0,osVersion:pl(r)}}},{test:/safari|applewebkit/i,describe(r){return{name:"Safari",version:to(qS,r),os:r.includes("mobile/")?"iOS":"macOS",osVersion:pl(r)}}}];function to(r,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const a=t.match(r);return a&&a.length>=i&&a[i]||""}function pl(r){return r.includes("mac os")?to(/\(.+?(\d+_\d+(:?_\d+)?)/,r,1).replace(/_/g,"."):void 0}var FS="2.16.0";const HS=FS,GS=16;class vt{}vt.setTimeout=function(){return setTimeout(...arguments)},vt.setInterval=function(){return setInterval(...arguments)},vt.clearTimeout=function(){return clearTimeout(...arguments)},vt.clearInterval=function(){return clearInterval(...arguments)};const KS=5e3,Rs=[];var Vt;(function(r){r[r.LOW=0]="LOW",r[r.MEDIUM=1]="MEDIUM",r[r.HIGH=2]="HIGH"})(Vt||(Vt={}));class H extends Rn.EventEmitter{get streamState(){return this._streamState}setStreamState(t){this._streamState=t}constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var o;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=H.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=ge,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),KS):this.handleAppVisibilityChanged()},this.log=Ln((o=a.loggerName)!==null&&o!==void 0?o:gn.Track),this.loggerContextCb=a.loggerContextCb,this.setMaxListeners(100),this.kind=i,this._mediaStreamTrack=t,this._mediaStreamID=t.id,this.source=H.Source.Unknown}get logContext(){var t;return Object.assign(Object.assign({},(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this)),Se(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(t){let i="audio";this.kind===H.Kind.Video&&(i="video"),this.attachedElements.length===0&&this.kind===H.Kind.Video&&this.addAppVisibilityListener(),t||(i==="audio"&&(Rs.forEach(l=>{l.parentElement===null&&!t&&(t=l)}),t&&Rs.splice(Rs.indexOf(t),1)),t||(t=document.createElement(i))),this.attachedElements.includes(t)||this.attachedElements.push(t),Ta(this.mediaStreamTrack,t);const a=t.srcObject.getTracks(),o=a.some(l=>l.kind==="audio");return t.play().then(()=>{this.emit(o?J.AudioPlaybackStarted:J.VideoPlaybackStarted)}).catch(l=>{l.name==="NotAllowedError"?this.emit(o?J.AudioPlaybackFailed:J.VideoPlaybackFailed,l):l.name==="AbortError"?ge.debug("".concat(o?"audio":"video"," playback aborted, likely due to new play request")):ge.warn("could not playback ".concat(o?"audio":"video"),l),o&&t&&a.some(u=>u.kind==="video")&&l.name==="NotAllowedError"&&(t.muted=!0,t.play().catch(()=>{}))}),this.emit(J.ElementAttached,t),t}detach(t){try{if(t){Ca(this.mediaStreamTrack,t);const a=this.attachedElements.indexOf(t);return a>=0&&(this.attachedElements.splice(a,1),this.recycleElement(t),this.emit(J.ElementDetached,t)),t}const i=[];return this.attachedElements.forEach(a=>{Ca(this.mediaStreamTrack,a),i.push(a),this.recycleElement(a),this.emit(J.ElementDetached,a)}),this.attachedElements=[],i}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(t){t.loggerName&&(this.log=Ln(t.loggerName)),t.loggerContextCb&&(this.loggerContextCb=t.loggerContextCb)}recycleElement(t){if(t instanceof HTMLAudioElement){let i=!0;t.pause(),Rs.forEach(a=>{a.parentElement||(i=!1)}),i&&Rs.push(t)}}handleAppVisibilityChanged(){return T(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===H.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(t=>t.play().catch(()=>{})),0)})}addAppVisibilityListener(){Pt()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Pt()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Ta(r,t){let i;t.srcObject instanceof MediaStream?i=t.srcObject:i=new MediaStream;let a;r.kind==="audio"?a=i.getAudioTracks():a=i.getVideoTracks(),a.includes(r)||(a.forEach(o=>{i.removeTrack(o)}),i.addTrack(r)),(!Yi()||!(t instanceof HTMLVideoElement))&&(t.autoplay=!0),t.muted=i.getAudioTracks().length===0,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==i&&(t.srcObject=i,(Yi()||Ki())&&t instanceof HTMLVideoElement&&setTimeout(()=>{t.srcObject=i,t.play().catch(()=>{})},0))}function Ca(r,t){if(t.srcObject instanceof MediaStream){const i=t.srcObject;i.removeTrack(r),i.getTracks().length>0?t.srcObject=i:t.srcObject=null}}(function(r){let t;(function(m){m.Audio="audio",m.Video="video",m.Unknown="unknown"})(t=r.Kind||(r.Kind={}));let i;(function(m){m.Camera="camera",m.Microphone="microphone",m.ScreenShare="screen_share",m.ScreenShareAudio="screen_share_audio",m.Unknown="unknown"})(i=r.Source||(r.Source={}));let a;(function(m){m.Active="active",m.Paused="paused",m.Unknown="unknown"})(a=r.StreamState||(r.StreamState={}));function o(m){switch(m){case t.Audio:return hn.AUDIO;case t.Video:return hn.VIDEO;default:return hn.DATA}}r.kindToProto=o;function l(m){switch(m){case hn.AUDIO:return t.Audio;case hn.VIDEO:return t.Video;default:return t.Unknown}}r.kindFromProto=l;function u(m){switch(m){case i.Camera:return at.CAMERA;case i.Microphone:return at.MICROPHONE;case i.ScreenShare:return at.SCREEN_SHARE;case i.ScreenShareAudio:return at.SCREEN_SHARE_AUDIO;default:return at.UNKNOWN}}r.sourceToProto=u;function d(m){switch(m){case at.CAMERA:return i.Camera;case at.MICROPHONE:return i.Microphone;case at.SCREEN_SHARE:return i.ScreenShare;case at.SCREEN_SHARE_AUDIO:return i.ScreenShareAudio;default:return i.Unknown}}r.sourceFromProto=d;function p(m){switch(m){case Qc.ACTIVE:return a.Active;case Qc.PAUSED:return a.Paused;default:return a.Unknown}}r.streamStateFromProto=p})(H||(H={}));class Be{constructor(t,i,a,o,l){if(typeof t=="object")this.width=t.width,this.height=t.height,this.aspectRatio=t.aspectRatio,this.encoding={maxBitrate:t.maxBitrate,maxFramerate:t.maxFramerate,priority:t.priority};else if(i!==void 0&&a!==void 0)this.width=t,this.height=i,this.aspectRatio=t/i,this.encoding={maxBitrate:a,maxFramerate:o,priority:l};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const YS=["vp8","h264"],QS=["vp8","h264","vp9","av1","h265"];function JS(r){return!!YS.find(t=>t===r)}const XS=JS;var Dm;(function(r){r[r.PREFER_REGRESSION=0]="PREFER_REGRESSION",r[r.SIMULCAST=1]="SIMULCAST",r[r.REGRESSION=2]="REGRESSION"})(Dm||(Dm={}));var gl;(function(r){r.telephone={maxBitrate:12e3},r.speech={maxBitrate:24e3},r.music={maxBitrate:48e3},r.musicStereo={maxBitrate:64e3},r.musicHighQuality={maxBitrate:96e3},r.musicHighQualityStereo={maxBitrate:128e3}})(gl||(gl={}));const Os={h90:new Be(160,90,9e4,20),h180:new Be(320,180,16e4,20),h216:new Be(384,216,18e4,20),h360:new Be(640,360,45e4,20),h540:new Be(960,540,8e5,25),h720:new Be(1280,720,17e5,30),h1080:new Be(1920,1080,3e6,30),h1440:new Be(2560,1440,5e6,30),h2160:new Be(3840,2160,8e6,30)},vl={h120:new Be(160,120,7e4,20),h180:new Be(240,180,125e3,20),h240:new Be(320,240,14e4,20),h360:new Be(480,360,33e4,20),h480:new Be(640,480,5e5,20),h540:new Be(720,540,6e5,25),h720:new Be(960,720,13e5,30),h1080:new Be(1440,1080,23e5,30),h1440:new Be(1920,1440,38e5,30)},yl={h360fps3:new Be(640,360,2e5,3,"medium"),h360fps15:new Be(640,360,4e5,15,"medium"),h720fps5:new Be(1280,720,8e5,5,"medium"),h720fps15:new Be(1280,720,15e5,15,"medium"),h720fps30:new Be(1280,720,2e6,30,"medium"),h1080fps15:new Be(1920,1080,25e5,15,"medium"),h1080fps30:new Be(1920,1080,5e6,30,"medium"),original:new Be(0,0,7e6,30,"medium")},ZS="|",Mm="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function WS(r){const t=r.split(ZS);return t.length>1?[t[0],r.substr(t[0].length+1)]:[r,""]}function yt(r){return T(this,void 0,void 0,function*(){return new Promise(t=>vt.setTimeout(t,r))})}function bl(){return"addTransceiver"in RTCPeerConnection.prototype}function Sl(){return"addTrack"in RTCPeerConnection.prototype}function $S(){if(!("getCapabilities"in RTCRtpSender)||Yi()||Ki())return!1;const r=RTCRtpSender.getCapabilities("video");let t=!1;if(r){for(const i of r.codecs)if(i.mimeType.toLowerCase()==="video/av1"){t=!0;break}}return t}function eT(){if(!("getCapabilities"in RTCRtpSender)||Ki())return!1;if(Yi()){const i=xt();if(i?.version&&An(i.version,"16")<0||i?.os==="iOS"&&i?.osVersion&&An(i.osVersion,"16")<0)return!1}const r=RTCRtpSender.getCapabilities("video");let t=!1;if(r){for(const i of r.codecs)if(i.mimeType.toLowerCase()==="video/vp9"){t=!0;break}}return t}function vn(r){return r==="av1"||r==="vp9"}function Tl(r){return!document||As()?!1:(r||(r=document.createElement("audio")),"setSinkId"in r)}function tT(){return typeof RTCPeerConnection>"u"?!1:bl()||Sl()}function Ki(){var r;return((r=xt())===null||r===void 0?void 0:r.name)==="Firefox"}function wm(){const r=xt();return!!r&&r.name==="Chrome"&&r.os!=="iOS"}function Yi(){var r;return((r=xt())===null||r===void 0?void 0:r.name)==="Safari"}function As(){const r=xt();return r?.name==="Safari"||r?.os==="iOS"}function nT(){const r=xt();return r?.name==="Safari"&&r.version.startsWith("17.")||r?.os==="iOS"&&!!r?.osVersion&&An(r.osVersion,"17")>=0}function iT(r){return r||(r=xt()),r?.name==="Safari"&&An(r.version,"18.3")>0||r?.os==="iOS"&&!!r?.osVersion&&An(r.osVersion,"18.3")>0}function Nm(){var r,t;return Pt()?(t=(r=navigator.userAgentData)===null||r===void 0?void 0:r.mobile)!==null&&t!==void 0?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function aT(){const r=xt(),t="17.2";if(r)return r.name!=="Safari"&&r.os!=="iOS"||r.os==="iOS"&&r.osVersion&&An(r.osVersion,t)>=0?!0:r.name==="Safari"&&An(r.version,t)>=0}function Pt(){return typeof document<"u"}function On(){return navigator.product=="ReactNative"}function no(r){return r.hostname.endsWith(".livekit.cloud")||r.hostname.endsWith(".livekit.run")}function Cl(r){return no(r)?r.hostname.split(".")[0]:null}function xm(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function Pm(){if(!On())return;let r=xm();if(r)return r.platform}function Um(){if(Pt())return window.devicePixelRatio;if(On()){let r=xm();if(r)return r.devicePixelRatio}return 1}function An(r,t){const i=r.split("."),a=t.split("."),o=Math.min(i.length,a.length);for(let l=0;l<o;++l){const u=parseInt(i[l],10),d=parseInt(a[l],10);if(u>d)return 1;if(u<d)return-1;if(l===o-1&&u===d)return 0}return r===""&&t!==""?-1:t===""?1:i.length==a.length?0:i.length<a.length?-1:1}function sT(r){for(const t of r)t.target.handleResize(t)}function rT(r){for(const t of r)t.target.handleVisibilityChanged(t)}let kl=null;const Lm=()=>(kl||(kl=new ResizeObserver(sT)),kl);let El=null;const Im=()=>(El||(El=new IntersectionObserver(rT,{root:null,rootMargin:"0px"})),El);function oT(){var r;const t=new yh({sdk:bh.JS,protocol:GS,version:HS});return On()&&(t.os=(r=Pm())!==null&&r!==void 0?r:""),t}function Bm(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const o=document.createElement("canvas");o.width=r,o.height=t;const l=o.getContext("2d");l?.fillRect(0,0,o.width,o.height),a&&l&&(l.beginPath(),l.arc(r/2,t/2,50,0,Math.PI*2,!0),l.closePath(),l.fillStyle="grey",l.fill());const u=o.captureStream(),[d]=u.getTracks();if(!d)throw Error("Could not get empty media stream video track");return d.enabled=i,d}let Ds;function _l(){if(!Ds){const r=new AudioContext,t=r.createOscillator(),i=r.createGain();i.gain.setValueAtTime(0,0);const a=r.createMediaStreamDestination();if(t.connect(i),i.connect(a),t.start(),[Ds]=a.stream.getAudioTracks(),!Ds)throw Error("Could not get empty media stream audio track");Ds.enabled=!1}return Ds.clone()}class en{get isResolved(){return this._isResolved}constructor(t,i){this._isResolved=!1,this.onFinally=i,this.promise=new Promise((a,o)=>T(this,void 0,void 0,function*(){this.resolve=a,this.reject=o,t&&(yield t(a,o))})).finally(()=>{var a;this._isResolved=!0,(a=this.onFinally)===null||a===void 0||a.call(this)})}}function cT(r,t){const i=Object.assign({cloneTrack:!1,fftSize:2048,smoothingTimeConstant:.8,minDecibels:-100,maxDecibels:-80},t),a=Ml();if(!a)throw new Error("Audio Context not supported on this browser");const o=i.cloneTrack?r.mediaStreamTrack.clone():r.mediaStreamTrack,l=a.createMediaStreamSource(new MediaStream([o])),u=a.createAnalyser();u.minDecibels=i.minDecibels,u.maxDecibels=i.maxDecibels,u.fftSize=i.fftSize,u.smoothingTimeConstant=i.smoothingTimeConstant,l.connect(u);const d=new Uint8Array(u.frequencyBinCount);return{calculateVolume:()=>{u.getByteFrequencyData(d);let g=0;for(const S of d)g+=Math.pow(S/255,2);return Math.sqrt(g/d.length)},analyser:u,cleanup:()=>T(this,void 0,void 0,function*(){yield a.close(),i.cloneTrack&&o.stop()})}}function lT(r){return QS.includes(r)}function fi(r){if(typeof r=="string"||typeof r=="number")return r;if(Array.isArray(r))return r[0];if(r.exact!==void 0)return Array.isArray(r.exact)?r.exact[0]:r.exact;if(r.ideal!==void 0)return Array.isArray(r.ideal)?r.ideal[0]:r.ideal;throw Error("could not unwrap constraint")}function uT(r){return r.startsWith("http")?r.replace(/^(http)/,"ws"):r}function Ms(r){return r.startsWith("ws")?r.replace(/^(ws)/,"http"):r}function dT(r,t){return r.segments.map(i=>{let{id:a,text:o,language:l,startTime:u,endTime:d,final:p}=i;var m;const g=(m=t.get(a))!==null&&m!==void 0?m:Date.now(),y=Date.now();return p?t.delete(a):t.set(a,g),{id:a,text:o,startTime:Number.parseInt(u.toString()),endTime:Number.parseInt(d.toString()),final:p,language:l,firstReceivedTime:g,lastReceivedTime:y}})}function fT(r){const{id:t,timestamp:i,message:a,editTimestamp:o}=r;return{id:t,timestamp:Number.parseInt(i.toString()),editTimestamp:o?Number.parseInt(o.toString()):void 0,message:a}}function jm(r){switch(r.reason){case me.LeaveRequest:return r.context;case me.Cancelled:return mn.CLIENT_INITIATED;case me.NotAllowed:return mn.USER_REJECTED;case me.ServerUnreachable:return mn.JOIN_FAILURE;default:return mn.UNKNOWN_REASON}}function io(r){return r!==void 0?Number(r):void 0}function Qi(r){return r!==void 0?BigInt(r):void 0}function ka(r){return!!r&&!(r instanceof MediaStreamTrack)&&r.isLocal}function Dn(r){return!!r&&r.kind==H.Kind.Audio}function hi(r){return!!r&&r.kind==H.Kind.Video}function mi(r){return ka(r)&&hi(r)}function zn(r){return ka(r)&&Dn(r)}function Rl(r){return!!r&&!r.isLocal}function hT(r){return!!r&&!r.isLocal}function Ol(r){return Rl(r)&&hi(r)}function mT(r){return r.isLocal}function pT(r,t){const i=[];let a=new TextEncoder().encode(r);for(;a.length>t;){let o=t;for(;o>0;){const l=a[o];if(l!==void 0&&(l&192)!==128)break;o--}i.push(a.slice(0,o)),a=a.slice(o)}return a.length>0&&i.push(a),i}function gT(r){var t;const i=r.get("Cache-Control");if(i){const a=(t=i.match(/(?:^|[,\s])max-age=(\d+)/))===null||t===void 0?void 0:t[1];if(a)return parseInt(a,10)}}function zm(r,t,i){var a,o,l,u;const{optionsWithoutProcessor:d,audioProcessor:p,videoProcessor:m}=Vm(r??{}),g=t?.processor,y=i?.processor,S=d??{};return S.audio===!0&&(S.audio={}),S.video===!0&&(S.video={}),S.audio&&(Al(S.audio,t),(a=(l=S.audio).deviceId)!==null&&a!==void 0||(l.deviceId={ideal:"default"}),(p||g)&&(S.audio.processor=p??g)),S.video&&(Al(S.video,i),(o=(u=S.video).deviceId)!==null&&o!==void 0||(u.deviceId={ideal:"default"}),(m||y)&&(S.video.processor=m??y)),S}function Al(r,t){return Object.keys(t).forEach(i=>{r[i]===void 0&&(r[i]=t[i])}),r}function Dl(r){var t,i,a,o;const l={};if(r.video)if(typeof r.video=="object"){const u={},d=u,p=r.video;Object.keys(p).forEach(m=>{switch(m){case"resolution":Al(d,p.resolution);break;default:d[m]=p[m]}}),l.video=u,(t=(a=l.video).deviceId)!==null&&t!==void 0||(a.deviceId={ideal:"default"})}else l.video=r.video?{deviceId:{ideal:"default"}}:!1;else l.video=!1;return r.audio?typeof r.audio=="object"?(l.audio=r.audio,(i=(o=l.audio).deviceId)!==null&&i!==void 0||(o.deviceId={ideal:"default"})):l.audio={deviceId:{ideal:"default"}}:l.audio=!1,l}function qm(r){return T(this,arguments,void 0,function(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const a=Ml();if(a){const o=a.createAnalyser();o.fftSize=2048;const l=o.frequencyBinCount,u=new Uint8Array(l);a.createMediaStreamSource(new MediaStream([t.mediaStreamTrack])).connect(o),yield yt(i),o.getByteTimeDomainData(u);const p=u.some(m=>m!==128&&m!==0);return a.close(),!p}return!1})()})}function Ml(){var r;const t=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(t){const i=new t({latencyHint:"interactive"});if(i.state==="suspended"&&typeof window<"u"&&(!((r=window.document)===null||r===void 0)&&r.body)){const a=()=>T(this,void 0,void 0,function*(){var o;try{i.state==="suspended"&&(yield i.resume())}catch(l){console.warn("Error trying to auto-resume audio context",l)}finally{(o=window.document.body)===null||o===void 0||o.removeEventListener("click",a)}});i.addEventListener("statechange",()=>{var o;i.state==="closed"&&((o=window.document.body)===null||o===void 0||o.removeEventListener("click",a))}),window.document.body.addEventListener("click",a)}return i}}function vT(r){return r==="audioinput"?H.Source.Microphone:r==="videoinput"?H.Source.Camera:H.Source.Unknown}function wl(r){return r===H.Source.Microphone?"audioinput":r===H.Source.Camera?"videoinput":void 0}function yT(r){var t,i;let a=(t=r.video)!==null&&t!==void 0?t:!0;return r.resolution&&r.resolution.width>0&&r.resolution.height>0&&(a=typeof a=="boolean"?{}:a,Yi()?a=Object.assign(Object.assign({},a),{width:{max:r.resolution.width},height:{max:r.resolution.height},frameRate:r.resolution.frameRate}):a=Object.assign(Object.assign({},a),{width:{ideal:r.resolution.width},height:{ideal:r.resolution.height},frameRate:r.resolution.frameRate})),{audio:(i=r.audio)!==null&&i!==void 0?i:!1,video:a,controller:r.controller,selfBrowserSurface:r.selfBrowserSurface,surfaceSwitching:r.surfaceSwitching,systemAudio:r.systemAudio,preferCurrentTab:r.preferCurrentTab}}function ws(r){return r.split("/")[1].toLowerCase()}function bT(r){const t=[];return r.forEach(i=>{i.track!==void 0&&t.push(new Xc({cid:i.track.mediaStreamID,track:i.trackInfo}))}),t}function Se(r){return"mediaStreamTrack"in r?{trackID:r.sid,source:r.source,muted:r.isMuted,enabled:r.mediaStreamTrack.enabled,kind:r.kind,streamID:r.mediaStreamID,streamTrackID:r.mediaStreamTrack.id}:{trackID:r.trackSid,enabled:r.isEnabled,muted:r.isMuted,trackInfo:Object.assign({mimeType:r.mimeType,name:r.trackName,encrypted:r.isEncrypted,kind:r.kind,source:r.source},r.track?Se(r.track):{})}}function ST(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function TT(r,t){var i;r===void 0&&(r={}),t===void 0&&(t={});const a=[...Object.keys(t),...Object.keys(r)],o={};for(const l of a)r[l]!==t[l]&&(o[l]=(i=t[l])!==null&&i!==void 0?i:"");return o}function Vm(r){const t=Object.assign({},r);let i,a;return typeof t.audio=="object"&&t.audio.processor&&(i=t.audio.processor,t.audio=Object.assign(Object.assign({},t.audio),{processor:void 0})),typeof t.video=="object"&&t.video.processor&&(a=t.video.processor,t.video=Object.assign(Object.assign({},t.video),{processor:void 0})),{audioProcessor:i,videoProcessor:a,optionsWithoutProcessor:zS(t)}}function CT(r){switch(r){case at.CAMERA:return H.Source.Camera;case at.MICROPHONE:return H.Source.Microphone;case at.SCREEN_SHARE:return H.Source.ScreenShare;case at.SCREEN_SHARE_AUDIO:return H.Source.ScreenShareAudio;default:return H.Source.Unknown}}function Fm(r,t){return r.width*r.height<t.width*t.height}function kT(r,t){var i;return(i=r.layers)===null||i===void 0?void 0:i.find(a=>a.quality===t)}class ET extends Rn.EventEmitter{constructor(t,i){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=a=>{var o,l;const{kind:u,data:d}=a.data;switch(u){case"error":if(ge.error(d.error.message),d.uuid){const g=this.decryptDataRequests.get(d.uuid);if(g?.reject){g.reject(d.error);break}const y=this.encryptDataRequests.get(d.uuid);if(y?.reject){y.reject(d.error);break}}this.emit(di.EncryptionError,d.error,d.participantIdentity);break;case"initAck":d.enabled&&this.keyProvider.getKeys().forEach(g=>{this.postKey(g)});break;case"enable":if(d.enabled&&this.keyProvider.getKeys().forEach(g=>{this.postKey(g)}),this.encryptionEnabled!==d.enabled&&d.participantIdentity===((o=this.room)===null||o===void 0?void 0:o.localParticipant.identity))this.emit(di.ParticipantEncryptionStatusChanged,d.enabled,this.room.localParticipant),this.encryptionEnabled=d.enabled;else if(d.participantIdentity){const g=(l=this.room)===null||l===void 0?void 0:l.getParticipantByIdentity(d.participantIdentity);if(!g)throw TypeError("couldn't set encryption status, participant not found".concat(d.participantIdentity));this.emit(di.ParticipantEncryptionStatusChanged,d.enabled,g)}break;case"ratchetKey":this.keyProvider.emit(ui.KeyRatcheted,d.ratchetResult,d.participantIdentity,d.keyIndex);break;case"decryptDataResponse":const p=this.decryptDataRequests.get(d.uuid);p?.resolve&&p.resolve(d);break;case"encryptDataResponse":const m=this.encryptDataRequests.get(d.uuid);m?.resolve&&m.resolve(d);break}},this.onWorkerError=a=>{ge.error("e2ee worker encountered an error:",{error:a.error}),this.emit(di.EncryptionError,a.error,void 0)},this.keyProvider=t.keyProvider,this.worker=t.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=i}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(t){if(!LS())throw new fl("tried to setup end-to-end encryption on an unsupported browser");if(ge.info("setting up e2ee"),t!==this.room){this.room=t,this.setupEventListeners(t,this.keyProvider);const i={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:TS.getLevel()}};this.worker&&(ge.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(i))}}setParticipantCryptorEnabled(t,i){ge.debug("set e2ee to ".concat(t," for participant ").concat(i)),this.postEnable(t,i)}setSifTrailer(t){!t||t.length===0?ge.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(t)}setupEngine(t){t.on(Z.RTPVideoMapUpdate,i=>{this.postRTPMap(i)})}setupEventListeners(t,i){t.on(Q.TrackPublished,(a,o)=>this.setParticipantCryptorEnabled(a.trackInfo.encryption!==lt.NONE,o.identity)),t.on(Q.ConnectionStateChanged,a=>{a===Ne.Connected&&t.remoteParticipants.forEach(o=>{o.trackPublications.forEach(l=>{this.setParticipantCryptorEnabled(l.trackInfo.encryption!==lt.NONE,o.identity)})})}).on(Q.TrackUnsubscribed,(a,o,l)=>{var u;const d={kind:"removeTransform",data:{participantIdentity:l.identity,trackId:a.mediaStreamID}};(u=this.worker)===null||u===void 0||u.postMessage(d)}).on(Q.TrackSubscribed,(a,o,l)=>{this.setupE2EEReceiver(a,l.identity,o.trackInfo)}).on(Q.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");i.getKeys().forEach(a=>{this.postKey(a)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),t.localParticipant.on(W.LocalSenderCreated,(a,o)=>T(this,void 0,void 0,function*(){this.setupE2EESender(o,a)})),t.localParticipant.on(W.LocalTrackPublished,a=>{if(!hi(a.track)||!As())return;const o={kind:"updateCodec",data:{trackId:a.track.mediaStreamID,codec:ws(a.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(o)}),i.on(ui.SetKey,a=>this.postKey(a)).on(ui.RatchetRequest,(a,o)=>this.postRatchetRequest(a,o))}encryptData(t){return T(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const i=crypto.randomUUID(),a={kind:"encryptDataRequest",data:{uuid:i,payload:t,participantIdentity:this.room.localParticipant.identity}},o=new en;return o.onFinally=()=>{this.encryptDataRequests.delete(i)},this.encryptDataRequests.set(i,o),this.worker.postMessage(a),o.promise})}handleEncryptedData(t,i,a,o){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const l=crypto.randomUUID(),u={kind:"decryptDataRequest",data:{uuid:l,payload:t,iv:i,participantIdentity:a,keyIndex:o}},d=new en;return d.onFinally=()=>{this.decryptDataRequests.delete(l)},this.decryptDataRequests.set(l,d),this.worker.postMessage(u),d.promise}postRatchetRequest(t,i){if(!this.worker)throw Error("could not ratchet key, worker is missing");const a={kind:"ratchetRequest",data:{participantIdentity:t,keyIndex:i}};this.worker.postMessage(a)}postKey(t){let{key:i,participantIdentity:a,keyIndex:o}=t;var l;if(!this.worker)throw Error("could not set key, worker is missing");const u={kind:"setKey",data:{participantIdentity:a,isPublisher:a===((l=this.room)===null||l===void 0?void 0:l.localParticipant.identity),key:i,keyIndex:o}};this.worker.postMessage(u)}postEnable(t,i){if(this.worker){const a={kind:"enable",data:{enabled:t,participantIdentity:i}};this.worker.postMessage(a)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(t){var i;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((i=this.room)===null||i===void 0)&&i.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const a={kind:"setRTPMap",data:{map:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(a)}postSifTrailer(t){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const i={kind:"setSifTrailer",data:{trailer:t}};this.worker.postMessage(i)}setupE2EEReceiver(t,i,a){if(t.receiver){if(!a?.mimeType||a.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(t.receiver,t.mediaStreamID,i,t.kind==="video"?ws(a.mimeType):void 0)}}setupE2EESender(t,i){if(!ka(t)||!i){i||ge.warn("early return because sender is not ready");return}this.handleSender(i,t.mediaStreamID,void 0)}handleReceiver(t,i,a,o){return T(this,void 0,void 0,function*(){if(this.worker){if(dl()&&!wm()){const l={kind:"decode",participantIdentity:a,trackId:i,codec:o};t.transform=new RTCRtpScriptTransform(this.worker,l)}else{if(_s in t&&o){const p={kind:"updateCodec",data:{trackId:i,codec:o,participantIdentity:a}};this.worker.postMessage(p);return}let l=t.writableStream,u=t.readableStream;if(!l||!u){const p=t.createEncodedStreams();t.writableStream=p.writable,l=p.writable,t.readableStream=p.readable,u=p.readable}const d={kind:"decode",data:{readableStream:u,writableStream:l,trackId:i,codec:o,participantIdentity:a,isReuse:_s in t}};this.worker.postMessage(d,[u,l])}t[_s]=!0}})}handleSender(t,i,a){var o;if(!(_s in t||!this.worker)){if(!(!((o=this.room)===null||o===void 0)&&o.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(dl()&&!wm()){ge.info("initialize script transform");const l={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:i,codec:a};t.transform=new RTCRtpScriptTransform(this.worker,l)}else{ge.info("initialize encoded streams");const l=t.createEncodedStreams(),u={kind:"encode",data:{readableStream:l.readable,writableStream:l.writable,codec:a,trackId:i,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(u,[l.readable,l.writable])}t[_s]=!0}}}const _T=500,RT=15e3;class Ea{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new Ea),this._instance}addFailedConnectionAttempt(t){var i;const a=new URL(t),o=Cl(a);if(!o)return;let l=(i=this.failedConnectionAttempts.get(o))!==null&&i!==void 0?i:0;this.failedConnectionAttempts.set(o,l+1),this.backOffPromises.set(o,yt(Math.min(_T*Math.pow(2,l),RT)))}getBackOffPromise(t){const i=new URL(t),a=i&&Cl(i);return a&&this.backOffPromises.get(a)||Promise.resolve()}resetFailedConnectionAttempts(t){const i=new URL(t),a=i&&Cl(i);a&&(this.failedConnectionAttempts.set(a,0),this.backOffPromises.set(a,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}Ea._instance=null;const Nl="default";class ht{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new ht),this.instance}get previousDevices(){return this._previousDevices}getDevices(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var l;if(((l=ht.userMediaPromiseMap)===null||l===void 0?void 0:l.size)>0){ge.debug("awaiting getUserMedia promise");try{i?yield ht.userMediaPromiseMap.get(i):yield Promise.all(ht.userMediaPromiseMap.values())}catch{ge.warn("error waiting for media permissons")}}let u=yield navigator.mediaDevices.enumerateDevices();if(o&&!(Yi()&&a.hasDeviceInUse(i))&&(u.filter(p=>p.kind===i).length===0||u.some(p=>{const m=p.label==="",g=i?p.kind===i:!0;return m&&g}))){const p={video:i!=="audioinput"&&i!=="audiooutput",audio:i!=="videoinput"&&{deviceId:{ideal:"default"}}},m=yield navigator.mediaDevices.getUserMedia(p);u=yield navigator.mediaDevices.enumerateDevices(),m.getTracks().forEach(g=>{g.stop()})}return a._previousDevices=u,i&&(u=u.filter(d=>d.kind===i)),u})()})}normalizeDeviceId(t,i,a){return T(this,void 0,void 0,function*(){if(i!==Nl)return i;const o=yield this.getDevices(t),l=o.find(d=>d.deviceId===Nl);if(!l){ge.warn("could not reliably determine default device");return}const u=o.find(d=>d.deviceId!==Nl&&d.groupId===(a??l.groupId));if(!u){ge.warn("could not reliably determine default device");return}return u?.deviceId})}hasDeviceInUse(t){return t?ht.userMediaPromiseMap.has(t):ht.userMediaPromiseMap.size>0}}ht.mediaDeviceKinds=["audioinput","audiooutput","videoinput"],ht.userMediaPromiseMap=new Map;var Ns;(function(r){r[r.WAITING=0]="WAITING",r[r.RUNNING=1]="RUNNING",r[r.COMPLETED=2]="COMPLETED"})(Ns||(Ns={}));class OT{constructor(){this.pendingTasks=new Map,this.taskMutex=new Rt,this.nextTaskIndex=0}run(t){return T(this,void 0,void 0,function*(){const i={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Ns.WAITING};this.pendingTasks.set(i.id,i);const a=yield this.taskMutex.lock();try{return i.executedAt=Date.now(),i.status=Ns.RUNNING,yield t()}finally{i.status=Ns.COMPLETED,this.pendingTasks.delete(i.id),a()}})}flush(){return T(this,void 0,void 0,function*(){return this.run(()=>T(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class AT{get readyState(){return this.ws.readyState}constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var a,o;if(!((a=i.signal)===null||a===void 0)&&a.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=t;const l=new WebSocket(t,(o=i.protocols)!==null&&o!==void 0?o:[]);l.binaryType="arraybuffer",this.ws=l;const u=function(){let{closeCode:d,reason:p}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return l.close(d,p)};this.opened=new Promise((d,p)=>{l.onopen=()=>{d({readable:new ReadableStream({start(m){l.onmessage=g=>{let{data:y}=g;return m.enqueue(y)},l.onerror=g=>m.error(g)},cancel:u}),writable:new WritableStream({write(m){l.send(m)},abort(){l.close()},close:u}),protocol:l.protocol,extensions:l.extensions}),l.removeEventListener("error",p)},l.addEventListener("error",p)}),this.closed=new Promise((d,p)=>{const m=()=>T(this,void 0,void 0,function*(){const g=new Promise(S=>{l.readyState!==WebSocket.CLOSED&&l.addEventListener("close",C=>{S(C)},{once:!0})}),y=yield Promise.race([yt(250),g]);y?d(y):p(new Error("Encountered unspecified websocket error without a timely close event"))});l.onclose=g=>{let{code:y,reason:S}=g;d({closeCode:y,reason:S}),l.removeEventListener("error",m)},l.addEventListener("error",m)}),i.signal&&(i.signal.onabort=()=>l.close()),this.close=u}}function DT(r,t){const i=new URL(uT(r));return t.forEach((a,o)=>{i.searchParams.set(o,a)}),Hm(i,"rtc")}function MT(r){const t=new URL(Ms(r));return Hm(t,"validate")}function wT(r){return r.endsWith("/")?r:"".concat(r,"/")}function Hm(r,t){return r.pathname="".concat(wT(r.pathname)).concat(t),r.toString()}function Gm(r){if(typeof r=="string")return _h.fromJson(JSON.parse(r),{ignoreUnknownFields:!0});if(r instanceof ArrayBuffer)return _h.fromBinary(new Uint8Array(r));throw new Error("could not decode websocket message: ".concat(typeof r))}function NT(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(r instanceof AbortSignal))return t;const i=r.reason;switch(typeof i){case"string":return i;case"object":return i instanceof Error?i.message:t;default:return"toString"in i?i.toString():t}}const xT=["syncState","trickle","offer","answer","simulate","leave"];function PT(r){const t=xT.indexOf(r.case)>=0;return ge.trace("request allowed to bypass queue:",{canPass:t,req:r}),t}var Ve;(function(r){r[r.CONNECTING=0]="CONNECTING",r[r.CONNECTED=1]="CONNECTED",r[r.RECONNECTING=2]="RECONNECTING",r[r.DISCONNECTING=3]="DISCONNECTING",r[r.DISCONNECTED=4]="DISCONNECTED"})(Ve||(Ve={}));const UT=250;class xl{get currentState(){return this.state}get isDisconnected(){return this.state===Ve.DISCONNECTING||this.state===Ve.DISCONNECTED}get isEstablishingConnection(){return this.state===Ve.CONNECTING||this.state===Ve.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var a;this.rtt=0,this.state=Ve.DISCONNECTED,this.log=ge,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=Ln((a=i.loggerName)!==null&&a!==void 0?a:gn.Signal),this.loggerContextCb=i.loggerContextCb,this.useJSON=t,this.requestQueue=new OT,this.queuedRequests=[],this.closingLock=new Rt,this.connectionLock=new Rt,this.state=Ve.DISCONNECTED}get logContext(){var t,i;return(i=(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this))!==null&&i!==void 0?i:{}}join(t,i,a,o){return T(this,void 0,void 0,function*(){return this.state=Ve.CONNECTING,this.options=a,yield this.connect(t,i,a,o)})}reconnect(t,i,a,o){return T(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=Ve.RECONNECTING,this.clearPingInterval(),yield this.connect(t,i,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:a,reconnectReason:o}))})}connect(t,i,a,o){return T(this,void 0,void 0,function*(){const l=yield this.connectionLock.lock();this.connectOptions=a;const u=oT(),d=a.singlePeerConnection?IT(i,u,a):LT(i,u,a),p=DT(t,d),m=MT(p);return new Promise((g,y)=>T(this,void 0,void 0,function*(){var S,C;try{let O=!1;const A=D=>T(this,void 0,void 0,function*(){if(O)return;O=!0;const x=D instanceof Event?D.currentTarget:D,F=NT(x,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(F)).catch(Y=>{this.log.error(Y),this.close()}):this.close(),I(),y(x instanceof AbortSignal?x.reason:x)});o?.addEventListener("abort",A);const I=()=>{clearTimeout(L),o?.removeEventListener("abort",A)},L=setTimeout(()=>{A(new Ee("room connection has timed out (signal)",me.ServerUnreachable))},a.websocketTimeout),X=(D,x)=>{this.handleSignalConnected(D,L,x)},K=new URL(p);K.searchParams.has("access_token")&&K.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(K),Object.assign({reconnect:a.reconnect,reconnectReason:a.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new AT(p);try{this.ws.closed.then(ne=>{var ae;this.isEstablishingConnection&&y(new Ee("Websocket got closed during a (re)connection attempt: ".concat(ne.reason),me.InternalError)),ne.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:ne.reason,code:ne.closeCode,wasClean:ne.closeCode===1e3,state:this.state})),this.state===Ve.CONNECTED&&this.handleOnClose((ae=ne.reason)!==null&&ae!==void 0?ae:"Unexpected WS error"))}).catch(ne=>{this.isEstablishingConnection&&y(new Ee("Websocket error during a (re)connection attempt: ".concat(ne),me.InternalError))});const D=yield this.ws.opened.catch(ne=>T(this,void 0,void 0,function*(){if(this.state!==Ve.CONNECTED){this.state=Ve.DISCONNECTED,clearTimeout(L);const ae=yield this.handleConnectionError(ne,m);y(ae);return}this.handleWSError(ne),y(ne)}));if(clearTimeout(L),!D)return;const x=D.readable.getReader();this.streamWriter=D.writable.getWriter();const F=yield x.read();if(x.releaseLock(),!F.value)throw new Ee("no message received as first message",me.InternalError);const Y=Gm(F.value),te=this.validateFirstMessage(Y,(S=a.reconnect)!==null&&S!==void 0?S:!1);if(!te.isValid){y(te.error);return}((C=Y.message)===null||C===void 0?void 0:C.case)==="join"&&(this.pingTimeoutDuration=Y.message.value.pingTimeout,this.pingIntervalDuration=Y.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const ie=te.shouldProcessFirstMessage?Y:void 0;X(D,ie),g(te.response)}catch(D){y(D)}finally{I()}}finally{l()}}))})}startReadingLoop(t,i){return T(this,void 0,void 0,function*(){for(i&&this.handleSignalResponse(i);;){this.signalLatency&&(yield yt(this.signalLatency));const{done:a,value:o}=yield t.read();if(a)break;const l=Gm(o);this.handleSignalResponse(l)}})}close(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return(function*(){if([Ve.DISCONNECTING||Ve.DISCONNECTED].includes(t.state)){t.log.debug("ignoring signal close as it's already in disconnecting state");return}const o=yield t.closingLock.lock();try{if(t.clearPingInterval(),i&&(t.state=Ve.DISCONNECTING),t.ws){t.ws.close({closeCode:1e3,reason:a});const l=t.ws.closed;t.ws=void 0,t.streamWriter=void 0,yield Promise.race([l,yt(UT)])}}catch(l){t.log.debug("websocket error while closing",Object.assign(Object.assign({},t.logContext),{error:l}))}finally{i&&(t.state=Ve.DISCONNECTED),o()}})()})}sendOffer(t,i){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:t.sdp})),this.sendRequest({case:"offer",value:_a(t,i)})}sendAnswer(t,i){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:t.sdp})),this.sendRequest({case:"answer",value:_a(t,i)})}sendIceCandidate(t,i){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:t})),this.sendRequest({case:"trickle",value:new Vr({candidateInit:JSON.stringify(t),target:i})})}sendMuteTrack(t,i){return this.sendRequest({case:"mute",value:new Fr({sid:t,muted:i})})}sendAddTrack(t){return this.sendRequest({case:"addTrack",value:t})}sendUpdateLocalMetadata(t,i){return T(this,arguments,void 0,function(a,o){var l=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const d=l.getNextRequestId();return yield l.sendRequest({case:"updateMetadata",value:new Wc({requestId:d,metadata:a,name:o,attributes:u})}),d})()})}sendUpdateTrackSettings(t){this.sendRequest({case:"trackSetting",value:t})}sendUpdateSubscription(t){return this.sendRequest({case:"subscription",value:t})}sendSyncState(t){return this.sendRequest({case:"syncState",value:t})}sendUpdateVideoLayers(t,i){return this.sendRequest({case:"updateLayers",value:new Ah({trackSid:t,layers:i})})}sendUpdateSubscriptionPermissions(t,i){return this.sendRequest({case:"subscriptionPermission",value:new wh({allParticipants:t,trackPermissions:i})})}sendSimulateScenario(t){return this.sendRequest({case:"simulate",value:t})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:Ke.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Ph({timestamp:Ke.parse(Date.now()),rtt:Ke.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(t,i){return this.sendRequest({case:"updateAudioTrack",value:new Zc({trackSid:t,features:i})})}sendLeave(){return this.sendRequest({case:"leave",value:new Gr({reason:mn.CLIENT_INITIATED,action:ba.DISCONNECT})})}sendRequest(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!o&&!PT(i)&&a.state===Ve.RECONNECTING){a.queuedRequests.push(()=>T(a,void 0,void 0,function*(){yield this.sendRequest(i,!0)}));return}if(o||(yield a.requestQueue.flush()),a.signalLatency&&(yield yt(a.signalLatency)),a.isDisconnected){a.log.debug("skipping signal request (type: ".concat(i.case,") - SignalClient disconnected"));return}if(!a.streamWriter){a.log.error("cannot send signal request before connected, type: ".concat(i?.case),a.logContext);return}const u=new Kb({message:i});try{a.useJSON?yield a.streamWriter.write(u.toJsonString()):yield a.streamWriter.write(u.toBinary())}catch(d){a.log.error("error sending signal message",Object.assign(Object.assign({},a.logContext),{error:d}))}})()})}handleSignalResponse(t){var i,a;const o=t.message;if(o==null){this.log.debug("received unsupported message",this.logContext);return}let l=!1;if(o.case==="answer"){const u=Km(o.value);this.onAnswer&&this.onAnswer(u,o.value.id,o.value.midToTrackId)}else if(o.case==="offer"){const u=Km(o.value);this.onOffer&&this.onOffer(u,o.value.id,o.value.midToTrackId)}else if(o.case==="trickle"){const u=JSON.parse(o.value.candidateInit);this.onTrickle&&this.onTrickle(u,o.value.target)}else o.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((i=o.value.participants)!==null&&i!==void 0?i:[]):o.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(o.value):o.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((a=o.value.speakers)!==null&&a!==void 0?a:[]):o.case==="leave"?this.onLeave&&this.onLeave(o.value):o.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(o.value.sid,o.value.muted):o.case==="roomUpdate"?this.onRoomUpdate&&o.value.room&&this.onRoomUpdate(o.value.room):o.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(o.value):o.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(o.value):o.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(o.value):o.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(o.value):o.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(o.value):o.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(o.value):o.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(o.value):o.case==="pong"||(o.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(o.value.lastPingTimestamp.toString()),this.resetPingTimeout(),l=!0):o.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(o.value):o.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(o.value.trackSid):o.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(o.value.token),this.onRoomMoved&&this.onRoomMoved(o.value)):o.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(o.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:o.case})));l||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const t=this.queuedRequests.shift();t&&this.requestQueue.run(t)}}handleOnClose(t){return T(this,void 0,void 0,function*(){if(this.state===Ve.DISCONNECTED)return;const i=this.onClose;yield this.close(void 0,t),this.log.debug("websocket connection closed: ".concat(t),Object.assign(Object.assign({},this.logContext),{reason:t})),i&&i(t)})}handleWSError(t){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:t}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=vt.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&vt.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=vt.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&vt.clearInterval(this.pingInterval)}handleSignalConnected(t,i,a){this.state=Ve.CONNECTED,clearTimeout(i),this.startPingInterval(),this.startReadingLoop(t.readable.getReader(),a)}validateFirstMessage(t,i){var a,o,l,u,d;return((a=t.message)===null||a===void 0?void 0:a.case)==="join"?{isValid:!0,response:t.message.value}:this.state===Ve.RECONNECTING&&((o=t.message)===null||o===void 0?void 0:o.case)!=="leave"?((l=t.message)===null||l===void 0?void 0:l.case)==="reconnect"?{isValid:!0,response:t.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((u=t.message)===null||u===void 0?void 0:u.case)==="leave"?{isValid:!1,error:new Ee("Received leave request while trying to (re)connect",me.LeaveRequest,void 0,t.message.value.reason)}:i?{isValid:!1,error:new Ee("Unexpected first message",me.InternalError)}:{isValid:!1,error:new Ee("did not receive join response, got ".concat((d=t.message)===null||d===void 0?void 0:d.case," instead"),me.InternalError)}}handleConnectionError(t,i){return T(this,void 0,void 0,function*(){try{const a=yield fetch(i);if(a.status.toFixed(0).startsWith("4")){const o=yield a.text();return new Ee(o,me.NotAllowed,a.status)}else return t instanceof Ee?t:new Ee("Encountered unknown websocket error during connection: ".concat(t),me.InternalError,a.status)}catch(a){return a instanceof Ee?a:new Ee(a instanceof Error?a.message:"server was not reachable",me.ServerUnreachable)}})}}function Km(r){const t={type:"offer",sdp:r.sdp};switch(r.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=r.type;break}return t}function _a(r,t){return new li({sdp:r.sdp,type:r.type,id:t})}function LT(r,t,i){var a;const o=new URLSearchParams;return o.set("access_token",r),i.reconnect&&(o.set("reconnect","1"),i.sid&&o.set("sid",i.sid)),o.set("auto_subscribe",i.autoSubscribe?"1":"0"),o.set("sdk",On()?"reactnative":"js"),o.set("version",t.version),o.set("protocol",t.protocol.toString()),t.deviceModel&&o.set("device_model",t.deviceModel),t.os&&o.set("os",t.os),t.osVersion&&o.set("os_version",t.osVersion),t.browser&&o.set("browser",t.browser),t.browserVersion&&o.set("browser_version",t.browserVersion),i.adaptiveStream&&o.set("adaptive_stream","1"),i.reconnectReason&&o.set("reconnect_reason",i.reconnectReason.toString()),!((a=navigator.connection)===null||a===void 0)&&a.type&&o.set("network",navigator.connection.type),o}function IT(r,t,i){const a=new URLSearchParams;a.set("access_token",r);const o=new mS({clientInfo:t,connectionSettings:new Uh({autoSubscribe:!!i.autoSubscribe,adaptiveStream:!!i.adaptiveStream}),reconnect:!!i.reconnect,participantSid:i.sid?i.sid:void 0});i.reconnectReason&&(o.reconnectReason=i.reconnectReason);const l=new pS({joinRequest:o.toBinary()});return a.set("join_request",btoa(new TextDecoder("utf-8").decode(l.toBinary()))),a}class Ym{constructor(){this.buffer=[],this._totalSize=0}push(t){this.buffer.push(t),this._totalSize+=t.data.byteLength}pop(){const t=this.buffer.shift();return t&&(this._totalSize-=t.data.byteLength),t}getAll(){return this.buffer.slice()}popToSequence(t){for(;this.buffer.length>0&&this.buffer[0].sequence<=t;)this.pop()}alignBufferedAmount(t){for(;this.buffer.length>0;){const i=this.buffer[0];if(this._totalSize-i.data.byteLength<=t)break;this.pop()}}get length(){return this.buffer.length}}class BT{constructor(t){this._map=new Map,this._lastCleanup=0,this.ttl=t}set(t,i){const a=Date.now();a-this._lastCleanup>this.ttl/2&&this.cleanup();const o=a+this.ttl;return this._map.set(t,{value:i,expiresAt:o}),this}get(t){const i=this._map.get(t);if(i){if(i.expiresAt<Date.now()){this._map.delete(t);return}return i.value}}has(t){const i=this._map.get(t);return i?i.expiresAt<Date.now()?(this._map.delete(t),!1):!0:!1}delete(t){return this._map.delete(t)}clear(){this._map.clear()}cleanup(){const t=Date.now();for(const[i,a]of this._map.entries())a.expiresAt<t&&this._map.delete(i);this._lastCleanup=t}get size(){return this.cleanup(),this._map.size}forEach(t){this.cleanup();for(const[i,a]of this._map.entries())a.expiresAt>=Date.now()&&t(a.value,i,this.asValueMap())}map(t){this.cleanup();const i=[],a=this.asValueMap();for(const[o,l]of a.entries())i.push(t(l,o,a));return i}asValueMap(){const t=new Map;for(const[i,a]of this._map.entries())a.expiresAt>=Date.now()&&t.set(i,a.value);return t}}var yn={},Pl={},Ul={exports:{}},Qm;function Ll(){if(Qm)return Ul.exports;Qm=1;var r=Ul.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(t){return t.encoding?"rtpmap:%d %s/%s/%s":t.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(t){return t.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(t){return t.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(t){return"extmap:%d"+(t.direction?"/%s":"%v")+(t["encrypt-uri"]?" %s":"%v")+" %s"+(t.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(t){return t.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(t){var i="candidate:%s %d %s %d %s %d typ %s";return i+=t.raddr!=null?" raddr %s rport %d":"%v%v",i+=t.tcptype!=null?" tcptype %s":"%v",t.generation!=null&&(i+=" generation %d"),i+=t["network-id"]!=null?" network-id %d":"%v",i+=t["network-cost"]!=null?" network-cost %d":"%v",i}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(t){var i="ssrc:%d";return t.attribute!=null&&(i+=" %s",t.value!=null&&(i+=":%s")),i}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(t){return t.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(t){return t.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(t){return"imageattr:%s %s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(t){return"simulcast:%s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(t){return"ts-refclk:%s"+(t.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(t){var i="mediaclk:";return i+=t.id!=null?"id=%s %s":"%v%s",i+=t.mediaClockValue!=null?"=%s":"",i+=t.rateNumerator!=null?" rate=%s":"",i+=t.rateDenominator!=null?"/%s":"",i}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(r).forEach(function(t){var i=r[t];i.forEach(function(a){a.reg||(a.reg=/(.*)/),a.format||(a.format="%s")})}),Ul.exports}var Jm;function jT(){return Jm||(Jm=1,(function(r){var t=function(d){return String(Number(d))===d?Number(d):d},i=function(d,p,m,g){if(g&&!m)p[g]=t(d[1]);else for(var y=0;y<m.length;y+=1)d[y+1]!=null&&(p[m[y]]=t(d[y+1]))},a=function(d,p,m){var g=d.name&&d.names;d.push&&!p[d.push]?p[d.push]=[]:g&&!p[d.name]&&(p[d.name]={});var y=d.push?{}:g?p[d.name]:p;i(m.match(d.reg),y,d.names,d.name),d.push&&p[d.push].push(y)},o=Ll(),l=RegExp.prototype.test.bind(/^([a-z])=(.*)/);r.parse=function(d){var p={},m=[],g=p;return d.split(/(\r\n|\r|\n)/).filter(l).forEach(function(y){var S=y[0],C=y.slice(2);S==="m"&&(m.push({rtp:[],fmtp:[]}),g=m[m.length-1]);for(var O=0;O<(o[S]||[]).length;O+=1){var A=o[S][O];if(A.reg.test(C))return a(A,g,C)}}),p.media=m,p};var u=function(d,p){var m=p.split(/=(.+)/,2);return m.length===2?d[m[0]]=t(m[1]):m.length===1&&p.length>1&&(d[m[0]]=void 0),d};r.parseParams=function(d){return d.split(/;\s?/).reduce(u,{})},r.parseFmtpConfig=r.parseParams,r.parsePayloads=function(d){return d.toString().split(" ").map(Number)},r.parseRemoteCandidates=function(d){for(var p=[],m=d.split(" ").map(t),g=0;g<m.length;g+=3)p.push({component:m[g],ip:m[g+1],port:m[g+2]});return p},r.parseImageAttributes=function(d){return d.split(" ").map(function(p){return p.substring(1,p.length-1).split(",").reduce(u,{})})},r.parseSimulcastStreamList=function(d){return d.split(";").map(function(p){return p.split(",").map(function(m){var g,y=!1;return m[0]!=="~"?g=t(m):(g=t(m.substring(1,m.length)),y=!0),{scid:g,paused:y}})})}})(Pl)),Pl}var Il,Xm;function zT(){if(Xm)return Il;Xm=1;var r=Ll(),t=/%[sdv%]/g,i=function(u){var d=1,p=arguments,m=p.length;return u.replace(t,function(g){if(d>=m)return g;var y=p[d];switch(d+=1,g){case"%%":return"%";case"%s":return String(y);case"%d":return Number(y);case"%v":return""}})},a=function(u,d,p){var m=d.format instanceof Function?d.format(d.push?p:p[d.name]):d.format,g=[u+"="+m];if(d.names)for(var y=0;y<d.names.length;y+=1){var S=d.names[y];d.name?g.push(p[d.name][S]):g.push(p[d.names[y]])}else g.push(p[d.name]);return i.apply(null,g)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],l=["i","c","b","a"];return Il=function(u,d){d=d||{},u.version==null&&(u.version=0),u.name==null&&(u.name=" "),u.media.forEach(function(y){y.payloads==null&&(y.payloads="")});var p=d.outerOrder||o,m=d.innerOrder||l,g=[];return p.forEach(function(y){r[y].forEach(function(S){S.name in u&&u[S.name]!=null?g.push(a(y,S,u)):S.push in u&&u[S.push]!=null&&u[S.push].forEach(function(C){g.push(a(y,S,C))})})}),u.media.forEach(function(y){g.push(a("m",r.m[0],y)),m.forEach(function(S){r[S].forEach(function(C){C.name in y&&y[C.name]!=null?g.push(a(S,C,y)):C.push in y&&y[C.push]!=null&&y[C.push].forEach(function(O){g.push(a(S,C,O))})})})}),g.join(`\r
`)+`\r
`},Il}var Zm;function qT(){if(Zm)return yn;Zm=1;var r=jT(),t=zT(),i=Ll();return yn.grammar=i,yn.write=t,yn.parse=r.parse,yn.parseParams=r.parseParams,yn.parseFmtpConfig=r.parseFmtpConfig,yn.parsePayloads=r.parsePayloads,yn.parseRemoteCandidates=r.parseRemoteCandidates,yn.parseImageAttributes=r.parseImageAttributes,yn.parseSimulcastStreamList=r.parseSimulcastStreamList,yn}var pi=qT();function Bl(r,t,i){var a,o,l;t===void 0&&(t=50),i===void 0&&(i={});var u=(a=i.isImmediate)!=null&&a,d=(o=i.callback)!=null&&o,p=i.maxWait,m=Date.now(),g=[];function y(){if(p!==void 0){var C=Date.now()-m;if(C+t>=p)return p-C}return t}var S=function(){var C=[].slice.call(arguments),O=this;return new Promise(function(A,I){var L=u&&l===void 0;if(l!==void 0&&clearTimeout(l),l=setTimeout(function(){if(l=void 0,m=Date.now(),!u){var K=r.apply(O,C);d&&d(K),g.forEach(function(D){return(0,D.resolve)(K)}),g=[]}},y()),L){var X=r.apply(O,C);return d&&d(X),A(X)}g.push({resolve:A,reject:I})})};return S.cancel=function(C){l!==void 0&&clearTimeout(l),g.forEach(function(O){return(0,O.reject)(C)}),g=[]},S}const VT=.7,FT=20,Ra={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class Wm extends Rn.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var a;super(),this.log=ge,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Bl(o=>T(this,void 0,void 0,function*(){this.emit(Ra.NegotiationStarted);try{yield this.createAndSendOffer()}catch(l){if(o)o(l);else throw l}}),FT),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Ln((a=i.loggerName)!==null&&a!==void 0?a:gn.PCTransport),this.loggerOptions=i,this.config=t,this._pc=this.createPC(),this.offerLock=new Rt}createPC(){const t=new RTCPeerConnection(this.config);return t.onicecandidate=i=>{var a;i.candidate&&((a=this.onIceCandidate)===null||a===void 0||a.call(this,i.candidate))},t.onicecandidateerror=i=>{var a;(a=this.onIceCandidateError)===null||a===void 0||a.call(this,i)},t.oniceconnectionstatechange=()=>{var i;(i=this.onIceConnectionStateChange)===null||i===void 0||i.call(this,t.iceConnectionState)},t.onsignalingstatechange=()=>{var i;(i=this.onSignalingStatechange)===null||i===void 0||i.call(this,t.signalingState)},t.onconnectionstatechange=()=>{var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,t.connectionState)},t.ondatachannel=i=>{var a;(a=this.onDataChannel)===null||a===void 0||a.call(this,i)},t.ontrack=i=>{var a;(a=this.onTrack)===null||a===void 0||a.call(this,i)},t}get logContext(){var t,i;return Object.assign({},(i=(t=this.loggerOptions).loggerContextCb)===null||i===void 0?void 0:i.call(t))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(t){return T(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(t);this.pendingCandidates.push(t)})}setRemoteDescription(t,i){return T(this,void 0,void 0,function*(){var a;if(t.type==="answer"&&this.latestOfferId>0&&i>0&&i!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:i,latestOfferId:this.latestOfferId})),!1;let o;if(t.type==="offer"){let{stereoMids:l,nackMids:u}=HT(t);this.remoteStereoMids=l,this.remoteNackMids=u}else if(t.type==="answer"){const l=pi.parse((a=t.sdp)!==null&&a!==void 0?a:"");l.media.forEach(u=>{const d=jl(u.mid);u.type==="audio"&&this.trackBitrates.some(p=>{if(!p.transceiver||d!=p.transceiver.mid)return!1;let m=0;if(u.rtp.some(y=>y.codec.toUpperCase()===p.codec.toUpperCase()?(m=y.payload,!0):!1),m===0)return!0;let g=!1;for(const y of u.fmtp)if(y.payload===m){y.config=y.config.split(";").filter(S=>!S.includes("maxaveragebitrate")).join(";"),p.maxbr>0&&(y.config+=";maxaveragebitrate=".concat(p.maxbr*1e3)),g=!0;break}return g||p.maxbr>0&&u.fmtp.push({payload:m,config:"maxaveragebitrate=".concat(p.maxbr*1e3)}),!0})}),o=pi.write(l)}return yield this.setMungedSDP(t,o,!0),this.pendingCandidates.forEach(l=>{this.pc.addIceCandidate(l)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):t.type==="answer"&&(this.emit(Ra.NegotiationComplete),t.sdp&&pi.parse(t.sdp).media.forEach(u=>{u.type==="video"&&this.emit(Ra.RTPVideoPayloadTypes,u.rtp)})),!0})}createAndSendOffer(t){return T(this,void 0,void 0,function*(){var i;const a=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(t?.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const d=this._pc.remoteDescription;if(t?.iceRestart&&d)yield this._pc.setRemoteDescription(d);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const o=this.latestOfferId+1;this.latestOfferId=o;const l=yield this.pc.createOffer(t);this.log.debug("original offer",Object.assign({sdp:l.sdp},this.logContext));const u=pi.parse((i=l.sdp)!==null&&i!==void 0?i:"");if(u.media.forEach(d=>{ep(d),d.type==="audio"?$m(d,["all"],[]):d.type==="video"&&this.trackBitrates.some(p=>{if(!d.msid||!p.cid||!d.msid.includes(p.cid))return!1;let m=0;if(d.rtp.some(y=>y.codec.toUpperCase()===p.codec.toUpperCase()?(m=y.payload,!0):!1),m===0||(vn(p.codec)&&!Yi()&&this.ensureVideoDDExtensionForSVC(d,u),!vn(p.codec)))return!0;const g=Math.round(p.maxbr*VT);for(const y of d.fmtp)if(y.payload===m){y.config.includes("x-google-start-bitrate")||(y.config+=";x-google-start-bitrate=".concat(g));break}return!0})}),this.latestOfferId>o){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:o}));return}yield this.setMungedSDP(l,pi.write(u)),this.onOffer(l,this.latestOfferId)}finally{a()}})}createAndSetAnswer(){return T(this,void 0,void 0,function*(){var t;const i=yield this.pc.createAnswer(),a=pi.parse((t=i.sdp)!==null&&t!==void 0?t:"");return a.media.forEach(o=>{ep(o),o.type==="audio"&&$m(o,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(i,pi.write(a)),i})}createDataChannel(t,i){return this.pc.createDataChannel(t,i)}addTransceiver(t,i){return this.pc.addTransceiver(t,i)}addTransceiverOfKind(t,i){return this.pc.addTransceiver(t,i)}addTrack(t){if(!this._pc)throw new ut("PC closed, cannot add track");return this._pc.addTrack(t)}setTrackCodecBitrate(t){this.trackBitrates.push(t)}setConfiguration(t){var i;if(!this._pc)throw new ut("PC closed, cannot configure");return(i=this._pc)===null||i===void 0?void 0:i.setConfiguration(t)}canRemoveTrack(){var t;return!!(!((t=this._pc)===null||t===void 0)&&t.removeTrack)}removeTrack(t){var i;return(i=this._pc)===null||i===void 0?void 0:i.removeTrack(t)}getConnectionState(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.connectionState)!==null&&i!==void 0?i:"closed"}getICEConnectionState(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.iceConnectionState)!==null&&i!==void 0?i:"closed"}getSignallingState(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.signalingState)!==null&&i!==void 0?i:"closed"}getTransceivers(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.getTransceivers())!==null&&i!==void 0?i:[]}getSenders(){var t,i;return(i=(t=this._pc)===null||t===void 0?void 0:t.getSenders())!==null&&i!==void 0?i:[]}getLocalDescription(){var t;return(t=this._pc)===null||t===void 0?void 0:t.localDescription}getRemoteDescription(){var t;return(t=this.pc)===null||t===void 0?void 0:t.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return T(this,void 0,void 0,function*(){var t;if(!this._pc)return;let i="";const a=new Map,o=new Map;if((yield this._pc.getStats()).forEach(d=>{switch(d.type){case"transport":i=d.selectedCandidatePairId;break;case"candidate-pair":i===""&&d.selected&&(i=d.id),a.set(d.id,d);break;case"remote-candidate":o.set(d.id,"".concat(d.address,":").concat(d.port));break}}),i==="")return;const u=(t=a.get(i))===null||t===void 0?void 0:t.remoteCandidateId;if(u!==void 0)return o.get(u)})}setMungedSDP(t,i,a){return T(this,void 0,void 0,function*(){if(i){const o=t.sdp;t.sdp=i;try{this.log.debug("setting munged ".concat(a?"remote":"local"," description"),this.logContext),a?yield this.pc.setRemoteDescription(t):yield this.pc.setLocalDescription(t);return}catch(l){this.log.warn("not able to set ".concat(t.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:l,sdp:i})),t.sdp=o}}try{a?yield this.pc.setRemoteDescription(t):yield this.pc.setLocalDescription(t)}catch(o){let l="unknown error";o instanceof Error?l=o.message:typeof o=="string"&&(l=o);const u={error:l,sdp:t.sdp};throw!a&&this.pc.remoteDescription&&(u.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(t.type),Object.assign(Object.assign({},this.logContext),{fields:u})),new hl(l)}})}ensureVideoDDExtensionForSVC(t,i){var a,o;if(!((a=t.ext)===null||a===void 0?void 0:a.some(u=>u.uri===Mm))){if(this.ddExtID===0){let u=0;i.media.forEach(d=>{var p;d.type==="video"&&((p=d.ext)===null||p===void 0||p.forEach(m=>{m.value>u&&(u=m.value)}))}),this.ddExtID=u+1}(o=t.ext)===null||o===void 0||o.push({value:this.ddExtID,uri:Mm})}}}function $m(r,t,i){const a=jl(r.mid);let o=0;r.rtp.some(l=>l.codec==="opus"?(o=l.payload,!0):!1),o>0&&(r.rtcpFb||(r.rtcpFb=[]),i.includes(a)&&!r.rtcpFb.some(l=>l.payload===o&&l.type==="nack")&&r.rtcpFb.push({payload:o,type:"nack"}),(t.includes(a)||t.length===1&&t[0]==="all")&&r.fmtp.some(l=>l.payload===o?(l.config.includes("stereo=1")||(l.config+=";stereo=1"),!0):!1))}function HT(r){var t;const i=[],a=[],o=pi.parse((t=r.sdp)!==null&&t!==void 0?t:"");let l=0;return o.media.forEach(u=>{var d;const p=jl(u.mid);u.type==="audio"&&(u.rtp.some(m=>m.codec==="opus"?(l=m.payload,!0):!1),!((d=u.rtcpFb)===null||d===void 0)&&d.some(m=>m.payload===l&&m.type==="nack")&&a.push(p),u.fmtp.some(m=>m.payload===l?(m.config.includes("sprop-stereo=1")&&i.push(p),!0):!1))}),{stereoMids:i,nackMids:a}}function ep(r){if(r.connection){const t=r.connection.ip.indexOf(":")>=0;(r.connection.version===4&&t||r.connection.version===6&&!t)&&(r.connection.ip="0.0.0.0",r.connection.version=4)}}function jl(r){return typeof r=="number"?r.toFixed(0):r}const zl="vp8",GT={audioPreset:gl.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:yl.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:zl,backupCodec:!0,preConnectBuffer:!1},tp={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},np={deviceId:{ideal:"default"},resolution:Os.h720.resolution},KT={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new kS,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!1},ql={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Xe;(function(r){r[r.NEW=0]="NEW",r[r.CONNECTING=1]="CONNECTING",r[r.CONNECTED=2]="CONNECTED",r[r.FAILED=3]="FAILED",r[r.CLOSING=4]="CLOSING",r[r.CLOSED=5]="CLOSED"})(Xe||(Xe={}));class YT{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(t,i,a){var o;this.peerConnectionTimeout=ql.peerConnectionTimeout,this.log=ge,this.updateState=()=>{var l,u;const d=this.state,p=this.requiredTransports.map(m=>m.getConnectionState());p.every(m=>m==="connected")?this.state=Xe.CONNECTED:p.some(m=>m==="failed")?this.state=Xe.FAILED:p.some(m=>m==="connecting")?this.state=Xe.CONNECTING:p.every(m=>m==="closed")?this.state=Xe.CLOSED:p.some(m=>m==="closed")?this.state=Xe.CLOSING:p.every(m=>m==="new")&&(this.state=Xe.NEW),d!==this.state&&(this.log.debug("pc state change: from ".concat(Xe[d]," to ").concat(Xe[this.state]),this.logContext),(l=this.onStateChange)===null||l===void 0||l.call(this,this.state,this.publisher.getConnectionState(),(u=this.subscriber)===null||u===void 0?void 0:u.getConnectionState()))},this.log=Ln((o=a.loggerName)!==null&&o!==void 0?o:gn.PCManager),this.loggerOptions=a,this.isPublisherConnectionRequired=i!=="subscriber-primary",this.isSubscriberConnectionRequired=i==="subscriber-primary",this.publisher=new Wm(t,a),i!=="publisher-only"&&(this.subscriber=new Wm(t,a),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=l=>{var u;(u=this.onIceCandidate)===null||u===void 0||u.call(this,l,pn.SUBSCRIBER)},this.subscriber.onDataChannel=l=>{var u;(u=this.onDataChannel)===null||u===void 0||u.call(this,l)},this.subscriber.onTrack=l=>{var u;(u=this.onTrack)===null||u===void 0||u.call(this,l)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=l=>{var u;(u=this.onIceCandidate)===null||u===void 0||u.call(this,l,pn.PUBLISHER)},this.publisher.onTrack=l=>{var u;(u=this.onTrack)===null||u===void 0||u.call(this,l)},this.publisher.onOffer=(l,u)=>{var d;(d=this.onPublisherOffer)===null||d===void 0||d.call(this,l,u)},this.state=Xe.NEW,this.connectionLock=new Rt,this.remoteOfferLock=new Rt}get logContext(){var t,i;return Object.assign({},(i=(t=this.loggerOptions).loggerContextCb)===null||i===void 0?void 0:i.call(t))}requirePublisher(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=t,this.updateState()}createAndSendPublisherOffer(t){return this.publisher.createAndSendOffer(t)}setPublisherAnswer(t,i){return this.publisher.setRemoteDescription(t,i)}removeTrack(t){return this.publisher.removeTrack(t)}close(){return T(this,void 0,void 0,function*(){var t;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const i=this.publisher;for(const a of i.getSenders())try{i.canRemoveTrack()&&i.removeTrack(a)}catch(o){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:o}))}}yield Promise.all([this.publisher.close(),(t=this.subscriber)===null||t===void 0?void 0:t.close()]),this.updateState()})}triggerIceRestart(){return T(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(t,i){return T(this,void 0,void 0,function*(){var a;i===pn.PUBLISHER?yield this.publisher.addIceCandidate(t):yield(a=this.subscriber)===null||a===void 0?void 0:a.addIceCandidate(t)})}createSubscriberAnswerFromOffer(t,i){return T(this,void 0,void 0,function*(){var a,o,l;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:t.type,sdp:t.sdp,signalingState:(a=this.subscriber)===null||a===void 0?void 0:a.getSignallingState().toString()}));const u=yield this.remoteOfferLock.lock();try{return(yield(o=this.subscriber)===null||o===void 0?void 0:o.setRemoteDescription(t,i))?yield(l=this.subscriber)===null||l===void 0?void 0:l.createAndSetAnswer():void 0}finally{u()}})}updateConfiguration(t,i){var a;this.publisher.setConfiguration(t),(a=this.subscriber)===null||a===void 0||a.setConfiguration(t),i&&this.triggerIceRestart()}ensurePCTransportConnection(t,i){return T(this,void 0,void 0,function*(){var a;const o=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((a=this.requiredTransports)===null||a===void 0?void 0:a.map(l=>this.ensureTransportConnected(l,t,i)))}finally{o()}})}negotiate(t){return T(this,void 0,void 0,function*(){return new Promise((i,a)=>T(this,void 0,void 0,function*(){const o=setTimeout(()=>{a("negotiation timed out")},this.peerConnectionTimeout),l=()=>{clearTimeout(o),a("negotiation aborted")};t.signal.addEventListener("abort",l),this.publisher.once(Ra.NegotiationStarted,()=>{t.signal.aborted||this.publisher.once(Ra.NegotiationComplete,()=>{clearTimeout(o),i()})}),yield this.publisher.negotiate(u=>{clearTimeout(o),a(u)})}))})}addPublisherTransceiver(t,i){return this.publisher.addTransceiver(t,i)}addPublisherTransceiverOfKind(t,i){return this.publisher.addTransceiverOfKind(t,i)}getMidForReceiver(t){const a=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(o=>o.receiver===t);return a?.mid}addPublisherTrack(t){return this.publisher.addTrack(t)}createPublisherDataChannel(t,i){return this.publisher.createDataChannel(t,i)}getConnectedAddress(t){return t===pn.PUBLISHER?this.publisher.getConnectedAddress():t===pn.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const t=[];return this.isPublisherConnectionRequired&&t.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&t.push(this.subscriber),t}ensureTransportConnected(t,i){return T(this,arguments,void 0,function(a,o){var l=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(a.getConnectionState()!=="connected")return new Promise((p,m)=>T(l,void 0,void 0,function*(){const g=()=>{this.log.warn("abort transport connection",this.logContext),vt.clearTimeout(y),m(new Ee("room connection has been cancelled",me.Cancelled))};o?.signal.aborted&&g(),o?.signal.addEventListener("abort",g);const y=vt.setTimeout(()=>{o?.signal.removeEventListener("abort",g),m(new Ee("could not establish pc connection",me.InternalError))},u);for(;this.state!==Xe.CONNECTED;)if(yield yt(50),o?.signal.aborted){m(new Ee("room connection has been cancelled",me.Cancelled));return}vt.clearTimeout(y),o?.signal.removeEventListener("abort",g),p()}))})()})}}const ip=5e3,QT=3e4;class we{static fetchRegionSettings(t,i,a){return T(this,void 0,void 0,function*(){const o=yield we.fetchLock.lock();try{const l=yield fetch("".concat(JT(t),"/regions"),{headers:{authorization:"Bearer ".concat(i)},signal:a});if(l.ok){const u=gT(l.headers),d=u?u*1e3:ip;return{regionSettings:yield l.json(),updatedAtInMs:Date.now(),maxAgeInMs:d}}else throw new Ee("Could not fetch region settings: ".concat(l.statusText),l.status===401?me.NotAllowed:me.InternalError,l.status)}catch(l){throw l instanceof Ee?l:a?.aborted?new Ee("Region fetching was aborted",me.Cancelled):new Ee("Could not fetch region settings, ".concat(l instanceof Error?"".concat(l.name,": ").concat(l.message):l),me.ServerUnreachable,500)}finally{o()}})}static scheduleRefetch(t,i,a){return T(this,void 0,void 0,function*(){const o=we.settingsTimeouts.get(t.hostname);clearTimeout(o),we.settingsTimeouts.set(t.hostname,setTimeout(()=>T(this,void 0,void 0,function*(){try{const l=yield we.fetchRegionSettings(t,i);we.updateCachedRegionSettings(t,i,l)}catch(l){if(l instanceof Ee&&l.reason===me.NotAllowed){ge.debug("token is not valid, cancelling auto region refresh");return}ge.debug("auto refetching of region settings failed",{error:l}),we.scheduleRefetch(t,i,a)}}),a))})}static updateCachedRegionSettings(t,i,a){we.cache.set(t.hostname,a),we.scheduleRefetch(t,i,a.maxAgeInMs)}static stopRefetch(t){const i=we.settingsTimeouts.get(t);i&&(clearTimeout(i),we.settingsTimeouts.delete(t))}static scheduleCleanup(t){let i=we.connectionTrackers.get(t);i&&(i.cleanupTimeout&&clearTimeout(i.cleanupTimeout),i.cleanupTimeout=setTimeout(()=>{const a=we.connectionTrackers.get(t);a&&a.connectionCount===0&&(ge.debug("stopping region refetch after disconnect delay",{hostname:t}),we.stopRefetch(t)),a&&(a.cleanupTimeout=void 0)},QT))}static cancelCleanup(t){const i=we.connectionTrackers.get(t);i?.cleanupTimeout&&(clearTimeout(i.cleanupTimeout),i.cleanupTimeout=void 0)}notifyConnected(){const t=this.serverUrl.hostname;let i=we.connectionTrackers.get(t);i||(i={connectionCount:0},we.connectionTrackers.set(t,i)),i.connectionCount++,we.cancelCleanup(t)}notifyDisconnected(){const t=this.serverUrl.hostname,i=we.connectionTrackers.get(t);i&&(i.connectionCount=Math.max(0,i.connectionCount-1),i.connectionCount===0&&we.scheduleCleanup(t))}constructor(t,i){this.attemptedRegions=[],this.serverUrl=new URL(t),this.token=i}updateToken(t){this.token=t}isCloud(){return no(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(t){return T(this,void 0,void 0,function*(){return we.fetchRegionSettings(this.serverUrl,this.token,t)})}getNextBestRegionUrl(t){return T(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let i=we.cache.get(this.serverUrl.hostname);(!i||Date.now()-i.updatedAtInMs>i.maxAgeInMs)&&(i=yield this.fetchRegionSettings(t),we.updateCachedRegionSettings(this.serverUrl,this.token,i));const a=i.regionSettings.regions.filter(o=>!this.attemptedRegions.find(l=>l.url===o.url));if(a.length>0){const o=a[0];return this.attemptedRegions.push(o),ge.debug("next region: ".concat(o.region)),o.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(t){we.updateCachedRegionSettings(this.serverUrl,this.token,t)}}we.cache=new Map,we.settingsTimeouts=new Map,we.connectionTrackers=new Map,we.fetchLock=new Rt;function JT(r){return"".concat(r.protocol.replace("ws","http"),"//").concat(r.host,"/settings")}class Ze extends Error{constructor(t,i,a){super(i),this.code=t,this.message=sp(i,Ze.MAX_MESSAGE_BYTES),this.data=a?sp(a,Ze.MAX_DATA_BYTES):void 0}static fromProto(t){return new Ze(t.code,t.message,t.data)}toProto(){return new mh({code:this.code,message:this.message,data:this.data})}static builtIn(t,i){return new Ze(Ze.ErrorCode[t],Ze.ErrorMessage[t],i)}}Ze.MAX_MESSAGE_BYTES=256,Ze.MAX_DATA_BYTES=15360,Ze.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404},Ze.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const ap=15360;function Vl(r){return new TextEncoder().encode(r).length}function sp(r,t){if(Vl(r)<=t)return r;let i=0,a=r.length;const o=new TextEncoder;for(;i<a;){const l=Math.floor((i+a+1)/2);o.encode(r.slice(0,l)).length<=t?i=l:a=l-1}return r.slice(0,i)}const Fl=2e3;function ao(r,t){if(!t)return 0;let i,a;return"bytesReceived"in r?(i=r.bytesReceived,a=t.bytesReceived):"bytesSent"in r&&(i=r.bytesSent,a=t.bytesSent),i===void 0||a===void 0||r.timestamp===void 0||t.timestamp===void 0?0:(i-a)*8*1e3/(r.timestamp-t.timestamp)}const Hl=typeof MediaRecorder<"u";class XT{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const ZT=Hl?MediaRecorder:XT;class WT extends ZT{constructor(t,i){if(!Hl)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([t.mediaStreamTrack]),i);let a,o;const l=()=>o===void 0,u=()=>{this.removeEventListener("dataavailable",a),this.removeEventListener("stop",u),this.removeEventListener("error",d),o?.close(),o=void 0},d=p=>{o?.error(p),this.removeEventListener("dataavailable",a),this.removeEventListener("stop",u),this.removeEventListener("error",d),o=void 0};this.byteStream=new ReadableStream({start:p=>{o=p,a=m=>T(this,void 0,void 0,function*(){let g;if(m.data.arrayBuffer){const y=yield m.data.arrayBuffer();g=new Uint8Array(y)}else if(m.data.byteArray)g=m.data.byteArray;else throw new Error("no data available!");l()||p.enqueue(g)}),this.addEventListener("dataavailable",a)},cancel:()=>{u()}}),this.addEventListener("stop",u),this.addEventListener("error",d)}}function $T(){return Hl}const eC=1e3,tC=1e4;class rp extends H{get sender(){return this._sender}set sender(t){this._sender=t}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(t,i,a){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=arguments.length>4?arguments[4]:void 0;super(t,i,l),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Bl(()=>T(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>T(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(J.Ended,this)},this.reacquireTrack=!1,this.providedByUser=o,this.muteLock=new Rt,this.pauseUpstreamLock=new Rt,this.trackChangeLock=new Rt,this.trackChangeLock.lock().then(u=>T(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(t,!0)}finally{u()}})),this._constraints=t.getConstraints(),a&&(this._constraints=a)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==H.Kind.Video)return;const{width:t,height:i}=this._mediaStreamTrack.getSettings();if(t&&i)return{width:t,height:i}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var t,i;return(i=(t=this.processor)===null||t===void 0?void 0:t.processedTrack)!==null&&i!==void 0?i:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(t,i){return T(this,void 0,void 0,function*(){var a;if(t===this._mediaStreamTrack&&!i)return;this._mediaStreamTrack&&(this.attachedElements.forEach(l=>{Ca(this._mediaStreamTrack,l)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([t]),t&&(t.addEventListener("ended",this.handleEnded),t.addEventListener("mute",this.handleTrackMuteEvent),t.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=t.getConstraints());let o;if(this.processor&&t){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Ta(t,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:t,kind:this.kind,element:this.processorElement}),o=this.processor.processedTrack}this.sender&&((a=this.sender.transport)===null||a===void 0?void 0:a.state)!=="closed"&&(yield this.sender.replaceTrack(o??t)),!this.providedByUser&&this._mediaStreamTrack!==t&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=t,t&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(l=>{Ta(o??t,l)}))})}waitForDimensions(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:eC;return(function*(){var a;if(t.kind===H.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((a=xt())===null||a===void 0?void 0:a.os)==="iOS"&&(yield yt(10));const o=Date.now();for(;Date.now()-o<i;){const l=t.dimensions;if(l)return l;yield yt(50)}throw new jn("unable to get track dimensions after timeout")})()})}setDeviceId(t){return T(this,void 0,void 0,function*(){return this._constraints.deviceId===t&&this._mediaStreamTrack.getSettings().deviceId===fi(t)||(this._constraints.deviceId=t,this.isMuted)?!0:(yield this.restartTrack(),fi(t)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(t.source===H.Source.ScreenShare)return;const{deviceId:a,groupId:o}=t._mediaStreamTrack.getSettings(),l=t.kind===H.Kind.Audio?"audioinput":"videoinput";return i?ht.getInstance().normalizeDeviceId(l,a,o):a})()})}mute(){return T(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return T(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(t,i){return T(this,void 0,void 0,function*(){const a=yield this.trackChangeLock.lock();try{if(!this.sender)throw new jn("unable to replace an unpublished track");let o,l;return typeof i=="boolean"?o=i:i!==void 0&&(o=i.userProvidedTrack,l=i.stopProcessor),this.providedByUser=o??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(t),l&&this.processor&&(yield this.internalStopProcessor()),this}finally{a()}})}restart(t){return T(this,void 0,void 0,function*(){this.manuallyStopped=!1;const i=yield this.trackChangeLock.lock();try{t||(t=this._constraints);const{deviceId:a,facingMode:o}=t,l=ES(t,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:t}));const u={audio:!1,video:!1};this.kind===H.Kind.Video?u.video=a||o?{deviceId:a,facingMode:o}:!0:u.audio=a?Object.assign({deviceId:a},l):!0,this.attachedElements.forEach(m=>{Ca(this.mediaStreamTrack,m)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const p=(yield navigator.mediaDevices.getUserMedia(u)).getTracks()[0];return this.kind===H.Kind.Video&&(yield p.applyConstraints(l)),p.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(p),this._constraints=t,this.emit(J.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{i()}})}setTrackMuted(t){this.log.debug("setting ".concat(this.kind," track ").concat(t?"muted":"unmuted"),this.logContext),!(this.isMuted===t&&this._mediaStreamTrack.enabled!==t)&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?J.Muted:J.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),Nm()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var t;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(t=this.processor)===null||t===void 0||t.destroy(),this.processor=void 0}pauseUpstream(){return T(this,void 0,void 0,function*(){var t;const i=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(J.UpstreamPaused,this);const a=xt();if(a?.name==="Safari"&&An(a.version,"12.0")<0)throw new fl("pauseUpstream is not supported on Safari < 12.");((t=this.sender.transport)===null||t===void 0?void 0:t.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{i()}})}resumeUpstream(){return T(this,void 0,void 0,function*(){var t;const i=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(J.UpstreamResumed,this),((t=this.sender.transport)===null||t===void 0?void 0:t.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{i()}})}getRTCStatsReport(){return T(this,void 0,void 0,function*(){var t;return!((t=this.sender)===null||t===void 0)&&t.getStats?yield this.sender.getStats():void 0})}setProcessor(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var l;const u=yield a.trackChangeLock.lock();try{a.log.debug("setting up processor",a.logContext);const d=document.createElement(a.kind),p={kind:a.kind,track:a._mediaStreamTrack,element:d,audioContext:a.audioContext};if(yield i.init(p),a.log.debug("processor initialized",a.logContext),a.processor&&(yield a.internalStopProcessor()),a.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(Ta(a._mediaStreamTrack,d),d.muted=!0,d.play().catch(m=>{m instanceof DOMException&&m.name==="AbortError"?(a.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},a.logContext),{error:m})),setTimeout(()=>{d.play().catch(g=>{a.log.error("failed to play processor element",Object.assign(Object.assign({},a.logContext),{err:g}))})},100)):a.log.error("failed to play processor element",Object.assign(Object.assign({},a.logContext),{error:m}))}),a.processor=i,a.processorElement=d,a.processor.processedTrack){for(const m of a.attachedElements)m!==a.processorElement&&o&&(Ca(a._mediaStreamTrack,m),Ta(a.processor.processedTrack,m));yield(l=a.sender)===null||l===void 0?void 0:l.replaceTrack(a.processor.processedTrack)}a.emit(J.TrackProcessorUpdate,a.processor)}finally{u()}})()})}getProcessor(){return this.processor}stopProcessor(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const a=yield t.trackChangeLock.lock();try{yield t.internalStopProcessor(i)}finally{a()}})()})}internalStopProcessor(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var a,o;t.processor&&(t.log.debug("stopping processor",t.logContext),(a=t.processor.processedTrack)===null||a===void 0||a.stop(),yield t.processor.destroy(),t.processor=void 0,i||((o=t.processorElement)===null||o===void 0||o.remove(),t.processorElement=void 0),yield t._mediaStreamTrack.applyConstraints(t._constraints),yield t.setMediaStreamTrack(t._mediaStreamTrack,!0),t.emit(J.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!$T()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let i="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(i)||(i="video/mp4"),this.localTrackRecorder=new WT(this,{mimeType:i})}this.localTrackRecorder.start(t),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},tC)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var t;return(t=this.localTrackRecorder)===null||t===void 0?void 0:t.byteStream}getPreConnectBufferMimeType(){var t;return(t=this.localTrackRecorder)===null||t===void 0?void 0:t.mimeType}}class so extends rp{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,o=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0;super(t,H.Kind.Audio,i,a,l),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>T(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let u;try{u=yield this.getSenderStats()}catch(d){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:d}));return}u&&this.prevStats&&(this._currentBitrate=ao(u,this.prevStats)),this.prevStats=u}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(J.AudioTrackFeatureUpdate,this,ft.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(J.AudioTrackFeatureUpdate,this,ft.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=o,this.checkForSilence()}mute(){const t=Object.create(null,{mute:{get:()=>super.mute}});return T(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===H.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield t.mute.call(this),this)}finally{i()}})}unmute(){const t=Object.create(null,{unmute:{get:()=>super.unmute}});return T(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const a=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==fi(this._constraints.deviceId);return this.source===H.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||a)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield t.unmute.call(this),this}finally{i()}})}restartTrack(t){return T(this,void 0,void 0,function*(){let i;if(t){const a=Dl({audio:t});typeof a.audio!="boolean"&&(i=a.audio)}yield this.restart(i)})}restart(t){const i=Object.create(null,{restart:{get:()=>super.restart}});return T(this,void 0,void 0,function*(){const a=yield i.restart.call(this,t);return this.checkForSilence(),a})}startMonitor(){Pt()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Fl)))}setProcessor(t){return T(this,void 0,void 0,function*(){var i;const a=yield this.trackChangeLock.lock();try{if(!On()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const o={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(t.name),this.logContext),yield t.init(o),this.processor=t,this.processor.processedTrack&&(yield(i=this.sender)===null||i===void 0?void 0:i.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(J.TrackProcessorUpdate,this.processor)}finally{a()}})}setAudioContext(t){this.audioContext=t}getSenderStats(){return T(this,void 0,void 0,function*(){var t;if(!(!((t=this.sender)===null||t===void 0)&&t.getStats))return;const i=yield this.sender.getStats();let a;return i.forEach(o=>{o.type==="outbound-rtp"&&(a={type:"audio",streamId:o.id,packetsSent:o.packetsSent,packetsLost:o.packetsLost,bytesSent:o.bytesSent,timestamp:o.timestamp,roundTripTime:o.roundTripTime,jitter:o.jitter})}),a})}checkForSilence(){return T(this,void 0,void 0,function*(){const t=yield qm(this);return t&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(J.AudioSilenceDetected)),t})}}function nC(r,t,i){switch(r.kind){case"audio":return new so(r,t,!1,void 0,i);case"video":return new ro(r,t,!1,i);default:throw new jn("unsupported track type: ".concat(r.kind))}}const iC=Object.values(Os),aC=Object.values(vl),sC=Object.values(yl),rC=[Os.h180,Os.h360],oC=[vl.h180,vl.h360],cC=r=>[{scaleResolutionDownBy:2,fps:r.encoding.maxFramerate}].map(i=>{var a,o;return new Be(Math.floor(r.width/i.scaleResolutionDownBy),Math.floor(r.height/i.scaleResolutionDownBy),Math.max(15e4,Math.floor(r.encoding.maxBitrate/(Math.pow(i.scaleResolutionDownBy,2)*(((a=r.encoding.maxFramerate)!==null&&a!==void 0?a:30)/((o=i.fps)!==null&&o!==void 0?o:30))))),i.fps,r.encoding.priority)}),Gl=["q","h","f"];function Kl(r,t,i,a){var o,l;let u=a?.videoEncoding;r&&(u=a?.screenShareEncoding);const d=a?.simulcast,p=a?.scalabilityMode,m=a?.videoCodec;if(!u&&!d&&!p||!t||!i)return[{}];u||(u=uC(r,t,i,m),ge.debug("using video encoding",u));const g=u.maxFramerate,y=new Be(t,i,u.maxBitrate,u.maxFramerate,u.priority);if(p&&vn(m)){const O=new lp(p),A=[];if(O.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(p));const I=xt();if(As()||On()||I?.name==="Chrome"&&An(I?.version,"113")<0){const L=O.suffix=="h"?2:3,X=iT(I);for(let K=0;K<O.spatial;K+=1)A.push({rid:Gl[2-K],maxBitrate:u.maxBitrate/Math.pow(L,K),maxFramerate:y.encoding.maxFramerate,scaleResolutionDownBy:X?Math.pow(2,K):void 0});A[0].scalabilityMode=p}else A.push({maxBitrate:u.maxBitrate,maxFramerate:y.encoding.maxFramerate,scalabilityMode:p});return y.encoding.priority&&(A[0].priority=y.encoding.priority,A[0].networkPriority=y.encoding.priority),ge.debug("using svc encoding",{encodings:A}),A}if(!d)return[u];let S=[];r?S=(o=cp(a?.screenShareSimulcastLayers))!==null&&o!==void 0?o:op(r,y):S=(l=cp(a?.videoSimulcastLayers))!==null&&l!==void 0?l:op(r,y);let C;if(S.length>0){const O=S[0];S.length>1&&([,C]=S);const A=Math.max(t,i);if(A>=960&&C)return Yl(t,i,[O,C,y],g);if(A>=480)return Yl(t,i,[O,y],g)}return Yl(t,i,[y])}function lC(r,t,i){var a,o,l,u;if(!i.backupCodec||i.backupCodec===!0||i.backupCodec.codec===i.videoCodec)return;t!==i.backupCodec.codec&&ge.warn("requested a different codec than specified as backup",{serverRequested:t,backup:i.backupCodec.codec}),i.videoCodec=t,i.videoEncoding=i.backupCodec.encoding;const d=r.mediaStreamTrack.getSettings(),p=(a=d.width)!==null&&a!==void 0?a:(o=r.dimensions)===null||o===void 0?void 0:o.width,m=(l=d.height)!==null&&l!==void 0?l:(u=r.dimensions)===null||u===void 0?void 0:u.height;return r.source===H.Source.ScreenShare&&i.simulcast&&(i.simulcast=!1),Kl(r.source===H.Source.ScreenShare,p,m,i)}function uC(r,t,i,a){const o=dC(r,t,i);let{encoding:l}=o[0];const u=Math.max(t,i);for(let d=0;d<o.length;d+=1){const p=o[d];if(l=p.encoding,p.width>=u)break}if(a)switch(a){case"av1":case"h265":l=Object.assign({},l),l.maxBitrate=l.maxBitrate*.7;break;case"vp9":l=Object.assign({},l),l.maxBitrate=l.maxBitrate*.85;break}return l}function dC(r,t,i){if(r)return sC;const a=t>i?t/i:i/t;return Math.abs(a-16/9)<Math.abs(a-4/3)?iC:aC}function op(r,t){if(r)return cC(t);const{width:i,height:a}=t,o=i>a?i/a:a/i;return Math.abs(o-16/9)<Math.abs(o-4/3)?rC:oC}function Yl(r,t,i,a){const o=[];if(i.forEach((l,u)=>{if(u>=Gl.length)return;const d=Math.min(r,t),m={rid:Gl[u],scaleResolutionDownBy:Math.max(1,d/Math.min(l.width,l.height)),maxBitrate:l.encoding.maxBitrate},g=a&&l.encoding.maxFramerate?Math.min(a,l.encoding.maxFramerate):l.encoding.maxFramerate;g&&(m.maxFramerate=g);const y=Ki()||u===0;l.encoding.priority&&y&&(m.priority=l.encoding.priority,m.networkPriority=l.encoding.priority),o.push(m)}),On()&&Pm()==="ios"){let l;o.forEach(d=>{l?d.maxFramerate&&d.maxFramerate>l&&(l=d.maxFramerate):l=d.maxFramerate});let u=!0;o.forEach(d=>{var p;d.maxFramerate!=l&&(u&&(u=!1,ge.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),ge.info('Setting framerate of encoding "'.concat((p=d.rid)!==null&&p!==void 0?p:"",'" to ').concat(l)),d.maxFramerate=l)})}return o}function cp(r){if(r)return r.sort((t,i)=>{const{encoding:a}=t,{encoding:o}=i;return a.maxBitrate>o.maxBitrate?1:a.maxBitrate<o.maxBitrate?-1:a.maxBitrate===o.maxBitrate&&a.maxFramerate&&o.maxFramerate?a.maxFramerate>o.maxFramerate?1:-1:0})}class lp{constructor(t){const i=t.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!i)throw new Error("invalid scalability mode");if(this.spatial=parseInt(i[1]),this.temporal=parseInt(i[2]),i.length>3)switch(i[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=i[3]}}toString(){var t;return"L".concat(this.spatial,"T").concat(this.temporal).concat((t=this.suffix)!==null&&t!==void 0?t:"")}}function fC(r){return r.source===H.Source.ScreenShare||r.constraints.height&&fi(r.constraints.height)>=1080?"maintain-resolution":"balanced"}const hC=5e3;class ro extends rp{get sender(){return this._sender}set sender(t){this._sender=t,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,o=arguments.length>3?arguments[3]:void 0;super(t,H.Kind.Video,i,a,o),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>T(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let l;try{l=yield this.getSenderStats()}catch(p){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:p}));return}const u=new Map(l.map(p=>[p.rid,p])),d=l.some(p=>p.qualityLimitationReason==="cpu");if(d!==this.isCpuConstrained&&(this.isCpuConstrained=d,this.isCpuConstrained&&this.emit(J.CpuConstrained)),this.prevStats){let p=0;u.forEach((m,g)=>{var y;const S=(y=this.prevStats)===null||y===void 0?void 0:y.get(g);p+=ao(m,S)}),this._currentBitrate=p}this.prevStats=u}),this.senderLock=new Rt}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(t){var i;if(this.signalClient=t,!Pt())return;const a=(i=this.sender)===null||i===void 0?void 0:i.getParameters();a&&(this.encodings=a.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Fl))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(t=>{t.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const t=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return T(this,void 0,void 0,function*(){var i,a,o,l,u;yield t.pauseUpstream.call(this);try{for(var d=!0,p=In(this.simulcastCodecs.values()),m;m=yield p.next(),i=m.done,!i;d=!0)l=m.value,d=!1,yield(u=l.sender)===null||u===void 0?void 0:u.replaceTrack(null)}catch(g){a={error:g}}finally{try{!d&&!i&&(o=p.return)&&(yield o.call(p))}finally{if(a)throw a.error}}})}resumeUpstream(){const t=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return T(this,void 0,void 0,function*(){var i,a,o,l,u;yield t.resumeUpstream.call(this);try{for(var d=!0,p=In(this.simulcastCodecs.values()),m;m=yield p.next(),i=m.done,!i;d=!0){l=m.value,d=!1;const g=l;yield(u=g.sender)===null||u===void 0?void 0:u.replaceTrack(g.mediaStreamTrack)}}catch(g){a={error:g}}finally{try{!d&&!i&&(o=p.return)&&(yield o.call(p))}finally{if(a)throw a.error}}})}mute(){const t=Object.create(null,{mute:{get:()=>super.mute}});return T(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===H.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield t.mute.call(this),this)}finally{i()}})}unmute(){const t=Object.create(null,{unmute:{get:()=>super.unmute}});return T(this,void 0,void 0,function*(){const i=yield this.muteLock.lock();try{return this.isMuted?(this.source===H.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield t.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{i()}})}setTrackMuted(t){super.setTrackMuted(t);for(const i of this.simulcastCodecs.values())i.mediaStreamTrack.enabled=!t}getSenderStats(){return T(this,void 0,void 0,function*(){var t;if(!(!((t=this.sender)===null||t===void 0)&&t.getStats))return[];const i=[],a=yield this.sender.getStats();return a.forEach(o=>{var l;if(o.type==="outbound-rtp"){const u={type:"video",streamId:o.id,frameHeight:o.frameHeight,frameWidth:o.frameWidth,framesPerSecond:o.framesPerSecond,framesSent:o.framesSent,firCount:o.firCount,pliCount:o.pliCount,nackCount:o.nackCount,packetsSent:o.packetsSent,bytesSent:o.bytesSent,qualityLimitationReason:o.qualityLimitationReason,qualityLimitationDurations:o.qualityLimitationDurations,qualityLimitationResolutionChanges:o.qualityLimitationResolutionChanges,rid:(l=o.rid)!==null&&l!==void 0?l:o.id,retransmittedPacketsSent:o.retransmittedPacketsSent,targetBitrate:o.targetBitrate,timestamp:o.timestamp},d=a.get(o.remoteId);d&&(u.jitter=d.jitter,u.packetsLost=d.packetsLost,u.roundTripTime=d.roundTripTime),i.push(u)}}),i.sort((o,l)=>{var u,d;return((u=l.frameWidth)!==null&&u!==void 0?u:0)-((d=o.frameWidth)!==null&&d!==void 0?d:0)}),i})}setPublishingQuality(t){const i=[];for(let a=Vt.LOW;a<=Vt.HIGH;a+=1)i.push(new $c({quality:a,enabled:a<=t}));this.log.debug("setting publishing quality. max quality ".concat(t),this.logContext),this.setPublishingLayers(vn(this.codec),i)}restartTrack(t){return T(this,void 0,void 0,function*(){var i,a,o,l,u;let d;if(t){const y=Dl({video:t});typeof y.video!="boolean"&&(d=y.video)}yield this.restart(d),this.isCpuConstrained=!1;try{for(var p=!0,m=In(this.simulcastCodecs.values()),g;g=yield m.next(),i=g.done,!i;p=!0){l=g.value,p=!1;const y=l;y.sender&&((u=y.sender.transport)===null||u===void 0?void 0:u.state)!=="closed"&&(y.mediaStreamTrack=this.mediaStreamTrack.clone(),yield y.sender.replaceTrack(y.mediaStreamTrack))}}catch(y){a={error:y}}finally{try{!p&&!i&&(o=m.return)&&(yield o.call(m))}finally{if(a)throw a.error}}})}setProcessor(t){const i=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return T(this,arguments,void 0,function(a){var o=this;let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var u,d,p,m,g,y;if(yield i.setProcessor.call(o,a,l),!((g=o.processor)===null||g===void 0)&&g.processedTrack)try{for(var S=!0,C=In(o.simulcastCodecs.values()),O;O=yield C.next(),u=O.done,!u;S=!0)m=O.value,S=!1,yield(y=m.sender)===null||y===void 0?void 0:y.replaceTrack(o.processor.processedTrack)}catch(A){d={error:A}}finally{try{!S&&!u&&(p=C.return)&&(yield p.call(C))}finally{if(d)throw d.error}}})()})}setDegradationPreference(t){return T(this,void 0,void 0,function*(){if(this.degradationPreference=t,this.sender)try{this.log.debug("setting degradationPreference to ".concat(t),this.logContext);const i=this.sender.getParameters();i.degradationPreference=t,this.sender.setParameters(i)}catch(i){this.log.warn("failed to set degradationPreference",Object.assign({error:i},this.logContext))}})}addSimulcastTrack(t,i){if(this.simulcastCodecs.has(t)){this.log.error("".concat(t," already added, skipping adding simulcast codec"),this.logContext);return}const a={codec:t,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:i};return this.simulcastCodecs.set(t,a),a}setSimulcastTrackSender(t,i){const a=this.simulcastCodecs.get(t);a&&(a.sender=i,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},hC))}setPublishingCodecs(t){return T(this,void 0,void 0,function*(){var i,a,o,l,u,d,p;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:t,currentCodec:this.codec})),!this.codec&&t.length>0)return yield this.setPublishingLayers(vn(t[0].codec),t[0].qualities),[];this.subscribedCodecs=t;const m=[];try{for(i=!0,a=In(t);o=yield a.next(),l=o.done,!l;i=!0){p=o.value,i=!1;const g=p;if(!this.codec||this.codec===g.codec)yield this.setPublishingLayers(vn(g.codec),g.qualities);else{const y=this.simulcastCodecs.get(g.codec);if(this.log.debug("try setPublishingCodec for ".concat(g.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:y})),!y||!y.sender){for(const S of g.qualities)if(S.enabled){m.push(g.codec);break}}else y.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(g.codec),this.logContext),yield up(y.sender,y.encodings,g.qualities,this.senderLock,vn(g.codec),this.log,this.logContext))}}}catch(g){u={error:g}}finally{try{!i&&!l&&(d=a.return)&&(yield d.call(a))}finally{if(u)throw u.error}}return m})}setPublishingLayers(t,i){return T(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:i}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:i})),!(!this.sender||!this.encodings)&&(yield up(this.sender,this.encodings,i,this.senderLock,t,this.log,this.logContext))})}prioritizePerformance(){return T(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const t=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const i=this.sender.getParameters();i.encodings=i.encodings.map((a,o)=>{var l;return Object.assign(Object.assign({},a),{active:o===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((l=this.mediaStreamTrack.getSettings().height)!==null&&l!==void 0?l:360)/360)),scalabilityMode:o===0&&vn(this.codec)?"L1T3":void 0,maxFramerate:o===0?15:0,maxBitrate:o===0?a.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:i.encodings})),this.encodings=i.encodings,yield this.sender.setParameters(i)}catch(i){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:i})),this.optimizeForPerformance=!1}finally{t()}})}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),Nm()&&this.isInBackground&&this.source===H.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function up(r,t,i,a,o,l,u){return T(this,void 0,void 0,function*(){const d=yield a.lock();l.debug("setPublishingLayersForSender",Object.assign(Object.assign({},u),{sender:r,qualities:i,senderEncodings:t}));try{const p=r.getParameters(),{encodings:m}=p;if(!m)return;if(m.length!==t.length){l.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},u),{encodings:m,senderEncodings:t}));return}let g=!1;!1&&m[0].scalabilityMode||(o&&i.some(C=>C.enabled)&&i.forEach(C=>C.enabled=!0),m.forEach((S,C)=>{var O;let A=(O=S.rid)!==null&&O!==void 0?O:"";A===""&&(A="q");const I=dp(A),L=i.find(X=>X.quality===I);L&&S.active!==L.enabled&&(g=!0,S.active=L.enabled,l.debug("setting layer ".concat(L.quality," to ").concat(S.active?"enabled":"disabled"),u),Ki()&&(L.enabled?(S.scaleResolutionDownBy=t[C].scaleResolutionDownBy,S.maxBitrate=t[C].maxBitrate,S.maxFrameRate=t[C].maxFrameRate):(S.scaleResolutionDownBy=4,S.maxBitrate=10,S.maxFrameRate=2)))})),g&&(p.encodings=m,l.debug("setting encodings",Object.assign(Object.assign({},u),{encodings:p.encodings})),yield r.setParameters(p))}finally{d()}})}function dp(r){switch(r){case"f":return Vt.HIGH;case"h":return Vt.MEDIUM;case"q":return Vt.LOW;default:return Vt.HIGH}}function fp(r,t,i,a){if(!i)return[new ci({quality:Vt.HIGH,width:r,height:t,bitrate:0,ssrc:0})];if(a){const o=i[0].scalabilityMode,l=new lp(o),u=[],d=l.suffix=="h"?1.5:2,p=l.suffix=="h"?2:3;for(let m=0;m<l.spatial;m+=1)u.push(new ci({quality:Math.min(Vt.HIGH,l.spatial-1)-m,width:Math.ceil(r/Math.pow(d,m)),height:Math.ceil(t/Math.pow(d,m)),bitrate:i[0].maxBitrate?Math.ceil(i[0].maxBitrate/Math.pow(p,m)):0,ssrc:0}));return u}return i.map(o=>{var l,u,d;const p=(l=o.scaleResolutionDownBy)!==null&&l!==void 0?l:1;let m=dp((u=o.rid)!==null&&u!==void 0?u:"");return new ci({quality:m,width:Math.ceil(r/p),height:Math.ceil(t/p),bitrate:(d=o.maxBitrate)!==null&&d!==void 0?d:0,ssrc:0})})}const hp="_lossy",mp="_reliable",mC=2*1e3,Ql="leave-reconnect",pC=3e4;var tn;(function(r){r[r.New=0]="New",r[r.Connected=1]="Connected",r[r.Disconnected=2]="Disconnected",r[r.Reconnecting=3]="Reconnecting",r[r.Closed=4]="Closed"})(tn||(tn={}));class gC extends Rn.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(t){var i;super(),this.options=t,this.rtcConfig={},this.peerConnectionTimeout=ql.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=tn.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=ge,this.reliableDataSequence=1,this.reliableMessageBuffer=new Ym,this.reliableReceivedState=new BT(pC),this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=a=>T(this,[a],void 0,function(o){var l=this;let{channel:u}=o;return(function*(){if(u){if(u.label===mp)l.reliableDCSub=u;else if(u.label===hp)l.lossyDCSub=u;else return;l.log.debug("on data channel ".concat(u.id,", ").concat(u.label),l.logContext),u.onmessage=l.handleDataMessage}})()}),this.handleDataMessage=a=>T(this,void 0,void 0,function*(){var o,l,u,d,p;const m=yield this.dataProcessLock.lock();try{let g;if(a.data instanceof ArrayBuffer)g=a.data;else if(a.data instanceof Blob)g=yield a.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:a.data}));return}const y=Ot.fromBinary(new Uint8Array(g));if(y.sequence>0&&y.participantSid!==""){const S=this.reliableReceivedState.get(y.participantSid);if(S&&y.sequence<=S)return;this.reliableReceivedState.set(y.participantSid,y.sequence)}if(((o=y.value)===null||o===void 0?void 0:o.case)==="speaker")this.emit(Z.ActiveSpeakersUpdate,y.value.value.speakers);else if(((l=y.value)===null||l===void 0?void 0:l.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const S=yield(u=this.e2eeManager)===null||u===void 0?void 0:u.handleEncryptedData(y.value.value.encryptedValue,y.value.value.iv,y.participantIdentity,y.value.value.keyIndex),C=dh.fromBinary(S.payload),O=new Ot({value:C.value,participantIdentity:y.participantIdentity,participantSid:y.participantSid});((d=O.value)===null||d===void 0?void 0:d.case)==="user"&&pp(O,O.value.value),this.emit(Z.DataPacketReceived,O,y.value.value.encryptionType)}else((p=y.value)===null||p===void 0?void 0:p.case)==="user"&&pp(y,y.value.value),this.emit(Z.DataPacketReceived,y,lt.NONE)}finally{m()}}),this.handleDataError=a=>{const l=a.currentTarget.maxRetransmits===0?"lossy":"reliable";if(a instanceof ErrorEvent&&a.error){const{error:u}=a.error;this.log.error("DataChannel error on ".concat(l,": ").concat(a.message),Object.assign(Object.assign({},this.logContext),{error:u}))}else this.log.error("Unknown DataChannel error on ".concat(l),Object.assign(Object.assign({},this.logContext),{event:a}))},this.handleBufferedAmountLow=a=>{const l=a.currentTarget.maxRetransmits===0?be.LOSSY:be.RELIABLE;this.updateAndEmitDCBufferStatus(l)},this.handleDisconnect=(a,o)=>{if(this._isClosed)return;this.log.warn("".concat(a," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const l=p=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(p,"ms. giving up"),this.logContext),this.emit(Z.Disconnected),this.close()},u=Date.now()-this.reconnectStart;let d=this.getNextRetryDelay({elapsedMs:u,retryCount:this.reconnectAttempts});if(d===null){l(u);return}a===Ql&&(d=0),this.log.debug("reconnecting in ".concat(d,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=vt.setTimeout(()=>this.attemptReconnect(o).finally(()=>this.reconnectTimeout=void 0),d)},this.waitForRestarted=()=>new Promise((a,o)=>{this.pcState===tn.Connected&&a();const l=()=>{this.off(Z.Disconnected,u),a()},u=()=>{this.off(Z.Restarted,l),o()};this.once(Z.Restarted,l),this.once(Z.Disconnected,u)}),this.updateAndEmitDCBufferStatus=a=>{if(a===be.RELIABLE){const l=this.dataChannelForKind(a);l&&this.reliableMessageBuffer.alignBufferedAmount(l.bufferedAmount)}const o=this.isBufferStatusLow(a);typeof o<"u"&&o!==this.dcBufferStatus.get(a)&&(this.dcBufferStatus.set(a,o),this.emit(Z.DCBufferStatusChanged,o,a))},this.isBufferStatusLow=a=>{const o=this.dataChannelForKind(a);if(o)return o.bufferedAmount<=o.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>T(this,void 0,void 0,function*(){!this.url||!(yield fetch(Ms(this.url),{method:"HEAD"}).then(o=>o.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===Ve.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===Ve.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(Fi.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>T(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(Ms(this.url),{method:"HEAD"}),yt(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=Ln((i=t.loggerName)!==null&&i!==void 0?i:gn.Engine),this.loggerOptions={loggerName:t.loggerName,loggerContextCb:()=>this.logContext},this.client=new xl(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new Rt,this.dataProcessLock=new Rt,this.dcBufferStatus=new Map([[be.LOSSY,!0],[be.RELIABLE,!0]]),this.client.onParticipantUpdate=a=>this.emit(Z.ParticipantUpdate,a),this.client.onConnectionQuality=a=>this.emit(Z.ConnectionQualityUpdate,a),this.client.onRoomUpdate=a=>this.emit(Z.RoomUpdate,a),this.client.onSubscriptionError=a=>this.emit(Z.SubscriptionError,a),this.client.onSubscriptionPermissionUpdate=a=>this.emit(Z.SubscriptionPermissionUpdate,a),this.client.onSpeakersChanged=a=>this.emit(Z.SpeakersChanged,a),this.client.onStreamStateUpdate=a=>this.emit(Z.StreamStateChanged,a),this.client.onRequestResponse=a=>this.emit(Z.SignalRequestResponse,a)}get logContext(){var t,i,a,o,l,u;return{room:(i=(t=this.latestJoinResponse)===null||t===void 0?void 0:t.room)===null||i===void 0?void 0:i.name,roomID:(o=(a=this.latestJoinResponse)===null||a===void 0?void 0:a.room)===null||o===void 0?void 0:o.sid,participant:(u=(l=this.latestJoinResponse)===null||l===void 0?void 0:l.participant)===null||u===void 0?void 0:u.identity,pID:this.participantSid}}join(t,i,a,o){return T(this,void 0,void 0,function*(){this.url=t,this.token=i,this.signalOpts=a,this.maxJoinAttempts=a.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const l=yield this.client.join(t,i,a,o);return this._isClosed=!1,this.latestJoinResponse=l,this.subscriberPrimary=l.subscriberPrimary,this.pcManager||(yield this.configure(l)),(!this.subscriberPrimary||l.fastPublish)&&this.negotiate().catch(u=>{ge.error(u,this.logContext)}),this.registerOnLineListener(),this.clientConfiguration=l.clientConfiguration,this.emit(Z.SignalConnected,l),l}catch(l){if(l instanceof Ee&&l.reason===me.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(t,i,a,o);throw l}})}close(){return T(this,void 0,void 0,function*(){const t=yield this.closingLock.lock();if(this.isClosed){t();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(Z.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{t()}})}cleanupPeerConnections(){return T(this,void 0,void 0,function*(){var t;yield(t=this.pcManager)===null||t===void 0?void 0:t.close(),this.pcManager=void 0;const i=a=>{a&&(a.close(),a.onbufferedamountlow=null,a.onclose=null,a.onclosing=null,a.onerror=null,a.onmessage=null,a.onopen=null)};i(this.lossyDC),i(this.lossyDCSub),i(this.reliableDC),i(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new Ym,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return T(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(t){if(this.pendingTrackResolvers[t.cid])throw new jn("a track with the same ID has already been published");return new Promise((i,a)=>{const o=setTimeout(()=>{delete this.pendingTrackResolvers[t.cid],a(new Ee("publication of local track timed out, no response from server",me.Timeout))},1e4);this.pendingTrackResolvers[t.cid]={resolve:l=>{clearTimeout(o),i(l)},reject:()=>{clearTimeout(o),a(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(t)})}removeTrack(t){if(t.track&&this.pendingTrackResolvers[t.track.id]){const{reject:i}=this.pendingTrackResolvers[t.track.id];i&&i(),delete this.pendingTrackResolvers[t.track.id]}try{return this.pcManager.removeTrack(t),!0}catch(i){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:i}))}return!1}updateMuteStatus(t,i){this.client.sendMuteTrack(t,i)}get dataSubscriberReadyState(){var t;return(t=this.reliableDCSub)===null||t===void 0?void 0:t.readyState}getConnectedServerAddress(){return T(this,void 0,void 0,function*(){var t;return(t=this.pcManager)===null||t===void 0?void 0:t.getConnectedAddress()})}setRegionUrlProvider(t){this.regionUrlProvider=t}configure(t){return T(this,void 0,void 0,function*(){var i,a;if(this.pcManager&&this.pcManager.currentState!==Xe.NEW)return;this.participantSid=(i=t.participant)===null||i===void 0?void 0:i.sid;const o=this.makeRTCConfiguration(t);this.pcManager=new YT(o,this.options.singlePeerConnection?"publisher-only":t.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(Z.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(l,u)=>{this.client.sendIceCandidate(l,u)},this.pcManager.onPublisherOffer=(l,u)=>{this.client.sendOffer(l,u)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(l,u,d)=>T(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(l),this.logContext),["closed","disconnected","failed"].includes(u)&&(this.publisherConnectionPromise=void 0),l===Xe.CONNECTED){const g=this.pcState===tn.New;this.pcState=tn.Connected,g&&this.emit(Z.Connected,t)}else l===Xe.FAILED&&(this.pcState===tn.Connected||this.pcState===tn.Reconnecting)&&(this.pcState=tn.Disconnected,this.handleDisconnect("peerconnection failed",d==="failed"?Fi.RR_SUBSCRIBER_FAILED:Fi.RR_PUBLISHER_FAILED));const p=this.client.isDisconnected||this.client.currentState===Ve.RECONNECTING,m=[Xe.FAILED,Xe.CLOSING,Xe.CLOSED].includes(l);p&&m&&!this._isClosed&&this.emit(Z.Offline)}),this.pcManager.onTrack=l=>{l.streams.length!==0&&this.emit(Z.MediaTrackAdded,l.track,l.streams[0],l.receiver)},vC((a=t.serverInfo)===null||a===void 0?void 0:a.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(t,i,a)=>T(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:t.type,sdp:t.sdp,midToTrackId:a})),this.midToTrackId=a,yield this.pcManager.setPublisherAnswer(t,i))}),this.client.onTrickle=(t,i)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:t,target:i})),this.pcManager.addIceCandidate(t,i))},this.client.onOffer=(t,i,a)=>T(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=i,!this.pcManager)return;this.midToTrackId=a;const o=yield this.pcManager.createSubscriberAnswerFromOffer(t,i);o&&this.client.sendAnswer(o,i)}),this.client.onLocalTrackPublished=t=>{var i;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:t.cid,track:(i=t.track)===null||i===void 0?void 0:i.sid})),!this.pendingTrackResolvers[t.cid]){this.log.error("missing track resolver for ".concat(t.cid),Object.assign(Object.assign({},this.logContext),{cid:t.cid}));return}const{resolve:a}=this.pendingTrackResolvers[t.cid];delete this.pendingTrackResolvers[t.cid],a(t.track)},this.client.onLocalTrackUnpublished=t=>{this.emit(Z.LocalTrackUnpublished,t)},this.client.onLocalTrackSubscribed=t=>{this.emit(Z.LocalTrackSubscribed,t)},this.client.onTokenRefresh=t=>{var i;this.token=t,(i=this.regionUrlProvider)===null||i===void 0||i.updateToken(t)},this.client.onRemoteMuteChanged=(t,i)=>{this.emit(Z.RemoteMute,t,i)},this.client.onSubscribedQualityUpdate=t=>{this.emit(Z.SubscribedQualityUpdate,t)},this.client.onRoomMoved=t=>{var i;this.participantSid=(i=t.participant)===null||i===void 0?void 0:i.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=t.room),this.emit(Z.RoomMoved,t)},this.client.onMediaSectionsRequirement=t=>{var i,a;const o={direction:"recvonly"};for(let l=0;l<t.numAudios;l++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("audio",o);for(let l=0;l<t.numVideos;l++)(a=this.pcManager)===null||a===void 0||a.addPublisherTransceiverOfKind("video",o);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",Fi.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=t=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:t?.reason})),t.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:ip,regionSettings:t.regions})),t.action){case ba.DISCONNECT:this.emit(Z.Disconnected,t?.reason),this.close();break;case ba.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Ql);break;case ba.RESUME:this.handleDisconnect(Ql)}}}makeRTCConfiguration(t){var i;const a=Object.assign({},this.rtcConfig);if(!((i=this.signalOpts)===null||i===void 0)&&i.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),a.encodedInsertableStreams=!0),t.iceServers&&!a.iceServers){const o=[];t.iceServers.forEach(l=>{const u={urls:l.urls};l.username&&(u.username=l.username),l.credential&&(u.credential=l.credential),o.push(u)}),a.iceServers=o}return t.clientConfiguration&&t.clientConfiguration.forceRelay===Ss.ENABLED&&(a.iceTransportPolicy="relay"),a.sdpSemantics="unified-plan",a.continualGatheringPolicy="gather_continually",a}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(hp,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(mp,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(t,i,a){return T(this,void 0,void 0,function*(){if(bl())return yield this.createTransceiverRTCRtpSender(t,i,a);if(Sl())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(t.mediaStreamTrack);throw new ut("Required webRTC APIs not supported on this device")})}createSimulcastSender(t,i,a,o){return T(this,void 0,void 0,function*(){if(bl())return this.createSimulcastTransceiverSender(t,i,a,o);if(Sl())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(t.mediaStreamTrack);throw new ut("Cannot stream on this device")})}createTransceiverRTCRtpSender(t,i,a){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new ut("publisher is closed");const o=[];t.mediaStream&&o.push(t.mediaStream),hi(t)&&(t.codec=i.videoCodec);const l={direction:"sendonly",streams:o};return a&&(l.sendEncodings=a),(yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,l)).sender})}createSimulcastTransceiverSender(t,i,a,o){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new ut("publisher is closed");const l={direction:"sendonly"};o&&(l.sendEncodings=o);const u=yield this.pcManager.addPublisherTransceiver(i.mediaStreamTrack,l);if(a.videoCodec)return t.setSimulcastTrackSender(a.videoCodec,u.sender),u.sender})}createRTCRtpSender(t){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new ut("publisher is closed");return this.pcManager.addPublisherTrack(t)})}attemptReconnect(t){return T(this,void 0,void 0,function*(){var i,a,o;if(!this._isClosed){if(this.attemptingReconnect){ge.warn("already attempting reconnect, returning early",this.logContext);return}(((i=this.clientConfiguration)===null||i===void 0?void 0:i.resumeConnection)===Ss.DISABLED||((o=(a=this.pcManager)===null||a===void 0?void 0:a.currentState)!==null&&o!==void 0?o:Xe.NEW)===Xe.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(t),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(l){this.reconnectAttempts+=1;let u=!0;l instanceof ut?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:l})),u=!1):l instanceof Oa||(this.fullReconnectOnNext=!0),u?this.handleDisconnect("reconnect",Fi.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(Z.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(t){try{return this.reconnectPolicy.nextRetryDelayInMs(t)}catch(i){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:i}))}return null}restartConnection(t){return T(this,void 0,void 0,function*(){var i,a,o;try{if(!this.url||!this.token)throw new ut("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(Z.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let l;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Oa;l=yield this.join(t??this.url,this.token,this.signalOpts)}catch(u){throw u instanceof Ee&&u.reason===me.NotAllowed?new ut("could not reconnect, token might be expired"):new Oa}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(Z.SignalRestarted,l),yield this.waitForPCReconnected(),this.client.currentState!==Ve.CONNECTED)throw new Oa("Signal connection got severed during reconnect");(i=this.regionUrlProvider)===null||i===void 0||i.resetAttempts(),this.emit(Z.Restarted)}catch(l){const u=yield(a=this.regionUrlProvider)===null||a===void 0?void 0:a.getNextBestRegionUrl();if(u){yield this.restartConnection(u);return}else throw(o=this.regionUrlProvider)===null||o===void 0||o.resetAttempts(),l}})}resumeConnection(t){return T(this,void 0,void 0,function*(){var i;if(!this.url||!this.token)throw new ut("could not reconnect, url or token not saved");if(!this.pcManager)throw new ut("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(Z.Resuming);let a;try{this.setupSignalClientCallbacks(),a=yield this.client.reconnect(this.url,this.token,this.participantSid,t)}catch(o){let l="";throw o instanceof Error&&(l=o.message,this.log.error(o.message,Object.assign(Object.assign({},this.logContext),{error:o}))),o instanceof Ee&&o.reason===me.NotAllowed?new ut("could not reconnect, token might be expired"):o instanceof Ee&&o.reason===me.LeaveRequest?o:new Oa(l)}if(this.emit(Z.SignalResumed),a){const o=this.makeRTCConfiguration(a);this.pcManager.updateConfiguration(o),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=a.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Ve.CONNECTED)throw new Oa("Signal connection got severed during reconnect");this.client.setReconnected(),((i=this.reliableDC)===null||i===void 0?void 0:i.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),a?.lastMessageSeq&&this.resendReliableMessagesForResume(a.lastMessageSeq),this.emit(Z.Resumed)})}waitForPCInitialConnection(t,i){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new ut("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(i,t)})}waitForPCReconnected(){return T(this,void 0,void 0,function*(){this.pcState=tn.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield yt(mC),!this.pcManager)throw new ut("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=tn.Connected}catch(t){throw this.pcState=tn.Disconnected,new Ee("could not establish PC connection, ".concat(t.message),me.InternalError)}})}publishRpcResponse(t,i,a,o){return T(this,void 0,void 0,function*(){const l=new Ot({destinationIdentities:[t],kind:be.RELIABLE,value:{case:"rpcResponse",value:new Kc({requestId:i,value:o?{case:"error",value:o.toProto()}:{case:"payload",value:a??""}})}});yield this.sendDataPacket(l,be.RELIABLE)})}publishRpcAck(t,i){return T(this,void 0,void 0,function*(){const a=new Ot({destinationIdentities:[t],kind:be.RELIABLE,value:{case:"rpcAck",value:new Gc({requestId:i})}});yield this.sendDataPacket(a,be.RELIABLE)})}sendDataPacket(t,i){return T(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(i),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const l=BS(t);if(l){const u=yield this.e2eeManager.encryptData(l.toBinary());t.value={case:"encryptedPacket",value:new uh({encryptedValue:u.payload,iv:u.iv,keyIndex:u.keyIndex})}}}i===be.RELIABLE&&(t.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const a=t.toBinary();yield this.waitForBufferStatusLow(i);const o=this.dataChannelForKind(i);if(o){if(i===be.RELIABLE&&this.reliableMessageBuffer.push({data:a,sequence:t.sequence}),this.attemptingReconnect)return;o.send(a)}this.updateAndEmitDCBufferStatus(i)})}resendReliableMessagesForResume(t){return T(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(be.RELIABLE);const i=this.dataChannelForKind(be.RELIABLE);i&&(this.reliableMessageBuffer.popToSequence(t),this.reliableMessageBuffer.getAll().forEach(a=>{i.send(a.data)})),this.updateAndEmitDCBufferStatus(be.RELIABLE)})}waitForBufferStatusLow(t){return new Promise((i,a)=>T(this,void 0,void 0,function*(){if(this.isBufferStatusLow(t))i();else{const o=()=>a("Engine closed");for(this.once(Z.Closing,o);!this.dcBufferStatus.get(t);)yield yt(10);this.off(Z.Closing,o),i()}}))}ensureDataTransportConnected(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var l;if(!a.pcManager)throw new ut("PC manager is closed");const u=o?a.pcManager.subscriber:a.pcManager.publisher,d=o?"Subscriber":"Publisher";if(!u)throw new Ee("".concat(d," connection not set"),me.InternalError);let p=!1;!o&&!a.dataChannelForKind(i,o)&&(a.createDataChannels(),p=!0),!p&&!o&&!a.pcManager.publisher.isICEConnected&&a.pcManager.publisher.getICEConnectionState()!=="checking"&&(p=!0),p&&a.negotiate().catch(y=>{ge.error(y,a.logContext)});const m=a.dataChannelForKind(i,o);if(m?.readyState==="open")return;const g=new Date().getTime()+a.peerConnectionTimeout;for(;new Date().getTime()<g;){if(u.isICEConnected&&((l=a.dataChannelForKind(i,o))===null||l===void 0?void 0:l.readyState)==="open")return;yield yt(50)}throw new Ee("could not establish ".concat(d," connection, state: ").concat(u.getICEConnectionState()),me.InternalError)})()})}ensurePublisherConnected(t){return T(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(t,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==Xe.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return T(this,void 0,void 0,function*(){return new Promise((t,i)=>T(this,void 0,void 0,function*(){if(!this.pcManager){i(new hl("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const a=new AbortController,o=()=>{a.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),t()};this.isClosed&&i("cannot negotiate on closed engine"),this.on(Z.Closing,o),this.pcManager.publisher.once(Ra.RTPVideoPayloadTypes,l=>{const u=new Map;l.forEach(d=>{const p=d.codec.toLowerCase();lT(p)&&u.set(d.payload,p)}),this.emit(Z.RTPVideoMapUpdate,u)});try{yield this.pcManager.negotiate(a),t()}catch(l){l instanceof hl&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Fi.RR_UNKNOWN),i(l)}finally{this.off(Z.Closing,o)}}))})}dataChannelForKind(t,i){if(i){if(t===be.LOSSY)return this.lossyDCSub;if(t===be.RELIABLE)return this.reliableDCSub}else{if(t===be.LOSSY)return this.lossyDC;if(t===be.RELIABLE)return this.reliableDC}}sendSyncState(t,i){var a,o,l,u;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const d=this.pcManager.publisher.getLocalDescription(),p=this.pcManager.publisher.getRemoteDescription(),m=(a=this.pcManager.subscriber)===null||a===void 0?void 0:a.getRemoteDescription(),g=(o=this.pcManager.subscriber)===null||o===void 0?void 0:o.getLocalDescription(),y=(u=(l=this.signalOpts)===null||l===void 0?void 0:l.autoSubscribe)!==null&&u!==void 0?u:!0,S=new Array,C=new Array;t.forEach(O=>{O.isDesired!==y&&S.push(O.trackSid),O.isEnabled||C.push(O.trackSid)}),this.client.sendSyncState(new el({answer:this.options.singlePeerConnection?p?_a({sdp:p.sdp,type:p.type}):void 0:g?_a({sdp:g.sdp,type:g.type}):void 0,offer:this.options.singlePeerConnection?d?_a({sdp:d.sdp,type:d.type}):void 0:m?_a({sdp:m.sdp,type:m.type}):void 0,subscription:new Hr({trackSids:S,subscribe:!y,participantTracks:[]}),publishTracks:bT(i),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:C,datachannelReceiveStates:this.reliableReceivedState.map((O,A)=>new Nh({publisherSid:A,lastSeq:O}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const t=[],i=(a,o)=>{a?.id!==void 0&&a.id!==null&&t.push(new xh({label:a.label,id:a.id,target:o}))};return i(this.dataChannelForKind(be.LOSSY),pn.PUBLISHER),i(this.dataChannelForKind(be.RELIABLE),pn.PUBLISHER),i(this.dataChannelForKind(be.LOSSY,!0),pn.SUBSCRIBER),i(this.dataChannelForKind(be.RELIABLE,!0),pn.SUBSCRIBER),t}clearReconnectTimeout(){this.reconnectTimeout&&vt.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Pt()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){Pt()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(t){var i;const a=(i=this.pcManager)===null||i===void 0?void 0:i.getMidForReceiver(t);if(a){const o=Object.entries(this.midToTrackId).find(l=>{let[u]=l;return u===a});if(o)return o[1]}}}class Oa extends Error{}function vC(r){return r!==void 0&&r>13}function pp(r,t){const i=r.participantIdentity?r.participantIdentity:t.participantIdentity;r.participantIdentity=i,t.participantIdentity=i;const a=r.destinationIdentities.length!==0?r.destinationIdentities:t.destinationIdentities;r.destinationIdentities=a,t.destinationIdentities=a}class gp{get info(){return this._info}validateBytesReceived(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(t&&this.bytesReceived<this.totalByteSize)throw new $t("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),At.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new $t("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),At.LengthExceeded)}}constructor(t,i,a,o){this.reader=i,this.totalByteSize=a,this._info=t,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=o}}class yC extends gp{handleChunkReceived(t){var i;this.bytesReceived+=t.content.byteLength,this.validateBytesReceived();const a=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(i=this.onProgress)===null||i===void 0||i.call(this,a)}[Symbol.asyncIterator](){const t=this.reader.getReader();let i=new en,a=null,o=null;if(this.signal){const u=this.signal;o=()=>{var d;(d=i.reject)===null||d===void 0||d.call(i,u.reason)},u.addEventListener("abort",o),a=u}const l=()=>{t.releaseLock(),a&&o&&a.removeEventListener("abort",o),this.signal=void 0};return{next:()=>T(this,void 0,void 0,function*(){var u,d;try{const{done:p,value:m}=yield Promise.race([t.read(),i.promise,(d=(u=this.outOfBandFailureRejectingFuture)===null||u===void 0?void 0:u.promise)!==null&&d!==void 0?d:new Promise(()=>{})]);return p?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(m),{done:!1,value:m.content})}catch(p){throw l(),p}}),return(){return T(this,void 0,void 0,function*(){return l(),{done:!0,value:void 0}})}}}withAbortSignal(t){return this.signal=t,this}readAll(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var a,o,l,u;let d=new Set;const p=i.signal?t.withAbortSignal(i.signal):t;try{for(var m=!0,g=In(p),y;y=yield g.next(),a=y.done,!a;m=!0){u=y.value,m=!1;const S=u;d.add(S)}}catch(S){o={error:S}}finally{try{!m&&!a&&(l=g.return)&&(yield l.call(g))}finally{if(o)throw o.error}}return Array.from(d)})()})}}class bC extends gp{constructor(t,i,a,o){super(t,i,a,o),this.receivedChunks=new Map}handleChunkReceived(t){var i;const a=io(t.chunkIndex),o=this.receivedChunks.get(a);if(o&&o.version>t.version)return;this.receivedChunks.set(a,t),this.bytesReceived+=t.content.byteLength,this.validateBytesReceived();const l=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(i=this.onProgress)===null||i===void 0||i.call(this,l)}[Symbol.asyncIterator](){const t=this.reader.getReader(),i=new TextDecoder("utf-8",{fatal:!0});let a=new en,o=null,l=null;if(this.signal){const d=this.signal;l=()=>{var p;(p=a.reject)===null||p===void 0||p.call(a,d.reason)},d.addEventListener("abort",l),o=d}const u=()=>{t.releaseLock(),o&&l&&o.removeEventListener("abort",l),this.signal=void 0};return{next:()=>T(this,void 0,void 0,function*(){var d,p;try{const{done:m,value:g}=yield Promise.race([t.read(),a.promise,(p=(d=this.outOfBandFailureRejectingFuture)===null||d===void 0?void 0:d.promise)!==null&&p!==void 0?p:new Promise(()=>{})]);if(m)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(g);let y;try{y=i.decode(g.content)}catch(S){throw new $t("Cannot decode datastream chunk ".concat(g.chunkIndex," as text: ").concat(S),At.DecodeFailed)}return{done:!1,value:y}}}catch(m){throw u(),m}}),return(){return T(this,void 0,void 0,function*(){return u(),{done:!0,value:void 0}})}}}withAbortSignal(t){return this.signal=t,this}readAll(){return T(this,arguments,void 0,function(){var t=this;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var a,o,l,u;let d="";const p=i.signal?t.withAbortSignal(i.signal):t;try{for(var m=!0,g=In(p),y;y=yield g.next(),a=y.done,!a;m=!0)u=y.value,m=!1,d+=u}catch(S){o={error:S}}finally{try{!m&&!a&&(l=g.return)&&(yield l.call(g))}finally{if(o)throw o.error}}return d})()})}}class SC{constructor(){this.log=ge,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(t,i){if(this.textStreamHandlers.has(t))throw new $t('A text stream handler for topic "'.concat(t,'" has already been set.'),At.HandlerAlreadyRegistered);this.textStreamHandlers.set(t,i)}unregisterTextStreamHandler(t){this.textStreamHandlers.delete(t)}registerByteStreamHandler(t,i){if(this.byteStreamHandlers.has(t))throw new $t('A byte stream handler for topic "'.concat(t,'" has already been set.'),At.HandlerAlreadyRegistered);this.byteStreamHandlers.set(t,i)}unregisterByteStreamHandler(t){this.byteStreamHandlers.delete(t)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(t){var i,a,o,l;const u=Array.from(this.textStreamControllers.entries()).filter(p=>p[1].sendingParticipantIdentity===t),d=Array.from(this.byteStreamControllers.entries()).filter(p=>p[1].sendingParticipantIdentity===t);if(u.length>0||d.length>0){const p=new $t("Participant ".concat(t," unexpectedly disconnected in the middle of sending data"),At.AbnormalEnd);for(const[m,g]of d)(a=(i=g.outOfBandFailureRejectingFuture).reject)===null||a===void 0||a.call(i,p),this.byteStreamControllers.delete(m);for(const[m,g]of u)(l=(o=g.outOfBandFailureRejectingFuture).reject)===null||l===void 0||l.call(o,p),this.textStreamControllers.delete(m)}}handleDataStreamPacket(t,i){return T(this,void 0,void 0,function*(){switch(t.value.case){case"streamHeader":return this.handleStreamHeader(t.value.value,t.participantIdentity,i);case"streamChunk":return this.handleStreamChunk(t.value.value,i);case"streamTrailer":return this.handleStreamTrailer(t.value.value,i);default:throw new Error('DataPacket of value "'.concat(t.value.case,'" is not data stream related!'))}})}handleStreamHeader(t,i,a){return T(this,void 0,void 0,function*(){var o;if(t.contentHeader.case==="byteHeader"){const l=this.byteStreamHandlers.get(t.topic);if(!l){this.log.debug("ignoring incoming byte stream due to no handler for topic",t.topic);return}let u;const d=new en;d.promise.catch(g=>{this.log.error(g)});const p={id:t.streamId,name:(o=t.contentHeader.value.name)!==null&&o!==void 0?o:"unknown",mimeType:t.mimeType,size:t.totalLength?Number(t.totalLength):void 0,topic:t.topic,timestamp:io(t.timestamp),attributes:t.attributes,encryptionType:a},m=new ReadableStream({start:g=>{if(u=g,this.textStreamControllers.has(t.streamId))throw new $t("A data stream read is already in progress for a stream with id ".concat(t.streamId,"."),At.AlreadyOpened);this.byteStreamControllers.set(t.streamId,{info:p,controller:u,startTime:Date.now(),sendingParticipantIdentity:i,outOfBandFailureRejectingFuture:d})}});l(new yC(p,m,io(t.totalLength),d),{identity:i})}else if(t.contentHeader.case==="textHeader"){const l=this.textStreamHandlers.get(t.topic);if(!l){this.log.debug("ignoring incoming text stream due to no handler for topic",t.topic);return}let u;const d=new en;d.promise.catch(g=>{this.log.error(g)});const p={id:t.streamId,mimeType:t.mimeType,size:t.totalLength?Number(t.totalLength):void 0,topic:t.topic,timestamp:Number(t.timestamp),attributes:t.attributes,encryptionType:a},m=new ReadableStream({start:g=>{if(u=g,this.textStreamControllers.has(t.streamId))throw new $t("A data stream read is already in progress for a stream with id ".concat(t.streamId,"."),At.AlreadyOpened);this.textStreamControllers.set(t.streamId,{info:p,controller:u,startTime:Date.now(),sendingParticipantIdentity:i,outOfBandFailureRejectingFuture:d})}});l(new bC(p,m,io(t.totalLength),d),{identity:i})}})}handleStreamChunk(t,i){const a=this.byteStreamControllers.get(t.streamId);a&&(a.info.encryptionType!==i?(a.controller.error(new $t("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(i,", got ").concat(a.info.encryptionType),At.EncryptionTypeMismatch)),this.byteStreamControllers.delete(t.streamId)):t.content.length>0&&a.controller.enqueue(t));const o=this.textStreamControllers.get(t.streamId);o&&(o.info.encryptionType!==i?(o.controller.error(new $t("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(i,", got ").concat(o.info.encryptionType),At.EncryptionTypeMismatch)),this.textStreamControllers.delete(t.streamId)):t.content.length>0&&o.controller.enqueue(t))}handleStreamTrailer(t,i){const a=this.textStreamControllers.get(t.streamId);a&&(a.info.encryptionType!==i?a.controller.error(new $t("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(i,", got ").concat(a.info.encryptionType),At.EncryptionTypeMismatch)):(a.info.attributes=Object.assign(Object.assign({},a.info.attributes),t.attributes),a.controller.close(),this.textStreamControllers.delete(t.streamId)));const o=this.byteStreamControllers.get(t.streamId);o&&(o.info.encryptionType!==i?o.controller.error(new $t("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(i,", got ").concat(o.info.encryptionType),At.EncryptionTypeMismatch)):(o.info.attributes=Object.assign(Object.assign({},o.info.attributes),t.attributes),o.controller.close()),this.byteStreamControllers.delete(t.streamId))}}class vp{constructor(t,i,a){this.writableStream=t,this.defaultWriter=t.getWriter(),this.onClose=a,this.info=i}write(t){return this.defaultWriter.write(t)}close(){return T(this,void 0,void 0,function*(){var t;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(t=this.onClose)===null||t===void 0||t.call(this)})}}class TC extends vp{}class CC extends vp{}const yp=15e3;class kC{constructor(t,i){this.engine=t,this.log=i}setupEngine(t){this.engine=t}sendText(t,i){return T(this,void 0,void 0,function*(){var a;const o=crypto.randomUUID(),u=new TextEncoder().encode(t).byteLength,d=(a=i?.attachments)===null||a===void 0?void 0:a.map(()=>crypto.randomUUID()),p=new Array(d?d.length+1:1).fill(0),m=(y,S)=>{var C;p[S]=y;const O=p.reduce((A,I)=>A+I,0);(C=i?.onProgress)===null||C===void 0||C.call(i,O)},g=yield this.streamText({streamId:o,totalSize:u,destinationIdentities:i?.destinationIdentities,topic:i?.topic,attachedStreamIds:d,attributes:i?.attributes});return yield g.write(t),m(1,0),yield g.close(),i?.attachments&&d&&(yield Promise.all(i.attachments.map((y,S)=>T(this,void 0,void 0,function*(){return this._sendFile(d[S],y,{topic:i.topic,mimeType:y.type,onProgress:C=>{m(C,S+1)}})})))),g.info})}streamText(t){return T(this,void 0,void 0,function*(){var i,a,o;const l=(i=t?.streamId)!==null&&i!==void 0?i:crypto.randomUUID(),u={id:l,mimeType:"text/plain",timestamp:Date.now(),topic:(a=t?.topic)!==null&&a!==void 0?a:"",size:t?.totalSize,attributes:t?.attributes,encryptionType:!((o=this.engine.e2eeManager)===null||o===void 0)&&o.isDataChannelEncryptionEnabled?lt.GCM:lt.NONE},d=new jr({streamId:l,mimeType:u.mimeType,topic:u.topic,timestamp:Qi(u.timestamp),totalLength:Qi(t?.totalSize),attributes:u.attributes,contentHeader:{case:"textHeader",value:new kh({version:t?.version,attachedStreamIds:t?.attachedStreamIds,replyToStreamId:t?.replyToStreamId,operationType:t?.type==="update"?Yc.UPDATE:Yc.CREATE})}}),p=t?.destinationIdentities,m=new Ot({destinationIdentities:p,value:{case:"streamHeader",value:d}});yield this.engine.sendDataPacket(m,be.RELIABLE);let g=0;const y=this.engine,S=new WritableStream({write(A){return T(this,void 0,void 0,function*(){for(const I of pT(A,yp)){const L=new zr({content:I,streamId:l,chunkIndex:Qi(g)}),X=new Ot({destinationIdentities:p,value:{case:"streamChunk",value:L}});yield y.sendDataPacket(X,be.RELIABLE),g+=1}})},close(){return T(this,void 0,void 0,function*(){const A=new qr({streamId:l}),I=new Ot({destinationIdentities:p,value:{case:"streamTrailer",value:A}});yield y.sendDataPacket(I,be.RELIABLE)})},abort(A){console.log("Sink error:",A)}});let C=()=>T(this,void 0,void 0,function*(){yield O.close()});y.once(Z.Closing,C);const O=new TC(S,u,()=>this.engine.off(Z.Closing,C));return O})}sendFile(t,i){return T(this,void 0,void 0,function*(){const a=crypto.randomUUID();return yield this._sendFile(a,t,i),{id:a}})}_sendFile(t,i,a){return T(this,void 0,void 0,function*(){var o;const l=yield this.streamBytes({streamId:t,totalSize:i.size,name:i.name,mimeType:(o=a?.mimeType)!==null&&o!==void 0?o:i.type,topic:a?.topic,destinationIdentities:a?.destinationIdentities}),u=i.stream().getReader();for(;;){const{done:d,value:p}=yield u.read();if(d)break;yield l.write(p)}return yield l.close(),l.info})}streamBytes(t){return T(this,void 0,void 0,function*(){var i,a,o,l,u,d;const p=(i=t?.streamId)!==null&&i!==void 0?i:crypto.randomUUID(),m=t?.destinationIdentities,g={id:p,mimeType:(a=t?.mimeType)!==null&&a!==void 0?a:"application/octet-stream",topic:(o=t?.topic)!==null&&o!==void 0?o:"",timestamp:Date.now(),attributes:t?.attributes,size:t?.totalSize,name:(l=t?.name)!==null&&l!==void 0?l:"unknown",encryptionType:!((u=this.engine.e2eeManager)===null||u===void 0)&&u.isDataChannelEncryptionEnabled?lt.GCM:lt.NONE},y=new jr({totalLength:Qi((d=g.size)!==null&&d!==void 0?d:0),mimeType:g.mimeType,streamId:p,topic:g.topic,timestamp:Qi(Date.now()),attributes:g.attributes,contentHeader:{case:"byteHeader",value:new Eh({name:g.name})}}),S=new Ot({destinationIdentities:m,value:{case:"streamHeader",value:y}});yield this.engine.sendDataPacket(S,be.RELIABLE);let C=0;const O=new Rt,A=this.engine,I=this.log,L=new WritableStream({write(K){return T(this,void 0,void 0,function*(){const D=yield O.lock();let x=0;try{for(;x<K.byteLength;){const F=K.slice(x,x+yp),Y=new Ot({destinationIdentities:m,value:{case:"streamChunk",value:new zr({content:F,streamId:p,chunkIndex:Qi(C)})}});yield A.sendDataPacket(Y,be.RELIABLE),C+=1,x+=F.byteLength}}finally{D()}})},close(){return T(this,void 0,void 0,function*(){const K=new qr({streamId:p}),D=new Ot({destinationIdentities:m,value:{case:"streamTrailer",value:K}});yield A.sendDataPacket(D,be.RELIABLE)})},abort(K){I.error("Sink error:",K)}});return new CC(L,g)})}}class bp extends H{constructor(t,i,a,o,l){super(t,a,l),this.sid=i,this.receiver=o}get isLocal(){return!1}setMuted(t){this.isMuted!==t&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?J.Muted:J.Unmuted,this))}setMediaStream(t){this.mediaStream=t;const i=a=>{a.track===this._mediaStreamTrack&&(t.removeEventListener("removetrack",i),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(J.Ended,this))};t.addEventListener("removetrack",i)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return T(this,void 0,void 0,function*(){var t;return!((t=this.receiver)===null||t===void 0)&&t.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(t){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=t:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Fl)),ST()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const t=()=>{var i;this.timeSyncHandle=requestAnimationFrame(()=>t());const a=(i=this.receiver)===null||i===void 0?void 0:i.getSynchronizationSources()[0];if(a){const{timestamp:o,rtpTimestamp:l}=a;l&&this.rtpTimestamp!==l&&(this.emit(J.TimeSyncUpdate,{timestamp:o,rtpTimestamp:l}),this.rtpTimestamp=l)}};t()}}class Sp extends bp{constructor(t,i,a,o,l,u){super(t,i,H.Kind.Audio,a,u),this.monitorReceiver=()=>T(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const d=yield this.getReceiverStats();d&&this.prevStats&&this.receiver&&(this._currentBitrate=ao(d,this.prevStats)),this.prevStats=d}),this.audioContext=o,this.webAudioPluginNodes=[],l&&(this.sinkId=l.deviceId)}setVolume(t){var i;for(const a of this.attachedElements)this.audioContext?(i=this.gainNode)===null||i===void 0||i.gain.setTargetAtTime(t,0,.1):a.volume=t;On()&&this._mediaStreamTrack._setVolume(t),this.elementVolume=t}getVolume(){if(this.elementVolume)return this.elementVolume;if(On())return 1;let t=0;return this.attachedElements.forEach(i=>{i.volume>t&&(t=i.volume)}),t}setSinkId(t){return T(this,void 0,void 0,function*(){this.sinkId=t,yield Promise.all(this.attachedElements.map(i=>{if(Tl(i))return i.setSinkId(t)}))})}attach(t){const i=this.attachedElements.length===0;return t?super.attach(t):t=super.attach(),this.sinkId&&Tl(t)&&t.setSinkId(this.sinkId).catch(a=>{this.log.error("Failed to set sink id on remote audio track",a,this.logContext)}),this.audioContext&&i&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,t),t.volume=0,t.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),t}detach(t){let i;return t?(i=super.detach(t),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(i=super.detach(),this.disconnectWebAudio()),i}setAudioContext(t){this.audioContext=t,t&&this.attachedElements.length>0?this.connectWebAudio(t,this.attachedElements[0]):t||this.disconnectWebAudio()}setWebAudioPlugins(t){this.webAudioPluginNodes=t,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(t,i){this.disconnectWebAudio(),this.sourceNode=t.createMediaStreamSource(i.srcObject);let a=this.sourceNode;this.webAudioPluginNodes.forEach(o=>{a.connect(o),a=o}),this.gainNode=t.createGain(),a.connect(this.gainNode),this.gainNode.connect(t.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),t.state!=="running"&&t.resume().then(()=>{t.state!=="running"&&this.emit(J.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(o=>{this.emit(J.AudioPlaybackFailed,o)})}disconnectWebAudio(){var t,i;(t=this.gainNode)===null||t===void 0||t.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return T(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const t=yield this.receiver.getStats();let i;return t.forEach(a=>{a.type==="inbound-rtp"&&(i={type:"audio",streamId:a.id,timestamp:a.timestamp,jitter:a.jitter,bytesReceived:a.bytesReceived,concealedSamples:a.concealedSamples,concealmentEvents:a.concealmentEvents,silentConcealedSamples:a.silentConcealedSamples,silentConcealmentEvents:a.silentConcealmentEvents,totalAudioEnergy:a.totalAudioEnergy,totalSamplesDuration:a.totalSamplesDuration})}),i})}}const Jl=100;class EC extends bp{constructor(t,i,a,o,l){super(t,i,H.Kind.Video,a,l),this.elementInfos=[],this.monitorReceiver=()=>T(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const u=yield this.getReceiverStats();u&&this.prevStats&&this.receiver&&(this._currentBitrate=ao(u,this.prevStats)),this.prevStats=u}),this.debouncedHandleResize=Bl(()=>{this.updateDimensions()},Jl),this.adaptiveStreamSettings=o}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(t){super.setStreamState(t),this.log.debug("setStreamState",t),this.isAdaptiveStream&&t===H.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(t){super.setMuted(t),this.attachedElements.forEach(i=>{t?Ca(this._mediaStreamTrack,i):Ta(this._mediaStreamTrack,i)})}attach(t){if(t?super.attach(t):t=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(i=>i.element===t)===void 0){const i=new _C(t);this.observeElementInfo(i)}return t}observeElementInfo(t){this.adaptiveStreamSettings&&this.elementInfos.find(i=>i===t)===void 0?(t.handleResize=()=>{this.debouncedHandleResize()},t.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(t),t.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(t){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const i=this.elementInfos.filter(a=>a===t);for(const a of i)a.stopObserving();this.elementInfos=this.elementInfos.filter(a=>a!==t),this.updateVisibility(),this.debouncedHandleResize()}detach(t){let i=[];if(t)return this.stopObservingElement(t),super.detach(t);i=super.detach();for(const a of i)this.stopObservingElement(a);return i}getDecoderImplementation(){var t;return(t=this.prevStats)===null||t===void 0?void 0:t.decoderImplementation}getReceiverStats(){return T(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const t=yield this.receiver.getStats();let i,a="",o=new Map;return t.forEach(l=>{l.type==="inbound-rtp"?(a=l.codecId,i={type:"video",streamId:l.id,framesDecoded:l.framesDecoded,framesDropped:l.framesDropped,framesReceived:l.framesReceived,packetsReceived:l.packetsReceived,packetsLost:l.packetsLost,frameWidth:l.frameWidth,frameHeight:l.frameHeight,pliCount:l.pliCount,firCount:l.firCount,nackCount:l.nackCount,jitter:l.jitter,timestamp:l.timestamp,bytesReceived:l.bytesReceived,decoderImplementation:l.decoderImplementation}):l.type==="codec"&&o.set(l.id,l)}),i&&a!==""&&o.get(a)&&(i.mimeType=o.get(a).mimeType),i})}stopObservingElement(t){const i=this.elementInfos.filter(a=>a.element===t);for(const a of i)this.stopObservingElementInfo(a)}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(t){var i,a;const o=this.elementInfos.reduce((p,m)=>Math.max(p,m.visibilityChangedAt||0),0),l=!((a=(i=this.adaptiveStreamSettings)===null||i===void 0?void 0:i.pauseVideoInBackground)!==null&&a!==void 0)||a?this.isInBackground:!1,u=this.elementInfos.some(p=>p.pictureInPicture),d=this.elementInfos.some(p=>p.visible)&&!l||u;if(!(this.lastVisible===d&&!t)){if(!d&&Date.now()-o<Jl){vt.setTimeout(()=>{this.updateVisibility()},Jl);return}this.lastVisible=d,this.emit(J.VisibilityChanged,d,this)}}updateDimensions(){var t,i;let a=0,o=0;const l=this.getPixelDensity();for(const u of this.elementInfos){const d=u.width()*l,p=u.height()*l;d+p>a+o&&(a=d,o=p)}((t=this.lastDimensions)===null||t===void 0?void 0:t.width)===a&&((i=this.lastDimensions)===null||i===void 0?void 0:i.height)===o||(this.lastDimensions={width:a,height:o},this.emit(J.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var t;const i=(t=this.adaptiveStreamSettings)===null||t===void 0?void 0:t.pixelDensity;return i==="screen"?Um():i||(Um()>2?2:1)}}class _C{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(t,i){this.onVisibilityChanged=a=>{var o;const{target:l,isIntersecting:u}=a;l===this.element&&(this.isIntersecting=u,this.isPiP=xs(this.element),this.visibilityChangedAt=Date.now(),(o=this.handleVisibilityChanged)===null||o===void 0||o.call(this))},this.onEnterPiP=()=>{var a,o,l;(o=(a=window.documentPictureInPicture)===null||a===void 0?void 0:a.window)===null||o===void 0||o.addEventListener("pagehide",this.onLeavePiP),this.isPiP=xs(this.element),(l=this.handleVisibilityChanged)===null||l===void 0||l.call(this)},this.onLeavePiP=()=>{var a;this.isPiP=xs(this.element),(a=this.handleVisibilityChanged)===null||a===void 0||a.call(this)},this.element=t,this.isIntersecting=i??Xl(t),this.isPiP=Pt()&&xs(t),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var t,i,a;this.isIntersecting=Xl(this.element),this.isPiP=xs(this.element),this.element.handleResize=()=>{var o;(o=this.handleResize)===null||o===void 0||o.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Im().observe(this.element),Lm().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(t=window.documentPictureInPicture)===null||t===void 0||t.addEventListener("enter",this.onEnterPiP),(a=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||a===void 0||a.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var t,i,a,o,l;(t=Im())===null||t===void 0||t.unobserve(this.element),(i=Lm())===null||i===void 0||i.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(a=window.documentPictureInPicture)===null||a===void 0||a.removeEventListener("enter",this.onEnterPiP),(l=(o=window.documentPictureInPicture)===null||o===void 0?void 0:o.window)===null||l===void 0||l.removeEventListener("pagehide",this.onLeavePiP)}}function xs(r){var t,i;return document.pictureInPictureElement===r?!0:!((t=window.documentPictureInPicture)===null||t===void 0)&&t.window?Xl(r,(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window):!1}function Xl(r,t){const i=t||window;let a=r.offsetTop,o=r.offsetLeft;const l=r.offsetWidth,u=r.offsetHeight,{hidden:d}=r,{display:p}=getComputedStyle(r);for(;r.offsetParent;)r=r.offsetParent,a+=r.offsetTop,o+=r.offsetLeft;return a<i.pageYOffset+i.innerHeight&&o<i.pageXOffset+i.innerWidth&&a+u>i.pageYOffset&&o+l>i.pageXOffset&&!d&&p!=="none"}class qn extends Rn.EventEmitter{constructor(t,i,a,o){var l;super(),this.metadataMuted=!1,this.encryption=lt.NONE,this.log=ge,this.handleMuted=()=>{this.emit(J.Muted)},this.handleUnmuted=()=>{this.emit(J.Unmuted)},this.log=Ln((l=o?.loggerName)!==null&&l!==void 0?l:gn.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=t,this.trackSid=i,this.trackName=a,this.source=H.Source.Unknown}setTrack(t){this.track&&(this.track.off(J.Muted,this.handleMuted),this.track.off(J.Unmuted,this.handleUnmuted)),this.track=t,t&&(t.on(J.Muted,this.handleMuted),t.on(J.Unmuted,this.handleUnmuted))}get logContext(){var t;return Object.assign(Object.assign({},(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this)),Se(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==lt.NONE}get audioTrack(){if(Dn(this.track))return this.track}get videoTrack(){if(hi(this.track))return this.track}updateInfo(t){this.trackSid=t.sid,this.trackName=t.name,this.source=H.sourceFromProto(t.source),this.mimeType=t.mimeType,this.kind===H.Kind.Video&&t.width>0&&(this.dimensions={width:t.width,height:t.height},this.simulcasted=t.simulcast),this.encryption=t.encryption,this.trackInfo=t,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:t}))}}(function(r){(function(t){t.Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed"})(r.SubscriptionStatus||(r.SubscriptionStatus={})),(function(t){t.Allowed="allowed",t.NotAllowed="not_allowed"})(r.PermissionStatus||(r.PermissionStatus={}))})(qn||(qn={}));class Zl extends qn{get isUpstreamPaused(){var t;return(t=this.track)===null||t===void 0?void 0:t.isUpstreamPaused}constructor(t,i,a,o){super(t,i.sid,i.name,o),this.track=void 0,this.handleTrackEnded=()=>{this.emit(J.Ended)},this.handleCpuConstrained=()=>{this.track&&hi(this.track)&&this.emit(J.CpuConstrained,this.track)},this.updateInfo(i),this.setTrack(a)}setTrack(t){this.track&&(this.track.off(J.Ended,this.handleTrackEnded),this.track.off(J.CpuConstrained,this.handleCpuConstrained)),super.setTrack(t),t&&(t.on(J.Ended,this.handleTrackEnded),t.on(J.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return T(this,void 0,void 0,function*(){var t;return(t=this.track)===null||t===void 0?void 0:t.mute()})}unmute(){return T(this,void 0,void 0,function*(){var t;return(t=this.track)===null||t===void 0?void 0:t.unmute()})}pauseUpstream(){return T(this,void 0,void 0,function*(){var t;yield(t=this.track)===null||t===void 0?void 0:t.pauseUpstream()})}resumeUpstream(){return T(this,void 0,void 0,function*(){var t;yield(t=this.track)===null||t===void 0?void 0:t.resumeUpstream()})}getTrackFeatures(){var t;if(Dn(this.track)){const i=this.track.getSourceTrackSettings(),a=new Set;return i.autoGainControl&&a.add(ft.TF_AUTO_GAIN_CONTROL),i.echoCancellation&&a.add(ft.TF_ECHO_CANCELLATION),i.noiseSuppression&&a.add(ft.TF_NOISE_SUPPRESSION),i.channelCount&&i.channelCount>1&&a.add(ft.TF_STEREO),!((t=this.options)===null||t===void 0)&&t.dtx||a.add(ft.TF_NO_DTX),this.track.enhancedNoiseCancellation&&a.add(ft.TF_ENHANCED_NOISE_CANCELLATION),Array.from(a.values())}else return[]}}function oo(r,t){return T(this,void 0,void 0,function*(){r??(r={});let i=!1;const{audioProcessor:a,videoProcessor:o,optionsWithoutProcessor:l}=Vm(r);let u=l.audio,d=l.video;if(a&&typeof l.audio=="object"&&(l.audio.processor=a),o&&typeof l.video=="object"&&(l.video.processor=o),r.audio&&typeof l.audio=="object"&&typeof l.audio.deviceId=="string"){const y=l.audio.deviceId;l.audio.deviceId={exact:y},i=!0,u=Object.assign(Object.assign({},l.audio),{deviceId:{ideal:y}})}if(l.video&&typeof l.video=="object"&&typeof l.video.deviceId=="string"){const y=l.video.deviceId;l.video.deviceId={exact:y},i=!0,d=Object.assign(Object.assign({},l.video),{deviceId:{ideal:y}})}l.audio===!0?l.audio={deviceId:"default"}:typeof l.audio=="object"&&l.audio!==null&&(l.audio=Object.assign(Object.assign({},l.audio),{deviceId:l.audio.deviceId||"default"})),l.video===!0?l.video={deviceId:"default"}:typeof l.video=="object"&&!l.video.deviceId&&(l.video.deviceId="default");const p=zm(l,tp,np),m=Dl(p),g=navigator.mediaDevices.getUserMedia(m);l.audio&&(ht.userMediaPromiseMap.set("audioinput",g),g.catch(()=>ht.userMediaPromiseMap.delete("audioinput"))),l.video&&(ht.userMediaPromiseMap.set("videoinput",g),g.catch(()=>ht.userMediaPromiseMap.delete("videoinput")));try{const y=yield g;return yield Promise.all(y.getTracks().map(S=>T(this,void 0,void 0,function*(){const C=S.kind==="audio";let O=C?p.audio:p.video;(typeof O=="boolean"||!O)&&(O={});let A;const I=C?m.audio:m.video;typeof I!="boolean"&&(A=I);const L=S.getSettings().deviceId;A?.deviceId&&fi(A.deviceId)!==L?A.deviceId=L:A||(A={deviceId:L});const X=nC(S,A,t);return X.kind===H.Kind.Video?X.source=H.Source.Camera:X.kind===H.Kind.Audio&&(X.source=H.Source.Microphone),X.mediaStream=y,Dn(X)&&a?yield X.setProcessor(a):hi(X)&&o&&(yield X.setProcessor(o)),X})))}catch(y){if(!i)throw y;return oo(Object.assign(Object.assign({},r),{audio:u,video:d}),t)}})}function RC(r){return T(this,void 0,void 0,function*(){return(yield oo({audio:!1,video:!0}))[0]})}function OC(r){return T(this,void 0,void 0,function*(){return(yield oo({audio:!0,video:!1}))[0]})}var gi;(function(r){r.Excellent="excellent",r.Good="good",r.Poor="poor",r.Lost="lost",r.Unknown="unknown"})(gi||(gi={}));function AC(r){switch(r){case bs.EXCELLENT:return gi.Excellent;case bs.GOOD:return gi.Good;case bs.POOR:return gi.Poor;case bs.LOST:return gi.Lost;default:return gi.Unknown}}class Tp extends Rn.EventEmitter{get logContext(){var t,i;return Object.assign({},(i=(t=this.loggerOptions)===null||t===void 0?void 0:t.loggerContextCb)===null||i===void 0?void 0:i.call(t))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(t=>t.isEncrypted)}get isAgent(){var t;return((t=this.permissions)===null||t===void 0?void 0:t.agent)||this.kind===Ts.AGENT}get isActive(){var t;return((t=this.participantInfo)===null||t===void 0?void 0:t.state)===va.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(t,i,a,o,l,u){let d=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Ts.STANDARD;var p;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=gi.Unknown,this.log=ge,this.log=Ln((p=u?.loggerName)!==null&&p!==void 0?p:gn.Participant),this.loggerOptions=u,this.setMaxListeners(100),this.sid=t,this.identity=i,this.name=a,this.metadata=o,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=d,this._attributes=l??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(t){for(const[,i]of this.trackPublications)if(i.source===t)return i}getTrackPublicationByName(t){for(const[,i]of this.trackPublications)if(i.trackName===t)return i}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new en,this.once(W.Active,()=>{var t,i;(i=(t=this.activeFuture)===null||t===void 0?void 0:t.resolve)===null||i===void 0||i.call(t),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var t;const i=this.getTrackPublication(H.Source.Camera);return!(!((t=i?.isMuted)!==null&&t!==void 0)||t)}get isMicrophoneEnabled(){var t;const i=this.getTrackPublication(H.Source.Microphone);return!(!((t=i?.isMuted)!==null&&t!==void 0)||t)}get isScreenShareEnabled(){return!!this.getTrackPublication(H.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(t){var i;return this.participantInfo&&this.participantInfo.sid===t.sid&&this.participantInfo.version>t.version?!1:(this.identity=t.identity,this.sid=t.sid,this._setName(t.name),this._setMetadata(t.metadata),this._setAttributes(t.attributes),t.state===va.ACTIVE&&((i=this.participantInfo)===null||i===void 0?void 0:i.state)!==va.ACTIVE&&this.emit(W.Active),t.permission&&this.setPermissions(t.permission),this.participantInfo=t,!0)}_setMetadata(t){const i=this.metadata!==t,a=this.metadata;this.metadata=t,i&&this.emit(W.ParticipantMetadataChanged,a)}_setName(t){const i=this.name!==t;this.name=t,i&&this.emit(W.ParticipantNameChanged,t)}_setAttributes(t){const i=TT(this.attributes,t);this._attributes=t,Object.keys(i).length>0&&this.emit(W.AttributesChanged,i)}setPermissions(t){var i,a,o,l,u,d;const p=this.permissions,m=t.canPublish!==((i=this.permissions)===null||i===void 0?void 0:i.canPublish)||t.canSubscribe!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribe)||t.canPublishData!==((o=this.permissions)===null||o===void 0?void 0:o.canPublishData)||t.hidden!==((l=this.permissions)===null||l===void 0?void 0:l.hidden)||t.recorder!==((u=this.permissions)===null||u===void 0?void 0:u.recorder)||t.canPublishSources.length!==this.permissions.canPublishSources.length||t.canPublishSources.some((g,y)=>{var S;return g!==((S=this.permissions)===null||S===void 0?void 0:S.canPublishSources[y])})||t.canSubscribeMetrics!==((d=this.permissions)===null||d===void 0?void 0:d.canSubscribeMetrics);return this.permissions=t,m&&this.emit(W.ParticipantPermissionsChanged,p),m}setIsSpeaking(t){t!==this.isSpeaking&&(this.isSpeaking=t,t&&(this.lastSpokeAt=new Date),this.emit(W.IsSpeakingChanged,t))}setConnectionQuality(t){const i=this._connectionQuality;this._connectionQuality=AC(t),i!==this._connectionQuality&&this.emit(W.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var t,i;this.activeFuture&&((i=(t=this.activeFuture).reject)===null||i===void 0||i.call(t,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(t){this.audioContext=t,this.audioTrackPublications.forEach(i=>Dn(i.track)&&i.track.setAudioContext(t))}addTrackPublication(t){t.on(J.Muted,()=>{this.emit(W.TrackMuted,t)}),t.on(J.Unmuted,()=>{this.emit(W.TrackUnmuted,t)});const i=t;switch(i.track&&(i.track.sid=t.trackSid),this.trackPublications.set(t.trackSid,t),t.kind){case H.Kind.Audio:this.audioTrackPublications.set(t.trackSid,t);break;case H.Kind.Video:this.videoTrackPublications.set(t.trackSid,t);break}}}function DC(r){var t,i,a;if(!r.participantSid&&!r.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Mh({participantIdentity:(t=r.participantIdentity)!==null&&t!==void 0?t:"",participantSid:(i=r.participantSid)!==null&&i!==void 0?i:"",allTracks:(a=r.allowAll)!==null&&a!==void 0?a:!1,trackSids:r.allowedTrackSids||[]})}class MC extends Tp{constructor(t,i,a,o,l,u){super(t,i,void 0,void 0,void 0,{loggerName:o.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=lt.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new en)},this.handleReconnected=()=>{var d,p;(p=(d=this.reconnectFuture)===null||d===void 0?void 0:d.resolve)===null||p===void 0||p.call(d),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var d,p,m,g,y,S;this.reconnectFuture&&(this.reconnectFuture.promise.catch(C=>this.log.warn(C.message,this.logContext)),(p=(d=this.reconnectFuture)===null||d===void 0?void 0:d.reject)===null||p===void 0||p.call(d,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((g=(m=this.signalConnectedFuture).reject)===null||g===void 0||g.call(m,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(S=(y=this.activeAgentFuture)===null||y===void 0?void 0:y.reject)===null||S===void 0||S.call(y,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=d=>{var p,m;d.participant&&this.updateInfo(d.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new en),(m=(p=this.signalConnectedFuture).resolve)===null||m===void 0||m.call(p)},this.handleSignalRequestResponse=d=>{const{requestId:p,reason:m,message:g}=d,y=this.pendingSignalRequests.get(p);y&&(m!==tl.OK&&y.reject(new Om(g,m)),this.pendingSignalRequests.delete(p))},this.handleDataPacket=d=>{switch(d.value.case){case"rpcResponse":let p=d.value.value,m=null,g=null;p.value.case==="payload"?m=p.value.value:p.value.case==="error"&&(g=Ze.fromProto(p.value.value)),this.handleIncomingRpcResponse(p.requestId,m,g);break;case"rpcAck":let y=d.value.value;this.handleIncomingRpcAck(y.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(d=>DC(d)))},this.onTrackUnmuted=d=>{this.onTrackMuted(d,d.isUpstreamPaused)},this.onTrackMuted=(d,p)=>{if(p===void 0&&(p=!0),!d.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Se(d)));return}this.engine.updateMuteStatus(d.sid,p)},this.onTrackUpstreamPaused=d=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Se(d))),this.onTrackMuted(d,!0)},this.onTrackUpstreamResumed=d=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Se(d))),this.onTrackMuted(d,d.isMuted)},this.onTrackFeatureUpdate=d=>{const p=this.audioTrackPublications.get(d.sid);if(!p){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(d.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(p.trackSid,p.getTrackFeatures())},this.onTrackCpuConstrained=(d,p)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Se(p))),this.emit(W.LocalTrackCpuConstrained,d,p)},this.handleSubscribedQualityUpdate=d=>T(this,void 0,void 0,function*(){var p,m,g,y,S;if(!(!((S=this.roomOptions)===null||S===void 0)&&S.dynacast))return;const C=this.videoTrackPublications.get(d.trackSid);if(!C){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:d.trackSid}));return}if(!C.videoTrack)return;const O=yield C.videoTrack.setPublishingCodecs(d.subscribedCodecs);try{for(var A=!0,I=In(O),L;L=yield I.next(),p=L.done,!p;A=!0){y=L.value,A=!1;const X=y;XS(X)&&(this.log.debug("publish ".concat(X," for ").concat(C.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Se(C))),yield this.publishAdditionalCodecForTrack(C.videoTrack,X,C.options))}}catch(X){m={error:X}}finally{try{!A&&!p&&(g=I.return)&&(yield g.call(I))}finally{if(m)throw m.error}}}),this.handleLocalTrackUnpublished=d=>{const p=this.trackPublications.get(d.trackSid);if(!p){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:d.trackSid}));return}this.unpublishTrack(p.track)},this.handleTrackEnded=d=>T(this,void 0,void 0,function*(){if(d.source===H.Source.ScreenShare||d.source===H.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Se(d))),this.unpublishTrack(d);else if(d.isUserProvided)yield d.mute();else if(zn(d)||mi(d))try{if(Pt())try{const p=yield navigator?.permissions.query({name:d.source===H.Source.Camera?"camera":"microphone"});if(p&&p.state==="denied")throw this.log.warn("user has revoked access to ".concat(d.source),Object.assign(Object.assign({},this.logContext),Se(d))),p.onchange=()=>{p.state!=="denied"&&(d.isMuted||d.restartTrack(),p.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}d.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Se(d))),zn(d)?yield d.restartTrack({deviceId:"default"}):yield d.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Se(d))),yield d.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=a,this.roomOptions=o,this.setupEngine(a),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=l,this.roomOutgoingDataStreamManager=u}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==lt.NONE}getTrackPublication(t){const i=super.getTrackPublication(t);if(i)return i}getTrackPublicationByName(t){const i=super.getTrackPublicationByName(t);if(i)return i}setupEngine(t){var i;this.engine=t,this.engine.on(Z.RemoteMute,(a,o)=>{const l=this.trackPublications.get(a);!l||!l.track||(o?l.mute():l.unmute())}),!((i=this.signalConnectedFuture)===null||i===void 0)&&i.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(Z.Connected,this.handleReconnected).on(Z.SignalConnected,this.handleSignalConnected).on(Z.SignalRestarted,this.handleReconnected).on(Z.SignalResumed,this.handleReconnected).on(Z.Restarting,this.handleReconnecting).on(Z.Resuming,this.handleReconnecting).on(Z.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(Z.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(Z.Closing,this.handleClosing).on(Z.SignalRequestResponse,this.handleSignalRequestResponse).on(Z.DataPacketReceived,this.handleDataPacket)}setMetadata(t){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:t})})}setName(t){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:t})})}setAttributes(t){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:t})})}requestMetadataUpdate(t){return T(this,arguments,void 0,function(i){var a=this;let{metadata:o,name:l,attributes:u}=i;return(function*(){return new Promise((d,p)=>T(a,void 0,void 0,function*(){var m,g;try{let y=!1;const S=yield this.engine.client.sendUpdateLocalMetadata((m=o??this.metadata)!==null&&m!==void 0?m:"",(g=l??this.name)!==null&&g!==void 0?g:"",u),C=performance.now();for(this.pendingSignalRequests.set(S,{resolve:d,reject:O=>{p(O),y=!0},values:{name:l,metadata:o,attributes:u}});performance.now()-C<5e3&&!y;){if((!l||this.name===l)&&(!o||this.metadata===o)&&(!u||Object.entries(u).every(O=>{let[A,I]=O;return this.attributes[A]===I||I===""&&!this.attributes[A]}))){this.pendingSignalRequests.delete(S),d();return}yield yt(50)}p(new Om("Request to update local metadata timed out","TimeoutError"))}catch(y){y instanceof Error&&p(y)}}))})()})}setCameraEnabled(t,i,a){return this.setTrackEnabled(H.Source.Camera,t,i,a)}setMicrophoneEnabled(t,i,a){return this.setTrackEnabled(H.Source.Microphone,t,i,a)}setScreenShareEnabled(t,i,a){return this.setTrackEnabled(H.Source.ScreenShare,t,i,a)}setE2EEEnabled(t){return T(this,void 0,void 0,function*(){this.encryptionType=t?lt.GCM:lt.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(t,i,a,o){return T(this,void 0,void 0,function*(){var l,u;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:t,enabled:i})),this.republishPromise&&(yield this.republishPromise);let d=this.getTrackPublication(t);if(i)if(d)yield d.unmute();else{let p;if(this.pendingPublishing.has(t)){const m=yield this.waitForPendingPublicationOfSource(t);return m||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:t})),yield m?.unmute(),m}this.pendingPublishing.add(t);try{switch(t){case H.Source.Camera:p=yield this.createTracks({video:(l=a)!==null&&l!==void 0?l:!0});break;case H.Source.Microphone:p=yield this.createTracks({audio:(u=a)!==null&&u!==void 0?u:!0});break;case H.Source.ScreenShare:p=yield this.createScreenTracks(Object.assign({},a));break;default:throw new jn(t)}}catch(m){throw p?.forEach(g=>{g.stop()}),m instanceof Error&&this.emit(W.MediaDevicesError,m,wl(t)),this.pendingPublishing.delete(t),m}for(const m of p){const g=Object.assign(Object.assign({},this.roomOptions.publishDefaults),a);t===H.Source.Microphone&&Dn(m)&&g.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),m.startPreConnectBuffer())}try{const m=[];for(const y of p)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Se(y))),m.push(this.publishTrack(y,o));[d]=yield Promise.all(m)}catch(m){throw p?.forEach(g=>{g.stop()}),m}finally{this.pendingPublishing.delete(t)}}else if(!d?.track&&this.pendingPublishing.has(t)&&(d=yield this.waitForPendingPublicationOfSource(t),d||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:t}))),d&&d.track)if(t===H.Source.ScreenShare){d=yield this.unpublishTrack(d.track);const p=this.getTrackPublication(H.Source.ScreenShareAudio);p&&p.track&&this.unpublishTrack(p.track)}else yield d.mute();return d})}enableCameraAndMicrophone(){return T(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(H.Source.Camera)||this.pendingPublishing.has(H.Source.Microphone))){this.pendingPublishing.add(H.Source.Camera),this.pendingPublishing.add(H.Source.Microphone);try{const t=yield this.createTracks({audio:!0,video:!0});yield Promise.all(t.map(i=>this.publishTrack(i)))}finally{this.pendingPublishing.delete(H.Source.Camera),this.pendingPublishing.delete(H.Source.Microphone)}}})}createTracks(t){return T(this,void 0,void 0,function*(){var i,a;t??(t={});const o=zm(t,(i=this.roomOptions)===null||i===void 0?void 0:i.audioCaptureDefaults,(a=this.roomOptions)===null||a===void 0?void 0:a.videoCaptureDefaults);try{return(yield oo(o,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(d=>(Dn(d)&&(this.microphoneError=void 0,d.setAudioContext(this.audioContext),d.source=H.Source.Microphone,this.emit(W.AudioStreamAcquired)),hi(d)&&(this.cameraError=void 0,d.source=H.Source.Camera),d))}catch(l){throw l instanceof Error&&(t.audio&&(this.microphoneError=l),t.video&&(this.cameraError=l)),l}})}createScreenTracks(t){return T(this,void 0,void 0,function*(){if(t===void 0&&(t={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new fl("getDisplayMedia not supported");t.resolution===void 0&&!nT()&&(t.resolution=yl.h1080fps30.resolution);const i=yT(t),a=yield navigator.mediaDevices.getDisplayMedia(i),o=a.getVideoTracks();if(o.length===0)throw new jn("no video track found");const l=new ro(o[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});l.source=H.Source.ScreenShare,t.contentHint&&(l.mediaStreamTrack.contentHint=t.contentHint);const u=[l];if(a.getAudioTracks().length>0){this.emit(W.AudioStreamAcquired);const d=new so(a.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});d.source=H.Source.ScreenShareAudio,u.push(d)}return u})}publishTrack(t,i){return T(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(t,i)})}publishOrRepublishTrack(t,i){return T(this,arguments,void 0,function(a,o){var l=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var d,p,m,g;zn(a)&&a.setAudioContext(l.audioContext),yield(d=l.reconnectFuture)===null||d===void 0?void 0:d.promise,l.republishPromise&&!u&&(yield l.republishPromise),ka(a)&&l.pendingPublishPromises.has(a)&&(yield l.pendingPublishPromises.get(a));let y;if(a instanceof MediaStreamTrack)y=a.getConstraints();else{y=a.constraints;let L;switch(a.source){case H.Source.Microphone:L="audioinput";break;case H.Source.Camera:L="videoinput"}L&&l.activeDeviceMap.has(L)&&(y=Object.assign(Object.assign({},y),{deviceId:l.activeDeviceMap.get(L)}))}if(a instanceof MediaStreamTrack)switch(a.kind){case"audio":a=new so(a,y,!0,l.audioContext,{loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});break;case"video":a=new ro(a,y,!0,{loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});break;default:throw new jn("unsupported MediaStreamTrack kind ".concat(a.kind))}else a.updateLoggerOptions({loggerName:l.roomOptions.loggerName,loggerContextCb:()=>l.logContext});let S;if(l.trackPublications.forEach(L=>{L.track&&L.track===a&&(S=L)}),S)return l.log.warn("track has already been published, skipping",Object.assign(Object.assign({},l.logContext),Se(S))),S;const C=Object.assign(Object.assign({},l.roomOptions.publishDefaults),o),O="channelCount"in a.mediaStreamTrack.getSettings()&&a.mediaStreamTrack.getSettings().channelCount===2||a.mediaStreamTrack.getConstraints().channelCount===2,A=(p=C.forceStereo)!==null&&p!==void 0?p:O;A&&(C.dtx===void 0&&l.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},l.logContext),Se(a))),C.red===void 0&&l.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(m=C.dtx)!==null&&m!==void 0||(C.dtx=!1),(g=C.red)!==null&&g!==void 0||(C.red=!1)),!aT()&&l.roomOptions.e2ee&&(l.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},l.logContext)),C.simulcast=!1),C.source&&(a.source=C.source);const I=new Promise((L,X)=>T(l,void 0,void 0,function*(){try{if(this.engine.client.currentState!==Ve.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Se(a)}));let K=!1;const D=setTimeout(()=>{K=!0,a.stop(),X(new Rm("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(D),K)return;const x=yield this.publish(a,C,A);L(x)}else try{const K=yield this.publish(a,C,A);L(K)}catch(K){X(K)}}catch(K){X(K)}}));l.pendingPublishPromises.set(a,I);try{return yield I}catch(L){throw L}finally{l.pendingPublishPromises.delete(a)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new en),this.signalConnectedFuture.promise}hasPermissionsToPublish(t){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Se(t))),!1;const{canPublish:i,canPublishSources:a}=this.permissions;return i&&(a.length===0||a.map(o=>CT(o)).includes(t.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Se(t))),!1)}publish(t,i,a){return T(this,void 0,void 0,function*(){var o,l,u,d,p,m,g,y,S,C;if(!this.hasPermissionsToPublish(t))throw new Rm("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(ie=>ka(t)&&ie.source===t.source)&&t.source!==H.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(t.source),Object.assign(Object.assign({},this.logContext),Se(t))),i.stopMicTrackOnMute&&Dn(t)&&(t.stopOnMute=!0),t.source===H.Source.ScreenShare&&Ki()&&(i.simulcast=!1),i.videoCodec==="av1"&&!$S()&&(i.videoCodec=void 0),i.videoCodec==="vp9"&&!eT()&&(i.videoCodec=void 0),i.videoCodec===void 0&&(i.videoCodec=zl),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(ie=>i.videoCodec===ws(ie.mime))||(i.videoCodec=ws(this.enabledPublishVideoCodecs[0].mime)));const A=i.videoCodec;t.on(J.Muted,this.onTrackMuted),t.on(J.Unmuted,this.onTrackUnmuted),t.on(J.Ended,this.handleTrackEnded),t.on(J.UpstreamPaused,this.onTrackUpstreamPaused),t.on(J.UpstreamResumed,this.onTrackUpstreamResumed),t.on(J.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const I=[],L=!(!((o=i.dtx)!==null&&o!==void 0)||o),X=t.getSourceTrackSettings();X.autoGainControl&&I.push(ft.TF_AUTO_GAIN_CONTROL),X.echoCancellation&&I.push(ft.TF_ECHO_CANCELLATION),X.noiseSuppression&&I.push(ft.TF_NOISE_SUPPRESSION),X.channelCount&&X.channelCount>1&&I.push(ft.TF_STEREO),L&&I.push(ft.TF_NO_DTX),zn(t)&&t.hasPreConnectBuffer&&I.push(ft.TF_PRECONNECT_BUFFER);const K=new Cs({cid:t.mediaStreamTrack.id,name:i.name,type:H.kindToProto(t.kind),muted:t.isMuted,source:H.sourceToProto(t.source),disableDtx:L,encryption:this.encryptionType,stereo:a,disableRed:this.isE2EEEnabled||!(!((l=i.red)!==null&&l!==void 0)||l),stream:i?.stream,backupCodecPolicy:i?.backupCodecPolicy,audioFeatures:I});let D;if(t.kind===H.Kind.Video){let ie={width:0,height:0};try{ie=yield t.waitForDimensions()}catch{const ae=(d=(u=this.roomOptions.videoCaptureDefaults)===null||u===void 0?void 0:u.resolution)!==null&&d!==void 0?d:Os.h720.resolution;ie={width:ae.width,height:ae.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Se(t)),{dims:ie}))}K.width=ie.width,K.height=ie.height,mi(t)&&(vn(A)&&(t.source===H.Source.ScreenShare&&(i.scalabilityMode="L1T3","contentHint"in t.mediaStreamTrack&&(t.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Se(t))))),i.scalabilityMode=(p=i.scalabilityMode)!==null&&p!==void 0?p:"L3T3_KEY"),K.simulcastCodecs=[new Jc({codec:A,cid:t.mediaStreamTrack.id})],i.backupCodec===!0&&(i.backupCodec={codec:zl}),i.backupCodec&&A!==i.backupCodec.codec&&K.encryption===lt.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),K.simulcastCodecs.push(new Jc({codec:i.backupCodec.codec,cid:""})))),D=Kl(t.source===H.Source.ScreenShare,K.width,K.height,i),K.layers=fp(K.width,K.height,D,vn(i.videoCodec))}else t.kind===H.Kind.Audio&&(D=[{maxBitrate:(m=i.audioPreset)===null||m===void 0?void 0:m.maxBitrate,priority:(y=(g=i.audioPreset)===null||g===void 0?void 0:g.priority)!==null&&y!==void 0?y:"high",networkPriority:(C=(S=i.audioPreset)===null||S===void 0?void 0:S.priority)!==null&&C!==void 0?C:"high"}]);if(!this.engine||this.engine.isClosed)throw new ut("cannot publish track when not connected");const x=()=>T(this,void 0,void 0,function*(){var ie,ne,ae;if(!this.engine.pcManager)throw new ut("pcManager is not ready");if(t.sender=yield this.engine.createSender(t,i,D),this.emit(W.LocalSenderCreated,t.sender,t),mi(t)&&((ie=i.degradationPreference)!==null&&ie!==void 0||(i.degradationPreference=fC(t)),t.setDegradationPreference(i.degradationPreference)),D)if(Ki()&&t.kind===H.Kind.Audio){let de;for(const Qe of this.engine.pcManager.publisher.getTransceivers())if(Qe.sender===t.sender){de=Qe;break}de&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:de,codec:"opus",maxbr:!((ne=D[0])===null||ne===void 0)&&ne.maxBitrate?D[0].maxBitrate/1e3:0})}else t.codec&&vn(t.codec)&&(!((ae=D[0])===null||ae===void 0)&&ae.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:K.cid,codec:t.codec,maxbr:D[0].maxBitrate/1e3});yield this.engine.negotiate()});let F;const Y=new Promise((ie,ne)=>T(this,void 0,void 0,function*(){var ae;try{F=yield this.engine.addTrack(K),ie(F)}catch(de){t.sender&&(!((ae=this.engine.pcManager)===null||ae===void 0)&&ae.publisher)&&(this.engine.pcManager.publisher.removeTrack(t.sender),yield this.engine.negotiate().catch(Qe=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Se(t)),{error:Qe}))})),ne(de)}}));if(this.enabledPublishVideoCodecs.length>0)F=(yield Promise.all([Y,x()]))[0];else{F=yield Y;let ie;if(F.codecs.forEach(ne=>{ie===void 0&&(ie=ne.mimeType)}),ie&&t.kind===H.Kind.Video){const ne=ws(ie);ne!==A&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Se(t)),{codec:ne})),i.videoCodec=ne,D=Kl(t.source===H.Source.ScreenShare,K.width,K.height,i))}yield x()}const te=new Zl(t.kind,F,t,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(te.on(J.CpuConstrained,ie=>this.onTrackCpuConstrained(ie,te)),te.options=i,t.sid=F.sid,this.log.debug("publishing ".concat(t.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:D,trackInfo:F})),mi(t)?t.startMonitor(this.engine.client):zn(t)&&t.startMonitor(),this.addTrackPublication(te),this.emit(W.LocalTrackPublished,te),zn(t)&&F.audioFeatures.includes(ft.TF_PRECONNECT_BUFFER)){const ie=t.getPreConnectBuffer(),ne=t.getPreConnectBufferMimeType();this.on(W.LocalTrackSubscribed,ae=>{if(ae.trackSid===F.sid){if(!t.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Se(t))),t.stopPreConnectBuffer()}}),ie&&new Promise((de,Qe)=>T(this,void 0,void 0,function*(){var mt,bt,j,$,le,Ae;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Se(t)));const ee=setTimeout(()=>{Qe(new Error("agent not active within 10 seconds"))},1e4),re=yield this.waitUntilActiveAgentPresent();clearTimeout(ee),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Se(t)));const fe=yield this.streamBytes({name:"preconnect-buffer",mimeType:ne,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[re.identity],attributes:{trackId:te.trackSid,sampleRate:String((le=X.sampleRate)!==null&&le!==void 0?le:"48000"),channels:String((Ae=X.channelCount)!==null&&Ae!==void 0?Ae:"1")}});try{for(var xe=!0,_=In(ie),q;q=yield _.next(),mt=q.done,!mt;xe=!0){$=q.value,xe=!1;const ve=$;yield fe.write(ve)}}catch(ve){bt={error:ve}}finally{try{!xe&&!mt&&(j=_.return)&&(yield j.call(_))}finally{if(bt)throw bt.error}}yield fe.close(),de()}catch(ee){Qe(ee)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Se(t)))}).catch(de=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Se(t)),{error:de}))})}return te})}get isLocal(){return!0}publishAdditionalCodecForTrack(t,i,a){return T(this,void 0,void 0,function*(){var o;if(this.encryptionType!==lt.NONE)return;let l;if(this.trackPublications.forEach(C=>{C.track&&C.track===t&&(l=C)}),!l)throw new jn("track is not published");if(!mi(t))throw new jn("track is not a video track");const u=Object.assign(Object.assign({},(o=this.roomOptions)===null||o===void 0?void 0:o.publishDefaults),a),d=lC(t,i,u);if(!d){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Se(t)));return}const p=t.addSimulcastTrack(i,d);if(!p)return;const m=new Cs({cid:p.mediaStreamTrack.id,type:H.kindToProto(t.kind),muted:t.isMuted,source:H.sourceToProto(t.source),sid:t.sid,simulcastCodecs:[{codec:u.videoCodec,cid:p.mediaStreamTrack.id}]});if(m.layers=fp(m.width,m.height,d),!this.engine||this.engine.isClosed)throw new ut("cannot publish track when not connected");const g=()=>T(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(t,p,u,d),yield this.engine.negotiate()}),S=(yield Promise.all([this.engine.addTrack(m),g()]))[0];this.log.debug("published ".concat(i," for track ").concat(t.sid),Object.assign(Object.assign({},this.logContext),{encodings:d,trackInfo:S}))})}unpublishTrack(t,i){return T(this,void 0,void 0,function*(){var a,o;if(ka(t)){const m=this.pendingPublishPromises.get(t);m&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Se(t))),yield m)}const l=this.getPublicationForTrack(t),u=l?Se(l):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),u)),!l||!l.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),u));return}t=l.track,t.off(J.Muted,this.onTrackMuted),t.off(J.Unmuted,this.onTrackUnmuted),t.off(J.Ended,this.handleTrackEnded),t.off(J.UpstreamPaused,this.onTrackUpstreamPaused),t.off(J.UpstreamResumed,this.onTrackUpstreamResumed),t.off(J.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),i===void 0&&(i=(o=(a=this.roomOptions)===null||a===void 0?void 0:a.stopLocalTrackOnUnpublish)!==null&&o!==void 0?o:!0),i?t.stop():t.stopMonitor();let d=!1;const p=t.sender;if(t.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Xe.FAILED&&p)try{for(const m of this.engine.pcManager.publisher.getTransceivers())m.sender===p&&(m.direction="inactive",d=!0);if(this.engine.removeTrack(p)&&(d=!0),mi(t)){for(const[,m]of t.simulcastCodecs)m.sender&&(this.engine.removeTrack(m.sender)&&(d=!0),m.sender=void 0);t.simulcastCodecs.clear()}}catch(m){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),u),{error:m}))}switch(this.trackPublications.delete(l.trackSid),l.kind){case H.Kind.Audio:this.audioTrackPublications.delete(l.trackSid);break;case H.Kind.Video:this.videoTrackPublications.delete(l.trackSid);break}return this.emit(W.LocalTrackUnpublished,l),l.setTrack(void 0),d&&(yield this.engine.negotiate()),l})}unpublishTracks(t){return T(this,void 0,void 0,function*(){return(yield Promise.all(t.map(a=>this.unpublishTrack(a)))).filter(a=>!!a)})}republishAllTracks(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){a.republishPromise&&(yield a.republishPromise),a.republishPromise=new Promise((l,u)=>T(a,void 0,void 0,function*(){try{const d=[];this.trackPublications.forEach(p=>{p.track&&(i&&(p.options=Object.assign(Object.assign({},p.options),i)),d.push(p))}),yield Promise.all(d.map(p=>T(this,void 0,void 0,function*(){const m=p.track;yield this.unpublishTrack(m,!1),o&&!m.isMuted&&m.source!==H.Source.ScreenShare&&m.source!==H.Source.ScreenShareAudio&&(zn(m)||mi(m))&&!m.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:p.trackSid})),yield m.restartTrack()),yield this.publishOrRepublishTrack(m,p.options,!0)}))),l()}catch(d){u(d)}finally{this.republishPromise=void 0}})),yield a.republishPromise})()})}publishData(t){return T(this,arguments,void 0,function(i){var a=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const l=o.reliable?be.RELIABLE:be.LOSSY,u=o.destinationIdentities,d=o.topic;let p=new Fc({participantIdentity:a.identity,payload:i,destinationIdentities:u,topic:d});const m=new Ot({kind:l,value:{case:"user",value:p}});yield a.engine.sendDataPacket(m,l)})()})}publishDtmf(t,i){return T(this,void 0,void 0,function*(){const a=new Ot({kind:be.RELIABLE,value:{case:"sipDtmf",value:new hh({code:t,digit:i})}});yield this.engine.sendDataPacket(a,be.RELIABLE)})}sendChatMessage(t,i){return T(this,void 0,void 0,function*(){const a={id:crypto.randomUUID(),message:t,timestamp:Date.now(),attachedFiles:i?.attachments},o=new Ot({value:{case:"chatMessage",value:new Br(Object.assign(Object.assign({},a),{timestamp:Ke.parse(a.timestamp)}))}});return yield this.engine.sendDataPacket(o,be.RELIABLE),this.emit(W.ChatMessage,a),a})}editChatMessage(t,i){return T(this,void 0,void 0,function*(){const a=Object.assign(Object.assign({},i),{message:t,editTimestamp:Date.now()}),o=new Ot({value:{case:"chatMessage",value:new Br(Object.assign(Object.assign({},a),{timestamp:Ke.parse(a.timestamp),editTimestamp:Ke.parse(a.editTimestamp)}))}});return yield this.engine.sendDataPacket(o,be.RELIABLE),this.emit(W.ChatMessage,a),a})}sendText(t,i){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(t,i)})}streamText(t){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(t)})}sendFile(t,i){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(t,i)})}streamBytes(t){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(t)})}performRpc(t){return T(this,arguments,void 0,function(i){var a=this;let{destinationIdentity:o,method:l,payload:u,responseTimeout:d=15e3}=i;return(function*(){return new Promise((g,y)=>T(a,void 0,void 0,function*(){var S,C,O,A;if(Vl(u)>ap){y(Ze.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((C=(S=this.engine.latestJoinResponse)===null||S===void 0?void 0:S.serverInfo)===null||C===void 0)&&C.version&&An((A=(O=this.engine.latestJoinResponse)===null||O===void 0?void 0:O.serverInfo)===null||A===void 0?void 0:A.version,"1.8.0")<0){y(Ze.builtIn("UNSUPPORTED_SERVER"));return}const I=Math.max(d,8e3),L=crypto.randomUUID();yield this.publishRpcRequest(o,L,l,u,I);const X=setTimeout(()=>{this.pendingAcks.delete(L),y(Ze.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(L),clearTimeout(K)},7e3);this.pendingAcks.set(L,{resolve:()=>{clearTimeout(X)},participantIdentity:o});const K=setTimeout(()=>{this.pendingResponses.delete(L),y(Ze.builtIn("RESPONSE_TIMEOUT"))},d);this.pendingResponses.set(L,{resolve:(D,x)=>{clearTimeout(K),this.pendingAcks.has(L)&&(console.warn("RPC response received before ack",L),this.pendingAcks.delete(L),clearTimeout(X)),x?y(x):g(D??"")},participantIdentity:o})}))})()})}registerRpcMethod(t,i){this.rpcHandlers.has(t)&&this.log.warn("you're overriding the RPC handler for method ".concat(t,", in the future this will throw an error")),this.rpcHandlers.set(t,i)}unregisterRpcMethod(t){this.rpcHandlers.delete(t)}setTrackSubscriptionPermissions(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=i,this.allParticipantsAllowedToSubscribe=t,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(t){const i=this.pendingAcks.get(t);i?(i.resolve(),this.pendingAcks.delete(t)):console.error("Ack received for unexpected RPC request",t)}handleIncomingRpcResponse(t,i,a){const o=this.pendingResponses.get(t);o?(o.resolve(i,a),this.pendingResponses.delete(t)):console.error("Response received for unexpected RPC request",t)}publishRpcRequest(t,i,a,o,l){return T(this,void 0,void 0,function*(){const u=new Ot({destinationIdentities:[t],kind:be.RELIABLE,value:{case:"rpcRequest",value:new Hc({id:i,method:a,payload:o,responseTimeoutMs:l,version:1})}});yield this.engine.sendDataPacket(u,be.RELIABLE)})}handleParticipantDisconnected(t){for(const[i,{participantIdentity:a}]of this.pendingAcks)a===t&&this.pendingAcks.delete(i);for(const[i,{participantIdentity:a,resolve:o}]of this.pendingResponses)a===t&&(o(null,Ze.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(i))}setEnabledPublishCodecs(t){this.enabledPublishVideoCodecs=t.filter(i=>i.mime.split("/")[0].toLowerCase()==="video")}updateInfo(t){return super.updateInfo(t)?(t.tracks.forEach(i=>{var a,o;const l=this.trackPublications.get(i.sid);if(l){const u=l.isMuted||((o=(a=l.track)===null||a===void 0?void 0:a.isUpstreamPaused)!==null&&o!==void 0?o:!1);u!==i.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Se(l)),{mutedOnServer:u})),this.engine.client.sendMuteTrack(i.sid,u))}}),!0):!1}setActiveAgent(t){var i,a,o,l;this.firstActiveAgent=t,t&&!this.firstActiveAgent&&(this.firstActiveAgent=t),t?(a=(i=this.activeAgentFuture)===null||i===void 0?void 0:i.resolve)===null||a===void 0||a.call(i,t):(l=(o=this.activeAgentFuture)===null||o===void 0?void 0:o.reject)===null||l===void 0||l.call(o,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new en),this.activeAgentFuture.promise)}getPublicationForTrack(t){let i;return this.trackPublications.forEach(a=>{const o=a.track;o&&(t instanceof MediaStreamTrack?(zn(o)||mi(o))&&o.mediaStreamTrack===t&&(i=a):t===o&&(i=a))}),i}waitForPendingPublicationOfSource(t){return T(this,void 0,void 0,function*(){const a=Date.now();for(;Date.now()<a+1e4;){const o=Array.from(this.pendingPublishPromises.entries()).find(l=>{let[u]=l;return u.source===t});if(o)return o[1];yield yt(20)}})}}class wC extends qn{constructor(t,i,a,o){super(t,i.sid,i.name,o),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=l=>{this.setTrack(void 0),this.emit(J.Ended,l)},this.handleVisibilityChange=l=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(l),this.logContext),this.visible=l,this.emitTrackUpdate()},this.handleVideoDimensionsChange=l=>{this.log.debug("adaptivestream video dimensions ".concat(l.width,"x").concat(l.height),this.logContext),this.videoDimensionsAdaptiveStream=l,this.emitTrackUpdate()},this.subscribed=a,this.updateInfo(i)}setSubscribed(t){const i=this.subscriptionStatus,a=this.permissionStatus;this.subscribed=t,t&&(this.allowed=!0);const o=new Hr({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new ph({participantSid:"",trackSids:[this.trackSid]})]});this.emit(J.UpdateSubscription,o),this.emitSubscriptionUpdateIfChanged(i),this.emitPermissionUpdateIfChanged(a)}get subscriptionStatus(){return this.subscribed===!1?qn.SubscriptionStatus.Unsubscribed:super.isSubscribed?qn.SubscriptionStatus.Subscribed:qn.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?qn.PermissionStatus.Allowed:qn.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(t){!this.isManualOperationAllowed()||this.requestedDisabled===!t||(this.requestedDisabled=!t,this.emitTrackUpdate())}setVideoQuality(t){!this.isManualOperationAllowed()||this.requestedMaxQuality===t||(this.requestedMaxQuality=t,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(t){var i,a;this.isManualOperationAllowed()&&(((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.width)===t.width&&((a=this.requestedVideoDimensions)===null||a===void 0?void 0:a.height)===t.height||(Ol(this.track)&&(this.requestedVideoDimensions=t),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(t){this.isManualOperationAllowed()&&Ol(this.track)&&this.fps!==t&&(this.fps=t,this.emitTrackUpdate())}get videoQuality(){var t;return(t=this.requestedMaxQuality)!==null&&t!==void 0?t:Vt.HIGH}setTrack(t){const i=this.subscriptionStatus,a=this.permissionStatus,o=this.track;o!==t&&(o&&(o.off(J.VideoDimensionsChanged,this.handleVideoDimensionsChange),o.off(J.VisibilityChanged,this.handleVisibilityChange),o.off(J.Ended,this.handleEnded),o.detach(),o.stopMonitor(),this.emit(J.Unsubscribed,o)),super.setTrack(t),t&&(t.sid=this.trackSid,t.on(J.VideoDimensionsChanged,this.handleVideoDimensionsChange),t.on(J.VisibilityChanged,this.handleVisibilityChange),t.on(J.Ended,this.handleEnded),this.emit(J.Subscribed,t)),this.emitPermissionUpdateIfChanged(a),this.emitSubscriptionUpdateIfChanged(i))}setAllowed(t){const i=this.subscriptionStatus,a=this.permissionStatus;this.allowed=t,this.emitPermissionUpdateIfChanged(a),this.emitSubscriptionUpdateIfChanged(i)}setSubscriptionError(t){this.emit(J.SubscriptionFailed,t)}updateInfo(t){super.updateInfo(t);const i=this.metadataMuted;this.metadataMuted=t.muted,this.track?this.track.setMuted(t.muted):i!==t.muted&&this.emit(t.muted?J.Muted:J.Unmuted)}emitSubscriptionUpdateIfChanged(t){const i=this.subscriptionStatus;t!==i&&this.emit(J.SubscriptionStatusChanged,i,t)}emitPermissionUpdateIfChanged(t){this.permissionStatus!==t&&this.emit(J.SubscriptionPermissionChanged,this.permissionStatus,t)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Ol(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const t=new Rh({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===H.Kind.Video){let i=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(i)Fm(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),i=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const a=kT(this.trackInfo,this.requestedMaxQuality);a&&Fm(this.videoDimensionsAdaptiveStream,a)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),i=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),i=this.videoDimensionsAdaptiveStream;i?(t.width=Math.ceil(i.width),t.height=Math.ceil(i.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),t.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:Vt.HIGH})),t.quality=Vt.HIGH)}this.emit(J.UpdateSettings,t)}}class co extends Tp{static fromParticipantInfo(t,i,a){return new co(t,i.sid,i.identity,i.name,i.metadata,i.attributes,a,i.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(t,i,a,o,l,u,d){let p=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Ts.STANDARD;super(i,a||"",o,l,u,d,p),this.signalClient=t,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(t){super.addTrackPublication(t),t.on(J.UpdateSettings,i=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Se(t)),{settings:i})),this.signalClient.sendUpdateTrackSettings(i)}),t.on(J.UpdateSubscription,i=>{i.participantTracks.forEach(a=>{a.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(i)}),t.on(J.SubscriptionPermissionChanged,i=>{this.emit(W.TrackSubscriptionPermissionChanged,t,i)}),t.on(J.SubscriptionStatusChanged,i=>{this.emit(W.TrackSubscriptionStatusChanged,t,i)}),t.on(J.Subscribed,i=>{this.emit(W.TrackSubscribed,i,t)}),t.on(J.Unsubscribed,i=>{this.emit(W.TrackUnsubscribed,i,t)}),t.on(J.SubscriptionFailed,i=>{this.emit(W.TrackSubscriptionFailed,t.trackSid,i)})}getTrackPublication(t){const i=super.getTrackPublication(t);if(i)return i}getTrackPublicationByName(t){const i=super.getTrackPublicationByName(t);if(i)return i}setVolume(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:H.Source.Microphone;this.volumeMap.set(i,t);const a=this.getTrackPublication(i);a&&a.track&&a.track.setVolume(t)}getVolume(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:H.Source.Microphone;const i=this.getTrackPublication(t);return i&&i.track?i.track.getVolume():this.volumeMap.get(t)}addSubscribedMediaTrack(t,i,a,o,l,u){let d=this.getTrackPublicationBySid(i);if(d||i.startsWith("TR")||this.trackPublications.forEach(g=>{!d&&t.kind===g.kind.toString()&&(d=g)}),!d){if(u===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:i})),this.emit(W.TrackSubscriptionFailed,i);return}u===void 0&&(u=20),setTimeout(()=>{this.addSubscribedMediaTrack(t,i,a,o,l,u-1)},150);return}if(t.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Se(d))),this.emit(W.TrackSubscriptionFailed,i);return}const p=t.kind==="video";let m;return p?m=new EC(t,i,o,l):m=new Sp(t,i,o,this.audioContext,this.audioOutput),m.source=d.source,m.isMuted=d.isMuted,m.setMediaStream(a),m.start(),d.setTrack(m),this.volumeMap.has(d.source)&&Rl(m)&&Dn(m)&&m.setVolume(this.volumeMap.get(d.source)),d}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(t){return this.trackPublications.get(t)}updateInfo(t){if(!super.updateInfo(t))return!1;const i=new Map,a=new Map;return t.tracks.forEach(o=>{var l,u;let d=this.getTrackPublicationBySid(o.sid);if(d)d.updateInfo(o);else{const p=H.kindFromProto(o.type);if(!p)return;d=new wC(p,o,(l=this.signalClient.connectOptions)===null||l===void 0?void 0:l.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(u=this.loggerOptions)===null||u===void 0?void 0:u.loggerName}),d.updateInfo(o),a.set(o.sid,d);const m=Array.from(this.trackPublications.values()).find(g=>g.source===d?.source);m&&d.source!==H.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(d.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Se(m),newTrack:Se(d)})),this.addTrackPublication(d)}i.set(o.sid,d)}),this.trackPublications.forEach(o=>{i.has(o.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Se(o))),this.unpublishTrack(o.trackSid,!0))}),a.forEach(o=>{this.emit(W.TrackPublished,o)}),!0}unpublishTrack(t,i){const a=this.trackPublications.get(t);if(!a)return;const{track:o}=a;switch(o&&(o.stop(),a.setTrack(void 0)),this.trackPublications.delete(t),a.kind){case H.Kind.Audio:this.audioTrackPublications.delete(t);break;case H.Kind.Video:this.videoTrackPublications.delete(t);break}i&&this.emit(W.TrackUnpublished,a)}setAudioOutput(t){return T(this,void 0,void 0,function*(){this.audioOutput=t;const i=[];this.audioTrackPublications.forEach(a=>{var o;Dn(a.track)&&Rl(a.track)&&i.push(a.track.setSinkId((o=t.deviceId)!==null&&o!==void 0?o:"default"))}),yield Promise.all(i)})}emit(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:t,args:a})),super.emit(t,...a)}}var Ne;(function(r){r.Disconnected="disconnected",r.Connecting="connecting",r.Connected="connected",r.Reconnecting="reconnecting",r.SignalReconnecting="signalReconnecting"})(Ne||(Ne={}));const NC=4*1e3;class Aa extends Rn.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(t){var i,a,o,l;if(super(),i=this,this.state=Ne.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=ge,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(u,d,p)=>T(this,void 0,void 0,function*(){var m;if(!tT())throw On()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const g=yield this.disconnectLock.lock();if(this.state===Ne.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),g(),Promise.resolve();if(this.connectFuture)return g(),this.connectFuture.promise;this.setAndEmitConnectionState(Ne.Connecting),((m=this.regionUrlProvider)===null||m===void 0?void 0:m.getServerUrl().toString())!==u&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),no(new URL(u))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new we(u,d):this.regionUrlProvider.updateToken(d),this.regionUrlProvider.fetchRegionSettings().then(C=>{var O;(O=this.regionUrlProvider)===null||O===void 0||O.setServerReportedRegions(C)}).catch(C=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:C}))}));const y=(C,O,A)=>T(this,void 0,void 0,function*(){var I,L;this.abortController&&this.abortController.abort();const X=new AbortController;this.abortController=X,g?.();try{if(yield Ea.getInstance().getBackOffPromise(u),X.signal.aborted)throw new Ee("Connection attempt aborted",me.Cancelled);yield this.attemptConnection(A??u,d,p,X),this.abortController=void 0,C()}catch(K){if(this.regionUrlProvider&&K instanceof Ee&&K.reason!==me.Cancelled&&K.reason!==me.NotAllowed){let D=null;try{this.log.debug("Fetching next region"),D=yield this.regionUrlProvider.getNextBestRegionUrl((I=this.abortController)===null||I===void 0?void 0:I.signal)}catch(x){if(x instanceof Ee&&(x.status===401||x.reason===me.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),O(x);return}}[me.InternalError,me.ServerUnreachable,me.Timeout].includes(K.reason)&&(this.log.debug("Adding failed connection attempt to back off"),Ea.getInstance().addFailedConnectionAttempt(u)),D&&!(!((L=this.abortController)===null||L===void 0)&&L.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(K.message,". Retrying with another region: ").concat(D),this.logContext),this.recreateEngine(),yield y(C,O,D)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,jm(K)),O(K))}else{let D=mn.UNKNOWN_REASON;K instanceof Ee&&(D=jm(K)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,D),O(K)}}}),S=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new en((C,O)=>{y(C,O,S)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(u,d,p,m,g,y)=>T(this,void 0,void 0,function*(){var S,C,O;const A=yield p.join(u,d,{autoSubscribe:m.autoSubscribe,adaptiveStream:typeof g.adaptiveStream=="object"?!0:g.adaptiveStream,maxRetries:m.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:m.websocketTimeout,singlePeerConnection:g.singlePeerConnection},y.signal);let I=A.serverInfo;if(I||(I={version:A.serverVersion,region:A.serverRegion}),this.serverInfo=I,this.log.debug("connected to Livekit Server ".concat(Object.entries(I).map(L=>{let[X,K]=L;return"".concat(X,": ").concat(K)}).join(", ")),{room:(S=A.room)===null||S===void 0?void 0:S.name,roomSid:(C=A.room)===null||C===void 0?void 0:C.sid,identity:(O=A.participant)===null||O===void 0?void 0:O.identity}),!I.version)throw new jS("unknown server version");return I.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),g.dynacast=!1),A}),this.applyJoinResponse=u=>{const d=u.participant;if(this.localParticipant.sid=d.sid,this.localParticipant.identity=d.identity,this.localParticipant.setEnabledPublishCodecs(u.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(u.sifTrailer)}catch(p){this.log.error(p instanceof Error?p.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:p}))}this.handleParticipantUpdates([d,...u.otherParticipants]),u.room&&this.handleRoomUpdate(u.room)},this.attemptConnection=(u,d,p,m)=>T(this,void 0,void 0,function*(){var g,y;this.state===Ne.Reconnecting||this.isResuming||!((g=this.engine)===null||g===void 0)&&g.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((y=this.regionUrlProvider)===null||y===void 0)&&y.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},ql),p),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const S=yield this.connectSignal(u,d,this.engine,this.connOptions,this.options,m);this.applyJoinResponse(S),this.setupLocalParticipantEvents(),this.emit(Q.SignalConnected)}catch(S){yield this.engine.close(),this.recreateEngine();const C=new Ee("could not establish signal connection",m.signal.aborted?me.Cancelled:me.ServerUnreachable);throw S instanceof Error&&(C.message="".concat(C.message,": ").concat(S.message)),S instanceof Ee&&(C.reason=S.reason,C.status=S.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:S})),C}if(m.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new Ee("Connection attempt aborted",me.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,m)}catch(S){throw yield this.engine.close(),this.recreateEngine(),S}Pt()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Pt()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Ne.Connected),this.emit(Q.Connected),Ea.getInstance().resetFailedConnectionAttempts(u),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var u=arguments.length,d=new Array(u),p=0;p<u;p++)d[p]=arguments[p];return T(i,[...d],void 0,function(){var m=this;let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var y,S,C;const O=yield m.disconnectLock.lock();try{if(m.state===Ne.Disconnected){m.log.debug("already disconnected",m.logContext);return}if(m.log.info("disconnect from room",Object.assign({},m.logContext)),m.state===Ne.Connecting||m.state===Ne.Reconnecting||m.isResuming){const A="Abort connection attempt due to user initiated disconnect";m.log.warn(A,m.logContext),(y=m.abortController)===null||y===void 0||y.abort(A),(C=(S=m.connectFuture)===null||S===void 0?void 0:S.reject)===null||C===void 0||C.call(S,new Ee("Client initiated disconnect",me.Cancelled)),m.connectFuture=void 0}m.engine&&(m.engine.client.isDisconnected||(yield m.engine.client.sendLeave()),yield m.engine.close()),m.handleDisconnect(g,mn.CLIENT_INITIATED),m.engine=void 0}finally{O()}})()})},this.onPageLeave=()=>T(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>T(this,void 0,void 0,function*(){const u=[],d=xt();if(d&&d.os==="iOS"){const p="livekit-dummy-audio-el";let m=document.getElementById(p);if(!m){m=document.createElement("audio"),m.id=p,m.autoplay=!0,m.hidden=!0;const g=_l();g.enabled=!0;const y=new MediaStream([g]);m.srcObject=y,document.addEventListener("visibilitychange",()=>{m&&(m.srcObject=document.hidden?null:y,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(m),this.once(Q.Disconnected,()=>{m?.remove(),m=null})}u.push(m)}this.remoteParticipants.forEach(p=>{p.audioTrackPublications.forEach(m=>{m.track&&m.track.attachedElements.forEach(g=>{u.push(g)})})});try{yield Promise.all([this.acquireAudioContext(),...u.map(p=>(p.muted=!1,p.play()))]),this.handleAudioPlaybackStarted()}catch(p){throw this.handleAudioPlaybackFailed(p),p}}),this.startVideo=()=>T(this,void 0,void 0,function*(){const u=[];for(const d of this.remoteParticipants.values())d.videoTrackPublications.forEach(p=>{var m;(m=p.track)===null||m===void 0||m.attachedElements.forEach(g=>{u.includes(g)||u.push(g)})});yield Promise.all(u.map(d=>d.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(d=>{d.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const u of this.remoteParticipants.values())this.handleParticipantDisconnected(u.identity,u);this.setAndEmitConnectionState(Ne.Reconnecting)&&this.emit(Q.Reconnecting)},this.handleSignalRestarted=u=>T(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(u.serverRegion),Object.assign(Object.assign({},this.logContext),{region:u.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(u);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(d){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:d}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:u.serverRegion}))}catch{return}this.setAndEmitConnectionState(Ne.Connected),this.emit(Q.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=u=>{u.forEach(d=>{var p;if(d.identity===this.localParticipant.identity){this.localParticipant.updateInfo(d);return}d.identity===""&&(d.identity=(p=this.sidToIdentity.get(d.sid))!==null&&p!==void 0?p:"");let m=this.remoteParticipants.get(d.identity);d.state===va.DISCONNECTED?this.handleParticipantDisconnected(d.identity,m):m=this.getOrCreateParticipant(d.identity,d)})},this.handleActiveSpeakersUpdate=u=>{const d=[],p={};u.forEach(m=>{if(p[m.sid]=!0,m.sid===this.localParticipant.sid)this.localParticipant.audioLevel=m.level,this.localParticipant.setIsSpeaking(!0),d.push(this.localParticipant);else{const g=this.getRemoteParticipantBySid(m.sid);g&&(g.audioLevel=m.level,g.setIsSpeaking(!0),d.push(g))}}),p[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(m=>{p[m.sid]||(m.audioLevel=0,m.setIsSpeaking(!1))}),this.activeSpeakers=d,this.emitWhenConnected(Q.ActiveSpeakersChanged,d)},this.handleSpeakersChanged=u=>{const d=new Map;this.activeSpeakers.forEach(m=>{const g=this.remoteParticipants.get(m.identity);g&&g.sid!==m.sid||d.set(m.sid,m)}),u.forEach(m=>{let g=this.getRemoteParticipantBySid(m.sid);m.sid===this.localParticipant.sid&&(g=this.localParticipant),g&&(g.audioLevel=m.level,g.setIsSpeaking(m.active),m.active?d.set(m.sid,g):d.delete(m.sid))});const p=Array.from(d.values());p.sort((m,g)=>g.audioLevel-m.audioLevel),this.activeSpeakers=p,this.emitWhenConnected(Q.ActiveSpeakersChanged,p)},this.handleStreamStateUpdate=u=>{u.streamStates.forEach(d=>{const p=this.getRemoteParticipantBySid(d.participantSid);if(!p)return;const m=p.getTrackPublicationBySid(d.trackSid);if(!m||!m.track)return;const g=H.streamStateFromProto(d.state);m.track.setStreamState(g),g!==m.track.streamState&&(p.emit(W.TrackStreamStateChanged,m,m.track.streamState),this.emitWhenConnected(Q.TrackStreamStateChanged,m,m.track.streamState,p))})},this.handleSubscriptionPermissionUpdate=u=>{const d=this.getRemoteParticipantBySid(u.participantSid);if(!d)return;const p=d.getTrackPublicationBySid(u.trackSid);p&&p.setAllowed(u.allowed)},this.handleSubscriptionError=u=>{const d=Array.from(this.remoteParticipants.values()).find(m=>m.trackPublications.has(u.trackSid));if(!d)return;const p=d.getTrackPublicationBySid(u.trackSid);p&&p.setSubscriptionError(u.err)},this.handleDataPacket=(u,d)=>{const p=this.remoteParticipants.get(u.participantIdentity);if(u.value.case==="user")this.handleUserPacket(p,u.value.value,u.kind,d);else if(u.value.case==="transcription")this.handleTranscription(p,u.value.value);else if(u.value.case==="sipDtmf")this.handleSipDtmf(p,u.value.value);else if(u.value.case==="chatMessage")this.handleChatMessage(p,u.value.value);else if(u.value.case==="metrics")this.handleMetrics(u.value.value,p);else if(u.value.case==="streamHeader"||u.value.case==="streamChunk"||u.value.case==="streamTrailer")this.handleDataStream(u,d);else if(u.value.case==="rpcRequest"){const m=u.value.value;this.handleIncomingRpcRequest(u.participantIdentity,m.id,m.method,m.payload,m.responseTimeoutMs,m.version)}},this.handleUserPacket=(u,d,p,m)=>{this.emit(Q.DataReceived,d.payload,u,p,d.topic,m),u?.emit(W.DataReceived,d.payload,p,m)},this.handleSipDtmf=(u,d)=>{this.emit(Q.SipDTMFReceived,d,u),u?.emit(W.SipDTMFReceived,d)},this.handleTranscription=(u,d)=>{const p=d.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(d.transcribedParticipantIdentity),m=p?.trackPublications.get(d.trackId),g=dT(d,this.transcriptionReceivedTimes);m?.emit(J.TranscriptionReceived,g),p?.emit(W.TranscriptionReceived,g,m),this.emit(Q.TranscriptionReceived,g,p,m)},this.handleChatMessage=(u,d)=>{const p=fT(d);this.emit(Q.ChatMessage,p,u)},this.handleMetrics=(u,d)=>{this.emit(Q.MetricsReceived,u,d)},this.handleDataStream=(u,d)=>{this.incomingDataStreamManager.handleDataStreamPacket(u,d)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(Q.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=u=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:u})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(Q.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(Q.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(Q.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>T(this,void 0,void 0,function*(){var u;((u=xt())===null||u===void 0?void 0:u.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(Q.MediaDevicesChanged)}),this.handleRoomUpdate=u=>{const d=this.roomInfo;this.roomInfo=u,d&&d.metadata!==u.metadata&&this.emitWhenConnected(Q.RoomMetadataChanged,u.metadata),d?.activeRecording!==u.activeRecording&&this.emitWhenConnected(Q.RecordingStatusChanged,u.activeRecording)},this.handleConnectionQualityUpdate=u=>{u.updates.forEach(d=>{if(d.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(d.quality);return}const p=this.getRemoteParticipantBySid(d.participantSid);p&&p.setConnectionQuality(d.quality)})},this.onLocalParticipantMetadataChanged=u=>{this.emit(Q.ParticipantMetadataChanged,u,this.localParticipant)},this.onLocalParticipantNameChanged=u=>{this.emit(Q.ParticipantNameChanged,u,this.localParticipant)},this.onLocalAttributesChanged=u=>{this.emit(Q.ParticipantAttributesChanged,u,this.localParticipant)},this.onLocalTrackMuted=u=>{this.emit(Q.TrackMuted,u,this.localParticipant)},this.onLocalTrackUnmuted=u=>{this.emit(Q.TrackUnmuted,u,this.localParticipant)},this.onTrackProcessorUpdate=u=>{var d;(d=u?.onPublish)===null||d===void 0||d.call(u,this)},this.onLocalTrackPublished=u=>T(this,void 0,void 0,function*(){var d,p,m,g,y,S;(d=u.track)===null||d===void 0||d.on(J.TrackProcessorUpdate,this.onTrackProcessorUpdate),(p=u.track)===null||p===void 0||p.on(J.Restarted,this.onLocalTrackRestarted),(y=(g=(m=u.track)===null||m===void 0?void 0:m.getProcessor())===null||g===void 0?void 0:g.onPublish)===null||y===void 0||y.call(g,this),this.emit(Q.LocalTrackPublished,u,this.localParticipant),zn(u.track)&&(yield u.track.checkForSilence())&&this.emit(Q.LocalAudioSilenceDetected,u);const C=yield(S=u.track)===null||S===void 0?void 0:S.getDeviceId(!1),O=wl(u.source);O&&C&&C!==this.localParticipant.activeDeviceMap.get(O)&&(this.localParticipant.activeDeviceMap.set(O,C),this.emit(Q.ActiveDeviceChanged,O,C))}),this.onLocalTrackUnpublished=u=>{var d,p;(d=u.track)===null||d===void 0||d.off(J.TrackProcessorUpdate,this.onTrackProcessorUpdate),(p=u.track)===null||p===void 0||p.off(J.Restarted,this.onLocalTrackRestarted),this.emit(Q.LocalTrackUnpublished,u,this.localParticipant)},this.onLocalTrackRestarted=u=>T(this,void 0,void 0,function*(){const d=yield u.getDeviceId(!1),p=wl(u.source);p&&d&&d!==this.localParticipant.activeDeviceMap.get(p)&&(this.log.debug("local track restarted, setting ".concat(p," ").concat(d," active"),this.logContext),this.localParticipant.activeDeviceMap.set(p,d),this.emit(Q.ActiveDeviceChanged,p,d))}),this.onLocalConnectionQualityChanged=u=>{this.emit(Q.ConnectionQualityChanged,u,this.localParticipant)},this.onMediaDevicesError=(u,d)=>{this.emit(Q.MediaDevicesError,u,d)},this.onLocalParticipantPermissionsChanged=u=>{this.emit(Q.ParticipantPermissionsChanged,u,this.localParticipant)},this.onLocalChatMessageSent=u=>{this.emit(Q.ChatMessage,u,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},KT),t),this.log=Ln((a=this.options.loggerName)!==null&&a!==void 0?a:gn.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},tp),t?.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},np),t?.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},GT),t?.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new SC,this.outgoingDataStreamManager=new kC(this.engine,this.log),this.disconnectLock=new Rt,this.localParticipant=new MC("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",fi(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",fi(this.options.audioCaptureDefaults.deviceId)),!((o=this.options.audioOutput)===null||o===void 0)&&o.deviceId&&this.switchActiveDevice("audiooutput",fi(this.options.audioOutput.deviceId)).catch(u=>this.log.warn("Could not set audio output: ".concat(u.message),this.logContext)),Pt()){const u=new AbortController;(l=navigator.mediaDevices)===null||l===void 0||l.addEventListener("devicechange",this.handleDeviceChange,{signal:u.signal}),Aa.cleanupRegistry&&Aa.cleanupRegistry.register(this,()=>{u.abort()})}}registerTextStreamHandler(t,i){return this.incomingDataStreamManager.registerTextStreamHandler(t,i)}unregisterTextStreamHandler(t){return this.incomingDataStreamManager.unregisterTextStreamHandler(t)}registerByteStreamHandler(t,i){return this.incomingDataStreamManager.registerByteStreamHandler(t,i)}unregisterByteStreamHandler(t){return this.incomingDataStreamManager.unregisterByteStreamHandler(t)}registerRpcMethod(t,i){if(this.rpcHandlers.has(t))throw Error("RPC handler already registered for method ".concat(t,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(t,i)}unregisterRpcMethod(t){this.rpcHandlers.delete(t)}setE2EEEnabled(t){return T(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(t)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(t,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var t;const i=!!this.options.encryption,a=this.options.encryption||this.options.e2ee;a&&("e2eeManager"in a?(this.e2eeManager=a.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=i):this.e2eeManager=new ET(a,i),this.e2eeManager.on(di.ParticipantEncryptionStatusChanged,(o,l)=>{mT(l)&&(this.isE2EEEnabled=o),this.emit(Q.ParticipantEncryptionStatusChanged,o,l)}),this.e2eeManager.on(di.EncryptionError,(o,l)=>{const u=l?this.getParticipantByIdentity(l):void 0;this.emit(Q.EncryptionError,o,u)}),(t=this.e2eeManager)===null||t===void 0||t.setup(this))}get logContext(){var t;return{room:this.name,roomID:(t=this.roomInfo)===null||t===void 0?void 0:t.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var t,i;return(i=(t=this.roomInfo)===null||t===void 0?void 0:t.activeRecording)!==null&&i!==void 0?i:!1}getSid(){return T(this,void 0,void 0,function*(){return this.state===Ne.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((t,i)=>{const a=o=>{o.sid!==""&&(this.engine.off(Z.RoomUpdate,a),t(o.sid))};this.engine.on(Z.RoomUpdate,a),this.once(Q.Disconnected,()=>{this.engine.off(Z.RoomUpdate,a),i("Room disconnected before room server id was available")})})})}get name(){var t,i;return(i=(t=this.roomInfo)===null||t===void 0?void 0:t.name)!==null&&i!==void 0?i:""}get metadata(){var t;return(t=this.roomInfo)===null||t===void 0?void 0:t.metadata}get numParticipants(){var t,i;return(i=(t=this.roomInfo)===null||t===void 0?void 0:t.numParticipants)!==null&&i!==void 0?i:0}get numPublishers(){var t,i;return(i=(t=this.roomInfo)===null||t===void 0?void 0:t.numPublishers)!==null&&i!==void 0?i:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new gC(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(Z.ParticipantUpdate,this.handleParticipantUpdates).on(Z.RoomUpdate,this.handleRoomUpdate).on(Z.SpeakersChanged,this.handleSpeakersChanged).on(Z.StreamStateChanged,this.handleStreamStateUpdate).on(Z.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(Z.SubscriptionError,this.handleSubscriptionError).on(Z.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(Z.MediaTrackAdded,(t,i,a)=>{this.onTrackAdded(t,i,a)}).on(Z.Disconnected,t=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,t)}).on(Z.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(Z.DataPacketReceived,this.handleDataPacket).on(Z.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Ne.SignalReconnecting)&&this.emit(Q.SignalReconnecting)}).on(Z.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Ne.Connected)&&this.emit(Q.Reconnected)}).on(Z.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Ne.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(Z.Restarting,this.handleRestarting).on(Z.SignalRestarted,this.handleSignalRestarted).on(Z.Offline,()=>{this.setAndEmitConnectionState(Ne.Reconnecting)&&this.emit(Q.Reconnecting)}).on(Z.DCBufferStatusChanged,(t,i)=>{this.emit(Q.DCBufferStatusChanged,t,i)}).on(Z.LocalTrackSubscribed,t=>{const i=this.localParticipant.getTrackPublications().find(a=>{let{trackSid:o}=a;return o===t});if(!i){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(W.LocalTrackSubscribed,i),this.emitWhenConnected(Q.LocalTrackSubscribed,i,this.localParticipant)}).on(Z.RoomMoved,t=>{this.log.debug("room moved",t),t.room&&this.handleRoomUpdate(t.room),this.remoteParticipants.forEach((i,a)=>{this.handleParticipantDisconnected(a,i)}),this.emit(Q.Moved,t.room.name),t.participant?this.handleParticipantUpdates([t.participant,...t.otherParticipants]):this.handleParticipantUpdates(t.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return ht.getInstance().getDevices(t,i)}prepareConnection(t,i){return T(this,void 0,void 0,function*(){if(this.state===Ne.Disconnected){this.log.debug("prepareConnection to ".concat(t),this.logContext);try{if(no(new URL(t))&&i){this.regionUrlProvider=new we(t,i);const a=yield this.regionUrlProvider.getNextBestRegionUrl();a&&this.state===Ne.Disconnected&&(this.regionUrl=a,yield fetch(Ms(a),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(a),this.logContext))}else yield fetch(Ms(t),{method:"HEAD"})}catch(a){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:a}))}}})}getParticipantByIdentity(t){return this.localParticipant.identity===t?this.localParticipant:this.remoteParticipants.get(t)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(t,i){return T(this,void 0,void 0,function*(){let a=()=>T(this,void 0,void 0,function*(){}),o;switch(t){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":o=new _n({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":o=new _n({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":o=new _n({scenario:{case:"serverLeave",value:!0}});break;case"migration":o=new _n({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":a=()=>T(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),o=new _n({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":a=()=>T(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),o=new _n({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":o=new _n({scenario:{case:"switchCandidateProtocol",value:t==="force-tls"?2:1}}),a=()=>T(this,void 0,void 0,function*(){const l=this.engine.client.onLeave;l&&l(new Gr({reason:mn.CLIENT_INITIATED,action:ba.RECONNECT}))});break;case"subscriber-bandwidth":if(i===void 0||typeof i!="number")throw new Error("subscriber-bandwidth requires a number as argument");o=new _n({scenario:{case:"subscriberBandwidth",value:Qi(i)}});break;case"leave-full-reconnect":o=new _n({scenario:{case:"leaveRequestFullReconnect",value:!0}})}o&&(yield this.engine.client.sendSimulateScenario(o),yield a())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(t){return this.localParticipant.activeDeviceMap.get(t)}switchActiveDevice(t,i){return T(this,arguments,void 0,function(a,o){var l=this;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var d,p,m,g,y,S,C;let O=!0,A=!1;const I=u?{exact:o}:o;if(a==="audioinput"){A=l.localParticipant.audioTrackPublications.size===0;const L=(d=l.getActiveDevice(a))!==null&&d!==void 0?d:l.options.audioCaptureDefaults.deviceId;l.options.audioCaptureDefaults.deviceId=I;const X=Array.from(l.localParticipant.audioTrackPublications.values()).filter(D=>D.source===H.Source.Microphone);try{O=(yield Promise.all(X.map(D=>{var x;return(x=D.audioTrack)===null||x===void 0?void 0:x.setDeviceId(I)}))).every(D=>D===!0)}catch(D){throw l.options.audioCaptureDefaults.deviceId=L,D}const K=X.some(D=>{var x,F;return(F=(x=D.track)===null||x===void 0?void 0:x.isMuted)!==null&&F!==void 0?F:!1});O&&K&&(A=!0)}else if(a==="videoinput"){A=l.localParticipant.videoTrackPublications.size===0;const L=(p=l.getActiveDevice(a))!==null&&p!==void 0?p:l.options.videoCaptureDefaults.deviceId;l.options.videoCaptureDefaults.deviceId=I;const X=Array.from(l.localParticipant.videoTrackPublications.values()).filter(D=>D.source===H.Source.Camera);try{O=(yield Promise.all(X.map(D=>{var x;return(x=D.videoTrack)===null||x===void 0?void 0:x.setDeviceId(I)}))).every(D=>D===!0)}catch(D){throw l.options.videoCaptureDefaults.deviceId=L,D}const K=X.some(D=>{var x,F;return(F=(x=D.track)===null||x===void 0?void 0:x.isMuted)!==null&&F!==void 0?F:!1});O&&K&&(A=!0)}else if(a==="audiooutput"){if(A=!0,!Tl()&&!l.options.webAudioMix||l.options.webAudioMix&&l.audioContext&&!("setSinkId"in l.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");l.options.webAudioMix&&(o=(m=yield ht.getInstance().normalizeDeviceId("audiooutput",o))!==null&&m!==void 0?m:""),(g=(C=l.options).audioOutput)!==null&&g!==void 0||(C.audioOutput={});const L=(y=l.getActiveDevice(a))!==null&&y!==void 0?y:l.options.audioOutput.deviceId;l.options.audioOutput.deviceId=o;try{l.options.webAudioMix&&((S=l.audioContext)===null||S===void 0||S.setSinkId(o)),yield Promise.all(Array.from(l.remoteParticipants.values()).map(X=>X.setAudioOutput({deviceId:o})))}catch(X){throw l.options.audioOutput.deviceId=L,X}}return A&&(l.localParticipant.activeDeviceMap.set(a,o),l.emit(Q.ActiveDeviceChanged,a,o)),O})()})}setupLocalParticipantEvents(){this.localParticipant.on(W.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(W.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(W.AttributesChanged,this.onLocalAttributesChanged).on(W.TrackMuted,this.onLocalTrackMuted).on(W.TrackUnmuted,this.onLocalTrackUnmuted).on(W.LocalTrackPublished,this.onLocalTrackPublished).on(W.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(W.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(W.MediaDevicesError,this.onMediaDevicesError).on(W.AudioStreamAcquired,this.startAudio).on(W.ChatMessage,this.onLocalChatMessageSent).on(W.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var t;(t=this.engine)===null||t===void 0||t.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(t,i,a){if(this.state===Ne.Connecting||this.state===Ne.Reconnecting){const y=()=>{this.log.debug("deferring on track for later",{mediaTrackId:t.id,mediaStreamId:i.id,tracksInStream:i.getTracks().map(C=>C.id)}),this.onTrackAdded(t,i,a),S()},S=()=>{this.off(Q.Reconnected,y),this.off(Q.Connected,y),this.off(Q.Disconnected,S)};this.once(Q.Reconnected,y),this.once(Q.Connected,y),this.once(Q.Disconnected,S);return}if(this.state===Ne.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(t.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const o=WS(i.id),l=o[0];let u=o[1],d=t.id;if(u&&u.startsWith("TR")&&(d=u),l===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const p=Array.from(this.remoteParticipants.values()).find(y=>y.sid===l);if(!p){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(l),this.logContext);return}if(!d.startsWith("TR")){const y=this.engine.getTrackIdForReceiver(a);if(!y){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(l),this.logContext);return}d=y}d.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(l,", streamId: ").concat(u,", trackId: ").concat(d),Object.assign(Object.assign({},this.logContext),{rpID:l,streamId:u,trackId:d}));let m;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?m=this.options.adaptiveStream:m={});const g=p.addSubscribedMediaTrack(t,d,i,a,m);g?.isEncrypted&&!this.e2eeManager&&this.emit(Q.EncryptionError,new Error("Encrypted ".concat(g.source," track received from participant ").concat(p.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1?arguments[1]:void 0;var a;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==Ne.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(o=>{o.trackPublications.forEach(l=>{o.unpublishTrack(l.trackSid)})}),this.localParticipant.trackPublications.forEach(o=>{var l,u,d;o.track&&this.localParticipant.unpublishTrack(o.track,t),t?((l=o.track)===null||l===void 0||l.detach(),(u=o.track)===null||u===void 0||u.stop()):(d=o.track)===null||d===void 0||d.stopMonitor()}),this.localParticipant.off(W.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(W.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(W.AttributesChanged,this.onLocalAttributesChanged).off(W.TrackMuted,this.onLocalTrackMuted).off(W.TrackUnmuted,this.onLocalTrackUnmuted).off(W.LocalTrackPublished,this.onLocalTrackPublished).off(W.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(W.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(W.MediaDevicesError,this.onMediaDevicesError).off(W.AudioStreamAcquired,this.startAudio).off(W.ChatMessage,this.onLocalChatMessageSent).off(W.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),Pt()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(a=navigator.mediaDevices)===null||a===void 0||a.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Ne.Disconnected),this.emit(Q.Disconnected,i)}}}handleParticipantDisconnected(t,i){var a;this.remoteParticipants.delete(t),i&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(t),i.trackPublications.forEach(o=>{i.unpublishTrack(o.trackSid,!0)}),this.emit(Q.ParticipantDisconnected,i),i.setDisconnected(),(a=this.localParticipant)===null||a===void 0||a.handleParticipantDisconnected(i.identity))}handleIncomingRpcRequest(t,i,a,o,l,u){return T(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(t,i),u!==1){yield this.engine.publishRpcResponse(t,i,null,Ze.builtIn("UNSUPPORTED_VERSION"));return}const d=this.rpcHandlers.get(a);if(!d){yield this.engine.publishRpcResponse(t,i,null,Ze.builtIn("UNSUPPORTED_METHOD"));return}let p=null,m=null;try{const g=yield d({requestId:i,callerIdentity:t,payload:o,responseTimeout:l});Vl(g)>ap?(p=Ze.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(a))):m=g}catch(g){g instanceof Ze?p=g:(console.warn("Uncaught error returned by RPC handler for ".concat(a,". Returning APPLICATION_ERROR instead."),g),p=Ze.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(t,i,m,p)})}selectDefaultDevices(){return T(this,void 0,void 0,function*(){var t,i,a;const o=ht.getInstance().previousDevices,l=yield ht.getInstance().getDevices(void 0,!1),u=xt();if(u?.name==="Chrome"&&u.os!=="iOS")for(let p of l){const m=o.find(g=>g.deviceId===p.deviceId);m&&m.label!==""&&m.kind===p.kind&&m.label!==p.label&&this.getActiveDevice(p.kind)==="default"&&this.emit(Q.ActiveDeviceChanged,p.kind,p.deviceId)}const d=["audiooutput","audioinput","videoinput"];for(let p of d){const m=vT(p),g=this.localParticipant.getTrackPublication(m);if(g&&(!((t=g.track)===null||t===void 0)&&t.isUserProvided))continue;const y=l.filter(C=>C.kind===p),S=this.getActiveDevice(p);if(S===((i=o.filter(C=>C.kind===p)[0])===null||i===void 0?void 0:i.deviceId)&&y.length>0&&((a=y[0])===null||a===void 0?void 0:a.deviceId)!==S){yield this.switchActiveDevice(p,y[0].deviceId);continue}p==="audioinput"&&!As()||p==="videoinput"||y.length>0&&!y.find(C=>C.deviceId===this.getActiveDevice(p))&&(p!=="audiooutput"||!As())&&(yield this.switchActiveDevice(p,y[0].deviceId))}})}acquireAudioContext(){return T(this,void 0,void 0,function*(){var t,i;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(t=Ml())!==null&&t!==void 0?t:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(o=>o.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),yt(200)])}catch(o){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:o}))}const a=((i=this.audioContext)===null||i===void 0?void 0:i.state)==="running";a!==this.canPlaybackAudio&&(this.audioEnabled=a,this.emit(Q.AudioPlaybackStatusChanged,a))})}createParticipant(t,i){var a;let o;return i?o=co.fromParticipantInfo(this.engine.client,i,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):o=new co(this.engine.client,"",t,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&o.setAudioContext(this.audioContext),!((a=this.options.audioOutput)===null||a===void 0)&&a.deviceId&&o.setAudioOutput(this.options.audioOutput).catch(l=>this.log.warn("Could not set audio output: ".concat(l.message),this.logContext)),o}getOrCreateParticipant(t,i){if(this.remoteParticipants.has(t)){const o=this.remoteParticipants.get(t);return i&&o.updateInfo(i)&&this.sidToIdentity.set(i.sid,i.identity),o}const a=this.createParticipant(t,i);return this.remoteParticipants.set(t,a),this.sidToIdentity.set(i.sid,i.identity),this.emitWhenConnected(Q.ParticipantConnected,a),a.on(W.TrackPublished,o=>{this.emitWhenConnected(Q.TrackPublished,o,a)}).on(W.TrackSubscribed,(o,l)=>{o.kind===H.Kind.Audio?(o.on(J.AudioPlaybackStarted,this.handleAudioPlaybackStarted),o.on(J.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):o.kind===H.Kind.Video&&(o.on(J.VideoPlaybackFailed,this.handleVideoPlaybackFailed),o.on(J.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(Q.TrackSubscribed,o,l,a)}).on(W.TrackUnpublished,o=>{this.emit(Q.TrackUnpublished,o,a)}).on(W.TrackUnsubscribed,(o,l)=>{this.emit(Q.TrackUnsubscribed,o,l,a)}).on(W.TrackMuted,o=>{this.emitWhenConnected(Q.TrackMuted,o,a)}).on(W.TrackUnmuted,o=>{this.emitWhenConnected(Q.TrackUnmuted,o,a)}).on(W.ParticipantMetadataChanged,o=>{this.emitWhenConnected(Q.ParticipantMetadataChanged,o,a)}).on(W.ParticipantNameChanged,o=>{this.emitWhenConnected(Q.ParticipantNameChanged,o,a)}).on(W.AttributesChanged,o=>{this.emitWhenConnected(Q.ParticipantAttributesChanged,o,a)}).on(W.ConnectionQualityChanged,o=>{this.emitWhenConnected(Q.ConnectionQualityChanged,o,a)}).on(W.ParticipantPermissionsChanged,o=>{this.emitWhenConnected(Q.ParticipantPermissionsChanged,o,a)}).on(W.TrackSubscriptionStatusChanged,(o,l)=>{this.emitWhenConnected(Q.TrackSubscriptionStatusChanged,o,l,a)}).on(W.TrackSubscriptionFailed,(o,l)=>{this.emit(Q.TrackSubscriptionFailed,o,a,l)}).on(W.TrackSubscriptionPermissionChanged,(o,l)=>{this.emitWhenConnected(Q.TrackSubscriptionPermissionChanged,o,l,a)}).on(W.Active,()=>{this.emitWhenConnected(Q.ParticipantActive,a),a.kind===Ts.AGENT&&this.localParticipant.setActiveAgent(a)}),i&&a.updateInfo(i),a}sendSyncState(){const t=Array.from(this.remoteParticipants.values()).reduce((a,o)=>(a.push(...o.getTrackPublications()),a),[]),i=this.localParticipant.getTrackPublications();this.engine.sendSyncState(t,i)}updateSubscriptions(){for(const t of this.remoteParticipants.values())for(const i of t.videoTrackPublications.values())i.isSubscribed&&hT(i)&&i.emitTrackUpdate()}getRemoteParticipantBySid(t){const i=this.sidToIdentity.get(t);if(i)return this.remoteParticipants.get(i)}registerConnectionReconcile(){this.clearConnectionReconcile();let t=0;this.connectionReconcileInterval=vt.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(t++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:t,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),t>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,mn.STATE_MISMATCH))):t=0},NC)}clearConnectionReconcile(){this.connectionReconcileInterval&&vt.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(t){return t===this.state?!1:(this.state=t,this.emit(Q.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(t=>{let[i,a]=t;this.emit(i,...a)}),this.bufferedEvents=[]}emitWhenConnected(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];if(this.state===Ne.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([t,a]);else if(this.state===Ne.Connected)return this.emit(t,...a);return!1}simulateParticipants(t){return T(this,void 0,void 0,function*(){var i,a;const o=Object.assign({audio:!0,video:!0,useRealTracks:!1},t.publish),l=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},t.participants);if(this.handleDisconnect(),this.roomInfo=new Lr({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:Ke.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Hi({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(Q.SignalConnected),this.emit(Q.Connected),this.setAndEmitConnectionState(Ne.Connected),o.video){const u=new Zl(H.Kind.Video,new ya({source:at.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:hn.AUDIO,name:"video-dummy"}),new ro(o.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:Bm(160*((i=l.aspectRatios[0])!==null&&i!==void 0?i:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(u),this.localParticipant.emit(W.LocalTrackPublished,u)}if(o.audio){const u=new Zl(H.Kind.Audio,new ya({source:at.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:hn.AUDIO}),new so(o.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:_l(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(u),this.localParticipant.emit(W.LocalTrackPublished,u)}for(let u=0;u<l.count-1;u+=1){let d=new Hi({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(u),state:va.ACTIVE,tracks:[],joinedAt:Ke.parse(Date.now())});const p=this.getOrCreateParticipant(d.identity,d);if(l.video){const m=Bm(160*((a=l.aspectRatios[u%l.aspectRatios.length])!==null&&a!==void 0?a:1),160,!1,!0),g=new ya({source:at.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:hn.AUDIO});p.addSubscribedMediaTrack(m,g.sid,new MediaStream([m]),new RTCRtpReceiver),d.tracks=[...d.tracks,g]}if(l.audio){const m=_l(),g=new ya({source:at.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:hn.AUDIO});p.addSubscribedMediaTrack(m,g.sid,new MediaStream([m]),new RTCRtpReceiver),d.tracks=[...d.tracks,g]}p.updateInfo(d)}})}emit(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];if(t!==Q.ActiveSpeakersChanged&&t!==Q.TranscriptionReceived){const l=Cp(a).filter(u=>u!==void 0);(t===Q.TrackSubscribed||t===Q.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(t),Object.assign(Object.assign({},this.logContext),{event:t,args:l})),this.log.debug("room event ".concat(t),Object.assign(Object.assign({},this.logContext),{event:t,args:l}))}return super.emit(t,...a)}}Aa.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(r=>{r()});function Cp(r){return r.map(t=>{if(t)return Array.isArray(t)?Cp(t):typeof t=="object"?"logContext"in t?t.logContext:void 0:t})}var bn;(function(r){r[r.IDLE=0]="IDLE",r[r.RUNNING=1]="RUNNING",r[r.SKIPPED=2]="SKIPPED",r[r.SUCCESS=3]="SUCCESS",r[r.FAILED=4]="FAILED"})(bn||(bn={}));class vi extends Rn.EventEmitter{constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=bn.IDLE,this.logs=[],this.options={},this.url=t,this.token=i,this.name=this.constructor.name,this.room=new Aa(a.roomOptions),this.connectOptions=a.connectOptions,this.options=a}run(t){return T(this,void 0,void 0,function*(){if(this.status!==bn.IDLE)throw Error("check is running already");this.setStatus(bn.RUNNING);try{yield this.perform()}catch(i){i instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(i.message):this.appendError(i.message))}return yield this.disconnect(),yield new Promise(i=>setTimeout(i,500)),this.status!==bn.SKIPPED&&this.setStatus(this.isSuccess()?bn.SUCCESS:bn.FAILED),t&&t(),this.getInfo()})}isSuccess(){return!this.logs.some(t=>t.level==="error")}connect(t){return T(this,void 0,void 0,function*(){return this.room.state===Ne.Connected?this.room:(t||(t=this.url),yield this.room.connect(t,this.token,this.connectOptions),this.room)})}disconnect(){return T(this,void 0,void 0,function*(){this.room&&this.room.state!==Ne.Disconnected&&(yield this.room.disconnect(),yield new Promise(t=>setTimeout(t,500)))})}skip(){this.setStatus(bn.SKIPPED)}switchProtocol(t){return T(this,void 0,void 0,function*(){let i=!1,a=!1;if(this.room.on(Q.Reconnecting,()=>{i=!0}),this.room.once(Q.Reconnected,()=>{a=!0}),this.room.simulateScenario("force-".concat(t)),yield new Promise(l=>setTimeout(l,1e3)),!i)return;const o=Date.now()+1e4;for(;Date.now()<o;){if(a)return;yield yt(100)}throw new Error("Could not reconnect using ".concat(t," protocol after 10 seconds"))})}appendMessage(t){this.logs.push({level:"info",message:t}),this.emit("update",this.getInfo())}appendWarning(t){this.logs.push({level:"warning",message:t}),this.emit("update",this.getInfo())}appendError(t){this.logs.push({level:"error",message:t}),this.emit("update",this.getInfo())}setStatus(t){this.status=t,this.emit("update",this.getInfo())}get engine(){var t;return(t=this.room)===null||t===void 0?void 0:t.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class xC extends vi{get description(){return"Cloud regions"}perform(){return T(this,void 0,void 0,function*(){const t=new we(this.url,this.token);if(!t.isCloud()){this.skip();return}const i=[],a=new Set;for(let l=0;l<3;l++){const u=yield t.getNextBestRegionUrl();if(!u)break;if(a.has(u))continue;a.add(u);const d=yield this.checkCloudRegion(u);this.appendMessage("".concat(d.region," RTT: ").concat(d.rtt,"ms, duration: ").concat(d.duration,"ms")),i.push(d)}i.sort((l,u)=>(l.duration-u.duration)*.5+(l.rtt-u.rtt)*.5);const o=i[0];this.bestStats=o,this.appendMessage("best Cloud region: ".concat(o.region))})}getInfo(){const t=super.getInfo();return t.data=this.bestStats,t}checkCloudRegion(t){return T(this,void 0,void 0,function*(){var i,a;yield this.connect(t),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const o=(i=this.room.serverInfo)===null||i===void 0?void 0:i.region;if(!o)throw new Error("Region not found");const l=yield this.room.localParticipant.streamText({topic:"test"}),u=1e3,p=1e6/u,m="A".repeat(u),g=Date.now();for(let O=0;O<p;O++)yield l.write(m);yield l.close();const y=Date.now(),S=yield(a=this.room.engine.pcManager)===null||a===void 0?void 0:a.publisher.getStats(),C={region:o,rtt:1e4,duration:y-g};return S?.forEach(O=>{O.type==="candidate-pair"&&O.nominated&&(C.rtt=O.currentRoundTripTime*1e3)}),yield this.disconnect(),C})}}const Wl=1e4;class PC extends vi{get description(){return"Connection via UDP vs TCP"}perform(){return T(this,void 0,void 0,function*(){const t=yield this.checkConnectionProtocol("udp"),i=yield this.checkConnectionProtocol("tcp");this.bestStats=t,t.qualityLimitationDurations.bandwidth-i.qualityLimitationDurations.bandwidth>.5||(t.packetsLost-i.packetsLost)/t.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=i):this.appendMessage("best connection quality via udp");const a=this.bestStats;this.appendMessage("upstream bitrate: ".concat((a.bitrateTotal/a.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((a.rttTotal/a.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((a.jitterTotal/a.count*1e3).toFixed(2)," ms")),a.packetsLost>0&&this.appendWarning("packets lost: ".concat((a.packetsLost/a.packetsSent*100).toFixed(2),"%")),a.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((a.qualityLimitationDurations.bandwidth/(Wl/1e3)*100).toFixed(2),"%")),a.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((a.qualityLimitationDurations.cpu/(Wl/1e3)*100).toFixed(2),"%"))})}getInfo(){const t=super.getInfo();return t.data=this.bestStats,t}checkConnectionProtocol(t){return T(this,void 0,void 0,function*(){yield this.connect(),t==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const i=document.createElement("canvas");i.width=1280,i.height=720;const a=i.getContext("2d");if(!a)throw new Error("Could not get canvas context");let o=0;const l=()=>{o=(o+1)%360,a.fillStyle="hsl(".concat(o,", 100%, 50%)"),a.fillRect(0,0,i.width,i.height),requestAnimationFrame(l)};l();const d=i.captureStream(30).getVideoTracks()[0],m=(yield this.room.localParticipant.publishTrack(d,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,g={protocol:t,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},y=setInterval(()=>T(this,void 0,void 0,function*(){const S=yield m.getRTCStatsReport();S?.forEach(C=>{C.type==="outbound-rtp"?(g.packetsSent=C.packetsSent,g.qualityLimitationDurations=C.qualityLimitationDurations,g.bitrateTotal+=C.targetBitrate,g.count++):C.type==="remote-inbound-rtp"&&(g.packetsLost=C.packetsLost,g.rttTotal+=C.roundTripTime,g.jitterTotal+=C.jitter)})}),1e3);return yield new Promise(S=>setTimeout(S,Wl)),clearInterval(y),d.stop(),i.remove(),yield this.disconnect(),g})}}class UC extends vi{get description(){return"Can publish audio"}perform(){return T(this,void 0,void 0,function*(){var t;const i=yield this.connect(),a=yield OC();if(yield qm(a,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),i.localParticipant.publishTrack(a),yield new Promise(d=>setTimeout(d,3e3));const l=yield(t=a.sender)===null||t===void 0?void 0:t.getStats();if(!l)throw new Error("Could not get RTCStats");let u=0;if(l.forEach(d=>{d.type==="outbound-rtp"&&(d.kind==="audio"||!d.kind&&d.mediaType==="audio")&&(u=d.packetsSent)}),u===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(u," audio packets"))})}}class LC extends vi{get description(){return"Can publish video"}perform(){return T(this,void 0,void 0,function*(){var t;const i=yield this.connect(),a=yield RC();yield this.checkForVideo(a.mediaStreamTrack),i.localParticipant.publishTrack(a),yield new Promise(u=>setTimeout(u,5e3));const o=yield(t=a.sender)===null||t===void 0?void 0:t.getStats();if(!o)throw new Error("Could not get RTCStats");let l=0;if(o.forEach(u=>{u.type==="outbound-rtp"&&(u.kind==="video"||!u.kind&&u.mediaType==="video")&&(l+=u.packetsSent)}),l===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(l," video packets"))})}checkForVideo(t){return T(this,void 0,void 0,function*(){const i=new MediaStream;i.addTrack(t.clone());const a=document.createElement("video");a.srcObject=i,a.muted=!0,a.autoplay=!0,a.playsInline=!0,a.setAttribute("playsinline","true"),document.body.appendChild(a),yield new Promise(o=>{a.onplay=()=>{setTimeout(()=>{var l,u,d,p;const m=document.createElement("canvas"),g=t.getSettings(),y=(u=(l=g.width)!==null&&l!==void 0?l:a.videoWidth)!==null&&u!==void 0?u:1280,S=(p=(d=g.height)!==null&&d!==void 0?d:a.videoHeight)!==null&&p!==void 0?p:720;m.width=y,m.height=S;const C=m.getContext("2d");C.drawImage(a,0,0);const A=C.getImageData(0,0,m.width,m.height).data;let I=!0;for(let L=0;L<A.length;L+=4)if(A[L]!==0||A[L+1]!==0||A[L+2]!==0){I=!1;break}I?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),o()},1e3)},a.play()}),i.getTracks().forEach(o=>o.stop()),a.remove()})}}class IC extends vi{get description(){return"Resuming connection after interruption"}perform(){return T(this,void 0,void 0,function*(){var t;const i=yield this.connect();let a=!1,o=!1,l;const u=new Promise(m=>{setTimeout(m,5e3),l=m}),d=()=>{a=!0};i.on(Q.SignalReconnecting,d).on(Q.Reconnecting,d).on(Q.Reconnected,()=>{o=!0,l(!0)}),(t=i.engine.client.ws)===null||t===void 0||t.close();const p=i.engine.client.onClose;if(p&&p(""),yield u,a){if(!o||i.state!==Ne.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class BC extends vi{get description(){return"Can connect via TURN"}perform(){return T(this,void 0,void 0,function*(){var t,i;const a=new xl,o=yield a.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});let l=!1,u=!1,d=!1;for(let p of o.iceServers)for(let m of p.urls)m.startsWith("turn:")?(u=!0,d=!0):m.startsWith("turns:")&&(u=!0,d=!0,l=!0),m.startsWith("stun:")&&(d=!0);d?u&&!l&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield a.close(),!((i=(t=this.connectOptions)===null||t===void 0?void 0:t.rtcConfig)===null||i===void 0)&&i.iceServers||u?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(p=>setTimeout(p,0)))})}}class jC extends vi{get description(){return"Establishing WebRTC connection"}perform(){return T(this,void 0,void 0,function*(){let t=!1,i=!1;this.room.on(Q.SignalConnected,()=>{var a;const o=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(l,u)=>{if(l.candidate){const d=new RTCIceCandidate(l);let p="".concat(d.protocol," ").concat(d.address,":").concat(d.port," ").concat(d.type);d.address&&(zC(d.address)?p+=" (private)":d.protocol==="tcp"&&d.tcpType==="passive"?(t=!0,p+=" (passive)"):d.protocol==="udp"&&(i=!0)),this.appendMessage(p)}o&&o(l,u)},!((a=this.room.engine.pcManager)===null||a===void 0)&&a.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=l=>{l instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(l.errorCode," ").concat(l.errorText," ").concat(l.url))})});try{yield this.connect(),ge.info("now the room is connected")}catch(a){throw this.appendWarning("ports need to be open on firewall in order to connect."),a}t||this.appendWarning("Server is not configured for ICE/TCP"),i||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function zC(r){const t=r.split(".");if(t.length===4){if(t[0]==="10")return!0;if(t[0]==="192"&&t[1]==="168")return!0;if(t[0]==="172"){const i=parseInt(t[1],10);if(i>=16&&i<=31)return!0}}return!1}class qC extends vi{get description(){return"Connecting to signal connection via WebSocket"}perform(){return T(this,void 0,void 0,function*(){var t,i,a;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let o=new xl;const l=yield o.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});this.appendMessage("Connected to server, version ".concat(l.serverVersion,".")),((t=l.serverInfo)===null||t===void 0?void 0:t.edition)===vh.Cloud&&(!((i=l.serverInfo)===null||i===void 0)&&i.region)&&this.appendMessage("LiveKit Cloud: ".concat((a=l.serverInfo)===null||a===void 0?void 0:a.region)),yield o.close()})}}class x_ extends Rn.EventEmitter{constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=t,this.token=i,this.options=a}getNextCheckId(){const t=this.checkResults.size;return this.checkResults.set(t,{logs:[],status:bn.IDLE,name:"",description:""}),t}updateCheck(t,i){this.checkResults.set(t,i),this.emit("checkUpdate",t,i)}isSuccess(){return Array.from(this.checkResults.values()).every(t=>t.status!==bn.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(t){return T(this,void 0,void 0,function*(){const i=this.getNextCheckId(),a=new t(this.url,this.token,this.options),o=u=>{this.updateCheck(i,u)};a.on("update",o);const l=yield a.run();return a.off("update",o),l})}checkWebsocket(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(qC)})}checkWebRTC(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(jC)})}checkTURN(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(BC)})}checkReconnect(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(IC)})}checkPublishAudio(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(UC)})}checkPublishVideo(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(LC)})}checkConnectionProtocol(){return T(this,void 0,void 0,function*(){const t=yield this.createAndRunCheck(PC);if(t.data&&"protocol"in t.data){const i=t.data;this.options.protocol=i.protocol}return t})}checkCloudRegion(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(xC)})}}function Te(r,t,i){return(t=FC(t))in r?Object.defineProperty(r,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[t]=i,r}function VC(r,t){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var a=i.call(r,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function FC(r){var t=VC(r,"string");return typeof t=="symbol"?t:t+""}new TextEncoder,new TextDecoder;class Dt extends Error{constructor(t,i){var a;super(t,i),Te(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(a=Error.captureStackTrace)===null||a===void 0||a.call(Error,this,this.constructor)}}Te(Dt,"code","ERR_JOSE_GENERIC");class HC extends Dt{constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(t,{cause:{claim:a,reason:o,payload:i}}),Te(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),Te(this,"claim",void 0),Te(this,"reason",void 0),Te(this,"payload",void 0),this.claim=a,this.reason=o,this.payload=i}}Te(HC,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class GC extends Dt{constructor(t,i){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(t,{cause:{claim:a,reason:o,payload:i}}),Te(this,"code","ERR_JWT_EXPIRED"),Te(this,"claim",void 0),Te(this,"reason",void 0),Te(this,"payload",void 0),this.claim=a,this.reason=o,this.payload=i}}Te(GC,"code","ERR_JWT_EXPIRED");class KC extends Dt{constructor(){super(...arguments),Te(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}Te(KC,"code","ERR_JOSE_ALG_NOT_ALLOWED");class YC extends Dt{constructor(){super(...arguments),Te(this,"code","ERR_JOSE_NOT_SUPPORTED")}}Te(YC,"code","ERR_JOSE_NOT_SUPPORTED");class QC extends Dt{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",i=arguments.length>1?arguments[1]:void 0;super(t,i),Te(this,"code","ERR_JWE_DECRYPTION_FAILED")}}Te(QC,"code","ERR_JWE_DECRYPTION_FAILED");class JC extends Dt{constructor(){super(...arguments),Te(this,"code","ERR_JWE_INVALID")}}Te(JC,"code","ERR_JWE_INVALID");class XC extends Dt{constructor(){super(...arguments),Te(this,"code","ERR_JWS_INVALID")}}Te(XC,"code","ERR_JWS_INVALID");class ZC extends Dt{constructor(){super(...arguments),Te(this,"code","ERR_JWT_INVALID")}}Te(ZC,"code","ERR_JWT_INVALID");class WC extends Dt{constructor(){super(...arguments),Te(this,"code","ERR_JWK_INVALID")}}Te(WC,"code","ERR_JWK_INVALID");class $C extends Dt{constructor(){super(...arguments),Te(this,"code","ERR_JWKS_INVALID")}}Te($C,"code","ERR_JWKS_INVALID");class ek extends Dt{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",i=arguments.length>1?arguments[1]:void 0;super(t,i),Te(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}Te(ek,"code","ERR_JWKS_NO_MATCHING_KEY");class tk extends Dt{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",i=arguments.length>1?arguments[1]:void 0;super(t,i),Te(this,Symbol.asyncIterator,void 0),Te(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}Te(tk,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class nk extends Dt{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",i=arguments.length>1?arguments[1]:void 0;super(t,i),Te(this,"code","ERR_JWKS_TIMEOUT")}}Te(nk,"code","ERR_JWKS_TIMEOUT");class ik extends Dt{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",i=arguments.length>1?arguments[1]:void 0;super(t,i),Te(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}Te(ik,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function $l(r,t){return $l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,a){return i.__proto__=a,i},$l(r,t)}var ak=new TextDecoder,sk=(function(r){var t,i;function a(){var l;return(l=r.call(this)||this).room=void 0,l.connected=!1,l.isAgentTalking=!1,l.analyzerComponent=void 0,l.captureAudioFrame=void 0,l}i=r,(t=a).prototype=Object.create(i.prototype),t.prototype.constructor=t,$l(t,i);var o=a.prototype;return o.startCall=function(l){try{var u=this,d=(function(p,m){try{var g=(u.room=new Aa({audioCaptureDefaults:{autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,channelCount:1,deviceId:l.captureDeviceId,sampleRate:l.sampleRate},audioOutput:{deviceId:l.playbackDeviceId}}),u.handleRoomEvents(),u.handleAudioEvents(l),u.handleDataEvents(),Promise.resolve(u.room.connect("wss://retell-ai-4ihahnq7.livekit.cloud",l.accessToken)).then(function(){console.log("connected to room",u.room.name),u.room.localParticipant.setMicrophoneEnabled(!0),u.connected=!0,u.emit("call_started")}))}catch(y){return m(y)}return g&&g.then?g.then(void 0,m):g})(0,function(p){u.emit("error","Error starting call"),console.error("Error starting call",p),u.stopCall()});return Promise.resolve(d&&d.then?d.then(function(){}):void 0)}catch(p){return Promise.reject(p)}},o.startAudioPlayback=function(){try{return Promise.resolve(this.room.startAudio()).then(function(){})}catch(l){return Promise.reject(l)}},o.stopCall=function(){var l;this.connected&&(this.connected=!1,this.emit("call_ended"),(l=this.room)==null||l.disconnect(),this.isAgentTalking=!1,delete this.room,this.analyzerComponent&&(this.analyzerComponent.cleanup(),delete this.analyzerComponent),this.captureAudioFrame&&(window.cancelAnimationFrame(this.captureAudioFrame),delete this.captureAudioFrame))},o.mute=function(){this.connected&&this.room.localParticipant.setMicrophoneEnabled(!1)},o.unmute=function(){this.connected&&this.room.localParticipant.setMicrophoneEnabled(!0)},o.captureAudioSamples=function(){var l=this;if(this.connected&&this.analyzerComponent){var u=new Float32Array(this.analyzerComponent.analyser.fftSize);this.analyzerComponent.analyser.getFloatTimeDomainData(u),this.emit("audio",u),this.captureAudioFrame=window.requestAnimationFrame(function(){return l.captureAudioSamples()})}},o.handleRoomEvents=function(){var l=this;this.room.on(Q.ParticipantDisconnected,function(u){u?.identity==="server"&&setTimeout(function(){l.stopCall()},500)}),this.room.on(Q.Disconnected,function(){l.stopCall()})},o.handleAudioEvents=function(l){var u=this;this.room.on(Q.TrackSubscribed,function(d,p,m){d.kind===H.Kind.Audio&&d instanceof Sp&&(p.trackName==="agent_audio"&&(u.emit("call_ready"),l.emitRawAudioSamples&&(u.analyzerComponent=cT(d),u.captureAudioFrame=window.requestAnimationFrame(function(){return u.captureAudioSamples()}))),d.attach())})},o.handleDataEvents=function(){var l=this;this.room.on(Q.DataReceived,function(u,d,p,m){try{if(d?.identity!=="server")return;var g=ak.decode(u),y=JSON.parse(g);y.event_type==="update"?l.emit("update",y):y.event_type==="metadata"?l.emit("metadata",y):y.event_type==="agent_start_talking"?(l.isAgentTalking=!0,l.emit("agent_start_talking")):y.event_type==="agent_stop_talking"?(l.isAgentTalking=!1,l.emit("agent_stop_talking")):y.event_type==="node_transition"&&l.emit("node_transition",y)}catch(S){console.error("Error decoding data received",S)}})},a})(jy);const rk="agent_2034688a89f57be5fc28e263f1",ok=()=>{const[r,t]=ma.useState(!1),[i,a]=ma.useState(null),[o,l]=ma.useState(null);ma.useEffect(()=>{const p=new sk;return a(p),p.on("call_started",()=>{console.log("Call started"),t(!0)}),p.on("call_ended",()=>{console.log("Call ended"),t(!1),l(null)}),p.on("error",m=>{console.error("Retell error:",m),t(!1),l(null)}),()=>{p.stopCall()}},[]),ma.useEffect(()=>{if(!r||!o)return;const p=setInterval(async()=>{try{const g=await(await fetch(`/api/retell/commands?call_id=${o}`)).json();g.commands&&g.commands.length>0&&g.commands.forEach(y=>{switch(console.log("Executing command:",y),y.type){case"NAVIGATE":window.location.href=y.payload;break;case"PREFILL_FORM":console.log("Pre-filling form with:",y.payload),alert(`[DEMO] Pre-filling form: ${JSON.stringify(y.payload)}`);break;case"UPDATE_CART":console.log("Updating cart:",y.payload),alert(`[DEMO] Cart updated: ${JSON.stringify(y.payload)}`);break}})}catch(m){console.error("Error polling commands:",m)}},1e3);return()=>clearInterval(p)},[r,o]);const u=async()=>{if(console.log("Start Call clicked"),!i){console.error("Retell client not initialized");return}try{console.log("Fetching access token...");const m=await fetch("https://milestone-trucks-chat.vercel.app/api/retell/register-call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({agent_id:rk})});if(!m.ok){const y=await m.text();throw console.error("Failed to get access token:",m.status,y),new Error(`Failed to get access token: ${m.status}`)}const g=await m.json();console.log("Access token received:",g),g.call_id&&l(g.call_id),console.log("Starting call with Retell SDK..."),await i.startCall({accessToken:g.access_token}),console.log("Call started successfully")}catch(p){console.error("Failed to start call:",p),alert("Failed to start call. Check console for details.")}},d=()=>{i&&i.stopCall()};return kn.jsx("div",{className:"fixed bottom-4 right-4 z-[9999]",children:r?kn.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-xl border border-gray-200 flex flex-col items-center gap-4",children:[kn.jsxs("div",{className:"flex items-center gap-2 text-green-600 font-semibold animate-pulse",children:[kn.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),"Live Call Active"]}),kn.jsx("button",{onClick:d,className:"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-full transition-colors w-full",children:"End Call"})]}):kn.jsxs("button",{onClick:u,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all transform hover:scale-105 flex items-center gap-2",children:[kn.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:kn.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z"})}),"Talk to Us"]})})},kp="retell-chatbot-root";function Ep(){let r=document.getElementById(kp);r||(r=document.createElement("div"),r.id=kp,document.body.appendChild(r)),Ly.createRoot(r).render(kn.jsx(Dy.StrictMode,{children:kn.jsx(ok,{})}))}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Ep):Ep())}));
